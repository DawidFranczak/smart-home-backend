var Xg=n=>{throw TypeError(n)};var Dc=(n,e,t)=>e.has(n)||Xg("Cannot "+t);var w=(n,e,t)=>(Dc(n,e,"read from private field"),t?t.call(n):e.get(n)),ue=(n,e,t)=>e.has(n)?Xg("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(n):e.set(n,t),J=(n,e,t,r)=>(Dc(n,e,"write to private field"),r?r.call(n,t):e.set(n,t),t),ve=(n,e,t)=>(Dc(n,e,"access private method"),t);var il=(n,e,t,r)=>({set _(i){J(n,e,i,t)},get _(){return w(n,e,r)}});function Ry(n,e){for(var t=0;t<e.length;t++){const r=e[t];if(typeof r!="string"&&!Array.isArray(r)){for(const i in r)if(i!=="default"&&!(i in n)){const s=Object.getOwnPropertyDescriptor(r,i);s&&Object.defineProperty(n,i,s.get?s:{enumerable:!0,get:()=>r[i]})}}}return Object.freeze(Object.defineProperty(n,Symbol.toStringTag,{value:"Module"}))}(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))r(i);new MutationObserver(i=>{for(const s of i)if(s.type==="childList")for(const a of s.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&r(a)}).observe(document,{childList:!0,subtree:!0});function t(i){const s={};return i.integrity&&(s.integrity=i.integrity),i.referrerPolicy&&(s.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?s.credentials="include":i.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function r(i){if(i.ep)return;i.ep=!0;const s=t(i);fetch(i.href,s)}})();function _y(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var Iy={exports:{}},Ju={},Dy={exports:{}},xe={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Uo=Symbol.for("react.element"),fT=Symbol.for("react.portal"),gT=Symbol.for("react.fragment"),mT=Symbol.for("react.strict_mode"),pT=Symbol.for("react.profiler"),yT=Symbol.for("react.provider"),vT=Symbol.for("react.context"),ET=Symbol.for("react.forward_ref"),ST=Symbol.for("react.suspense"),xT=Symbol.for("react.memo"),TT=Symbol.for("react.lazy"),Zg=Symbol.iterator;function LT(n){return n===null||typeof n!="object"?null:(n=Zg&&n[Zg]||n["@@iterator"],typeof n=="function"?n:null)}var Cy={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},wy=Object.assign,by={};function ma(n,e,t){this.props=n,this.context=e,this.refs=by,this.updater=t||Cy}ma.prototype.isReactComponent={};ma.prototype.setState=function(n,e){if(typeof n!="object"&&typeof n!="function"&&n!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,n,e,"setState")};ma.prototype.forceUpdate=function(n){this.updater.enqueueForceUpdate(this,n,"forceUpdate")};function ky(){}ky.prototype=ma.prototype;function cf(n,e,t){this.props=n,this.context=e,this.refs=by,this.updater=t||Cy}var df=cf.prototype=new ky;df.constructor=cf;wy(df,ma.prototype);df.isPureReactComponent=!0;var Jg=Array.isArray,Py=Object.prototype.hasOwnProperty,hf={current:null},Oy={key:!0,ref:!0,__self:!0,__source:!0};function Fy(n,e,t){var r,i={},s=null,a=null;if(e!=null)for(r in e.ref!==void 0&&(a=e.ref),e.key!==void 0&&(s=""+e.key),e)Py.call(e,r)&&!Oy.hasOwnProperty(r)&&(i[r]=e[r]);var o=arguments.length-2;if(o===1)i.children=t;else if(1<o){for(var l=Array(o),u=0;u<o;u++)l[u]=arguments[u+2];i.children=l}if(n&&n.defaultProps)for(r in o=n.defaultProps,o)i[r]===void 0&&(i[r]=o[r]);return{$$typeof:Uo,type:n,key:s,ref:a,props:i,_owner:hf.current}}function AT(n,e){return{$$typeof:Uo,type:n.type,key:e,ref:n.ref,props:n.props,_owner:n._owner}}function ff(n){return typeof n=="object"&&n!==null&&n.$$typeof===Uo}function RT(n){var e={"=":"=0",":":"=2"};return"$"+n.replace(/[=:]/g,function(t){return e[t]})}var em=/\/+/g;function Cc(n,e){return typeof n=="object"&&n!==null&&n.key!=null?RT(""+n.key):e.toString(36)}function Vl(n,e,t,r,i){var s=typeof n;(s==="undefined"||s==="boolean")&&(n=null);var a=!1;if(n===null)a=!0;else switch(s){case"string":case"number":a=!0;break;case"object":switch(n.$$typeof){case Uo:case fT:a=!0}}if(a)return a=n,i=i(a),n=r===""?"."+Cc(a,0):r,Jg(i)?(t="",n!=null&&(t=n.replace(em,"$&/")+"/"),Vl(i,e,t,"",function(u){return u})):i!=null&&(ff(i)&&(i=AT(i,t+(!i.key||a&&a.key===i.key?"":(""+i.key).replace(em,"$&/")+"/")+n)),e.push(i)),1;if(a=0,r=r===""?".":r+":",Jg(n))for(var o=0;o<n.length;o++){s=n[o];var l=r+Cc(s,o);a+=Vl(s,e,t,l,i)}else if(l=LT(n),typeof l=="function")for(n=l.call(n),o=0;!(s=n.next()).done;)s=s.value,l=r+Cc(s,o++),a+=Vl(s,e,t,l,i);else if(s==="object")throw e=String(n),Error("Objects are not valid as a React child (found: "+(e==="[object Object]"?"object with keys {"+Object.keys(n).join(", ")+"}":e)+"). If you meant to render a collection of children, use an array instead.");return a}function sl(n,e,t){if(n==null)return n;var r=[],i=0;return Vl(n,r,"","",function(s){return e.call(t,s,i++)}),r}function _T(n){if(n._status===-1){var e=n._result;e=e(),e.then(function(t){(n._status===0||n._status===-1)&&(n._status=1,n._result=t)},function(t){(n._status===0||n._status===-1)&&(n._status=2,n._result=t)}),n._status===-1&&(n._status=0,n._result=e)}if(n._status===1)return n._result.default;throw n._result}var Mt={current:null},Hl={transition:null},IT={ReactCurrentDispatcher:Mt,ReactCurrentBatchConfig:Hl,ReactCurrentOwner:hf};function My(){throw Error("act(...) is not supported in production builds of React.")}xe.Children={map:sl,forEach:function(n,e,t){sl(n,function(){e.apply(this,arguments)},t)},count:function(n){var e=0;return sl(n,function(){e++}),e},toArray:function(n){return sl(n,function(e){return e})||[]},only:function(n){if(!ff(n))throw Error("React.Children.only expected to receive a single React element child.");return n}};xe.Component=ma;xe.Fragment=gT;xe.Profiler=pT;xe.PureComponent=cf;xe.StrictMode=mT;xe.Suspense=ST;xe.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=IT;xe.act=My;xe.cloneElement=function(n,e,t){if(n==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+n+".");var r=wy({},n.props),i=n.key,s=n.ref,a=n._owner;if(e!=null){if(e.ref!==void 0&&(s=e.ref,a=hf.current),e.key!==void 0&&(i=""+e.key),n.type&&n.type.defaultProps)var o=n.type.defaultProps;for(l in e)Py.call(e,l)&&!Oy.hasOwnProperty(l)&&(r[l]=e[l]===void 0&&o!==void 0?o[l]:e[l])}var l=arguments.length-2;if(l===1)r.children=t;else if(1<l){o=Array(l);for(var u=0;u<l;u++)o[u]=arguments[u+2];r.children=o}return{$$typeof:Uo,type:n.type,key:i,ref:s,props:r,_owner:a}};xe.createContext=function(n){return n={$$typeof:vT,_currentValue:n,_currentValue2:n,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},n.Provider={$$typeof:yT,_context:n},n.Consumer=n};xe.createElement=Fy;xe.createFactory=function(n){var e=Fy.bind(null,n);return e.type=n,e};xe.createRef=function(){return{current:null}};xe.forwardRef=function(n){return{$$typeof:ET,render:n}};xe.isValidElement=ff;xe.lazy=function(n){return{$$typeof:TT,_payload:{_status:-1,_result:n},_init:_T}};xe.memo=function(n,e){return{$$typeof:xT,type:n,compare:e===void 0?null:e}};xe.startTransition=function(n){var e=Hl.transition;Hl.transition={};try{n()}finally{Hl.transition=e}};xe.unstable_act=My;xe.useCallback=function(n,e){return Mt.current.useCallback(n,e)};xe.useContext=function(n){return Mt.current.useContext(n)};xe.useDebugValue=function(){};xe.useDeferredValue=function(n){return Mt.current.useDeferredValue(n)};xe.useEffect=function(n,e){return Mt.current.useEffect(n,e)};xe.useId=function(){return Mt.current.useId()};xe.useImperativeHandle=function(n,e,t){return Mt.current.useImperativeHandle(n,e,t)};xe.useInsertionEffect=function(n,e){return Mt.current.useInsertionEffect(n,e)};xe.useLayoutEffect=function(n,e){return Mt.current.useLayoutEffect(n,e)};xe.useMemo=function(n,e){return Mt.current.useMemo(n,e)};xe.useReducer=function(n,e,t){return Mt.current.useReducer(n,e,t)};xe.useRef=function(n){return Mt.current.useRef(n)};xe.useState=function(n){return Mt.current.useState(n)};xe.useSyncExternalStore=function(n,e,t){return Mt.current.useSyncExternalStore(n,e,t)};xe.useTransition=function(){return Mt.current.useTransition()};xe.version="18.3.1";Dy.exports=xe;var b=Dy.exports;const gf=_y(b),DT=Ry({__proto__:null,default:gf},[b]);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var CT=b,wT=Symbol.for("react.element"),bT=Symbol.for("react.fragment"),kT=Object.prototype.hasOwnProperty,PT=CT.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,OT={key:!0,ref:!0,__self:!0,__source:!0};function Ny(n,e,t){var r,i={},s=null,a=null;t!==void 0&&(s=""+t),e.key!==void 0&&(s=""+e.key),e.ref!==void 0&&(a=e.ref);for(r in e)kT.call(e,r)&&!OT.hasOwnProperty(r)&&(i[r]=e[r]);if(n&&n.defaultProps)for(r in e=n.defaultProps,e)i[r]===void 0&&(i[r]=e[r]);return{$$typeof:wT,type:n,key:s,ref:a,props:i,_owner:PT.current}}Ju.Fragment=bT;Ju.jsx=Ny;Ju.jsxs=Ny;Iy.exports=Ju;var L=Iy.exports,Uy={exports:{}},ln={},By={exports:{}},$y={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(n){function e(B,F){var U=B.length;B.push(F);e:for(;0<U;){var Q=U-1>>>1,q=B[Q];if(0<i(q,F))B[Q]=F,B[U]=q,U=Q;else break e}}function t(B){return B.length===0?null:B[0]}function r(B){if(B.length===0)return null;var F=B[0],U=B.pop();if(U!==F){B[0]=U;e:for(var Q=0,q=B.length,oe=q>>>1;Q<oe;){var de=2*(Q+1)-1,pe=B[de],he=de+1,Fe=B[he];if(0>i(pe,U))he<q&&0>i(Fe,pe)?(B[Q]=Fe,B[he]=U,Q=he):(B[Q]=pe,B[de]=U,Q=de);else if(he<q&&0>i(Fe,U))B[Q]=Fe,B[he]=U,Q=he;else break e}}return F}function i(B,F){var U=B.sortIndex-F.sortIndex;return U!==0?U:B.id-F.id}if(typeof performance=="object"&&typeof performance.now=="function"){var s=performance;n.unstable_now=function(){return s.now()}}else{var a=Date,o=a.now();n.unstable_now=function(){return a.now()-o}}var l=[],u=[],c=1,d=null,h=3,f=!1,g=!1,m=!1,y=typeof setTimeout=="function"?setTimeout:null,p=typeof clearTimeout=="function"?clearTimeout:null,v=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function E(B){for(var F=t(u);F!==null;){if(F.callback===null)r(u);else if(F.startTime<=B)r(u),F.sortIndex=F.expirationTime,e(l,F);else break;F=t(u)}}function T(B){if(m=!1,E(B),!g)if(t(l)!==null)g=!0,V(A);else{var F=t(u);F!==null&&X(T,F.startTime-B)}}function A(B,F){g=!1,m&&(m=!1,p(x),x=-1),f=!0;var U=h;try{for(E(F),d=t(l);d!==null&&(!(d.expirationTime>F)||B&&!M());){var Q=d.callback;if(typeof Q=="function"){d.callback=null,h=d.priorityLevel;var q=Q(d.expirationTime<=F);F=n.unstable_now(),typeof q=="function"?d.callback=q:d===t(l)&&r(l),E(F)}else r(l);d=t(l)}if(d!==null)var oe=!0;else{var de=t(u);de!==null&&X(T,de.startTime-F),oe=!1}return oe}finally{d=null,h=U,f=!1}}var I=!1,R=null,x=-1,D=5,_=-1;function M(){return!(n.unstable_now()-_<D)}function j(){if(R!==null){var B=n.unstable_now();_=B;var F=!0;try{F=R(!0,B)}finally{F?z():(I=!1,R=null)}}else I=!1}var z;if(typeof v=="function")z=function(){v(j)};else if(typeof MessageChannel<"u"){var H=new MessageChannel,W=H.port2;H.port1.onmessage=j,z=function(){W.postMessage(null)}}else z=function(){y(j,0)};function V(B){R=B,I||(I=!0,z())}function X(B,F){x=y(function(){B(n.unstable_now())},F)}n.unstable_IdlePriority=5,n.unstable_ImmediatePriority=1,n.unstable_LowPriority=4,n.unstable_NormalPriority=3,n.unstable_Profiling=null,n.unstable_UserBlockingPriority=2,n.unstable_cancelCallback=function(B){B.callback=null},n.unstable_continueExecution=function(){g||f||(g=!0,V(A))},n.unstable_forceFrameRate=function(B){0>B||125<B?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):D=0<B?Math.floor(1e3/B):5},n.unstable_getCurrentPriorityLevel=function(){return h},n.unstable_getFirstCallbackNode=function(){return t(l)},n.unstable_next=function(B){switch(h){case 1:case 2:case 3:var F=3;break;default:F=h}var U=h;h=F;try{return B()}finally{h=U}},n.unstable_pauseExecution=function(){},n.unstable_requestPaint=function(){},n.unstable_runWithPriority=function(B,F){switch(B){case 1:case 2:case 3:case 4:case 5:break;default:B=3}var U=h;h=B;try{return F()}finally{h=U}},n.unstable_scheduleCallback=function(B,F,U){var Q=n.unstable_now();switch(typeof U=="object"&&U!==null?(U=U.delay,U=typeof U=="number"&&0<U?Q+U:Q):U=Q,B){case 1:var q=-1;break;case 2:q=250;break;case 5:q=1073741823;break;case 4:q=1e4;break;default:q=5e3}return q=U+q,B={id:c++,callback:F,priorityLevel:B,startTime:U,expirationTime:q,sortIndex:-1},U>Q?(B.sortIndex=U,e(u,B),t(l)===null&&B===t(u)&&(m?(p(x),x=-1):m=!0,X(T,U-Q))):(B.sortIndex=q,e(l,B),g||f||(g=!0,V(A))),B},n.unstable_shouldYield=M,n.unstable_wrapCallback=function(B){var F=h;return function(){var U=h;h=F;try{return B.apply(this,arguments)}finally{h=U}}}})($y);By.exports=$y;var FT=By.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var MT=b,an=FT;function K(n){for(var e="https://reactjs.org/docs/error-decoder.html?invariant="+n,t=1;t<arguments.length;t++)e+="&args[]="+encodeURIComponent(arguments[t]);return"Minified React error #"+n+"; visit "+e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var jy=new Set,so={};function is(n,e){ia(n,e),ia(n+"Capture",e)}function ia(n,e){for(so[n]=e,n=0;n<e.length;n++)jy.add(e[n])}var Rr=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),Nd=Object.prototype.hasOwnProperty,NT=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,tm={},nm={};function UT(n){return Nd.call(nm,n)?!0:Nd.call(tm,n)?!1:NT.test(n)?nm[n]=!0:(tm[n]=!0,!1)}function BT(n,e,t,r){if(t!==null&&t.type===0)return!1;switch(typeof e){case"function":case"symbol":return!0;case"boolean":return r?!1:t!==null?!t.acceptsBooleans:(n=n.toLowerCase().slice(0,5),n!=="data-"&&n!=="aria-");default:return!1}}function $T(n,e,t,r){if(e===null||typeof e>"u"||BT(n,e,t,r))return!0;if(r)return!1;if(t!==null)switch(t.type){case 3:return!e;case 4:return e===!1;case 5:return isNaN(e);case 6:return isNaN(e)||1>e}return!1}function Nt(n,e,t,r,i,s,a){this.acceptsBooleans=e===2||e===3||e===4,this.attributeName=r,this.attributeNamespace=i,this.mustUseProperty=t,this.propertyName=n,this.type=e,this.sanitizeURL=s,this.removeEmptyString=a}var Lt={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(n){Lt[n]=new Nt(n,0,!1,n,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(n){var e=n[0];Lt[e]=new Nt(e,1,!1,n[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(n){Lt[n]=new Nt(n,2,!1,n.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(n){Lt[n]=new Nt(n,2,!1,n,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(n){Lt[n]=new Nt(n,3,!1,n.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(n){Lt[n]=new Nt(n,3,!0,n,null,!1,!1)});["capture","download"].forEach(function(n){Lt[n]=new Nt(n,4,!1,n,null,!1,!1)});["cols","rows","size","span"].forEach(function(n){Lt[n]=new Nt(n,6,!1,n,null,!1,!1)});["rowSpan","start"].forEach(function(n){Lt[n]=new Nt(n,5,!1,n.toLowerCase(),null,!1,!1)});var mf=/[\-:]([a-z])/g;function pf(n){return n[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(n){var e=n.replace(mf,pf);Lt[e]=new Nt(e,1,!1,n,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(n){var e=n.replace(mf,pf);Lt[e]=new Nt(e,1,!1,n,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(n){var e=n.replace(mf,pf);Lt[e]=new Nt(e,1,!1,n,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(n){Lt[n]=new Nt(n,1,!1,n.toLowerCase(),null,!1,!1)});Lt.xlinkHref=new Nt("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(n){Lt[n]=new Nt(n,1,!1,n.toLowerCase(),null,!0,!0)});function yf(n,e,t,r){var i=Lt.hasOwnProperty(e)?Lt[e]:null;(i!==null?i.type!==0:r||!(2<e.length)||e[0]!=="o"&&e[0]!=="O"||e[1]!=="n"&&e[1]!=="N")&&($T(e,t,i,r)&&(t=null),r||i===null?UT(e)&&(t===null?n.removeAttribute(e):n.setAttribute(e,""+t)):i.mustUseProperty?n[i.propertyName]=t===null?i.type===3?!1:"":t:(e=i.attributeName,r=i.attributeNamespace,t===null?n.removeAttribute(e):(i=i.type,t=i===3||i===4&&t===!0?"":""+t,r?n.setAttributeNS(r,e,t):n.setAttribute(e,t))))}var Cr=MT.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,al=Symbol.for("react.element"),Es=Symbol.for("react.portal"),Ss=Symbol.for("react.fragment"),vf=Symbol.for("react.strict_mode"),Ud=Symbol.for("react.profiler"),Gy=Symbol.for("react.provider"),Ky=Symbol.for("react.context"),Ef=Symbol.for("react.forward_ref"),Bd=Symbol.for("react.suspense"),$d=Symbol.for("react.suspense_list"),Sf=Symbol.for("react.memo"),jr=Symbol.for("react.lazy"),Vy=Symbol.for("react.offscreen"),rm=Symbol.iterator;function Aa(n){return n===null||typeof n!="object"?null:(n=rm&&n[rm]||n["@@iterator"],typeof n=="function"?n:null)}var qe=Object.assign,wc;function Ua(n){if(wc===void 0)try{throw Error()}catch(t){var e=t.stack.trim().match(/\n( *(at )?)/);wc=e&&e[1]||""}return`
`+wc+n}var bc=!1;function kc(n,e){if(!n||bc)return"";bc=!0;var t=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(e)if(e=function(){throw Error()},Object.defineProperty(e.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(e,[])}catch(u){var r=u}Reflect.construct(n,[],e)}else{try{e.call()}catch(u){r=u}n.call(e.prototype)}else{try{throw Error()}catch(u){r=u}n()}}catch(u){if(u&&r&&typeof u.stack=="string"){for(var i=u.stack.split(`
`),s=r.stack.split(`
`),a=i.length-1,o=s.length-1;1<=a&&0<=o&&i[a]!==s[o];)o--;for(;1<=a&&0<=o;a--,o--)if(i[a]!==s[o]){if(a!==1||o!==1)do if(a--,o--,0>o||i[a]!==s[o]){var l=`
`+i[a].replace(" at new "," at ");return n.displayName&&l.includes("<anonymous>")&&(l=l.replace("<anonymous>",n.displayName)),l}while(1<=a&&0<=o);break}}}finally{bc=!1,Error.prepareStackTrace=t}return(n=n?n.displayName||n.name:"")?Ua(n):""}function jT(n){switch(n.tag){case 5:return Ua(n.type);case 16:return Ua("Lazy");case 13:return Ua("Suspense");case 19:return Ua("SuspenseList");case 0:case 2:case 15:return n=kc(n.type,!1),n;case 11:return n=kc(n.type.render,!1),n;case 1:return n=kc(n.type,!0),n;default:return""}}function jd(n){if(n==null)return null;if(typeof n=="function")return n.displayName||n.name||null;if(typeof n=="string")return n;switch(n){case Ss:return"Fragment";case Es:return"Portal";case Ud:return"Profiler";case vf:return"StrictMode";case Bd:return"Suspense";case $d:return"SuspenseList"}if(typeof n=="object")switch(n.$$typeof){case Ky:return(n.displayName||"Context")+".Consumer";case Gy:return(n._context.displayName||"Context")+".Provider";case Ef:var e=n.render;return n=n.displayName,n||(n=e.displayName||e.name||"",n=n!==""?"ForwardRef("+n+")":"ForwardRef"),n;case Sf:return e=n.displayName||null,e!==null?e:jd(n.type)||"Memo";case jr:e=n._payload,n=n._init;try{return jd(n(e))}catch{}}return null}function GT(n){var e=n.type;switch(n.tag){case 24:return"Cache";case 9:return(e.displayName||"Context")+".Consumer";case 10:return(e._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return n=e.render,n=n.displayName||n.name||"",e.displayName||(n!==""?"ForwardRef("+n+")":"ForwardRef");case 7:return"Fragment";case 5:return e;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return jd(e);case 8:return e===vf?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e}return null}function gi(n){switch(typeof n){case"boolean":case"number":case"string":case"undefined":return n;case"object":return n;default:return""}}function Hy(n){var e=n.type;return(n=n.nodeName)&&n.toLowerCase()==="input"&&(e==="checkbox"||e==="radio")}function KT(n){var e=Hy(n)?"checked":"value",t=Object.getOwnPropertyDescriptor(n.constructor.prototype,e),r=""+n[e];if(!n.hasOwnProperty(e)&&typeof t<"u"&&typeof t.get=="function"&&typeof t.set=="function"){var i=t.get,s=t.set;return Object.defineProperty(n,e,{configurable:!0,get:function(){return i.call(this)},set:function(a){r=""+a,s.call(this,a)}}),Object.defineProperty(n,e,{enumerable:t.enumerable}),{getValue:function(){return r},setValue:function(a){r=""+a},stopTracking:function(){n._valueTracker=null,delete n[e]}}}}function ol(n){n._valueTracker||(n._valueTracker=KT(n))}function zy(n){if(!n)return!1;var e=n._valueTracker;if(!e)return!0;var t=e.getValue(),r="";return n&&(r=Hy(n)?n.checked?"true":"false":n.value),n=r,n!==t?(e.setValue(n),!0):!1}function gu(n){if(n=n||(typeof document<"u"?document:void 0),typeof n>"u")return null;try{return n.activeElement||n.body}catch{return n.body}}function Gd(n,e){var t=e.checked;return qe({},e,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:t??n._wrapperState.initialChecked})}function im(n,e){var t=e.defaultValue==null?"":e.defaultValue,r=e.checked!=null?e.checked:e.defaultChecked;t=gi(e.value!=null?e.value:t),n._wrapperState={initialChecked:r,initialValue:t,controlled:e.type==="checkbox"||e.type==="radio"?e.checked!=null:e.value!=null}}function Wy(n,e){e=e.checked,e!=null&&yf(n,"checked",e,!1)}function Kd(n,e){Wy(n,e);var t=gi(e.value),r=e.type;if(t!=null)r==="number"?(t===0&&n.value===""||n.value!=t)&&(n.value=""+t):n.value!==""+t&&(n.value=""+t);else if(r==="submit"||r==="reset"){n.removeAttribute("value");return}e.hasOwnProperty("value")?Vd(n,e.type,t):e.hasOwnProperty("defaultValue")&&Vd(n,e.type,gi(e.defaultValue)),e.checked==null&&e.defaultChecked!=null&&(n.defaultChecked=!!e.defaultChecked)}function sm(n,e,t){if(e.hasOwnProperty("value")||e.hasOwnProperty("defaultValue")){var r=e.type;if(!(r!=="submit"&&r!=="reset"||e.value!==void 0&&e.value!==null))return;e=""+n._wrapperState.initialValue,t||e===n.value||(n.value=e),n.defaultValue=e}t=n.name,t!==""&&(n.name=""),n.defaultChecked=!!n._wrapperState.initialChecked,t!==""&&(n.name=t)}function Vd(n,e,t){(e!=="number"||gu(n.ownerDocument)!==n)&&(t==null?n.defaultValue=""+n._wrapperState.initialValue:n.defaultValue!==""+t&&(n.defaultValue=""+t))}var Ba=Array.isArray;function Fs(n,e,t,r){if(n=n.options,e){e={};for(var i=0;i<t.length;i++)e["$"+t[i]]=!0;for(t=0;t<n.length;t++)i=e.hasOwnProperty("$"+n[t].value),n[t].selected!==i&&(n[t].selected=i),i&&r&&(n[t].defaultSelected=!0)}else{for(t=""+gi(t),e=null,i=0;i<n.length;i++){if(n[i].value===t){n[i].selected=!0,r&&(n[i].defaultSelected=!0);return}e!==null||n[i].disabled||(e=n[i])}e!==null&&(e.selected=!0)}}function Hd(n,e){if(e.dangerouslySetInnerHTML!=null)throw Error(K(91));return qe({},e,{value:void 0,defaultValue:void 0,children:""+n._wrapperState.initialValue})}function am(n,e){var t=e.value;if(t==null){if(t=e.children,e=e.defaultValue,t!=null){if(e!=null)throw Error(K(92));if(Ba(t)){if(1<t.length)throw Error(K(93));t=t[0]}e=t}e==null&&(e=""),t=e}n._wrapperState={initialValue:gi(t)}}function Yy(n,e){var t=gi(e.value),r=gi(e.defaultValue);t!=null&&(t=""+t,t!==n.value&&(n.value=t),e.defaultValue==null&&n.defaultValue!==t&&(n.defaultValue=t)),r!=null&&(n.defaultValue=""+r)}function om(n){var e=n.textContent;e===n._wrapperState.initialValue&&e!==""&&e!==null&&(n.value=e)}function qy(n){switch(n){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function zd(n,e){return n==null||n==="http://www.w3.org/1999/xhtml"?qy(e):n==="http://www.w3.org/2000/svg"&&e==="foreignObject"?"http://www.w3.org/1999/xhtml":n}var ll,Qy=function(n){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(e,t,r,i){MSApp.execUnsafeLocalFunction(function(){return n(e,t,r,i)})}:n}(function(n,e){if(n.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in n)n.innerHTML=e;else{for(ll=ll||document.createElement("div"),ll.innerHTML="<svg>"+e.valueOf().toString()+"</svg>",e=ll.firstChild;n.firstChild;)n.removeChild(n.firstChild);for(;e.firstChild;)n.appendChild(e.firstChild)}});function ao(n,e){if(e){var t=n.firstChild;if(t&&t===n.lastChild&&t.nodeType===3){t.nodeValue=e;return}}n.textContent=e}var za={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},VT=["Webkit","ms","Moz","O"];Object.keys(za).forEach(function(n){VT.forEach(function(e){e=e+n.charAt(0).toUpperCase()+n.substring(1),za[e]=za[n]})});function Xy(n,e,t){return e==null||typeof e=="boolean"||e===""?"":t||typeof e!="number"||e===0||za.hasOwnProperty(n)&&za[n]?(""+e).trim():e+"px"}function Zy(n,e){n=n.style;for(var t in e)if(e.hasOwnProperty(t)){var r=t.indexOf("--")===0,i=Xy(t,e[t],r);t==="float"&&(t="cssFloat"),r?n.setProperty(t,i):n[t]=i}}var HT=qe({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function Wd(n,e){if(e){if(HT[n]&&(e.children!=null||e.dangerouslySetInnerHTML!=null))throw Error(K(137,n));if(e.dangerouslySetInnerHTML!=null){if(e.children!=null)throw Error(K(60));if(typeof e.dangerouslySetInnerHTML!="object"||!("__html"in e.dangerouslySetInnerHTML))throw Error(K(61))}if(e.style!=null&&typeof e.style!="object")throw Error(K(62))}}function Yd(n,e){if(n.indexOf("-")===-1)return typeof e.is=="string";switch(n){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var qd=null;function xf(n){return n=n.target||n.srcElement||window,n.correspondingUseElement&&(n=n.correspondingUseElement),n.nodeType===3?n.parentNode:n}var Qd=null,Ms=null,Ns=null;function lm(n){if(n=jo(n)){if(typeof Qd!="function")throw Error(K(280));var e=n.stateNode;e&&(e=ic(e),Qd(n.stateNode,n.type,e))}}function Jy(n){Ms?Ns?Ns.push(n):Ns=[n]:Ms=n}function ev(){if(Ms){var n=Ms,e=Ns;if(Ns=Ms=null,lm(n),e)for(n=0;n<e.length;n++)lm(e[n])}}function tv(n,e){return n(e)}function nv(){}var Pc=!1;function rv(n,e,t){if(Pc)return n(e,t);Pc=!0;try{return tv(n,e,t)}finally{Pc=!1,(Ms!==null||Ns!==null)&&(nv(),ev())}}function oo(n,e){var t=n.stateNode;if(t===null)return null;var r=ic(t);if(r===null)return null;t=r[e];e:switch(e){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(r=!r.disabled)||(n=n.type,r=!(n==="button"||n==="input"||n==="select"||n==="textarea")),n=!r;break e;default:n=!1}if(n)return null;if(t&&typeof t!="function")throw Error(K(231,e,typeof t));return t}var Xd=!1;if(Rr)try{var Ra={};Object.defineProperty(Ra,"passive",{get:function(){Xd=!0}}),window.addEventListener("test",Ra,Ra),window.removeEventListener("test",Ra,Ra)}catch{Xd=!1}function zT(n,e,t,r,i,s,a,o,l){var u=Array.prototype.slice.call(arguments,3);try{e.apply(t,u)}catch(c){this.onError(c)}}var Wa=!1,mu=null,pu=!1,Zd=null,WT={onError:function(n){Wa=!0,mu=n}};function YT(n,e,t,r,i,s,a,o,l){Wa=!1,mu=null,zT.apply(WT,arguments)}function qT(n,e,t,r,i,s,a,o,l){if(YT.apply(this,arguments),Wa){if(Wa){var u=mu;Wa=!1,mu=null}else throw Error(K(198));pu||(pu=!0,Zd=u)}}function ss(n){var e=n,t=n;if(n.alternate)for(;e.return;)e=e.return;else{n=e;do e=n,e.flags&4098&&(t=e.return),n=e.return;while(n)}return e.tag===3?t:null}function iv(n){if(n.tag===13){var e=n.memoizedState;if(e===null&&(n=n.alternate,n!==null&&(e=n.memoizedState)),e!==null)return e.dehydrated}return null}function um(n){if(ss(n)!==n)throw Error(K(188))}function QT(n){var e=n.alternate;if(!e){if(e=ss(n),e===null)throw Error(K(188));return e!==n?null:n}for(var t=n,r=e;;){var i=t.return;if(i===null)break;var s=i.alternate;if(s===null){if(r=i.return,r!==null){t=r;continue}break}if(i.child===s.child){for(s=i.child;s;){if(s===t)return um(i),n;if(s===r)return um(i),e;s=s.sibling}throw Error(K(188))}if(t.return!==r.return)t=i,r=s;else{for(var a=!1,o=i.child;o;){if(o===t){a=!0,t=i,r=s;break}if(o===r){a=!0,r=i,t=s;break}o=o.sibling}if(!a){for(o=s.child;o;){if(o===t){a=!0,t=s,r=i;break}if(o===r){a=!0,r=s,t=i;break}o=o.sibling}if(!a)throw Error(K(189))}}if(t.alternate!==r)throw Error(K(190))}if(t.tag!==3)throw Error(K(188));return t.stateNode.current===t?n:e}function sv(n){return n=QT(n),n!==null?av(n):null}function av(n){if(n.tag===5||n.tag===6)return n;for(n=n.child;n!==null;){var e=av(n);if(e!==null)return e;n=n.sibling}return null}var ov=an.unstable_scheduleCallback,cm=an.unstable_cancelCallback,XT=an.unstable_shouldYield,ZT=an.unstable_requestPaint,nt=an.unstable_now,JT=an.unstable_getCurrentPriorityLevel,Tf=an.unstable_ImmediatePriority,lv=an.unstable_UserBlockingPriority,yu=an.unstable_NormalPriority,e1=an.unstable_LowPriority,uv=an.unstable_IdlePriority,ec=null,er=null;function t1(n){if(er&&typeof er.onCommitFiberRoot=="function")try{er.onCommitFiberRoot(ec,n,void 0,(n.current.flags&128)===128)}catch{}}var Pn=Math.clz32?Math.clz32:i1,n1=Math.log,r1=Math.LN2;function i1(n){return n>>>=0,n===0?32:31-(n1(n)/r1|0)|0}var ul=64,cl=4194304;function $a(n){switch(n&-n){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return n&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return n&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return n}}function vu(n,e){var t=n.pendingLanes;if(t===0)return 0;var r=0,i=n.suspendedLanes,s=n.pingedLanes,a=t&268435455;if(a!==0){var o=a&~i;o!==0?r=$a(o):(s&=a,s!==0&&(r=$a(s)))}else a=t&~i,a!==0?r=$a(a):s!==0&&(r=$a(s));if(r===0)return 0;if(e!==0&&e!==r&&!(e&i)&&(i=r&-r,s=e&-e,i>=s||i===16&&(s&4194240)!==0))return e;if(r&4&&(r|=t&16),e=n.entangledLanes,e!==0)for(n=n.entanglements,e&=r;0<e;)t=31-Pn(e),i=1<<t,r|=n[t],e&=~i;return r}function s1(n,e){switch(n){case 1:case 2:case 4:return e+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function a1(n,e){for(var t=n.suspendedLanes,r=n.pingedLanes,i=n.expirationTimes,s=n.pendingLanes;0<s;){var a=31-Pn(s),o=1<<a,l=i[a];l===-1?(!(o&t)||o&r)&&(i[a]=s1(o,e)):l<=e&&(n.expiredLanes|=o),s&=~o}}function Jd(n){return n=n.pendingLanes&-1073741825,n!==0?n:n&1073741824?1073741824:0}function cv(){var n=ul;return ul<<=1,!(ul&4194240)&&(ul=64),n}function Oc(n){for(var e=[],t=0;31>t;t++)e.push(n);return e}function Bo(n,e,t){n.pendingLanes|=e,e!==536870912&&(n.suspendedLanes=0,n.pingedLanes=0),n=n.eventTimes,e=31-Pn(e),n[e]=t}function o1(n,e){var t=n.pendingLanes&~e;n.pendingLanes=e,n.suspendedLanes=0,n.pingedLanes=0,n.expiredLanes&=e,n.mutableReadLanes&=e,n.entangledLanes&=e,e=n.entanglements;var r=n.eventTimes;for(n=n.expirationTimes;0<t;){var i=31-Pn(t),s=1<<i;e[i]=0,r[i]=-1,n[i]=-1,t&=~s}}function Lf(n,e){var t=n.entangledLanes|=e;for(n=n.entanglements;t;){var r=31-Pn(t),i=1<<r;i&e|n[r]&e&&(n[r]|=e),t&=~i}}var Pe=0;function dv(n){return n&=-n,1<n?4<n?n&268435455?16:536870912:4:1}var hv,Af,fv,gv,mv,eh=!1,dl=[],ai=null,oi=null,li=null,lo=new Map,uo=new Map,Hr=[],l1="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function dm(n,e){switch(n){case"focusin":case"focusout":ai=null;break;case"dragenter":case"dragleave":oi=null;break;case"mouseover":case"mouseout":li=null;break;case"pointerover":case"pointerout":lo.delete(e.pointerId);break;case"gotpointercapture":case"lostpointercapture":uo.delete(e.pointerId)}}function _a(n,e,t,r,i,s){return n===null||n.nativeEvent!==s?(n={blockedOn:e,domEventName:t,eventSystemFlags:r,nativeEvent:s,targetContainers:[i]},e!==null&&(e=jo(e),e!==null&&Af(e)),n):(n.eventSystemFlags|=r,e=n.targetContainers,i!==null&&e.indexOf(i)===-1&&e.push(i),n)}function u1(n,e,t,r,i){switch(e){case"focusin":return ai=_a(ai,n,e,t,r,i),!0;case"dragenter":return oi=_a(oi,n,e,t,r,i),!0;case"mouseover":return li=_a(li,n,e,t,r,i),!0;case"pointerover":var s=i.pointerId;return lo.set(s,_a(lo.get(s)||null,n,e,t,r,i)),!0;case"gotpointercapture":return s=i.pointerId,uo.set(s,_a(uo.get(s)||null,n,e,t,r,i)),!0}return!1}function pv(n){var e=Oi(n.target);if(e!==null){var t=ss(e);if(t!==null){if(e=t.tag,e===13){if(e=iv(t),e!==null){n.blockedOn=e,mv(n.priority,function(){fv(t)});return}}else if(e===3&&t.stateNode.current.memoizedState.isDehydrated){n.blockedOn=t.tag===3?t.stateNode.containerInfo:null;return}}}n.blockedOn=null}function zl(n){if(n.blockedOn!==null)return!1;for(var e=n.targetContainers;0<e.length;){var t=th(n.domEventName,n.eventSystemFlags,e[0],n.nativeEvent);if(t===null){t=n.nativeEvent;var r=new t.constructor(t.type,t);qd=r,t.target.dispatchEvent(r),qd=null}else return e=jo(t),e!==null&&Af(e),n.blockedOn=t,!1;e.shift()}return!0}function hm(n,e,t){zl(n)&&t.delete(e)}function c1(){eh=!1,ai!==null&&zl(ai)&&(ai=null),oi!==null&&zl(oi)&&(oi=null),li!==null&&zl(li)&&(li=null),lo.forEach(hm),uo.forEach(hm)}function Ia(n,e){n.blockedOn===e&&(n.blockedOn=null,eh||(eh=!0,an.unstable_scheduleCallback(an.unstable_NormalPriority,c1)))}function co(n){function e(i){return Ia(i,n)}if(0<dl.length){Ia(dl[0],n);for(var t=1;t<dl.length;t++){var r=dl[t];r.blockedOn===n&&(r.blockedOn=null)}}for(ai!==null&&Ia(ai,n),oi!==null&&Ia(oi,n),li!==null&&Ia(li,n),lo.forEach(e),uo.forEach(e),t=0;t<Hr.length;t++)r=Hr[t],r.blockedOn===n&&(r.blockedOn=null);for(;0<Hr.length&&(t=Hr[0],t.blockedOn===null);)pv(t),t.blockedOn===null&&Hr.shift()}var Us=Cr.ReactCurrentBatchConfig,Eu=!0;function d1(n,e,t,r){var i=Pe,s=Us.transition;Us.transition=null;try{Pe=1,Rf(n,e,t,r)}finally{Pe=i,Us.transition=s}}function h1(n,e,t,r){var i=Pe,s=Us.transition;Us.transition=null;try{Pe=4,Rf(n,e,t,r)}finally{Pe=i,Us.transition=s}}function Rf(n,e,t,r){if(Eu){var i=th(n,e,t,r);if(i===null)Vc(n,e,r,Su,t),dm(n,r);else if(u1(i,n,e,t,r))r.stopPropagation();else if(dm(n,r),e&4&&-1<l1.indexOf(n)){for(;i!==null;){var s=jo(i);if(s!==null&&hv(s),s=th(n,e,t,r),s===null&&Vc(n,e,r,Su,t),s===i)break;i=s}i!==null&&r.stopPropagation()}else Vc(n,e,r,null,t)}}var Su=null;function th(n,e,t,r){if(Su=null,n=xf(r),n=Oi(n),n!==null)if(e=ss(n),e===null)n=null;else if(t=e.tag,t===13){if(n=iv(e),n!==null)return n;n=null}else if(t===3){if(e.stateNode.current.memoizedState.isDehydrated)return e.tag===3?e.stateNode.containerInfo:null;n=null}else e!==n&&(n=null);return Su=n,null}function yv(n){switch(n){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(JT()){case Tf:return 1;case lv:return 4;case yu:case e1:return 16;case uv:return 536870912;default:return 16}default:return 16}}var ni=null,_f=null,Wl=null;function vv(){if(Wl)return Wl;var n,e=_f,t=e.length,r,i="value"in ni?ni.value:ni.textContent,s=i.length;for(n=0;n<t&&e[n]===i[n];n++);var a=t-n;for(r=1;r<=a&&e[t-r]===i[s-r];r++);return Wl=i.slice(n,1<r?1-r:void 0)}function Yl(n){var e=n.keyCode;return"charCode"in n?(n=n.charCode,n===0&&e===13&&(n=13)):n=e,n===10&&(n=13),32<=n||n===13?n:0}function hl(){return!0}function fm(){return!1}function un(n){function e(t,r,i,s,a){this._reactName=t,this._targetInst=i,this.type=r,this.nativeEvent=s,this.target=a,this.currentTarget=null;for(var o in n)n.hasOwnProperty(o)&&(t=n[o],this[o]=t?t(s):s[o]);return this.isDefaultPrevented=(s.defaultPrevented!=null?s.defaultPrevented:s.returnValue===!1)?hl:fm,this.isPropagationStopped=fm,this}return qe(e.prototype,{preventDefault:function(){this.defaultPrevented=!0;var t=this.nativeEvent;t&&(t.preventDefault?t.preventDefault():typeof t.returnValue!="unknown"&&(t.returnValue=!1),this.isDefaultPrevented=hl)},stopPropagation:function(){var t=this.nativeEvent;t&&(t.stopPropagation?t.stopPropagation():typeof t.cancelBubble!="unknown"&&(t.cancelBubble=!0),this.isPropagationStopped=hl)},persist:function(){},isPersistent:hl}),e}var pa={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(n){return n.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},If=un(pa),$o=qe({},pa,{view:0,detail:0}),f1=un($o),Fc,Mc,Da,tc=qe({},$o,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Df,button:0,buttons:0,relatedTarget:function(n){return n.relatedTarget===void 0?n.fromElement===n.srcElement?n.toElement:n.fromElement:n.relatedTarget},movementX:function(n){return"movementX"in n?n.movementX:(n!==Da&&(Da&&n.type==="mousemove"?(Fc=n.screenX-Da.screenX,Mc=n.screenY-Da.screenY):Mc=Fc=0,Da=n),Fc)},movementY:function(n){return"movementY"in n?n.movementY:Mc}}),gm=un(tc),g1=qe({},tc,{dataTransfer:0}),m1=un(g1),p1=qe({},$o,{relatedTarget:0}),Nc=un(p1),y1=qe({},pa,{animationName:0,elapsedTime:0,pseudoElement:0}),v1=un(y1),E1=qe({},pa,{clipboardData:function(n){return"clipboardData"in n?n.clipboardData:window.clipboardData}}),S1=un(E1),x1=qe({},pa,{data:0}),mm=un(x1),T1={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},L1={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},A1={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function R1(n){var e=this.nativeEvent;return e.getModifierState?e.getModifierState(n):(n=A1[n])?!!e[n]:!1}function Df(){return R1}var _1=qe({},$o,{key:function(n){if(n.key){var e=T1[n.key]||n.key;if(e!=="Unidentified")return e}return n.type==="keypress"?(n=Yl(n),n===13?"Enter":String.fromCharCode(n)):n.type==="keydown"||n.type==="keyup"?L1[n.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Df,charCode:function(n){return n.type==="keypress"?Yl(n):0},keyCode:function(n){return n.type==="keydown"||n.type==="keyup"?n.keyCode:0},which:function(n){return n.type==="keypress"?Yl(n):n.type==="keydown"||n.type==="keyup"?n.keyCode:0}}),I1=un(_1),D1=qe({},tc,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),pm=un(D1),C1=qe({},$o,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Df}),w1=un(C1),b1=qe({},pa,{propertyName:0,elapsedTime:0,pseudoElement:0}),k1=un(b1),P1=qe({},tc,{deltaX:function(n){return"deltaX"in n?n.deltaX:"wheelDeltaX"in n?-n.wheelDeltaX:0},deltaY:function(n){return"deltaY"in n?n.deltaY:"wheelDeltaY"in n?-n.wheelDeltaY:"wheelDelta"in n?-n.wheelDelta:0},deltaZ:0,deltaMode:0}),O1=un(P1),F1=[9,13,27,32],Cf=Rr&&"CompositionEvent"in window,Ya=null;Rr&&"documentMode"in document&&(Ya=document.documentMode);var M1=Rr&&"TextEvent"in window&&!Ya,Ev=Rr&&(!Cf||Ya&&8<Ya&&11>=Ya),ym=" ",vm=!1;function Sv(n,e){switch(n){case"keyup":return F1.indexOf(e.keyCode)!==-1;case"keydown":return e.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function xv(n){return n=n.detail,typeof n=="object"&&"data"in n?n.data:null}var xs=!1;function N1(n,e){switch(n){case"compositionend":return xv(e);case"keypress":return e.which!==32?null:(vm=!0,ym);case"textInput":return n=e.data,n===ym&&vm?null:n;default:return null}}function U1(n,e){if(xs)return n==="compositionend"||!Cf&&Sv(n,e)?(n=vv(),Wl=_f=ni=null,xs=!1,n):null;switch(n){case"paste":return null;case"keypress":if(!(e.ctrlKey||e.altKey||e.metaKey)||e.ctrlKey&&e.altKey){if(e.char&&1<e.char.length)return e.char;if(e.which)return String.fromCharCode(e.which)}return null;case"compositionend":return Ev&&e.locale!=="ko"?null:e.data;default:return null}}var B1={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Em(n){var e=n&&n.nodeName&&n.nodeName.toLowerCase();return e==="input"?!!B1[n.type]:e==="textarea"}function Tv(n,e,t,r){Jy(r),e=xu(e,"onChange"),0<e.length&&(t=new If("onChange","change",null,t,r),n.push({event:t,listeners:e}))}var qa=null,ho=null;function $1(n){Pv(n,0)}function nc(n){var e=As(n);if(zy(e))return n}function j1(n,e){if(n==="change")return e}var Lv=!1;if(Rr){var Uc;if(Rr){var Bc="oninput"in document;if(!Bc){var Sm=document.createElement("div");Sm.setAttribute("oninput","return;"),Bc=typeof Sm.oninput=="function"}Uc=Bc}else Uc=!1;Lv=Uc&&(!document.documentMode||9<document.documentMode)}function xm(){qa&&(qa.detachEvent("onpropertychange",Av),ho=qa=null)}function Av(n){if(n.propertyName==="value"&&nc(ho)){var e=[];Tv(e,ho,n,xf(n)),rv($1,e)}}function G1(n,e,t){n==="focusin"?(xm(),qa=e,ho=t,qa.attachEvent("onpropertychange",Av)):n==="focusout"&&xm()}function K1(n){if(n==="selectionchange"||n==="keyup"||n==="keydown")return nc(ho)}function V1(n,e){if(n==="click")return nc(e)}function H1(n,e){if(n==="input"||n==="change")return nc(e)}function z1(n,e){return n===e&&(n!==0||1/n===1/e)||n!==n&&e!==e}var Fn=typeof Object.is=="function"?Object.is:z1;function fo(n,e){if(Fn(n,e))return!0;if(typeof n!="object"||n===null||typeof e!="object"||e===null)return!1;var t=Object.keys(n),r=Object.keys(e);if(t.length!==r.length)return!1;for(r=0;r<t.length;r++){var i=t[r];if(!Nd.call(e,i)||!Fn(n[i],e[i]))return!1}return!0}function Tm(n){for(;n&&n.firstChild;)n=n.firstChild;return n}function Lm(n,e){var t=Tm(n);n=0;for(var r;t;){if(t.nodeType===3){if(r=n+t.textContent.length,n<=e&&r>=e)return{node:t,offset:e-n};n=r}e:{for(;t;){if(t.nextSibling){t=t.nextSibling;break e}t=t.parentNode}t=void 0}t=Tm(t)}}function Rv(n,e){return n&&e?n===e?!0:n&&n.nodeType===3?!1:e&&e.nodeType===3?Rv(n,e.parentNode):"contains"in n?n.contains(e):n.compareDocumentPosition?!!(n.compareDocumentPosition(e)&16):!1:!1}function _v(){for(var n=window,e=gu();e instanceof n.HTMLIFrameElement;){try{var t=typeof e.contentWindow.location.href=="string"}catch{t=!1}if(t)n=e.contentWindow;else break;e=gu(n.document)}return e}function wf(n){var e=n&&n.nodeName&&n.nodeName.toLowerCase();return e&&(e==="input"&&(n.type==="text"||n.type==="search"||n.type==="tel"||n.type==="url"||n.type==="password")||e==="textarea"||n.contentEditable==="true")}function W1(n){var e=_v(),t=n.focusedElem,r=n.selectionRange;if(e!==t&&t&&t.ownerDocument&&Rv(t.ownerDocument.documentElement,t)){if(r!==null&&wf(t)){if(e=r.start,n=r.end,n===void 0&&(n=e),"selectionStart"in t)t.selectionStart=e,t.selectionEnd=Math.min(n,t.value.length);else if(n=(e=t.ownerDocument||document)&&e.defaultView||window,n.getSelection){n=n.getSelection();var i=t.textContent.length,s=Math.min(r.start,i);r=r.end===void 0?s:Math.min(r.end,i),!n.extend&&s>r&&(i=r,r=s,s=i),i=Lm(t,s);var a=Lm(t,r);i&&a&&(n.rangeCount!==1||n.anchorNode!==i.node||n.anchorOffset!==i.offset||n.focusNode!==a.node||n.focusOffset!==a.offset)&&(e=e.createRange(),e.setStart(i.node,i.offset),n.removeAllRanges(),s>r?(n.addRange(e),n.extend(a.node,a.offset)):(e.setEnd(a.node,a.offset),n.addRange(e)))}}for(e=[],n=t;n=n.parentNode;)n.nodeType===1&&e.push({element:n,left:n.scrollLeft,top:n.scrollTop});for(typeof t.focus=="function"&&t.focus(),t=0;t<e.length;t++)n=e[t],n.element.scrollLeft=n.left,n.element.scrollTop=n.top}}var Y1=Rr&&"documentMode"in document&&11>=document.documentMode,Ts=null,nh=null,Qa=null,rh=!1;function Am(n,e,t){var r=t.window===t?t.document:t.nodeType===9?t:t.ownerDocument;rh||Ts==null||Ts!==gu(r)||(r=Ts,"selectionStart"in r&&wf(r)?r={start:r.selectionStart,end:r.selectionEnd}:(r=(r.ownerDocument&&r.ownerDocument.defaultView||window).getSelection(),r={anchorNode:r.anchorNode,anchorOffset:r.anchorOffset,focusNode:r.focusNode,focusOffset:r.focusOffset}),Qa&&fo(Qa,r)||(Qa=r,r=xu(nh,"onSelect"),0<r.length&&(e=new If("onSelect","select",null,e,t),n.push({event:e,listeners:r}),e.target=Ts)))}function fl(n,e){var t={};return t[n.toLowerCase()]=e.toLowerCase(),t["Webkit"+n]="webkit"+e,t["Moz"+n]="moz"+e,t}var Ls={animationend:fl("Animation","AnimationEnd"),animationiteration:fl("Animation","AnimationIteration"),animationstart:fl("Animation","AnimationStart"),transitionend:fl("Transition","TransitionEnd")},$c={},Iv={};Rr&&(Iv=document.createElement("div").style,"AnimationEvent"in window||(delete Ls.animationend.animation,delete Ls.animationiteration.animation,delete Ls.animationstart.animation),"TransitionEvent"in window||delete Ls.transitionend.transition);function rc(n){if($c[n])return $c[n];if(!Ls[n])return n;var e=Ls[n],t;for(t in e)if(e.hasOwnProperty(t)&&t in Iv)return $c[n]=e[t];return n}var Dv=rc("animationend"),Cv=rc("animationiteration"),wv=rc("animationstart"),bv=rc("transitionend"),kv=new Map,Rm="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Si(n,e){kv.set(n,e),is(e,[n])}for(var jc=0;jc<Rm.length;jc++){var Gc=Rm[jc],q1=Gc.toLowerCase(),Q1=Gc[0].toUpperCase()+Gc.slice(1);Si(q1,"on"+Q1)}Si(Dv,"onAnimationEnd");Si(Cv,"onAnimationIteration");Si(wv,"onAnimationStart");Si("dblclick","onDoubleClick");Si("focusin","onFocus");Si("focusout","onBlur");Si(bv,"onTransitionEnd");ia("onMouseEnter",["mouseout","mouseover"]);ia("onMouseLeave",["mouseout","mouseover"]);ia("onPointerEnter",["pointerout","pointerover"]);ia("onPointerLeave",["pointerout","pointerover"]);is("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));is("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));is("onBeforeInput",["compositionend","keypress","textInput","paste"]);is("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));is("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));is("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var ja="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),X1=new Set("cancel close invalid load scroll toggle".split(" ").concat(ja));function _m(n,e,t){var r=n.type||"unknown-event";n.currentTarget=t,qT(r,e,void 0,n),n.currentTarget=null}function Pv(n,e){e=(e&4)!==0;for(var t=0;t<n.length;t++){var r=n[t],i=r.event;r=r.listeners;e:{var s=void 0;if(e)for(var a=r.length-1;0<=a;a--){var o=r[a],l=o.instance,u=o.currentTarget;if(o=o.listener,l!==s&&i.isPropagationStopped())break e;_m(i,o,u),s=l}else for(a=0;a<r.length;a++){if(o=r[a],l=o.instance,u=o.currentTarget,o=o.listener,l!==s&&i.isPropagationStopped())break e;_m(i,o,u),s=l}}}if(pu)throw n=Zd,pu=!1,Zd=null,n}function $e(n,e){var t=e[lh];t===void 0&&(t=e[lh]=new Set);var r=n+"__bubble";t.has(r)||(Ov(e,n,2,!1),t.add(r))}function Kc(n,e,t){var r=0;e&&(r|=4),Ov(t,n,r,e)}var gl="_reactListening"+Math.random().toString(36).slice(2);function go(n){if(!n[gl]){n[gl]=!0,jy.forEach(function(t){t!=="selectionchange"&&(X1.has(t)||Kc(t,!1,n),Kc(t,!0,n))});var e=n.nodeType===9?n:n.ownerDocument;e===null||e[gl]||(e[gl]=!0,Kc("selectionchange",!1,e))}}function Ov(n,e,t,r){switch(yv(e)){case 1:var i=d1;break;case 4:i=h1;break;default:i=Rf}t=i.bind(null,e,t,n),i=void 0,!Xd||e!=="touchstart"&&e!=="touchmove"&&e!=="wheel"||(i=!0),r?i!==void 0?n.addEventListener(e,t,{capture:!0,passive:i}):n.addEventListener(e,t,!0):i!==void 0?n.addEventListener(e,t,{passive:i}):n.addEventListener(e,t,!1)}function Vc(n,e,t,r,i){var s=r;if(!(e&1)&&!(e&2)&&r!==null)e:for(;;){if(r===null)return;var a=r.tag;if(a===3||a===4){var o=r.stateNode.containerInfo;if(o===i||o.nodeType===8&&o.parentNode===i)break;if(a===4)for(a=r.return;a!==null;){var l=a.tag;if((l===3||l===4)&&(l=a.stateNode.containerInfo,l===i||l.nodeType===8&&l.parentNode===i))return;a=a.return}for(;o!==null;){if(a=Oi(o),a===null)return;if(l=a.tag,l===5||l===6){r=s=a;continue e}o=o.parentNode}}r=r.return}rv(function(){var u=s,c=xf(t),d=[];e:{var h=kv.get(n);if(h!==void 0){var f=If,g=n;switch(n){case"keypress":if(Yl(t)===0)break e;case"keydown":case"keyup":f=I1;break;case"focusin":g="focus",f=Nc;break;case"focusout":g="blur",f=Nc;break;case"beforeblur":case"afterblur":f=Nc;break;case"click":if(t.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":f=gm;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":f=m1;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":f=w1;break;case Dv:case Cv:case wv:f=v1;break;case bv:f=k1;break;case"scroll":f=f1;break;case"wheel":f=O1;break;case"copy":case"cut":case"paste":f=S1;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":f=pm}var m=(e&4)!==0,y=!m&&n==="scroll",p=m?h!==null?h+"Capture":null:h;m=[];for(var v=u,E;v!==null;){E=v;var T=E.stateNode;if(E.tag===5&&T!==null&&(E=T,p!==null&&(T=oo(v,p),T!=null&&m.push(mo(v,T,E)))),y)break;v=v.return}0<m.length&&(h=new f(h,g,null,t,c),d.push({event:h,listeners:m}))}}if(!(e&7)){e:{if(h=n==="mouseover"||n==="pointerover",f=n==="mouseout"||n==="pointerout",h&&t!==qd&&(g=t.relatedTarget||t.fromElement)&&(Oi(g)||g[_r]))break e;if((f||h)&&(h=c.window===c?c:(h=c.ownerDocument)?h.defaultView||h.parentWindow:window,f?(g=t.relatedTarget||t.toElement,f=u,g=g?Oi(g):null,g!==null&&(y=ss(g),g!==y||g.tag!==5&&g.tag!==6)&&(g=null)):(f=null,g=u),f!==g)){if(m=gm,T="onMouseLeave",p="onMouseEnter",v="mouse",(n==="pointerout"||n==="pointerover")&&(m=pm,T="onPointerLeave",p="onPointerEnter",v="pointer"),y=f==null?h:As(f),E=g==null?h:As(g),h=new m(T,v+"leave",f,t,c),h.target=y,h.relatedTarget=E,T=null,Oi(c)===u&&(m=new m(p,v+"enter",g,t,c),m.target=E,m.relatedTarget=y,T=m),y=T,f&&g)t:{for(m=f,p=g,v=0,E=m;E;E=cs(E))v++;for(E=0,T=p;T;T=cs(T))E++;for(;0<v-E;)m=cs(m),v--;for(;0<E-v;)p=cs(p),E--;for(;v--;){if(m===p||p!==null&&m===p.alternate)break t;m=cs(m),p=cs(p)}m=null}else m=null;f!==null&&Im(d,h,f,m,!1),g!==null&&y!==null&&Im(d,y,g,m,!0)}}e:{if(h=u?As(u):window,f=h.nodeName&&h.nodeName.toLowerCase(),f==="select"||f==="input"&&h.type==="file")var A=j1;else if(Em(h))if(Lv)A=H1;else{A=K1;var I=G1}else(f=h.nodeName)&&f.toLowerCase()==="input"&&(h.type==="checkbox"||h.type==="radio")&&(A=V1);if(A&&(A=A(n,u))){Tv(d,A,t,c);break e}I&&I(n,h,u),n==="focusout"&&(I=h._wrapperState)&&I.controlled&&h.type==="number"&&Vd(h,"number",h.value)}switch(I=u?As(u):window,n){case"focusin":(Em(I)||I.contentEditable==="true")&&(Ts=I,nh=u,Qa=null);break;case"focusout":Qa=nh=Ts=null;break;case"mousedown":rh=!0;break;case"contextmenu":case"mouseup":case"dragend":rh=!1,Am(d,t,c);break;case"selectionchange":if(Y1)break;case"keydown":case"keyup":Am(d,t,c)}var R;if(Cf)e:{switch(n){case"compositionstart":var x="onCompositionStart";break e;case"compositionend":x="onCompositionEnd";break e;case"compositionupdate":x="onCompositionUpdate";break e}x=void 0}else xs?Sv(n,t)&&(x="onCompositionEnd"):n==="keydown"&&t.keyCode===229&&(x="onCompositionStart");x&&(Ev&&t.locale!=="ko"&&(xs||x!=="onCompositionStart"?x==="onCompositionEnd"&&xs&&(R=vv()):(ni=c,_f="value"in ni?ni.value:ni.textContent,xs=!0)),I=xu(u,x),0<I.length&&(x=new mm(x,n,null,t,c),d.push({event:x,listeners:I}),R?x.data=R:(R=xv(t),R!==null&&(x.data=R)))),(R=M1?N1(n,t):U1(n,t))&&(u=xu(u,"onBeforeInput"),0<u.length&&(c=new mm("onBeforeInput","beforeinput",null,t,c),d.push({event:c,listeners:u}),c.data=R))}Pv(d,e)})}function mo(n,e,t){return{instance:n,listener:e,currentTarget:t}}function xu(n,e){for(var t=e+"Capture",r=[];n!==null;){var i=n,s=i.stateNode;i.tag===5&&s!==null&&(i=s,s=oo(n,t),s!=null&&r.unshift(mo(n,s,i)),s=oo(n,e),s!=null&&r.push(mo(n,s,i))),n=n.return}return r}function cs(n){if(n===null)return null;do n=n.return;while(n&&n.tag!==5);return n||null}function Im(n,e,t,r,i){for(var s=e._reactName,a=[];t!==null&&t!==r;){var o=t,l=o.alternate,u=o.stateNode;if(l!==null&&l===r)break;o.tag===5&&u!==null&&(o=u,i?(l=oo(t,s),l!=null&&a.unshift(mo(t,l,o))):i||(l=oo(t,s),l!=null&&a.push(mo(t,l,o)))),t=t.return}a.length!==0&&n.push({event:e,listeners:a})}var Z1=/\r\n?/g,J1=/\u0000|\uFFFD/g;function Dm(n){return(typeof n=="string"?n:""+n).replace(Z1,`
`).replace(J1,"")}function ml(n,e,t){if(e=Dm(e),Dm(n)!==e&&t)throw Error(K(425))}function Tu(){}var ih=null,sh=null;function ah(n,e){return n==="textarea"||n==="noscript"||typeof e.children=="string"||typeof e.children=="number"||typeof e.dangerouslySetInnerHTML=="object"&&e.dangerouslySetInnerHTML!==null&&e.dangerouslySetInnerHTML.__html!=null}var oh=typeof setTimeout=="function"?setTimeout:void 0,eL=typeof clearTimeout=="function"?clearTimeout:void 0,Cm=typeof Promise=="function"?Promise:void 0,tL=typeof queueMicrotask=="function"?queueMicrotask:typeof Cm<"u"?function(n){return Cm.resolve(null).then(n).catch(nL)}:oh;function nL(n){setTimeout(function(){throw n})}function Hc(n,e){var t=e,r=0;do{var i=t.nextSibling;if(n.removeChild(t),i&&i.nodeType===8)if(t=i.data,t==="/$"){if(r===0){n.removeChild(i),co(e);return}r--}else t!=="$"&&t!=="$?"&&t!=="$!"||r++;t=i}while(t);co(e)}function ui(n){for(;n!=null;n=n.nextSibling){var e=n.nodeType;if(e===1||e===3)break;if(e===8){if(e=n.data,e==="$"||e==="$!"||e==="$?")break;if(e==="/$")return null}}return n}function wm(n){n=n.previousSibling;for(var e=0;n;){if(n.nodeType===8){var t=n.data;if(t==="$"||t==="$!"||t==="$?"){if(e===0)return n;e--}else t==="/$"&&e++}n=n.previousSibling}return null}var ya=Math.random().toString(36).slice(2),qn="__reactFiber$"+ya,po="__reactProps$"+ya,_r="__reactContainer$"+ya,lh="__reactEvents$"+ya,rL="__reactListeners$"+ya,iL="__reactHandles$"+ya;function Oi(n){var e=n[qn];if(e)return e;for(var t=n.parentNode;t;){if(e=t[_r]||t[qn]){if(t=e.alternate,e.child!==null||t!==null&&t.child!==null)for(n=wm(n);n!==null;){if(t=n[qn])return t;n=wm(n)}return e}n=t,t=n.parentNode}return null}function jo(n){return n=n[qn]||n[_r],!n||n.tag!==5&&n.tag!==6&&n.tag!==13&&n.tag!==3?null:n}function As(n){if(n.tag===5||n.tag===6)return n.stateNode;throw Error(K(33))}function ic(n){return n[po]||null}var uh=[],Rs=-1;function xi(n){return{current:n}}function je(n){0>Rs||(n.current=uh[Rs],uh[Rs]=null,Rs--)}function Ue(n,e){Rs++,uh[Rs]=n.current,n.current=e}var mi={},Ct=xi(mi),Vt=xi(!1),Yi=mi;function sa(n,e){var t=n.type.contextTypes;if(!t)return mi;var r=n.stateNode;if(r&&r.__reactInternalMemoizedUnmaskedChildContext===e)return r.__reactInternalMemoizedMaskedChildContext;var i={},s;for(s in t)i[s]=e[s];return r&&(n=n.stateNode,n.__reactInternalMemoizedUnmaskedChildContext=e,n.__reactInternalMemoizedMaskedChildContext=i),i}function Ht(n){return n=n.childContextTypes,n!=null}function Lu(){je(Vt),je(Ct)}function bm(n,e,t){if(Ct.current!==mi)throw Error(K(168));Ue(Ct,e),Ue(Vt,t)}function Fv(n,e,t){var r=n.stateNode;if(e=e.childContextTypes,typeof r.getChildContext!="function")return t;r=r.getChildContext();for(var i in r)if(!(i in e))throw Error(K(108,GT(n)||"Unknown",i));return qe({},t,r)}function Au(n){return n=(n=n.stateNode)&&n.__reactInternalMemoizedMergedChildContext||mi,Yi=Ct.current,Ue(Ct,n),Ue(Vt,Vt.current),!0}function km(n,e,t){var r=n.stateNode;if(!r)throw Error(K(169));t?(n=Fv(n,e,Yi),r.__reactInternalMemoizedMergedChildContext=n,je(Vt),je(Ct),Ue(Ct,n)):je(Vt),Ue(Vt,t)}var vr=null,sc=!1,zc=!1;function Mv(n){vr===null?vr=[n]:vr.push(n)}function sL(n){sc=!0,Mv(n)}function Ti(){if(!zc&&vr!==null){zc=!0;var n=0,e=Pe;try{var t=vr;for(Pe=1;n<t.length;n++){var r=t[n];do r=r(!0);while(r!==null)}vr=null,sc=!1}catch(i){throw vr!==null&&(vr=vr.slice(n+1)),ov(Tf,Ti),i}finally{Pe=e,zc=!1}}return null}var _s=[],Is=0,Ru=null,_u=0,mn=[],pn=0,qi=null,Sr=1,xr="";function Ci(n,e){_s[Is++]=_u,_s[Is++]=Ru,Ru=n,_u=e}function Nv(n,e,t){mn[pn++]=Sr,mn[pn++]=xr,mn[pn++]=qi,qi=n;var r=Sr;n=xr;var i=32-Pn(r)-1;r&=~(1<<i),t+=1;var s=32-Pn(e)+i;if(30<s){var a=i-i%5;s=(r&(1<<a)-1).toString(32),r>>=a,i-=a,Sr=1<<32-Pn(e)+i|t<<i|r,xr=s+n}else Sr=1<<s|t<<i|r,xr=n}function bf(n){n.return!==null&&(Ci(n,1),Nv(n,1,0))}function kf(n){for(;n===Ru;)Ru=_s[--Is],_s[Is]=null,_u=_s[--Is],_s[Is]=null;for(;n===qi;)qi=mn[--pn],mn[pn]=null,xr=mn[--pn],mn[pn]=null,Sr=mn[--pn],mn[pn]=null}var rn=null,tn=null,Ke=!1,bn=null;function Uv(n,e){var t=yn(5,null,null,0);t.elementType="DELETED",t.stateNode=e,t.return=n,e=n.deletions,e===null?(n.deletions=[t],n.flags|=16):e.push(t)}function Pm(n,e){switch(n.tag){case 5:var t=n.type;return e=e.nodeType!==1||t.toLowerCase()!==e.nodeName.toLowerCase()?null:e,e!==null?(n.stateNode=e,rn=n,tn=ui(e.firstChild),!0):!1;case 6:return e=n.pendingProps===""||e.nodeType!==3?null:e,e!==null?(n.stateNode=e,rn=n,tn=null,!0):!1;case 13:return e=e.nodeType!==8?null:e,e!==null?(t=qi!==null?{id:Sr,overflow:xr}:null,n.memoizedState={dehydrated:e,treeContext:t,retryLane:1073741824},t=yn(18,null,null,0),t.stateNode=e,t.return=n,n.child=t,rn=n,tn=null,!0):!1;default:return!1}}function ch(n){return(n.mode&1)!==0&&(n.flags&128)===0}function dh(n){if(Ke){var e=tn;if(e){var t=e;if(!Pm(n,e)){if(ch(n))throw Error(K(418));e=ui(t.nextSibling);var r=rn;e&&Pm(n,e)?Uv(r,t):(n.flags=n.flags&-4097|2,Ke=!1,rn=n)}}else{if(ch(n))throw Error(K(418));n.flags=n.flags&-4097|2,Ke=!1,rn=n}}}function Om(n){for(n=n.return;n!==null&&n.tag!==5&&n.tag!==3&&n.tag!==13;)n=n.return;rn=n}function pl(n){if(n!==rn)return!1;if(!Ke)return Om(n),Ke=!0,!1;var e;if((e=n.tag!==3)&&!(e=n.tag!==5)&&(e=n.type,e=e!=="head"&&e!=="body"&&!ah(n.type,n.memoizedProps)),e&&(e=tn)){if(ch(n))throw Bv(),Error(K(418));for(;e;)Uv(n,e),e=ui(e.nextSibling)}if(Om(n),n.tag===13){if(n=n.memoizedState,n=n!==null?n.dehydrated:null,!n)throw Error(K(317));e:{for(n=n.nextSibling,e=0;n;){if(n.nodeType===8){var t=n.data;if(t==="/$"){if(e===0){tn=ui(n.nextSibling);break e}e--}else t!=="$"&&t!=="$!"&&t!=="$?"||e++}n=n.nextSibling}tn=null}}else tn=rn?ui(n.stateNode.nextSibling):null;return!0}function Bv(){for(var n=tn;n;)n=ui(n.nextSibling)}function aa(){tn=rn=null,Ke=!1}function Pf(n){bn===null?bn=[n]:bn.push(n)}var aL=Cr.ReactCurrentBatchConfig;function Ca(n,e,t){if(n=t.ref,n!==null&&typeof n!="function"&&typeof n!="object"){if(t._owner){if(t=t._owner,t){if(t.tag!==1)throw Error(K(309));var r=t.stateNode}if(!r)throw Error(K(147,n));var i=r,s=""+n;return e!==null&&e.ref!==null&&typeof e.ref=="function"&&e.ref._stringRef===s?e.ref:(e=function(a){var o=i.refs;a===null?delete o[s]:o[s]=a},e._stringRef=s,e)}if(typeof n!="string")throw Error(K(284));if(!t._owner)throw Error(K(290,n))}return n}function yl(n,e){throw n=Object.prototype.toString.call(e),Error(K(31,n==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":n))}function Fm(n){var e=n._init;return e(n._payload)}function $v(n){function e(p,v){if(n){var E=p.deletions;E===null?(p.deletions=[v],p.flags|=16):E.push(v)}}function t(p,v){if(!n)return null;for(;v!==null;)e(p,v),v=v.sibling;return null}function r(p,v){for(p=new Map;v!==null;)v.key!==null?p.set(v.key,v):p.set(v.index,v),v=v.sibling;return p}function i(p,v){return p=fi(p,v),p.index=0,p.sibling=null,p}function s(p,v,E){return p.index=E,n?(E=p.alternate,E!==null?(E=E.index,E<v?(p.flags|=2,v):E):(p.flags|=2,v)):(p.flags|=1048576,v)}function a(p){return n&&p.alternate===null&&(p.flags|=2),p}function o(p,v,E,T){return v===null||v.tag!==6?(v=Jc(E,p.mode,T),v.return=p,v):(v=i(v,E),v.return=p,v)}function l(p,v,E,T){var A=E.type;return A===Ss?c(p,v,E.props.children,T,E.key):v!==null&&(v.elementType===A||typeof A=="object"&&A!==null&&A.$$typeof===jr&&Fm(A)===v.type)?(T=i(v,E.props),T.ref=Ca(p,v,E),T.return=p,T):(T=tu(E.type,E.key,E.props,null,p.mode,T),T.ref=Ca(p,v,E),T.return=p,T)}function u(p,v,E,T){return v===null||v.tag!==4||v.stateNode.containerInfo!==E.containerInfo||v.stateNode.implementation!==E.implementation?(v=ed(E,p.mode,T),v.return=p,v):(v=i(v,E.children||[]),v.return=p,v)}function c(p,v,E,T,A){return v===null||v.tag!==7?(v=zi(E,p.mode,T,A),v.return=p,v):(v=i(v,E),v.return=p,v)}function d(p,v,E){if(typeof v=="string"&&v!==""||typeof v=="number")return v=Jc(""+v,p.mode,E),v.return=p,v;if(typeof v=="object"&&v!==null){switch(v.$$typeof){case al:return E=tu(v.type,v.key,v.props,null,p.mode,E),E.ref=Ca(p,null,v),E.return=p,E;case Es:return v=ed(v,p.mode,E),v.return=p,v;case jr:var T=v._init;return d(p,T(v._payload),E)}if(Ba(v)||Aa(v))return v=zi(v,p.mode,E,null),v.return=p,v;yl(p,v)}return null}function h(p,v,E,T){var A=v!==null?v.key:null;if(typeof E=="string"&&E!==""||typeof E=="number")return A!==null?null:o(p,v,""+E,T);if(typeof E=="object"&&E!==null){switch(E.$$typeof){case al:return E.key===A?l(p,v,E,T):null;case Es:return E.key===A?u(p,v,E,T):null;case jr:return A=E._init,h(p,v,A(E._payload),T)}if(Ba(E)||Aa(E))return A!==null?null:c(p,v,E,T,null);yl(p,E)}return null}function f(p,v,E,T,A){if(typeof T=="string"&&T!==""||typeof T=="number")return p=p.get(E)||null,o(v,p,""+T,A);if(typeof T=="object"&&T!==null){switch(T.$$typeof){case al:return p=p.get(T.key===null?E:T.key)||null,l(v,p,T,A);case Es:return p=p.get(T.key===null?E:T.key)||null,u(v,p,T,A);case jr:var I=T._init;return f(p,v,E,I(T._payload),A)}if(Ba(T)||Aa(T))return p=p.get(E)||null,c(v,p,T,A,null);yl(v,T)}return null}function g(p,v,E,T){for(var A=null,I=null,R=v,x=v=0,D=null;R!==null&&x<E.length;x++){R.index>x?(D=R,R=null):D=R.sibling;var _=h(p,R,E[x],T);if(_===null){R===null&&(R=D);break}n&&R&&_.alternate===null&&e(p,R),v=s(_,v,x),I===null?A=_:I.sibling=_,I=_,R=D}if(x===E.length)return t(p,R),Ke&&Ci(p,x),A;if(R===null){for(;x<E.length;x++)R=d(p,E[x],T),R!==null&&(v=s(R,v,x),I===null?A=R:I.sibling=R,I=R);return Ke&&Ci(p,x),A}for(R=r(p,R);x<E.length;x++)D=f(R,p,x,E[x],T),D!==null&&(n&&D.alternate!==null&&R.delete(D.key===null?x:D.key),v=s(D,v,x),I===null?A=D:I.sibling=D,I=D);return n&&R.forEach(function(M){return e(p,M)}),Ke&&Ci(p,x),A}function m(p,v,E,T){var A=Aa(E);if(typeof A!="function")throw Error(K(150));if(E=A.call(E),E==null)throw Error(K(151));for(var I=A=null,R=v,x=v=0,D=null,_=E.next();R!==null&&!_.done;x++,_=E.next()){R.index>x?(D=R,R=null):D=R.sibling;var M=h(p,R,_.value,T);if(M===null){R===null&&(R=D);break}n&&R&&M.alternate===null&&e(p,R),v=s(M,v,x),I===null?A=M:I.sibling=M,I=M,R=D}if(_.done)return t(p,R),Ke&&Ci(p,x),A;if(R===null){for(;!_.done;x++,_=E.next())_=d(p,_.value,T),_!==null&&(v=s(_,v,x),I===null?A=_:I.sibling=_,I=_);return Ke&&Ci(p,x),A}for(R=r(p,R);!_.done;x++,_=E.next())_=f(R,p,x,_.value,T),_!==null&&(n&&_.alternate!==null&&R.delete(_.key===null?x:_.key),v=s(_,v,x),I===null?A=_:I.sibling=_,I=_);return n&&R.forEach(function(j){return e(p,j)}),Ke&&Ci(p,x),A}function y(p,v,E,T){if(typeof E=="object"&&E!==null&&E.type===Ss&&E.key===null&&(E=E.props.children),typeof E=="object"&&E!==null){switch(E.$$typeof){case al:e:{for(var A=E.key,I=v;I!==null;){if(I.key===A){if(A=E.type,A===Ss){if(I.tag===7){t(p,I.sibling),v=i(I,E.props.children),v.return=p,p=v;break e}}else if(I.elementType===A||typeof A=="object"&&A!==null&&A.$$typeof===jr&&Fm(A)===I.type){t(p,I.sibling),v=i(I,E.props),v.ref=Ca(p,I,E),v.return=p,p=v;break e}t(p,I);break}else e(p,I);I=I.sibling}E.type===Ss?(v=zi(E.props.children,p.mode,T,E.key),v.return=p,p=v):(T=tu(E.type,E.key,E.props,null,p.mode,T),T.ref=Ca(p,v,E),T.return=p,p=T)}return a(p);case Es:e:{for(I=E.key;v!==null;){if(v.key===I)if(v.tag===4&&v.stateNode.containerInfo===E.containerInfo&&v.stateNode.implementation===E.implementation){t(p,v.sibling),v=i(v,E.children||[]),v.return=p,p=v;break e}else{t(p,v);break}else e(p,v);v=v.sibling}v=ed(E,p.mode,T),v.return=p,p=v}return a(p);case jr:return I=E._init,y(p,v,I(E._payload),T)}if(Ba(E))return g(p,v,E,T);if(Aa(E))return m(p,v,E,T);yl(p,E)}return typeof E=="string"&&E!==""||typeof E=="number"?(E=""+E,v!==null&&v.tag===6?(t(p,v.sibling),v=i(v,E),v.return=p,p=v):(t(p,v),v=Jc(E,p.mode,T),v.return=p,p=v),a(p)):t(p,v)}return y}var oa=$v(!0),jv=$v(!1),Iu=xi(null),Du=null,Ds=null,Of=null;function Ff(){Of=Ds=Du=null}function Mf(n){var e=Iu.current;je(Iu),n._currentValue=e}function hh(n,e,t){for(;n!==null;){var r=n.alternate;if((n.childLanes&e)!==e?(n.childLanes|=e,r!==null&&(r.childLanes|=e)):r!==null&&(r.childLanes&e)!==e&&(r.childLanes|=e),n===t)break;n=n.return}}function Bs(n,e){Du=n,Of=Ds=null,n=n.dependencies,n!==null&&n.firstContext!==null&&(n.lanes&e&&(Kt=!0),n.firstContext=null)}function Sn(n){var e=n._currentValue;if(Of!==n)if(n={context:n,memoizedValue:e,next:null},Ds===null){if(Du===null)throw Error(K(308));Ds=n,Du.dependencies={lanes:0,firstContext:n}}else Ds=Ds.next=n;return e}var Fi=null;function Nf(n){Fi===null?Fi=[n]:Fi.push(n)}function Gv(n,e,t,r){var i=e.interleaved;return i===null?(t.next=t,Nf(e)):(t.next=i.next,i.next=t),e.interleaved=t,Ir(n,r)}function Ir(n,e){n.lanes|=e;var t=n.alternate;for(t!==null&&(t.lanes|=e),t=n,n=n.return;n!==null;)n.childLanes|=e,t=n.alternate,t!==null&&(t.childLanes|=e),t=n,n=n.return;return t.tag===3?t.stateNode:null}var Gr=!1;function Uf(n){n.updateQueue={baseState:n.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function Kv(n,e){n=n.updateQueue,e.updateQueue===n&&(e.updateQueue={baseState:n.baseState,firstBaseUpdate:n.firstBaseUpdate,lastBaseUpdate:n.lastBaseUpdate,shared:n.shared,effects:n.effects})}function Tr(n,e){return{eventTime:n,lane:e,tag:0,payload:null,callback:null,next:null}}function ci(n,e,t){var r=n.updateQueue;if(r===null)return null;if(r=r.shared,_e&2){var i=r.pending;return i===null?e.next=e:(e.next=i.next,i.next=e),r.pending=e,Ir(n,t)}return i=r.interleaved,i===null?(e.next=e,Nf(r)):(e.next=i.next,i.next=e),r.interleaved=e,Ir(n,t)}function ql(n,e,t){if(e=e.updateQueue,e!==null&&(e=e.shared,(t&4194240)!==0)){var r=e.lanes;r&=n.pendingLanes,t|=r,e.lanes=t,Lf(n,t)}}function Mm(n,e){var t=n.updateQueue,r=n.alternate;if(r!==null&&(r=r.updateQueue,t===r)){var i=null,s=null;if(t=t.firstBaseUpdate,t!==null){do{var a={eventTime:t.eventTime,lane:t.lane,tag:t.tag,payload:t.payload,callback:t.callback,next:null};s===null?i=s=a:s=s.next=a,t=t.next}while(t!==null);s===null?i=s=e:s=s.next=e}else i=s=e;t={baseState:r.baseState,firstBaseUpdate:i,lastBaseUpdate:s,shared:r.shared,effects:r.effects},n.updateQueue=t;return}n=t.lastBaseUpdate,n===null?t.firstBaseUpdate=e:n.next=e,t.lastBaseUpdate=e}function Cu(n,e,t,r){var i=n.updateQueue;Gr=!1;var s=i.firstBaseUpdate,a=i.lastBaseUpdate,o=i.shared.pending;if(o!==null){i.shared.pending=null;var l=o,u=l.next;l.next=null,a===null?s=u:a.next=u,a=l;var c=n.alternate;c!==null&&(c=c.updateQueue,o=c.lastBaseUpdate,o!==a&&(o===null?c.firstBaseUpdate=u:o.next=u,c.lastBaseUpdate=l))}if(s!==null){var d=i.baseState;a=0,c=u=l=null,o=s;do{var h=o.lane,f=o.eventTime;if((r&h)===h){c!==null&&(c=c.next={eventTime:f,lane:0,tag:o.tag,payload:o.payload,callback:o.callback,next:null});e:{var g=n,m=o;switch(h=e,f=t,m.tag){case 1:if(g=m.payload,typeof g=="function"){d=g.call(f,d,h);break e}d=g;break e;case 3:g.flags=g.flags&-65537|128;case 0:if(g=m.payload,h=typeof g=="function"?g.call(f,d,h):g,h==null)break e;d=qe({},d,h);break e;case 2:Gr=!0}}o.callback!==null&&o.lane!==0&&(n.flags|=64,h=i.effects,h===null?i.effects=[o]:h.push(o))}else f={eventTime:f,lane:h,tag:o.tag,payload:o.payload,callback:o.callback,next:null},c===null?(u=c=f,l=d):c=c.next=f,a|=h;if(o=o.next,o===null){if(o=i.shared.pending,o===null)break;h=o,o=h.next,h.next=null,i.lastBaseUpdate=h,i.shared.pending=null}}while(!0);if(c===null&&(l=d),i.baseState=l,i.firstBaseUpdate=u,i.lastBaseUpdate=c,e=i.shared.interleaved,e!==null){i=e;do a|=i.lane,i=i.next;while(i!==e)}else s===null&&(i.shared.lanes=0);Xi|=a,n.lanes=a,n.memoizedState=d}}function Nm(n,e,t){if(n=e.effects,e.effects=null,n!==null)for(e=0;e<n.length;e++){var r=n[e],i=r.callback;if(i!==null){if(r.callback=null,r=t,typeof i!="function")throw Error(K(191,i));i.call(r)}}}var Go={},tr=xi(Go),yo=xi(Go),vo=xi(Go);function Mi(n){if(n===Go)throw Error(K(174));return n}function Bf(n,e){switch(Ue(vo,e),Ue(yo,n),Ue(tr,Go),n=e.nodeType,n){case 9:case 11:e=(e=e.documentElement)?e.namespaceURI:zd(null,"");break;default:n=n===8?e.parentNode:e,e=n.namespaceURI||null,n=n.tagName,e=zd(e,n)}je(tr),Ue(tr,e)}function la(){je(tr),je(yo),je(vo)}function Vv(n){Mi(vo.current);var e=Mi(tr.current),t=zd(e,n.type);e!==t&&(Ue(yo,n),Ue(tr,t))}function $f(n){yo.current===n&&(je(tr),je(yo))}var We=xi(0);function wu(n){for(var e=n;e!==null;){if(e.tag===13){var t=e.memoizedState;if(t!==null&&(t=t.dehydrated,t===null||t.data==="$?"||t.data==="$!"))return e}else if(e.tag===19&&e.memoizedProps.revealOrder!==void 0){if(e.flags&128)return e}else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===n)break;for(;e.sibling===null;){if(e.return===null||e.return===n)return null;e=e.return}e.sibling.return=e.return,e=e.sibling}return null}var Wc=[];function jf(){for(var n=0;n<Wc.length;n++)Wc[n]._workInProgressVersionPrimary=null;Wc.length=0}var Ql=Cr.ReactCurrentDispatcher,Yc=Cr.ReactCurrentBatchConfig,Qi=0,Ye=null,ut=null,yt=null,bu=!1,Xa=!1,Eo=0,oL=0;function At(){throw Error(K(321))}function Gf(n,e){if(e===null)return!1;for(var t=0;t<e.length&&t<n.length;t++)if(!Fn(n[t],e[t]))return!1;return!0}function Kf(n,e,t,r,i,s){if(Qi=s,Ye=e,e.memoizedState=null,e.updateQueue=null,e.lanes=0,Ql.current=n===null||n.memoizedState===null?dL:hL,n=t(r,i),Xa){s=0;do{if(Xa=!1,Eo=0,25<=s)throw Error(K(301));s+=1,yt=ut=null,e.updateQueue=null,Ql.current=fL,n=t(r,i)}while(Xa)}if(Ql.current=ku,e=ut!==null&&ut.next!==null,Qi=0,yt=ut=Ye=null,bu=!1,e)throw Error(K(300));return n}function Vf(){var n=Eo!==0;return Eo=0,n}function jn(){var n={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return yt===null?Ye.memoizedState=yt=n:yt=yt.next=n,yt}function xn(){if(ut===null){var n=Ye.alternate;n=n!==null?n.memoizedState:null}else n=ut.next;var e=yt===null?Ye.memoizedState:yt.next;if(e!==null)yt=e,ut=n;else{if(n===null)throw Error(K(310));ut=n,n={memoizedState:ut.memoizedState,baseState:ut.baseState,baseQueue:ut.baseQueue,queue:ut.queue,next:null},yt===null?Ye.memoizedState=yt=n:yt=yt.next=n}return yt}function So(n,e){return typeof e=="function"?e(n):e}function qc(n){var e=xn(),t=e.queue;if(t===null)throw Error(K(311));t.lastRenderedReducer=n;var r=ut,i=r.baseQueue,s=t.pending;if(s!==null){if(i!==null){var a=i.next;i.next=s.next,s.next=a}r.baseQueue=i=s,t.pending=null}if(i!==null){s=i.next,r=r.baseState;var o=a=null,l=null,u=s;do{var c=u.lane;if((Qi&c)===c)l!==null&&(l=l.next={lane:0,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null}),r=u.hasEagerState?u.eagerState:n(r,u.action);else{var d={lane:c,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null};l===null?(o=l=d,a=r):l=l.next=d,Ye.lanes|=c,Xi|=c}u=u.next}while(u!==null&&u!==s);l===null?a=r:l.next=o,Fn(r,e.memoizedState)||(Kt=!0),e.memoizedState=r,e.baseState=a,e.baseQueue=l,t.lastRenderedState=r}if(n=t.interleaved,n!==null){i=n;do s=i.lane,Ye.lanes|=s,Xi|=s,i=i.next;while(i!==n)}else i===null&&(t.lanes=0);return[e.memoizedState,t.dispatch]}function Qc(n){var e=xn(),t=e.queue;if(t===null)throw Error(K(311));t.lastRenderedReducer=n;var r=t.dispatch,i=t.pending,s=e.memoizedState;if(i!==null){t.pending=null;var a=i=i.next;do s=n(s,a.action),a=a.next;while(a!==i);Fn(s,e.memoizedState)||(Kt=!0),e.memoizedState=s,e.baseQueue===null&&(e.baseState=s),t.lastRenderedState=s}return[s,r]}function Hv(){}function zv(n,e){var t=Ye,r=xn(),i=e(),s=!Fn(r.memoizedState,i);if(s&&(r.memoizedState=i,Kt=!0),r=r.queue,Hf(qv.bind(null,t,r,n),[n]),r.getSnapshot!==e||s||yt!==null&&yt.memoizedState.tag&1){if(t.flags|=2048,xo(9,Yv.bind(null,t,r,i,e),void 0,null),St===null)throw Error(K(349));Qi&30||Wv(t,e,i)}return i}function Wv(n,e,t){n.flags|=16384,n={getSnapshot:e,value:t},e=Ye.updateQueue,e===null?(e={lastEffect:null,stores:null},Ye.updateQueue=e,e.stores=[n]):(t=e.stores,t===null?e.stores=[n]:t.push(n))}function Yv(n,e,t,r){e.value=t,e.getSnapshot=r,Qv(e)&&Xv(n)}function qv(n,e,t){return t(function(){Qv(e)&&Xv(n)})}function Qv(n){var e=n.getSnapshot;n=n.value;try{var t=e();return!Fn(n,t)}catch{return!0}}function Xv(n){var e=Ir(n,1);e!==null&&On(e,n,1,-1)}function Um(n){var e=jn();return typeof n=="function"&&(n=n()),e.memoizedState=e.baseState=n,n={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:So,lastRenderedState:n},e.queue=n,n=n.dispatch=cL.bind(null,Ye,n),[e.memoizedState,n]}function xo(n,e,t,r){return n={tag:n,create:e,destroy:t,deps:r,next:null},e=Ye.updateQueue,e===null?(e={lastEffect:null,stores:null},Ye.updateQueue=e,e.lastEffect=n.next=n):(t=e.lastEffect,t===null?e.lastEffect=n.next=n:(r=t.next,t.next=n,n.next=r,e.lastEffect=n)),n}function Zv(){return xn().memoizedState}function Xl(n,e,t,r){var i=jn();Ye.flags|=n,i.memoizedState=xo(1|e,t,void 0,r===void 0?null:r)}function ac(n,e,t,r){var i=xn();r=r===void 0?null:r;var s=void 0;if(ut!==null){var a=ut.memoizedState;if(s=a.destroy,r!==null&&Gf(r,a.deps)){i.memoizedState=xo(e,t,s,r);return}}Ye.flags|=n,i.memoizedState=xo(1|e,t,s,r)}function Bm(n,e){return Xl(8390656,8,n,e)}function Hf(n,e){return ac(2048,8,n,e)}function Jv(n,e){return ac(4,2,n,e)}function eE(n,e){return ac(4,4,n,e)}function tE(n,e){if(typeof e=="function")return n=n(),e(n),function(){e(null)};if(e!=null)return n=n(),e.current=n,function(){e.current=null}}function nE(n,e,t){return t=t!=null?t.concat([n]):null,ac(4,4,tE.bind(null,e,n),t)}function zf(){}function rE(n,e){var t=xn();e=e===void 0?null:e;var r=t.memoizedState;return r!==null&&e!==null&&Gf(e,r[1])?r[0]:(t.memoizedState=[n,e],n)}function iE(n,e){var t=xn();e=e===void 0?null:e;var r=t.memoizedState;return r!==null&&e!==null&&Gf(e,r[1])?r[0]:(n=n(),t.memoizedState=[n,e],n)}function sE(n,e,t){return Qi&21?(Fn(t,e)||(t=cv(),Ye.lanes|=t,Xi|=t,n.baseState=!0),e):(n.baseState&&(n.baseState=!1,Kt=!0),n.memoizedState=t)}function lL(n,e){var t=Pe;Pe=t!==0&&4>t?t:4,n(!0);var r=Yc.transition;Yc.transition={};try{n(!1),e()}finally{Pe=t,Yc.transition=r}}function aE(){return xn().memoizedState}function uL(n,e,t){var r=hi(n);if(t={lane:r,action:t,hasEagerState:!1,eagerState:null,next:null},oE(n))lE(e,t);else if(t=Gv(n,e,t,r),t!==null){var i=Ft();On(t,n,r,i),uE(t,e,r)}}function cL(n,e,t){var r=hi(n),i={lane:r,action:t,hasEagerState:!1,eagerState:null,next:null};if(oE(n))lE(e,i);else{var s=n.alternate;if(n.lanes===0&&(s===null||s.lanes===0)&&(s=e.lastRenderedReducer,s!==null))try{var a=e.lastRenderedState,o=s(a,t);if(i.hasEagerState=!0,i.eagerState=o,Fn(o,a)){var l=e.interleaved;l===null?(i.next=i,Nf(e)):(i.next=l.next,l.next=i),e.interleaved=i;return}}catch{}finally{}t=Gv(n,e,i,r),t!==null&&(i=Ft(),On(t,n,r,i),uE(t,e,r))}}function oE(n){var e=n.alternate;return n===Ye||e!==null&&e===Ye}function lE(n,e){Xa=bu=!0;var t=n.pending;t===null?e.next=e:(e.next=t.next,t.next=e),n.pending=e}function uE(n,e,t){if(t&4194240){var r=e.lanes;r&=n.pendingLanes,t|=r,e.lanes=t,Lf(n,t)}}var ku={readContext:Sn,useCallback:At,useContext:At,useEffect:At,useImperativeHandle:At,useInsertionEffect:At,useLayoutEffect:At,useMemo:At,useReducer:At,useRef:At,useState:At,useDebugValue:At,useDeferredValue:At,useTransition:At,useMutableSource:At,useSyncExternalStore:At,useId:At,unstable_isNewReconciler:!1},dL={readContext:Sn,useCallback:function(n,e){return jn().memoizedState=[n,e===void 0?null:e],n},useContext:Sn,useEffect:Bm,useImperativeHandle:function(n,e,t){return t=t!=null?t.concat([n]):null,Xl(4194308,4,tE.bind(null,e,n),t)},useLayoutEffect:function(n,e){return Xl(4194308,4,n,e)},useInsertionEffect:function(n,e){return Xl(4,2,n,e)},useMemo:function(n,e){var t=jn();return e=e===void 0?null:e,n=n(),t.memoizedState=[n,e],n},useReducer:function(n,e,t){var r=jn();return e=t!==void 0?t(e):e,r.memoizedState=r.baseState=e,n={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:n,lastRenderedState:e},r.queue=n,n=n.dispatch=uL.bind(null,Ye,n),[r.memoizedState,n]},useRef:function(n){var e=jn();return n={current:n},e.memoizedState=n},useState:Um,useDebugValue:zf,useDeferredValue:function(n){return jn().memoizedState=n},useTransition:function(){var n=Um(!1),e=n[0];return n=lL.bind(null,n[1]),jn().memoizedState=n,[e,n]},useMutableSource:function(){},useSyncExternalStore:function(n,e,t){var r=Ye,i=jn();if(Ke){if(t===void 0)throw Error(K(407));t=t()}else{if(t=e(),St===null)throw Error(K(349));Qi&30||Wv(r,e,t)}i.memoizedState=t;var s={value:t,getSnapshot:e};return i.queue=s,Bm(qv.bind(null,r,s,n),[n]),r.flags|=2048,xo(9,Yv.bind(null,r,s,t,e),void 0,null),t},useId:function(){var n=jn(),e=St.identifierPrefix;if(Ke){var t=xr,r=Sr;t=(r&~(1<<32-Pn(r)-1)).toString(32)+t,e=":"+e+"R"+t,t=Eo++,0<t&&(e+="H"+t.toString(32)),e+=":"}else t=oL++,e=":"+e+"r"+t.toString(32)+":";return n.memoizedState=e},unstable_isNewReconciler:!1},hL={readContext:Sn,useCallback:rE,useContext:Sn,useEffect:Hf,useImperativeHandle:nE,useInsertionEffect:Jv,useLayoutEffect:eE,useMemo:iE,useReducer:qc,useRef:Zv,useState:function(){return qc(So)},useDebugValue:zf,useDeferredValue:function(n){var e=xn();return sE(e,ut.memoizedState,n)},useTransition:function(){var n=qc(So)[0],e=xn().memoizedState;return[n,e]},useMutableSource:Hv,useSyncExternalStore:zv,useId:aE,unstable_isNewReconciler:!1},fL={readContext:Sn,useCallback:rE,useContext:Sn,useEffect:Hf,useImperativeHandle:nE,useInsertionEffect:Jv,useLayoutEffect:eE,useMemo:iE,useReducer:Qc,useRef:Zv,useState:function(){return Qc(So)},useDebugValue:zf,useDeferredValue:function(n){var e=xn();return ut===null?e.memoizedState=n:sE(e,ut.memoizedState,n)},useTransition:function(){var n=Qc(So)[0],e=xn().memoizedState;return[n,e]},useMutableSource:Hv,useSyncExternalStore:zv,useId:aE,unstable_isNewReconciler:!1};function _n(n,e){if(n&&n.defaultProps){e=qe({},e),n=n.defaultProps;for(var t in n)e[t]===void 0&&(e[t]=n[t]);return e}return e}function fh(n,e,t,r){e=n.memoizedState,t=t(r,e),t=t==null?e:qe({},e,t),n.memoizedState=t,n.lanes===0&&(n.updateQueue.baseState=t)}var oc={isMounted:function(n){return(n=n._reactInternals)?ss(n)===n:!1},enqueueSetState:function(n,e,t){n=n._reactInternals;var r=Ft(),i=hi(n),s=Tr(r,i);s.payload=e,t!=null&&(s.callback=t),e=ci(n,s,i),e!==null&&(On(e,n,i,r),ql(e,n,i))},enqueueReplaceState:function(n,e,t){n=n._reactInternals;var r=Ft(),i=hi(n),s=Tr(r,i);s.tag=1,s.payload=e,t!=null&&(s.callback=t),e=ci(n,s,i),e!==null&&(On(e,n,i,r),ql(e,n,i))},enqueueForceUpdate:function(n,e){n=n._reactInternals;var t=Ft(),r=hi(n),i=Tr(t,r);i.tag=2,e!=null&&(i.callback=e),e=ci(n,i,r),e!==null&&(On(e,n,r,t),ql(e,n,r))}};function $m(n,e,t,r,i,s,a){return n=n.stateNode,typeof n.shouldComponentUpdate=="function"?n.shouldComponentUpdate(r,s,a):e.prototype&&e.prototype.isPureReactComponent?!fo(t,r)||!fo(i,s):!0}function cE(n,e,t){var r=!1,i=mi,s=e.contextType;return typeof s=="object"&&s!==null?s=Sn(s):(i=Ht(e)?Yi:Ct.current,r=e.contextTypes,s=(r=r!=null)?sa(n,i):mi),e=new e(t,s),n.memoizedState=e.state!==null&&e.state!==void 0?e.state:null,e.updater=oc,n.stateNode=e,e._reactInternals=n,r&&(n=n.stateNode,n.__reactInternalMemoizedUnmaskedChildContext=i,n.__reactInternalMemoizedMaskedChildContext=s),e}function jm(n,e,t,r){n=e.state,typeof e.componentWillReceiveProps=="function"&&e.componentWillReceiveProps(t,r),typeof e.UNSAFE_componentWillReceiveProps=="function"&&e.UNSAFE_componentWillReceiveProps(t,r),e.state!==n&&oc.enqueueReplaceState(e,e.state,null)}function gh(n,e,t,r){var i=n.stateNode;i.props=t,i.state=n.memoizedState,i.refs={},Uf(n);var s=e.contextType;typeof s=="object"&&s!==null?i.context=Sn(s):(s=Ht(e)?Yi:Ct.current,i.context=sa(n,s)),i.state=n.memoizedState,s=e.getDerivedStateFromProps,typeof s=="function"&&(fh(n,e,s,t),i.state=n.memoizedState),typeof e.getDerivedStateFromProps=="function"||typeof i.getSnapshotBeforeUpdate=="function"||typeof i.UNSAFE_componentWillMount!="function"&&typeof i.componentWillMount!="function"||(e=i.state,typeof i.componentWillMount=="function"&&i.componentWillMount(),typeof i.UNSAFE_componentWillMount=="function"&&i.UNSAFE_componentWillMount(),e!==i.state&&oc.enqueueReplaceState(i,i.state,null),Cu(n,t,i,r),i.state=n.memoizedState),typeof i.componentDidMount=="function"&&(n.flags|=4194308)}function ua(n,e){try{var t="",r=e;do t+=jT(r),r=r.return;while(r);var i=t}catch(s){i=`
Error generating stack: `+s.message+`
`+s.stack}return{value:n,source:e,stack:i,digest:null}}function Xc(n,e,t){return{value:n,source:null,stack:t??null,digest:e??null}}function mh(n,e){try{console.error(e.value)}catch(t){setTimeout(function(){throw t})}}var gL=typeof WeakMap=="function"?WeakMap:Map;function dE(n,e,t){t=Tr(-1,t),t.tag=3,t.payload={element:null};var r=e.value;return t.callback=function(){Ou||(Ou=!0,Rh=r),mh(n,e)},t}function hE(n,e,t){t=Tr(-1,t),t.tag=3;var r=n.type.getDerivedStateFromError;if(typeof r=="function"){var i=e.value;t.payload=function(){return r(i)},t.callback=function(){mh(n,e)}}var s=n.stateNode;return s!==null&&typeof s.componentDidCatch=="function"&&(t.callback=function(){mh(n,e),typeof r!="function"&&(di===null?di=new Set([this]):di.add(this));var a=e.stack;this.componentDidCatch(e.value,{componentStack:a!==null?a:""})}),t}function Gm(n,e,t){var r=n.pingCache;if(r===null){r=n.pingCache=new gL;var i=new Set;r.set(e,i)}else i=r.get(e),i===void 0&&(i=new Set,r.set(e,i));i.has(t)||(i.add(t),n=DL.bind(null,n,e,t),e.then(n,n))}function Km(n){do{var e;if((e=n.tag===13)&&(e=n.memoizedState,e=e!==null?e.dehydrated!==null:!0),e)return n;n=n.return}while(n!==null);return null}function Vm(n,e,t,r,i){return n.mode&1?(n.flags|=65536,n.lanes=i,n):(n===e?n.flags|=65536:(n.flags|=128,t.flags|=131072,t.flags&=-52805,t.tag===1&&(t.alternate===null?t.tag=17:(e=Tr(-1,1),e.tag=2,ci(t,e,1))),t.lanes|=1),n)}var mL=Cr.ReactCurrentOwner,Kt=!1;function Ot(n,e,t,r){e.child=n===null?jv(e,null,t,r):oa(e,n.child,t,r)}function Hm(n,e,t,r,i){t=t.render;var s=e.ref;return Bs(e,i),r=Kf(n,e,t,r,s,i),t=Vf(),n!==null&&!Kt?(e.updateQueue=n.updateQueue,e.flags&=-2053,n.lanes&=~i,Dr(n,e,i)):(Ke&&t&&bf(e),e.flags|=1,Ot(n,e,r,i),e.child)}function zm(n,e,t,r,i){if(n===null){var s=t.type;return typeof s=="function"&&!eg(s)&&s.defaultProps===void 0&&t.compare===null&&t.defaultProps===void 0?(e.tag=15,e.type=s,fE(n,e,s,r,i)):(n=tu(t.type,null,r,e,e.mode,i),n.ref=e.ref,n.return=e,e.child=n)}if(s=n.child,!(n.lanes&i)){var a=s.memoizedProps;if(t=t.compare,t=t!==null?t:fo,t(a,r)&&n.ref===e.ref)return Dr(n,e,i)}return e.flags|=1,n=fi(s,r),n.ref=e.ref,n.return=e,e.child=n}function fE(n,e,t,r,i){if(n!==null){var s=n.memoizedProps;if(fo(s,r)&&n.ref===e.ref)if(Kt=!1,e.pendingProps=r=s,(n.lanes&i)!==0)n.flags&131072&&(Kt=!0);else return e.lanes=n.lanes,Dr(n,e,i)}return ph(n,e,t,r,i)}function gE(n,e,t){var r=e.pendingProps,i=r.children,s=n!==null?n.memoizedState:null;if(r.mode==="hidden")if(!(e.mode&1))e.memoizedState={baseLanes:0,cachePool:null,transitions:null},Ue(ws,Zt),Zt|=t;else{if(!(t&1073741824))return n=s!==null?s.baseLanes|t:t,e.lanes=e.childLanes=1073741824,e.memoizedState={baseLanes:n,cachePool:null,transitions:null},e.updateQueue=null,Ue(ws,Zt),Zt|=n,null;e.memoizedState={baseLanes:0,cachePool:null,transitions:null},r=s!==null?s.baseLanes:t,Ue(ws,Zt),Zt|=r}else s!==null?(r=s.baseLanes|t,e.memoizedState=null):r=t,Ue(ws,Zt),Zt|=r;return Ot(n,e,i,t),e.child}function mE(n,e){var t=e.ref;(n===null&&t!==null||n!==null&&n.ref!==t)&&(e.flags|=512,e.flags|=2097152)}function ph(n,e,t,r,i){var s=Ht(t)?Yi:Ct.current;return s=sa(e,s),Bs(e,i),t=Kf(n,e,t,r,s,i),r=Vf(),n!==null&&!Kt?(e.updateQueue=n.updateQueue,e.flags&=-2053,n.lanes&=~i,Dr(n,e,i)):(Ke&&r&&bf(e),e.flags|=1,Ot(n,e,t,i),e.child)}function Wm(n,e,t,r,i){if(Ht(t)){var s=!0;Au(e)}else s=!1;if(Bs(e,i),e.stateNode===null)Zl(n,e),cE(e,t,r),gh(e,t,r,i),r=!0;else if(n===null){var a=e.stateNode,o=e.memoizedProps;a.props=o;var l=a.context,u=t.contextType;typeof u=="object"&&u!==null?u=Sn(u):(u=Ht(t)?Yi:Ct.current,u=sa(e,u));var c=t.getDerivedStateFromProps,d=typeof c=="function"||typeof a.getSnapshotBeforeUpdate=="function";d||typeof a.UNSAFE_componentWillReceiveProps!="function"&&typeof a.componentWillReceiveProps!="function"||(o!==r||l!==u)&&jm(e,a,r,u),Gr=!1;var h=e.memoizedState;a.state=h,Cu(e,r,a,i),l=e.memoizedState,o!==r||h!==l||Vt.current||Gr?(typeof c=="function"&&(fh(e,t,c,r),l=e.memoizedState),(o=Gr||$m(e,t,o,r,h,l,u))?(d||typeof a.UNSAFE_componentWillMount!="function"&&typeof a.componentWillMount!="function"||(typeof a.componentWillMount=="function"&&a.componentWillMount(),typeof a.UNSAFE_componentWillMount=="function"&&a.UNSAFE_componentWillMount()),typeof a.componentDidMount=="function"&&(e.flags|=4194308)):(typeof a.componentDidMount=="function"&&(e.flags|=4194308),e.memoizedProps=r,e.memoizedState=l),a.props=r,a.state=l,a.context=u,r=o):(typeof a.componentDidMount=="function"&&(e.flags|=4194308),r=!1)}else{a=e.stateNode,Kv(n,e),o=e.memoizedProps,u=e.type===e.elementType?o:_n(e.type,o),a.props=u,d=e.pendingProps,h=a.context,l=t.contextType,typeof l=="object"&&l!==null?l=Sn(l):(l=Ht(t)?Yi:Ct.current,l=sa(e,l));var f=t.getDerivedStateFromProps;(c=typeof f=="function"||typeof a.getSnapshotBeforeUpdate=="function")||typeof a.UNSAFE_componentWillReceiveProps!="function"&&typeof a.componentWillReceiveProps!="function"||(o!==d||h!==l)&&jm(e,a,r,l),Gr=!1,h=e.memoizedState,a.state=h,Cu(e,r,a,i);var g=e.memoizedState;o!==d||h!==g||Vt.current||Gr?(typeof f=="function"&&(fh(e,t,f,r),g=e.memoizedState),(u=Gr||$m(e,t,u,r,h,g,l)||!1)?(c||typeof a.UNSAFE_componentWillUpdate!="function"&&typeof a.componentWillUpdate!="function"||(typeof a.componentWillUpdate=="function"&&a.componentWillUpdate(r,g,l),typeof a.UNSAFE_componentWillUpdate=="function"&&a.UNSAFE_componentWillUpdate(r,g,l)),typeof a.componentDidUpdate=="function"&&(e.flags|=4),typeof a.getSnapshotBeforeUpdate=="function"&&(e.flags|=1024)):(typeof a.componentDidUpdate!="function"||o===n.memoizedProps&&h===n.memoizedState||(e.flags|=4),typeof a.getSnapshotBeforeUpdate!="function"||o===n.memoizedProps&&h===n.memoizedState||(e.flags|=1024),e.memoizedProps=r,e.memoizedState=g),a.props=r,a.state=g,a.context=l,r=u):(typeof a.componentDidUpdate!="function"||o===n.memoizedProps&&h===n.memoizedState||(e.flags|=4),typeof a.getSnapshotBeforeUpdate!="function"||o===n.memoizedProps&&h===n.memoizedState||(e.flags|=1024),r=!1)}return yh(n,e,t,r,s,i)}function yh(n,e,t,r,i,s){mE(n,e);var a=(e.flags&128)!==0;if(!r&&!a)return i&&km(e,t,!1),Dr(n,e,s);r=e.stateNode,mL.current=e;var o=a&&typeof t.getDerivedStateFromError!="function"?null:r.render();return e.flags|=1,n!==null&&a?(e.child=oa(e,n.child,null,s),e.child=oa(e,null,o,s)):Ot(n,e,o,s),e.memoizedState=r.state,i&&km(e,t,!0),e.child}function pE(n){var e=n.stateNode;e.pendingContext?bm(n,e.pendingContext,e.pendingContext!==e.context):e.context&&bm(n,e.context,!1),Bf(n,e.containerInfo)}function Ym(n,e,t,r,i){return aa(),Pf(i),e.flags|=256,Ot(n,e,t,r),e.child}var vh={dehydrated:null,treeContext:null,retryLane:0};function Eh(n){return{baseLanes:n,cachePool:null,transitions:null}}function yE(n,e,t){var r=e.pendingProps,i=We.current,s=!1,a=(e.flags&128)!==0,o;if((o=a)||(o=n!==null&&n.memoizedState===null?!1:(i&2)!==0),o?(s=!0,e.flags&=-129):(n===null||n.memoizedState!==null)&&(i|=1),Ue(We,i&1),n===null)return dh(e),n=e.memoizedState,n!==null&&(n=n.dehydrated,n!==null)?(e.mode&1?n.data==="$!"?e.lanes=8:e.lanes=1073741824:e.lanes=1,null):(a=r.children,n=r.fallback,s?(r=e.mode,s=e.child,a={mode:"hidden",children:a},!(r&1)&&s!==null?(s.childLanes=0,s.pendingProps=a):s=cc(a,r,0,null),n=zi(n,r,t,null),s.return=e,n.return=e,s.sibling=n,e.child=s,e.child.memoizedState=Eh(t),e.memoizedState=vh,n):Wf(e,a));if(i=n.memoizedState,i!==null&&(o=i.dehydrated,o!==null))return pL(n,e,a,r,o,i,t);if(s){s=r.fallback,a=e.mode,i=n.child,o=i.sibling;var l={mode:"hidden",children:r.children};return!(a&1)&&e.child!==i?(r=e.child,r.childLanes=0,r.pendingProps=l,e.deletions=null):(r=fi(i,l),r.subtreeFlags=i.subtreeFlags&14680064),o!==null?s=fi(o,s):(s=zi(s,a,t,null),s.flags|=2),s.return=e,r.return=e,r.sibling=s,e.child=r,r=s,s=e.child,a=n.child.memoizedState,a=a===null?Eh(t):{baseLanes:a.baseLanes|t,cachePool:null,transitions:a.transitions},s.memoizedState=a,s.childLanes=n.childLanes&~t,e.memoizedState=vh,r}return s=n.child,n=s.sibling,r=fi(s,{mode:"visible",children:r.children}),!(e.mode&1)&&(r.lanes=t),r.return=e,r.sibling=null,n!==null&&(t=e.deletions,t===null?(e.deletions=[n],e.flags|=16):t.push(n)),e.child=r,e.memoizedState=null,r}function Wf(n,e){return e=cc({mode:"visible",children:e},n.mode,0,null),e.return=n,n.child=e}function vl(n,e,t,r){return r!==null&&Pf(r),oa(e,n.child,null,t),n=Wf(e,e.pendingProps.children),n.flags|=2,e.memoizedState=null,n}function pL(n,e,t,r,i,s,a){if(t)return e.flags&256?(e.flags&=-257,r=Xc(Error(K(422))),vl(n,e,a,r)):e.memoizedState!==null?(e.child=n.child,e.flags|=128,null):(s=r.fallback,i=e.mode,r=cc({mode:"visible",children:r.children},i,0,null),s=zi(s,i,a,null),s.flags|=2,r.return=e,s.return=e,r.sibling=s,e.child=r,e.mode&1&&oa(e,n.child,null,a),e.child.memoizedState=Eh(a),e.memoizedState=vh,s);if(!(e.mode&1))return vl(n,e,a,null);if(i.data==="$!"){if(r=i.nextSibling&&i.nextSibling.dataset,r)var o=r.dgst;return r=o,s=Error(K(419)),r=Xc(s,r,void 0),vl(n,e,a,r)}if(o=(a&n.childLanes)!==0,Kt||o){if(r=St,r!==null){switch(a&-a){case 4:i=2;break;case 16:i=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:i=32;break;case 536870912:i=268435456;break;default:i=0}i=i&(r.suspendedLanes|a)?0:i,i!==0&&i!==s.retryLane&&(s.retryLane=i,Ir(n,i),On(r,n,i,-1))}return Jf(),r=Xc(Error(K(421))),vl(n,e,a,r)}return i.data==="$?"?(e.flags|=128,e.child=n.child,e=CL.bind(null,n),i._reactRetry=e,null):(n=s.treeContext,tn=ui(i.nextSibling),rn=e,Ke=!0,bn=null,n!==null&&(mn[pn++]=Sr,mn[pn++]=xr,mn[pn++]=qi,Sr=n.id,xr=n.overflow,qi=e),e=Wf(e,r.children),e.flags|=4096,e)}function qm(n,e,t){n.lanes|=e;var r=n.alternate;r!==null&&(r.lanes|=e),hh(n.return,e,t)}function Zc(n,e,t,r,i){var s=n.memoizedState;s===null?n.memoizedState={isBackwards:e,rendering:null,renderingStartTime:0,last:r,tail:t,tailMode:i}:(s.isBackwards=e,s.rendering=null,s.renderingStartTime=0,s.last=r,s.tail=t,s.tailMode=i)}function vE(n,e,t){var r=e.pendingProps,i=r.revealOrder,s=r.tail;if(Ot(n,e,r.children,t),r=We.current,r&2)r=r&1|2,e.flags|=128;else{if(n!==null&&n.flags&128)e:for(n=e.child;n!==null;){if(n.tag===13)n.memoizedState!==null&&qm(n,t,e);else if(n.tag===19)qm(n,t,e);else if(n.child!==null){n.child.return=n,n=n.child;continue}if(n===e)break e;for(;n.sibling===null;){if(n.return===null||n.return===e)break e;n=n.return}n.sibling.return=n.return,n=n.sibling}r&=1}if(Ue(We,r),!(e.mode&1))e.memoizedState=null;else switch(i){case"forwards":for(t=e.child,i=null;t!==null;)n=t.alternate,n!==null&&wu(n)===null&&(i=t),t=t.sibling;t=i,t===null?(i=e.child,e.child=null):(i=t.sibling,t.sibling=null),Zc(e,!1,i,t,s);break;case"backwards":for(t=null,i=e.child,e.child=null;i!==null;){if(n=i.alternate,n!==null&&wu(n)===null){e.child=i;break}n=i.sibling,i.sibling=t,t=i,i=n}Zc(e,!0,t,null,s);break;case"together":Zc(e,!1,null,null,void 0);break;default:e.memoizedState=null}return e.child}function Zl(n,e){!(e.mode&1)&&n!==null&&(n.alternate=null,e.alternate=null,e.flags|=2)}function Dr(n,e,t){if(n!==null&&(e.dependencies=n.dependencies),Xi|=e.lanes,!(t&e.childLanes))return null;if(n!==null&&e.child!==n.child)throw Error(K(153));if(e.child!==null){for(n=e.child,t=fi(n,n.pendingProps),e.child=t,t.return=e;n.sibling!==null;)n=n.sibling,t=t.sibling=fi(n,n.pendingProps),t.return=e;t.sibling=null}return e.child}function yL(n,e,t){switch(e.tag){case 3:pE(e),aa();break;case 5:Vv(e);break;case 1:Ht(e.type)&&Au(e);break;case 4:Bf(e,e.stateNode.containerInfo);break;case 10:var r=e.type._context,i=e.memoizedProps.value;Ue(Iu,r._currentValue),r._currentValue=i;break;case 13:if(r=e.memoizedState,r!==null)return r.dehydrated!==null?(Ue(We,We.current&1),e.flags|=128,null):t&e.child.childLanes?yE(n,e,t):(Ue(We,We.current&1),n=Dr(n,e,t),n!==null?n.sibling:null);Ue(We,We.current&1);break;case 19:if(r=(t&e.childLanes)!==0,n.flags&128){if(r)return vE(n,e,t);e.flags|=128}if(i=e.memoizedState,i!==null&&(i.rendering=null,i.tail=null,i.lastEffect=null),Ue(We,We.current),r)break;return null;case 22:case 23:return e.lanes=0,gE(n,e,t)}return Dr(n,e,t)}var EE,Sh,SE,xE;EE=function(n,e){for(var t=e.child;t!==null;){if(t.tag===5||t.tag===6)n.appendChild(t.stateNode);else if(t.tag!==4&&t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return;t=t.return}t.sibling.return=t.return,t=t.sibling}};Sh=function(){};SE=function(n,e,t,r){var i=n.memoizedProps;if(i!==r){n=e.stateNode,Mi(tr.current);var s=null;switch(t){case"input":i=Gd(n,i),r=Gd(n,r),s=[];break;case"select":i=qe({},i,{value:void 0}),r=qe({},r,{value:void 0}),s=[];break;case"textarea":i=Hd(n,i),r=Hd(n,r),s=[];break;default:typeof i.onClick!="function"&&typeof r.onClick=="function"&&(n.onclick=Tu)}Wd(t,r);var a;t=null;for(u in i)if(!r.hasOwnProperty(u)&&i.hasOwnProperty(u)&&i[u]!=null)if(u==="style"){var o=i[u];for(a in o)o.hasOwnProperty(a)&&(t||(t={}),t[a]="")}else u!=="dangerouslySetInnerHTML"&&u!=="children"&&u!=="suppressContentEditableWarning"&&u!=="suppressHydrationWarning"&&u!=="autoFocus"&&(so.hasOwnProperty(u)?s||(s=[]):(s=s||[]).push(u,null));for(u in r){var l=r[u];if(o=i!=null?i[u]:void 0,r.hasOwnProperty(u)&&l!==o&&(l!=null||o!=null))if(u==="style")if(o){for(a in o)!o.hasOwnProperty(a)||l&&l.hasOwnProperty(a)||(t||(t={}),t[a]="");for(a in l)l.hasOwnProperty(a)&&o[a]!==l[a]&&(t||(t={}),t[a]=l[a])}else t||(s||(s=[]),s.push(u,t)),t=l;else u==="dangerouslySetInnerHTML"?(l=l?l.__html:void 0,o=o?o.__html:void 0,l!=null&&o!==l&&(s=s||[]).push(u,l)):u==="children"?typeof l!="string"&&typeof l!="number"||(s=s||[]).push(u,""+l):u!=="suppressContentEditableWarning"&&u!=="suppressHydrationWarning"&&(so.hasOwnProperty(u)?(l!=null&&u==="onScroll"&&$e("scroll",n),s||o===l||(s=[])):(s=s||[]).push(u,l))}t&&(s=s||[]).push("style",t);var u=s;(e.updateQueue=u)&&(e.flags|=4)}};xE=function(n,e,t,r){t!==r&&(e.flags|=4)};function wa(n,e){if(!Ke)switch(n.tailMode){case"hidden":e=n.tail;for(var t=null;e!==null;)e.alternate!==null&&(t=e),e=e.sibling;t===null?n.tail=null:t.sibling=null;break;case"collapsed":t=n.tail;for(var r=null;t!==null;)t.alternate!==null&&(r=t),t=t.sibling;r===null?e||n.tail===null?n.tail=null:n.tail.sibling=null:r.sibling=null}}function Rt(n){var e=n.alternate!==null&&n.alternate.child===n.child,t=0,r=0;if(e)for(var i=n.child;i!==null;)t|=i.lanes|i.childLanes,r|=i.subtreeFlags&14680064,r|=i.flags&14680064,i.return=n,i=i.sibling;else for(i=n.child;i!==null;)t|=i.lanes|i.childLanes,r|=i.subtreeFlags,r|=i.flags,i.return=n,i=i.sibling;return n.subtreeFlags|=r,n.childLanes=t,e}function vL(n,e,t){var r=e.pendingProps;switch(kf(e),e.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Rt(e),null;case 1:return Ht(e.type)&&Lu(),Rt(e),null;case 3:return r=e.stateNode,la(),je(Vt),je(Ct),jf(),r.pendingContext&&(r.context=r.pendingContext,r.pendingContext=null),(n===null||n.child===null)&&(pl(e)?e.flags|=4:n===null||n.memoizedState.isDehydrated&&!(e.flags&256)||(e.flags|=1024,bn!==null&&(Dh(bn),bn=null))),Sh(n,e),Rt(e),null;case 5:$f(e);var i=Mi(vo.current);if(t=e.type,n!==null&&e.stateNode!=null)SE(n,e,t,r,i),n.ref!==e.ref&&(e.flags|=512,e.flags|=2097152);else{if(!r){if(e.stateNode===null)throw Error(K(166));return Rt(e),null}if(n=Mi(tr.current),pl(e)){r=e.stateNode,t=e.type;var s=e.memoizedProps;switch(r[qn]=e,r[po]=s,n=(e.mode&1)!==0,t){case"dialog":$e("cancel",r),$e("close",r);break;case"iframe":case"object":case"embed":$e("load",r);break;case"video":case"audio":for(i=0;i<ja.length;i++)$e(ja[i],r);break;case"source":$e("error",r);break;case"img":case"image":case"link":$e("error",r),$e("load",r);break;case"details":$e("toggle",r);break;case"input":im(r,s),$e("invalid",r);break;case"select":r._wrapperState={wasMultiple:!!s.multiple},$e("invalid",r);break;case"textarea":am(r,s),$e("invalid",r)}Wd(t,s),i=null;for(var a in s)if(s.hasOwnProperty(a)){var o=s[a];a==="children"?typeof o=="string"?r.textContent!==o&&(s.suppressHydrationWarning!==!0&&ml(r.textContent,o,n),i=["children",o]):typeof o=="number"&&r.textContent!==""+o&&(s.suppressHydrationWarning!==!0&&ml(r.textContent,o,n),i=["children",""+o]):so.hasOwnProperty(a)&&o!=null&&a==="onScroll"&&$e("scroll",r)}switch(t){case"input":ol(r),sm(r,s,!0);break;case"textarea":ol(r),om(r);break;case"select":case"option":break;default:typeof s.onClick=="function"&&(r.onclick=Tu)}r=i,e.updateQueue=r,r!==null&&(e.flags|=4)}else{a=i.nodeType===9?i:i.ownerDocument,n==="http://www.w3.org/1999/xhtml"&&(n=qy(t)),n==="http://www.w3.org/1999/xhtml"?t==="script"?(n=a.createElement("div"),n.innerHTML="<script><\/script>",n=n.removeChild(n.firstChild)):typeof r.is=="string"?n=a.createElement(t,{is:r.is}):(n=a.createElement(t),t==="select"&&(a=n,r.multiple?a.multiple=!0:r.size&&(a.size=r.size))):n=a.createElementNS(n,t),n[qn]=e,n[po]=r,EE(n,e,!1,!1),e.stateNode=n;e:{switch(a=Yd(t,r),t){case"dialog":$e("cancel",n),$e("close",n),i=r;break;case"iframe":case"object":case"embed":$e("load",n),i=r;break;case"video":case"audio":for(i=0;i<ja.length;i++)$e(ja[i],n);i=r;break;case"source":$e("error",n),i=r;break;case"img":case"image":case"link":$e("error",n),$e("load",n),i=r;break;case"details":$e("toggle",n),i=r;break;case"input":im(n,r),i=Gd(n,r),$e("invalid",n);break;case"option":i=r;break;case"select":n._wrapperState={wasMultiple:!!r.multiple},i=qe({},r,{value:void 0}),$e("invalid",n);break;case"textarea":am(n,r),i=Hd(n,r),$e("invalid",n);break;default:i=r}Wd(t,i),o=i;for(s in o)if(o.hasOwnProperty(s)){var l=o[s];s==="style"?Zy(n,l):s==="dangerouslySetInnerHTML"?(l=l?l.__html:void 0,l!=null&&Qy(n,l)):s==="children"?typeof l=="string"?(t!=="textarea"||l!=="")&&ao(n,l):typeof l=="number"&&ao(n,""+l):s!=="suppressContentEditableWarning"&&s!=="suppressHydrationWarning"&&s!=="autoFocus"&&(so.hasOwnProperty(s)?l!=null&&s==="onScroll"&&$e("scroll",n):l!=null&&yf(n,s,l,a))}switch(t){case"input":ol(n),sm(n,r,!1);break;case"textarea":ol(n),om(n);break;case"option":r.value!=null&&n.setAttribute("value",""+gi(r.value));break;case"select":n.multiple=!!r.multiple,s=r.value,s!=null?Fs(n,!!r.multiple,s,!1):r.defaultValue!=null&&Fs(n,!!r.multiple,r.defaultValue,!0);break;default:typeof i.onClick=="function"&&(n.onclick=Tu)}switch(t){case"button":case"input":case"select":case"textarea":r=!!r.autoFocus;break e;case"img":r=!0;break e;default:r=!1}}r&&(e.flags|=4)}e.ref!==null&&(e.flags|=512,e.flags|=2097152)}return Rt(e),null;case 6:if(n&&e.stateNode!=null)xE(n,e,n.memoizedProps,r);else{if(typeof r!="string"&&e.stateNode===null)throw Error(K(166));if(t=Mi(vo.current),Mi(tr.current),pl(e)){if(r=e.stateNode,t=e.memoizedProps,r[qn]=e,(s=r.nodeValue!==t)&&(n=rn,n!==null))switch(n.tag){case 3:ml(r.nodeValue,t,(n.mode&1)!==0);break;case 5:n.memoizedProps.suppressHydrationWarning!==!0&&ml(r.nodeValue,t,(n.mode&1)!==0)}s&&(e.flags|=4)}else r=(t.nodeType===9?t:t.ownerDocument).createTextNode(r),r[qn]=e,e.stateNode=r}return Rt(e),null;case 13:if(je(We),r=e.memoizedState,n===null||n.memoizedState!==null&&n.memoizedState.dehydrated!==null){if(Ke&&tn!==null&&e.mode&1&&!(e.flags&128))Bv(),aa(),e.flags|=98560,s=!1;else if(s=pl(e),r!==null&&r.dehydrated!==null){if(n===null){if(!s)throw Error(K(318));if(s=e.memoizedState,s=s!==null?s.dehydrated:null,!s)throw Error(K(317));s[qn]=e}else aa(),!(e.flags&128)&&(e.memoizedState=null),e.flags|=4;Rt(e),s=!1}else bn!==null&&(Dh(bn),bn=null),s=!0;if(!s)return e.flags&65536?e:null}return e.flags&128?(e.lanes=t,e):(r=r!==null,r!==(n!==null&&n.memoizedState!==null)&&r&&(e.child.flags|=8192,e.mode&1&&(n===null||We.current&1?ht===0&&(ht=3):Jf())),e.updateQueue!==null&&(e.flags|=4),Rt(e),null);case 4:return la(),Sh(n,e),n===null&&go(e.stateNode.containerInfo),Rt(e),null;case 10:return Mf(e.type._context),Rt(e),null;case 17:return Ht(e.type)&&Lu(),Rt(e),null;case 19:if(je(We),s=e.memoizedState,s===null)return Rt(e),null;if(r=(e.flags&128)!==0,a=s.rendering,a===null)if(r)wa(s,!1);else{if(ht!==0||n!==null&&n.flags&128)for(n=e.child;n!==null;){if(a=wu(n),a!==null){for(e.flags|=128,wa(s,!1),r=a.updateQueue,r!==null&&(e.updateQueue=r,e.flags|=4),e.subtreeFlags=0,r=t,t=e.child;t!==null;)s=t,n=r,s.flags&=14680066,a=s.alternate,a===null?(s.childLanes=0,s.lanes=n,s.child=null,s.subtreeFlags=0,s.memoizedProps=null,s.memoizedState=null,s.updateQueue=null,s.dependencies=null,s.stateNode=null):(s.childLanes=a.childLanes,s.lanes=a.lanes,s.child=a.child,s.subtreeFlags=0,s.deletions=null,s.memoizedProps=a.memoizedProps,s.memoizedState=a.memoizedState,s.updateQueue=a.updateQueue,s.type=a.type,n=a.dependencies,s.dependencies=n===null?null:{lanes:n.lanes,firstContext:n.firstContext}),t=t.sibling;return Ue(We,We.current&1|2),e.child}n=n.sibling}s.tail!==null&&nt()>ca&&(e.flags|=128,r=!0,wa(s,!1),e.lanes=4194304)}else{if(!r)if(n=wu(a),n!==null){if(e.flags|=128,r=!0,t=n.updateQueue,t!==null&&(e.updateQueue=t,e.flags|=4),wa(s,!0),s.tail===null&&s.tailMode==="hidden"&&!a.alternate&&!Ke)return Rt(e),null}else 2*nt()-s.renderingStartTime>ca&&t!==1073741824&&(e.flags|=128,r=!0,wa(s,!1),e.lanes=4194304);s.isBackwards?(a.sibling=e.child,e.child=a):(t=s.last,t!==null?t.sibling=a:e.child=a,s.last=a)}return s.tail!==null?(e=s.tail,s.rendering=e,s.tail=e.sibling,s.renderingStartTime=nt(),e.sibling=null,t=We.current,Ue(We,r?t&1|2:t&1),e):(Rt(e),null);case 22:case 23:return Zf(),r=e.memoizedState!==null,n!==null&&n.memoizedState!==null!==r&&(e.flags|=8192),r&&e.mode&1?Zt&1073741824&&(Rt(e),e.subtreeFlags&6&&(e.flags|=8192)):Rt(e),null;case 24:return null;case 25:return null}throw Error(K(156,e.tag))}function EL(n,e){switch(kf(e),e.tag){case 1:return Ht(e.type)&&Lu(),n=e.flags,n&65536?(e.flags=n&-65537|128,e):null;case 3:return la(),je(Vt),je(Ct),jf(),n=e.flags,n&65536&&!(n&128)?(e.flags=n&-65537|128,e):null;case 5:return $f(e),null;case 13:if(je(We),n=e.memoizedState,n!==null&&n.dehydrated!==null){if(e.alternate===null)throw Error(K(340));aa()}return n=e.flags,n&65536?(e.flags=n&-65537|128,e):null;case 19:return je(We),null;case 4:return la(),null;case 10:return Mf(e.type._context),null;case 22:case 23:return Zf(),null;case 24:return null;default:return null}}var El=!1,Dt=!1,SL=typeof WeakSet=="function"?WeakSet:Set,te=null;function Cs(n,e){var t=n.ref;if(t!==null)if(typeof t=="function")try{t(null)}catch(r){tt(n,e,r)}else t.current=null}function xh(n,e,t){try{t()}catch(r){tt(n,e,r)}}var Qm=!1;function xL(n,e){if(ih=Eu,n=_v(),wf(n)){if("selectionStart"in n)var t={start:n.selectionStart,end:n.selectionEnd};else e:{t=(t=n.ownerDocument)&&t.defaultView||window;var r=t.getSelection&&t.getSelection();if(r&&r.rangeCount!==0){t=r.anchorNode;var i=r.anchorOffset,s=r.focusNode;r=r.focusOffset;try{t.nodeType,s.nodeType}catch{t=null;break e}var a=0,o=-1,l=-1,u=0,c=0,d=n,h=null;t:for(;;){for(var f;d!==t||i!==0&&d.nodeType!==3||(o=a+i),d!==s||r!==0&&d.nodeType!==3||(l=a+r),d.nodeType===3&&(a+=d.nodeValue.length),(f=d.firstChild)!==null;)h=d,d=f;for(;;){if(d===n)break t;if(h===t&&++u===i&&(o=a),h===s&&++c===r&&(l=a),(f=d.nextSibling)!==null)break;d=h,h=d.parentNode}d=f}t=o===-1||l===-1?null:{start:o,end:l}}else t=null}t=t||{start:0,end:0}}else t=null;for(sh={focusedElem:n,selectionRange:t},Eu=!1,te=e;te!==null;)if(e=te,n=e.child,(e.subtreeFlags&1028)!==0&&n!==null)n.return=e,te=n;else for(;te!==null;){e=te;try{var g=e.alternate;if(e.flags&1024)switch(e.tag){case 0:case 11:case 15:break;case 1:if(g!==null){var m=g.memoizedProps,y=g.memoizedState,p=e.stateNode,v=p.getSnapshotBeforeUpdate(e.elementType===e.type?m:_n(e.type,m),y);p.__reactInternalSnapshotBeforeUpdate=v}break;case 3:var E=e.stateNode.containerInfo;E.nodeType===1?E.textContent="":E.nodeType===9&&E.documentElement&&E.removeChild(E.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(K(163))}}catch(T){tt(e,e.return,T)}if(n=e.sibling,n!==null){n.return=e.return,te=n;break}te=e.return}return g=Qm,Qm=!1,g}function Za(n,e,t){var r=e.updateQueue;if(r=r!==null?r.lastEffect:null,r!==null){var i=r=r.next;do{if((i.tag&n)===n){var s=i.destroy;i.destroy=void 0,s!==void 0&&xh(e,t,s)}i=i.next}while(i!==r)}}function lc(n,e){if(e=e.updateQueue,e=e!==null?e.lastEffect:null,e!==null){var t=e=e.next;do{if((t.tag&n)===n){var r=t.create;t.destroy=r()}t=t.next}while(t!==e)}}function Th(n){var e=n.ref;if(e!==null){var t=n.stateNode;switch(n.tag){case 5:n=t;break;default:n=t}typeof e=="function"?e(n):e.current=n}}function TE(n){var e=n.alternate;e!==null&&(n.alternate=null,TE(e)),n.child=null,n.deletions=null,n.sibling=null,n.tag===5&&(e=n.stateNode,e!==null&&(delete e[qn],delete e[po],delete e[lh],delete e[rL],delete e[iL])),n.stateNode=null,n.return=null,n.dependencies=null,n.memoizedProps=null,n.memoizedState=null,n.pendingProps=null,n.stateNode=null,n.updateQueue=null}function LE(n){return n.tag===5||n.tag===3||n.tag===4}function Xm(n){e:for(;;){for(;n.sibling===null;){if(n.return===null||LE(n.return))return null;n=n.return}for(n.sibling.return=n.return,n=n.sibling;n.tag!==5&&n.tag!==6&&n.tag!==18;){if(n.flags&2||n.child===null||n.tag===4)continue e;n.child.return=n,n=n.child}if(!(n.flags&2))return n.stateNode}}function Lh(n,e,t){var r=n.tag;if(r===5||r===6)n=n.stateNode,e?t.nodeType===8?t.parentNode.insertBefore(n,e):t.insertBefore(n,e):(t.nodeType===8?(e=t.parentNode,e.insertBefore(n,t)):(e=t,e.appendChild(n)),t=t._reactRootContainer,t!=null||e.onclick!==null||(e.onclick=Tu));else if(r!==4&&(n=n.child,n!==null))for(Lh(n,e,t),n=n.sibling;n!==null;)Lh(n,e,t),n=n.sibling}function Ah(n,e,t){var r=n.tag;if(r===5||r===6)n=n.stateNode,e?t.insertBefore(n,e):t.appendChild(n);else if(r!==4&&(n=n.child,n!==null))for(Ah(n,e,t),n=n.sibling;n!==null;)Ah(n,e,t),n=n.sibling}var xt=null,Cn=!1;function Mr(n,e,t){for(t=t.child;t!==null;)AE(n,e,t),t=t.sibling}function AE(n,e,t){if(er&&typeof er.onCommitFiberUnmount=="function")try{er.onCommitFiberUnmount(ec,t)}catch{}switch(t.tag){case 5:Dt||Cs(t,e);case 6:var r=xt,i=Cn;xt=null,Mr(n,e,t),xt=r,Cn=i,xt!==null&&(Cn?(n=xt,t=t.stateNode,n.nodeType===8?n.parentNode.removeChild(t):n.removeChild(t)):xt.removeChild(t.stateNode));break;case 18:xt!==null&&(Cn?(n=xt,t=t.stateNode,n.nodeType===8?Hc(n.parentNode,t):n.nodeType===1&&Hc(n,t),co(n)):Hc(xt,t.stateNode));break;case 4:r=xt,i=Cn,xt=t.stateNode.containerInfo,Cn=!0,Mr(n,e,t),xt=r,Cn=i;break;case 0:case 11:case 14:case 15:if(!Dt&&(r=t.updateQueue,r!==null&&(r=r.lastEffect,r!==null))){i=r=r.next;do{var s=i,a=s.destroy;s=s.tag,a!==void 0&&(s&2||s&4)&&xh(t,e,a),i=i.next}while(i!==r)}Mr(n,e,t);break;case 1:if(!Dt&&(Cs(t,e),r=t.stateNode,typeof r.componentWillUnmount=="function"))try{r.props=t.memoizedProps,r.state=t.memoizedState,r.componentWillUnmount()}catch(o){tt(t,e,o)}Mr(n,e,t);break;case 21:Mr(n,e,t);break;case 22:t.mode&1?(Dt=(r=Dt)||t.memoizedState!==null,Mr(n,e,t),Dt=r):Mr(n,e,t);break;default:Mr(n,e,t)}}function Zm(n){var e=n.updateQueue;if(e!==null){n.updateQueue=null;var t=n.stateNode;t===null&&(t=n.stateNode=new SL),e.forEach(function(r){var i=wL.bind(null,n,r);t.has(r)||(t.add(r),r.then(i,i))})}}function An(n,e){var t=e.deletions;if(t!==null)for(var r=0;r<t.length;r++){var i=t[r];try{var s=n,a=e,o=a;e:for(;o!==null;){switch(o.tag){case 5:xt=o.stateNode,Cn=!1;break e;case 3:xt=o.stateNode.containerInfo,Cn=!0;break e;case 4:xt=o.stateNode.containerInfo,Cn=!0;break e}o=o.return}if(xt===null)throw Error(K(160));AE(s,a,i),xt=null,Cn=!1;var l=i.alternate;l!==null&&(l.return=null),i.return=null}catch(u){tt(i,e,u)}}if(e.subtreeFlags&12854)for(e=e.child;e!==null;)RE(e,n),e=e.sibling}function RE(n,e){var t=n.alternate,r=n.flags;switch(n.tag){case 0:case 11:case 14:case 15:if(An(e,n),Un(n),r&4){try{Za(3,n,n.return),lc(3,n)}catch(m){tt(n,n.return,m)}try{Za(5,n,n.return)}catch(m){tt(n,n.return,m)}}break;case 1:An(e,n),Un(n),r&512&&t!==null&&Cs(t,t.return);break;case 5:if(An(e,n),Un(n),r&512&&t!==null&&Cs(t,t.return),n.flags&32){var i=n.stateNode;try{ao(i,"")}catch(m){tt(n,n.return,m)}}if(r&4&&(i=n.stateNode,i!=null)){var s=n.memoizedProps,a=t!==null?t.memoizedProps:s,o=n.type,l=n.updateQueue;if(n.updateQueue=null,l!==null)try{o==="input"&&s.type==="radio"&&s.name!=null&&Wy(i,s),Yd(o,a);var u=Yd(o,s);for(a=0;a<l.length;a+=2){var c=l[a],d=l[a+1];c==="style"?Zy(i,d):c==="dangerouslySetInnerHTML"?Qy(i,d):c==="children"?ao(i,d):yf(i,c,d,u)}switch(o){case"input":Kd(i,s);break;case"textarea":Yy(i,s);break;case"select":var h=i._wrapperState.wasMultiple;i._wrapperState.wasMultiple=!!s.multiple;var f=s.value;f!=null?Fs(i,!!s.multiple,f,!1):h!==!!s.multiple&&(s.defaultValue!=null?Fs(i,!!s.multiple,s.defaultValue,!0):Fs(i,!!s.multiple,s.multiple?[]:"",!1))}i[po]=s}catch(m){tt(n,n.return,m)}}break;case 6:if(An(e,n),Un(n),r&4){if(n.stateNode===null)throw Error(K(162));i=n.stateNode,s=n.memoizedProps;try{i.nodeValue=s}catch(m){tt(n,n.return,m)}}break;case 3:if(An(e,n),Un(n),r&4&&t!==null&&t.memoizedState.isDehydrated)try{co(e.containerInfo)}catch(m){tt(n,n.return,m)}break;case 4:An(e,n),Un(n);break;case 13:An(e,n),Un(n),i=n.child,i.flags&8192&&(s=i.memoizedState!==null,i.stateNode.isHidden=s,!s||i.alternate!==null&&i.alternate.memoizedState!==null||(Qf=nt())),r&4&&Zm(n);break;case 22:if(c=t!==null&&t.memoizedState!==null,n.mode&1?(Dt=(u=Dt)||c,An(e,n),Dt=u):An(e,n),Un(n),r&8192){if(u=n.memoizedState!==null,(n.stateNode.isHidden=u)&&!c&&n.mode&1)for(te=n,c=n.child;c!==null;){for(d=te=c;te!==null;){switch(h=te,f=h.child,h.tag){case 0:case 11:case 14:case 15:Za(4,h,h.return);break;case 1:Cs(h,h.return);var g=h.stateNode;if(typeof g.componentWillUnmount=="function"){r=h,t=h.return;try{e=r,g.props=e.memoizedProps,g.state=e.memoizedState,g.componentWillUnmount()}catch(m){tt(r,t,m)}}break;case 5:Cs(h,h.return);break;case 22:if(h.memoizedState!==null){ep(d);continue}}f!==null?(f.return=h,te=f):ep(d)}c=c.sibling}e:for(c=null,d=n;;){if(d.tag===5){if(c===null){c=d;try{i=d.stateNode,u?(s=i.style,typeof s.setProperty=="function"?s.setProperty("display","none","important"):s.display="none"):(o=d.stateNode,l=d.memoizedProps.style,a=l!=null&&l.hasOwnProperty("display")?l.display:null,o.style.display=Xy("display",a))}catch(m){tt(n,n.return,m)}}}else if(d.tag===6){if(c===null)try{d.stateNode.nodeValue=u?"":d.memoizedProps}catch(m){tt(n,n.return,m)}}else if((d.tag!==22&&d.tag!==23||d.memoizedState===null||d===n)&&d.child!==null){d.child.return=d,d=d.child;continue}if(d===n)break e;for(;d.sibling===null;){if(d.return===null||d.return===n)break e;c===d&&(c=null),d=d.return}c===d&&(c=null),d.sibling.return=d.return,d=d.sibling}}break;case 19:An(e,n),Un(n),r&4&&Zm(n);break;case 21:break;default:An(e,n),Un(n)}}function Un(n){var e=n.flags;if(e&2){try{e:{for(var t=n.return;t!==null;){if(LE(t)){var r=t;break e}t=t.return}throw Error(K(160))}switch(r.tag){case 5:var i=r.stateNode;r.flags&32&&(ao(i,""),r.flags&=-33);var s=Xm(n);Ah(n,s,i);break;case 3:case 4:var a=r.stateNode.containerInfo,o=Xm(n);Lh(n,o,a);break;default:throw Error(K(161))}}catch(l){tt(n,n.return,l)}n.flags&=-3}e&4096&&(n.flags&=-4097)}function TL(n,e,t){te=n,_E(n)}function _E(n,e,t){for(var r=(n.mode&1)!==0;te!==null;){var i=te,s=i.child;if(i.tag===22&&r){var a=i.memoizedState!==null||El;if(!a){var o=i.alternate,l=o!==null&&o.memoizedState!==null||Dt;o=El;var u=Dt;if(El=a,(Dt=l)&&!u)for(te=i;te!==null;)a=te,l=a.child,a.tag===22&&a.memoizedState!==null?tp(i):l!==null?(l.return=a,te=l):tp(i);for(;s!==null;)te=s,_E(s),s=s.sibling;te=i,El=o,Dt=u}Jm(n)}else i.subtreeFlags&8772&&s!==null?(s.return=i,te=s):Jm(n)}}function Jm(n){for(;te!==null;){var e=te;if(e.flags&8772){var t=e.alternate;try{if(e.flags&8772)switch(e.tag){case 0:case 11:case 15:Dt||lc(5,e);break;case 1:var r=e.stateNode;if(e.flags&4&&!Dt)if(t===null)r.componentDidMount();else{var i=e.elementType===e.type?t.memoizedProps:_n(e.type,t.memoizedProps);r.componentDidUpdate(i,t.memoizedState,r.__reactInternalSnapshotBeforeUpdate)}var s=e.updateQueue;s!==null&&Nm(e,s,r);break;case 3:var a=e.updateQueue;if(a!==null){if(t=null,e.child!==null)switch(e.child.tag){case 5:t=e.child.stateNode;break;case 1:t=e.child.stateNode}Nm(e,a,t)}break;case 5:var o=e.stateNode;if(t===null&&e.flags&4){t=o;var l=e.memoizedProps;switch(e.type){case"button":case"input":case"select":case"textarea":l.autoFocus&&t.focus();break;case"img":l.src&&(t.src=l.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(e.memoizedState===null){var u=e.alternate;if(u!==null){var c=u.memoizedState;if(c!==null){var d=c.dehydrated;d!==null&&co(d)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(K(163))}Dt||e.flags&512&&Th(e)}catch(h){tt(e,e.return,h)}}if(e===n){te=null;break}if(t=e.sibling,t!==null){t.return=e.return,te=t;break}te=e.return}}function ep(n){for(;te!==null;){var e=te;if(e===n){te=null;break}var t=e.sibling;if(t!==null){t.return=e.return,te=t;break}te=e.return}}function tp(n){for(;te!==null;){var e=te;try{switch(e.tag){case 0:case 11:case 15:var t=e.return;try{lc(4,e)}catch(l){tt(e,t,l)}break;case 1:var r=e.stateNode;if(typeof r.componentDidMount=="function"){var i=e.return;try{r.componentDidMount()}catch(l){tt(e,i,l)}}var s=e.return;try{Th(e)}catch(l){tt(e,s,l)}break;case 5:var a=e.return;try{Th(e)}catch(l){tt(e,a,l)}}}catch(l){tt(e,e.return,l)}if(e===n){te=null;break}var o=e.sibling;if(o!==null){o.return=e.return,te=o;break}te=e.return}}var LL=Math.ceil,Pu=Cr.ReactCurrentDispatcher,Yf=Cr.ReactCurrentOwner,En=Cr.ReactCurrentBatchConfig,_e=0,St=null,at=null,Tt=0,Zt=0,ws=xi(0),ht=0,To=null,Xi=0,uc=0,qf=0,Ja=null,jt=null,Qf=0,ca=1/0,mr=null,Ou=!1,Rh=null,di=null,Sl=!1,ri=null,Fu=0,eo=0,_h=null,Jl=-1,eu=0;function Ft(){return _e&6?nt():Jl!==-1?Jl:Jl=nt()}function hi(n){return n.mode&1?_e&2&&Tt!==0?Tt&-Tt:aL.transition!==null?(eu===0&&(eu=cv()),eu):(n=Pe,n!==0||(n=window.event,n=n===void 0?16:yv(n.type)),n):1}function On(n,e,t,r){if(50<eo)throw eo=0,_h=null,Error(K(185));Bo(n,t,r),(!(_e&2)||n!==St)&&(n===St&&(!(_e&2)&&(uc|=t),ht===4&&zr(n,Tt)),zt(n,r),t===1&&_e===0&&!(e.mode&1)&&(ca=nt()+500,sc&&Ti()))}function zt(n,e){var t=n.callbackNode;a1(n,e);var r=vu(n,n===St?Tt:0);if(r===0)t!==null&&cm(t),n.callbackNode=null,n.callbackPriority=0;else if(e=r&-r,n.callbackPriority!==e){if(t!=null&&cm(t),e===1)n.tag===0?sL(np.bind(null,n)):Mv(np.bind(null,n)),tL(function(){!(_e&6)&&Ti()}),t=null;else{switch(dv(r)){case 1:t=Tf;break;case 4:t=lv;break;case 16:t=yu;break;case 536870912:t=uv;break;default:t=yu}t=OE(t,IE.bind(null,n))}n.callbackPriority=e,n.callbackNode=t}}function IE(n,e){if(Jl=-1,eu=0,_e&6)throw Error(K(327));var t=n.callbackNode;if($s()&&n.callbackNode!==t)return null;var r=vu(n,n===St?Tt:0);if(r===0)return null;if(r&30||r&n.expiredLanes||e)e=Mu(n,r);else{e=r;var i=_e;_e|=2;var s=CE();(St!==n||Tt!==e)&&(mr=null,ca=nt()+500,Hi(n,e));do try{_L();break}catch(o){DE(n,o)}while(!0);Ff(),Pu.current=s,_e=i,at!==null?e=0:(St=null,Tt=0,e=ht)}if(e!==0){if(e===2&&(i=Jd(n),i!==0&&(r=i,e=Ih(n,i))),e===1)throw t=To,Hi(n,0),zr(n,r),zt(n,nt()),t;if(e===6)zr(n,r);else{if(i=n.current.alternate,!(r&30)&&!AL(i)&&(e=Mu(n,r),e===2&&(s=Jd(n),s!==0&&(r=s,e=Ih(n,s))),e===1))throw t=To,Hi(n,0),zr(n,r),zt(n,nt()),t;switch(n.finishedWork=i,n.finishedLanes=r,e){case 0:case 1:throw Error(K(345));case 2:wi(n,jt,mr);break;case 3:if(zr(n,r),(r&130023424)===r&&(e=Qf+500-nt(),10<e)){if(vu(n,0)!==0)break;if(i=n.suspendedLanes,(i&r)!==r){Ft(),n.pingedLanes|=n.suspendedLanes&i;break}n.timeoutHandle=oh(wi.bind(null,n,jt,mr),e);break}wi(n,jt,mr);break;case 4:if(zr(n,r),(r&4194240)===r)break;for(e=n.eventTimes,i=-1;0<r;){var a=31-Pn(r);s=1<<a,a=e[a],a>i&&(i=a),r&=~s}if(r=i,r=nt()-r,r=(120>r?120:480>r?480:1080>r?1080:1920>r?1920:3e3>r?3e3:4320>r?4320:1960*LL(r/1960))-r,10<r){n.timeoutHandle=oh(wi.bind(null,n,jt,mr),r);break}wi(n,jt,mr);break;case 5:wi(n,jt,mr);break;default:throw Error(K(329))}}}return zt(n,nt()),n.callbackNode===t?IE.bind(null,n):null}function Ih(n,e){var t=Ja;return n.current.memoizedState.isDehydrated&&(Hi(n,e).flags|=256),n=Mu(n,e),n!==2&&(e=jt,jt=t,e!==null&&Dh(e)),n}function Dh(n){jt===null?jt=n:jt.push.apply(jt,n)}function AL(n){for(var e=n;;){if(e.flags&16384){var t=e.updateQueue;if(t!==null&&(t=t.stores,t!==null))for(var r=0;r<t.length;r++){var i=t[r],s=i.getSnapshot;i=i.value;try{if(!Fn(s(),i))return!1}catch{return!1}}}if(t=e.child,e.subtreeFlags&16384&&t!==null)t.return=e,e=t;else{if(e===n)break;for(;e.sibling===null;){if(e.return===null||e.return===n)return!0;e=e.return}e.sibling.return=e.return,e=e.sibling}}return!0}function zr(n,e){for(e&=~qf,e&=~uc,n.suspendedLanes|=e,n.pingedLanes&=~e,n=n.expirationTimes;0<e;){var t=31-Pn(e),r=1<<t;n[t]=-1,e&=~r}}function np(n){if(_e&6)throw Error(K(327));$s();var e=vu(n,0);if(!(e&1))return zt(n,nt()),null;var t=Mu(n,e);if(n.tag!==0&&t===2){var r=Jd(n);r!==0&&(e=r,t=Ih(n,r))}if(t===1)throw t=To,Hi(n,0),zr(n,e),zt(n,nt()),t;if(t===6)throw Error(K(345));return n.finishedWork=n.current.alternate,n.finishedLanes=e,wi(n,jt,mr),zt(n,nt()),null}function Xf(n,e){var t=_e;_e|=1;try{return n(e)}finally{_e=t,_e===0&&(ca=nt()+500,sc&&Ti())}}function Zi(n){ri!==null&&ri.tag===0&&!(_e&6)&&$s();var e=_e;_e|=1;var t=En.transition,r=Pe;try{if(En.transition=null,Pe=1,n)return n()}finally{Pe=r,En.transition=t,_e=e,!(_e&6)&&Ti()}}function Zf(){Zt=ws.current,je(ws)}function Hi(n,e){n.finishedWork=null,n.finishedLanes=0;var t=n.timeoutHandle;if(t!==-1&&(n.timeoutHandle=-1,eL(t)),at!==null)for(t=at.return;t!==null;){var r=t;switch(kf(r),r.tag){case 1:r=r.type.childContextTypes,r!=null&&Lu();break;case 3:la(),je(Vt),je(Ct),jf();break;case 5:$f(r);break;case 4:la();break;case 13:je(We);break;case 19:je(We);break;case 10:Mf(r.type._context);break;case 22:case 23:Zf()}t=t.return}if(St=n,at=n=fi(n.current,null),Tt=Zt=e,ht=0,To=null,qf=uc=Xi=0,jt=Ja=null,Fi!==null){for(e=0;e<Fi.length;e++)if(t=Fi[e],r=t.interleaved,r!==null){t.interleaved=null;var i=r.next,s=t.pending;if(s!==null){var a=s.next;s.next=i,r.next=a}t.pending=r}Fi=null}return n}function DE(n,e){do{var t=at;try{if(Ff(),Ql.current=ku,bu){for(var r=Ye.memoizedState;r!==null;){var i=r.queue;i!==null&&(i.pending=null),r=r.next}bu=!1}if(Qi=0,yt=ut=Ye=null,Xa=!1,Eo=0,Yf.current=null,t===null||t.return===null){ht=1,To=e,at=null;break}e:{var s=n,a=t.return,o=t,l=e;if(e=Tt,o.flags|=32768,l!==null&&typeof l=="object"&&typeof l.then=="function"){var u=l,c=o,d=c.tag;if(!(c.mode&1)&&(d===0||d===11||d===15)){var h=c.alternate;h?(c.updateQueue=h.updateQueue,c.memoizedState=h.memoizedState,c.lanes=h.lanes):(c.updateQueue=null,c.memoizedState=null)}var f=Km(a);if(f!==null){f.flags&=-257,Vm(f,a,o,s,e),f.mode&1&&Gm(s,u,e),e=f,l=u;var g=e.updateQueue;if(g===null){var m=new Set;m.add(l),e.updateQueue=m}else g.add(l);break e}else{if(!(e&1)){Gm(s,u,e),Jf();break e}l=Error(K(426))}}else if(Ke&&o.mode&1){var y=Km(a);if(y!==null){!(y.flags&65536)&&(y.flags|=256),Vm(y,a,o,s,e),Pf(ua(l,o));break e}}s=l=ua(l,o),ht!==4&&(ht=2),Ja===null?Ja=[s]:Ja.push(s),s=a;do{switch(s.tag){case 3:s.flags|=65536,e&=-e,s.lanes|=e;var p=dE(s,l,e);Mm(s,p);break e;case 1:o=l;var v=s.type,E=s.stateNode;if(!(s.flags&128)&&(typeof v.getDerivedStateFromError=="function"||E!==null&&typeof E.componentDidCatch=="function"&&(di===null||!di.has(E)))){s.flags|=65536,e&=-e,s.lanes|=e;var T=hE(s,o,e);Mm(s,T);break e}}s=s.return}while(s!==null)}bE(t)}catch(A){e=A,at===t&&t!==null&&(at=t=t.return);continue}break}while(!0)}function CE(){var n=Pu.current;return Pu.current=ku,n===null?ku:n}function Jf(){(ht===0||ht===3||ht===2)&&(ht=4),St===null||!(Xi&268435455)&&!(uc&268435455)||zr(St,Tt)}function Mu(n,e){var t=_e;_e|=2;var r=CE();(St!==n||Tt!==e)&&(mr=null,Hi(n,e));do try{RL();break}catch(i){DE(n,i)}while(!0);if(Ff(),_e=t,Pu.current=r,at!==null)throw Error(K(261));return St=null,Tt=0,ht}function RL(){for(;at!==null;)wE(at)}function _L(){for(;at!==null&&!XT();)wE(at)}function wE(n){var e=PE(n.alternate,n,Zt);n.memoizedProps=n.pendingProps,e===null?bE(n):at=e,Yf.current=null}function bE(n){var e=n;do{var t=e.alternate;if(n=e.return,e.flags&32768){if(t=EL(t,e),t!==null){t.flags&=32767,at=t;return}if(n!==null)n.flags|=32768,n.subtreeFlags=0,n.deletions=null;else{ht=6,at=null;return}}else if(t=vL(t,e,Zt),t!==null){at=t;return}if(e=e.sibling,e!==null){at=e;return}at=e=n}while(e!==null);ht===0&&(ht=5)}function wi(n,e,t){var r=Pe,i=En.transition;try{En.transition=null,Pe=1,IL(n,e,t,r)}finally{En.transition=i,Pe=r}return null}function IL(n,e,t,r){do $s();while(ri!==null);if(_e&6)throw Error(K(327));t=n.finishedWork;var i=n.finishedLanes;if(t===null)return null;if(n.finishedWork=null,n.finishedLanes=0,t===n.current)throw Error(K(177));n.callbackNode=null,n.callbackPriority=0;var s=t.lanes|t.childLanes;if(o1(n,s),n===St&&(at=St=null,Tt=0),!(t.subtreeFlags&2064)&&!(t.flags&2064)||Sl||(Sl=!0,OE(yu,function(){return $s(),null})),s=(t.flags&15990)!==0,t.subtreeFlags&15990||s){s=En.transition,En.transition=null;var a=Pe;Pe=1;var o=_e;_e|=4,Yf.current=null,xL(n,t),RE(t,n),W1(sh),Eu=!!ih,sh=ih=null,n.current=t,TL(t),ZT(),_e=o,Pe=a,En.transition=s}else n.current=t;if(Sl&&(Sl=!1,ri=n,Fu=i),s=n.pendingLanes,s===0&&(di=null),t1(t.stateNode),zt(n,nt()),e!==null)for(r=n.onRecoverableError,t=0;t<e.length;t++)i=e[t],r(i.value,{componentStack:i.stack,digest:i.digest});if(Ou)throw Ou=!1,n=Rh,Rh=null,n;return Fu&1&&n.tag!==0&&$s(),s=n.pendingLanes,s&1?n===_h?eo++:(eo=0,_h=n):eo=0,Ti(),null}function $s(){if(ri!==null){var n=dv(Fu),e=En.transition,t=Pe;try{if(En.transition=null,Pe=16>n?16:n,ri===null)var r=!1;else{if(n=ri,ri=null,Fu=0,_e&6)throw Error(K(331));var i=_e;for(_e|=4,te=n.current;te!==null;){var s=te,a=s.child;if(te.flags&16){var o=s.deletions;if(o!==null){for(var l=0;l<o.length;l++){var u=o[l];for(te=u;te!==null;){var c=te;switch(c.tag){case 0:case 11:case 15:Za(8,c,s)}var d=c.child;if(d!==null)d.return=c,te=d;else for(;te!==null;){c=te;var h=c.sibling,f=c.return;if(TE(c),c===u){te=null;break}if(h!==null){h.return=f,te=h;break}te=f}}}var g=s.alternate;if(g!==null){var m=g.child;if(m!==null){g.child=null;do{var y=m.sibling;m.sibling=null,m=y}while(m!==null)}}te=s}}if(s.subtreeFlags&2064&&a!==null)a.return=s,te=a;else e:for(;te!==null;){if(s=te,s.flags&2048)switch(s.tag){case 0:case 11:case 15:Za(9,s,s.return)}var p=s.sibling;if(p!==null){p.return=s.return,te=p;break e}te=s.return}}var v=n.current;for(te=v;te!==null;){a=te;var E=a.child;if(a.subtreeFlags&2064&&E!==null)E.return=a,te=E;else e:for(a=v;te!==null;){if(o=te,o.flags&2048)try{switch(o.tag){case 0:case 11:case 15:lc(9,o)}}catch(A){tt(o,o.return,A)}if(o===a){te=null;break e}var T=o.sibling;if(T!==null){T.return=o.return,te=T;break e}te=o.return}}if(_e=i,Ti(),er&&typeof er.onPostCommitFiberRoot=="function")try{er.onPostCommitFiberRoot(ec,n)}catch{}r=!0}return r}finally{Pe=t,En.transition=e}}return!1}function rp(n,e,t){e=ua(t,e),e=dE(n,e,1),n=ci(n,e,1),e=Ft(),n!==null&&(Bo(n,1,e),zt(n,e))}function tt(n,e,t){if(n.tag===3)rp(n,n,t);else for(;e!==null;){if(e.tag===3){rp(e,n,t);break}else if(e.tag===1){var r=e.stateNode;if(typeof e.type.getDerivedStateFromError=="function"||typeof r.componentDidCatch=="function"&&(di===null||!di.has(r))){n=ua(t,n),n=hE(e,n,1),e=ci(e,n,1),n=Ft(),e!==null&&(Bo(e,1,n),zt(e,n));break}}e=e.return}}function DL(n,e,t){var r=n.pingCache;r!==null&&r.delete(e),e=Ft(),n.pingedLanes|=n.suspendedLanes&t,St===n&&(Tt&t)===t&&(ht===4||ht===3&&(Tt&130023424)===Tt&&500>nt()-Qf?Hi(n,0):qf|=t),zt(n,e)}function kE(n,e){e===0&&(n.mode&1?(e=cl,cl<<=1,!(cl&130023424)&&(cl=4194304)):e=1);var t=Ft();n=Ir(n,e),n!==null&&(Bo(n,e,t),zt(n,t))}function CL(n){var e=n.memoizedState,t=0;e!==null&&(t=e.retryLane),kE(n,t)}function wL(n,e){var t=0;switch(n.tag){case 13:var r=n.stateNode,i=n.memoizedState;i!==null&&(t=i.retryLane);break;case 19:r=n.stateNode;break;default:throw Error(K(314))}r!==null&&r.delete(e),kE(n,t)}var PE;PE=function(n,e,t){if(n!==null)if(n.memoizedProps!==e.pendingProps||Vt.current)Kt=!0;else{if(!(n.lanes&t)&&!(e.flags&128))return Kt=!1,yL(n,e,t);Kt=!!(n.flags&131072)}else Kt=!1,Ke&&e.flags&1048576&&Nv(e,_u,e.index);switch(e.lanes=0,e.tag){case 2:var r=e.type;Zl(n,e),n=e.pendingProps;var i=sa(e,Ct.current);Bs(e,t),i=Kf(null,e,r,n,i,t);var s=Vf();return e.flags|=1,typeof i=="object"&&i!==null&&typeof i.render=="function"&&i.$$typeof===void 0?(e.tag=1,e.memoizedState=null,e.updateQueue=null,Ht(r)?(s=!0,Au(e)):s=!1,e.memoizedState=i.state!==null&&i.state!==void 0?i.state:null,Uf(e),i.updater=oc,e.stateNode=i,i._reactInternals=e,gh(e,r,n,t),e=yh(null,e,r,!0,s,t)):(e.tag=0,Ke&&s&&bf(e),Ot(null,e,i,t),e=e.child),e;case 16:r=e.elementType;e:{switch(Zl(n,e),n=e.pendingProps,i=r._init,r=i(r._payload),e.type=r,i=e.tag=kL(r),n=_n(r,n),i){case 0:e=ph(null,e,r,n,t);break e;case 1:e=Wm(null,e,r,n,t);break e;case 11:e=Hm(null,e,r,n,t);break e;case 14:e=zm(null,e,r,_n(r.type,n),t);break e}throw Error(K(306,r,""))}return e;case 0:return r=e.type,i=e.pendingProps,i=e.elementType===r?i:_n(r,i),ph(n,e,r,i,t);case 1:return r=e.type,i=e.pendingProps,i=e.elementType===r?i:_n(r,i),Wm(n,e,r,i,t);case 3:e:{if(pE(e),n===null)throw Error(K(387));r=e.pendingProps,s=e.memoizedState,i=s.element,Kv(n,e),Cu(e,r,null,t);var a=e.memoizedState;if(r=a.element,s.isDehydrated)if(s={element:r,isDehydrated:!1,cache:a.cache,pendingSuspenseBoundaries:a.pendingSuspenseBoundaries,transitions:a.transitions},e.updateQueue.baseState=s,e.memoizedState=s,e.flags&256){i=ua(Error(K(423)),e),e=Ym(n,e,r,t,i);break e}else if(r!==i){i=ua(Error(K(424)),e),e=Ym(n,e,r,t,i);break e}else for(tn=ui(e.stateNode.containerInfo.firstChild),rn=e,Ke=!0,bn=null,t=jv(e,null,r,t),e.child=t;t;)t.flags=t.flags&-3|4096,t=t.sibling;else{if(aa(),r===i){e=Dr(n,e,t);break e}Ot(n,e,r,t)}e=e.child}return e;case 5:return Vv(e),n===null&&dh(e),r=e.type,i=e.pendingProps,s=n!==null?n.memoizedProps:null,a=i.children,ah(r,i)?a=null:s!==null&&ah(r,s)&&(e.flags|=32),mE(n,e),Ot(n,e,a,t),e.child;case 6:return n===null&&dh(e),null;case 13:return yE(n,e,t);case 4:return Bf(e,e.stateNode.containerInfo),r=e.pendingProps,n===null?e.child=oa(e,null,r,t):Ot(n,e,r,t),e.child;case 11:return r=e.type,i=e.pendingProps,i=e.elementType===r?i:_n(r,i),Hm(n,e,r,i,t);case 7:return Ot(n,e,e.pendingProps,t),e.child;case 8:return Ot(n,e,e.pendingProps.children,t),e.child;case 12:return Ot(n,e,e.pendingProps.children,t),e.child;case 10:e:{if(r=e.type._context,i=e.pendingProps,s=e.memoizedProps,a=i.value,Ue(Iu,r._currentValue),r._currentValue=a,s!==null)if(Fn(s.value,a)){if(s.children===i.children&&!Vt.current){e=Dr(n,e,t);break e}}else for(s=e.child,s!==null&&(s.return=e);s!==null;){var o=s.dependencies;if(o!==null){a=s.child;for(var l=o.firstContext;l!==null;){if(l.context===r){if(s.tag===1){l=Tr(-1,t&-t),l.tag=2;var u=s.updateQueue;if(u!==null){u=u.shared;var c=u.pending;c===null?l.next=l:(l.next=c.next,c.next=l),u.pending=l}}s.lanes|=t,l=s.alternate,l!==null&&(l.lanes|=t),hh(s.return,t,e),o.lanes|=t;break}l=l.next}}else if(s.tag===10)a=s.type===e.type?null:s.child;else if(s.tag===18){if(a=s.return,a===null)throw Error(K(341));a.lanes|=t,o=a.alternate,o!==null&&(o.lanes|=t),hh(a,t,e),a=s.sibling}else a=s.child;if(a!==null)a.return=s;else for(a=s;a!==null;){if(a===e){a=null;break}if(s=a.sibling,s!==null){s.return=a.return,a=s;break}a=a.return}s=a}Ot(n,e,i.children,t),e=e.child}return e;case 9:return i=e.type,r=e.pendingProps.children,Bs(e,t),i=Sn(i),r=r(i),e.flags|=1,Ot(n,e,r,t),e.child;case 14:return r=e.type,i=_n(r,e.pendingProps),i=_n(r.type,i),zm(n,e,r,i,t);case 15:return fE(n,e,e.type,e.pendingProps,t);case 17:return r=e.type,i=e.pendingProps,i=e.elementType===r?i:_n(r,i),Zl(n,e),e.tag=1,Ht(r)?(n=!0,Au(e)):n=!1,Bs(e,t),cE(e,r,i),gh(e,r,i,t),yh(null,e,r,!0,n,t);case 19:return vE(n,e,t);case 22:return gE(n,e,t)}throw Error(K(156,e.tag))};function OE(n,e){return ov(n,e)}function bL(n,e,t,r){this.tag=n,this.key=t,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=e,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=r,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function yn(n,e,t,r){return new bL(n,e,t,r)}function eg(n){return n=n.prototype,!(!n||!n.isReactComponent)}function kL(n){if(typeof n=="function")return eg(n)?1:0;if(n!=null){if(n=n.$$typeof,n===Ef)return 11;if(n===Sf)return 14}return 2}function fi(n,e){var t=n.alternate;return t===null?(t=yn(n.tag,e,n.key,n.mode),t.elementType=n.elementType,t.type=n.type,t.stateNode=n.stateNode,t.alternate=n,n.alternate=t):(t.pendingProps=e,t.type=n.type,t.flags=0,t.subtreeFlags=0,t.deletions=null),t.flags=n.flags&14680064,t.childLanes=n.childLanes,t.lanes=n.lanes,t.child=n.child,t.memoizedProps=n.memoizedProps,t.memoizedState=n.memoizedState,t.updateQueue=n.updateQueue,e=n.dependencies,t.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext},t.sibling=n.sibling,t.index=n.index,t.ref=n.ref,t}function tu(n,e,t,r,i,s){var a=2;if(r=n,typeof n=="function")eg(n)&&(a=1);else if(typeof n=="string")a=5;else e:switch(n){case Ss:return zi(t.children,i,s,e);case vf:a=8,i|=8;break;case Ud:return n=yn(12,t,e,i|2),n.elementType=Ud,n.lanes=s,n;case Bd:return n=yn(13,t,e,i),n.elementType=Bd,n.lanes=s,n;case $d:return n=yn(19,t,e,i),n.elementType=$d,n.lanes=s,n;case Vy:return cc(t,i,s,e);default:if(typeof n=="object"&&n!==null)switch(n.$$typeof){case Gy:a=10;break e;case Ky:a=9;break e;case Ef:a=11;break e;case Sf:a=14;break e;case jr:a=16,r=null;break e}throw Error(K(130,n==null?n:typeof n,""))}return e=yn(a,t,e,i),e.elementType=n,e.type=r,e.lanes=s,e}function zi(n,e,t,r){return n=yn(7,n,r,e),n.lanes=t,n}function cc(n,e,t,r){return n=yn(22,n,r,e),n.elementType=Vy,n.lanes=t,n.stateNode={isHidden:!1},n}function Jc(n,e,t){return n=yn(6,n,null,e),n.lanes=t,n}function ed(n,e,t){return e=yn(4,n.children!==null?n.children:[],n.key,e),e.lanes=t,e.stateNode={containerInfo:n.containerInfo,pendingChildren:null,implementation:n.implementation},e}function PL(n,e,t,r,i){this.tag=e,this.containerInfo=n,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=Oc(0),this.expirationTimes=Oc(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Oc(0),this.identifierPrefix=r,this.onRecoverableError=i,this.mutableSourceEagerHydrationData=null}function tg(n,e,t,r,i,s,a,o,l){return n=new PL(n,e,t,o,l),e===1?(e=1,s===!0&&(e|=8)):e=0,s=yn(3,null,null,e),n.current=s,s.stateNode=n,s.memoizedState={element:r,isDehydrated:t,cache:null,transitions:null,pendingSuspenseBoundaries:null},Uf(s),n}function OL(n,e,t){var r=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:Es,key:r==null?null:""+r,children:n,containerInfo:e,implementation:t}}function FE(n){if(!n)return mi;n=n._reactInternals;e:{if(ss(n)!==n||n.tag!==1)throw Error(K(170));var e=n;do{switch(e.tag){case 3:e=e.stateNode.context;break e;case 1:if(Ht(e.type)){e=e.stateNode.__reactInternalMemoizedMergedChildContext;break e}}e=e.return}while(e!==null);throw Error(K(171))}if(n.tag===1){var t=n.type;if(Ht(t))return Fv(n,t,e)}return e}function ME(n,e,t,r,i,s,a,o,l){return n=tg(t,r,!0,n,i,s,a,o,l),n.context=FE(null),t=n.current,r=Ft(),i=hi(t),s=Tr(r,i),s.callback=e??null,ci(t,s,i),n.current.lanes=i,Bo(n,i,r),zt(n,r),n}function dc(n,e,t,r){var i=e.current,s=Ft(),a=hi(i);return t=FE(t),e.context===null?e.context=t:e.pendingContext=t,e=Tr(s,a),e.payload={element:n},r=r===void 0?null:r,r!==null&&(e.callback=r),n=ci(i,e,a),n!==null&&(On(n,i,a,s),ql(n,i,a)),a}function Nu(n){if(n=n.current,!n.child)return null;switch(n.child.tag){case 5:return n.child.stateNode;default:return n.child.stateNode}}function ip(n,e){if(n=n.memoizedState,n!==null&&n.dehydrated!==null){var t=n.retryLane;n.retryLane=t!==0&&t<e?t:e}}function ng(n,e){ip(n,e),(n=n.alternate)&&ip(n,e)}function FL(){return null}var NE=typeof reportError=="function"?reportError:function(n){console.error(n)};function rg(n){this._internalRoot=n}hc.prototype.render=rg.prototype.render=function(n){var e=this._internalRoot;if(e===null)throw Error(K(409));dc(n,e,null,null)};hc.prototype.unmount=rg.prototype.unmount=function(){var n=this._internalRoot;if(n!==null){this._internalRoot=null;var e=n.containerInfo;Zi(function(){dc(null,n,null,null)}),e[_r]=null}};function hc(n){this._internalRoot=n}hc.prototype.unstable_scheduleHydration=function(n){if(n){var e=gv();n={blockedOn:null,target:n,priority:e};for(var t=0;t<Hr.length&&e!==0&&e<Hr[t].priority;t++);Hr.splice(t,0,n),t===0&&pv(n)}};function ig(n){return!(!n||n.nodeType!==1&&n.nodeType!==9&&n.nodeType!==11)}function fc(n){return!(!n||n.nodeType!==1&&n.nodeType!==9&&n.nodeType!==11&&(n.nodeType!==8||n.nodeValue!==" react-mount-point-unstable "))}function sp(){}function ML(n,e,t,r,i){if(i){if(typeof r=="function"){var s=r;r=function(){var u=Nu(a);s.call(u)}}var a=ME(e,r,n,0,null,!1,!1,"",sp);return n._reactRootContainer=a,n[_r]=a.current,go(n.nodeType===8?n.parentNode:n),Zi(),a}for(;i=n.lastChild;)n.removeChild(i);if(typeof r=="function"){var o=r;r=function(){var u=Nu(l);o.call(u)}}var l=tg(n,0,!1,null,null,!1,!1,"",sp);return n._reactRootContainer=l,n[_r]=l.current,go(n.nodeType===8?n.parentNode:n),Zi(function(){dc(e,l,t,r)}),l}function gc(n,e,t,r,i){var s=t._reactRootContainer;if(s){var a=s;if(typeof i=="function"){var o=i;i=function(){var l=Nu(a);o.call(l)}}dc(e,a,n,i)}else a=ML(t,e,n,i,r);return Nu(a)}hv=function(n){switch(n.tag){case 3:var e=n.stateNode;if(e.current.memoizedState.isDehydrated){var t=$a(e.pendingLanes);t!==0&&(Lf(e,t|1),zt(e,nt()),!(_e&6)&&(ca=nt()+500,Ti()))}break;case 13:Zi(function(){var r=Ir(n,1);if(r!==null){var i=Ft();On(r,n,1,i)}}),ng(n,1)}};Af=function(n){if(n.tag===13){var e=Ir(n,134217728);if(e!==null){var t=Ft();On(e,n,134217728,t)}ng(n,134217728)}};fv=function(n){if(n.tag===13){var e=hi(n),t=Ir(n,e);if(t!==null){var r=Ft();On(t,n,e,r)}ng(n,e)}};gv=function(){return Pe};mv=function(n,e){var t=Pe;try{return Pe=n,e()}finally{Pe=t}};Qd=function(n,e,t){switch(e){case"input":if(Kd(n,t),e=t.name,t.type==="radio"&&e!=null){for(t=n;t.parentNode;)t=t.parentNode;for(t=t.querySelectorAll("input[name="+JSON.stringify(""+e)+'][type="radio"]'),e=0;e<t.length;e++){var r=t[e];if(r!==n&&r.form===n.form){var i=ic(r);if(!i)throw Error(K(90));zy(r),Kd(r,i)}}}break;case"textarea":Yy(n,t);break;case"select":e=t.value,e!=null&&Fs(n,!!t.multiple,e,!1)}};tv=Xf;nv=Zi;var NL={usingClientEntryPoint:!1,Events:[jo,As,ic,Jy,ev,Xf]},ba={findFiberByHostInstance:Oi,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},UL={bundleType:ba.bundleType,version:ba.version,rendererPackageName:ba.rendererPackageName,rendererConfig:ba.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:Cr.ReactCurrentDispatcher,findHostInstanceByFiber:function(n){return n=sv(n),n===null?null:n.stateNode},findFiberByHostInstance:ba.findFiberByHostInstance||FL,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var xl=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!xl.isDisabled&&xl.supportsFiber)try{ec=xl.inject(UL),er=xl}catch{}}ln.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=NL;ln.createPortal=function(n,e){var t=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!ig(e))throw Error(K(200));return OL(n,e,null,t)};ln.createRoot=function(n,e){if(!ig(n))throw Error(K(299));var t=!1,r="",i=NE;return e!=null&&(e.unstable_strictMode===!0&&(t=!0),e.identifierPrefix!==void 0&&(r=e.identifierPrefix),e.onRecoverableError!==void 0&&(i=e.onRecoverableError)),e=tg(n,1,!1,null,null,t,!1,r,i),n[_r]=e.current,go(n.nodeType===8?n.parentNode:n),new rg(e)};ln.findDOMNode=function(n){if(n==null)return null;if(n.nodeType===1)return n;var e=n._reactInternals;if(e===void 0)throw typeof n.render=="function"?Error(K(188)):(n=Object.keys(n).join(","),Error(K(268,n)));return n=sv(e),n=n===null?null:n.stateNode,n};ln.flushSync=function(n){return Zi(n)};ln.hydrate=function(n,e,t){if(!fc(e))throw Error(K(200));return gc(null,n,e,!0,t)};ln.hydrateRoot=function(n,e,t){if(!ig(n))throw Error(K(405));var r=t!=null&&t.hydratedSources||null,i=!1,s="",a=NE;if(t!=null&&(t.unstable_strictMode===!0&&(i=!0),t.identifierPrefix!==void 0&&(s=t.identifierPrefix),t.onRecoverableError!==void 0&&(a=t.onRecoverableError)),e=ME(e,null,n,1,t??null,i,!1,s,a),n[_r]=e.current,go(n),r)for(n=0;n<r.length;n++)t=r[n],i=t._getVersion,i=i(t._source),e.mutableSourceEagerHydrationData==null?e.mutableSourceEagerHydrationData=[t,i]:e.mutableSourceEagerHydrationData.push(t,i);return new hc(e)};ln.render=function(n,e,t){if(!fc(e))throw Error(K(200));return gc(null,n,e,!1,t)};ln.unmountComponentAtNode=function(n){if(!fc(n))throw Error(K(40));return n._reactRootContainer?(Zi(function(){gc(null,null,n,!1,function(){n._reactRootContainer=null,n[_r]=null})}),!0):!1};ln.unstable_batchedUpdates=Xf;ln.unstable_renderSubtreeIntoContainer=function(n,e,t,r){if(!fc(t))throw Error(K(200));if(n==null||n._reactInternals===void 0)throw Error(K(38));return gc(n,e,t,!1,r)};ln.version="18.3.1-next-f1338f8080-20240426";function UE(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(UE)}catch(n){console.error(n)}}UE(),Uy.exports=ln;var sg=Uy.exports;const BL=_y(sg),$L=Ry({__proto__:null,default:BL},[sg]);var BE,ap=sg;BE=ap.createRoot,ap.hydrateRoot;/**
 * @remix-run/router v1.19.2
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function ze(){return ze=Object.assign?Object.assign.bind():function(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(n[r]=t[r])}return n},ze.apply(this,arguments)}var st;(function(n){n.Pop="POP",n.Push="PUSH",n.Replace="REPLACE"})(st||(st={}));const op="popstate";function jL(n){n===void 0&&(n={});function e(r,i){let{pathname:s,search:a,hash:o}=r.location;return Lo("",{pathname:s,search:a,hash:o},i.state&&i.state.usr||null,i.state&&i.state.key||"default")}function t(r,i){return typeof i=="string"?i:pi(i)}return KL(e,t,null,n)}function Ee(n,e){if(n===!1||n===null||typeof n>"u")throw new Error(e)}function da(n,e){if(!n){typeof console<"u"&&console.warn(e);try{throw new Error(e)}catch{}}}function GL(){return Math.random().toString(36).substr(2,8)}function lp(n,e){return{usr:n.state,key:n.key,idx:e}}function Lo(n,e,t,r){return t===void 0&&(t=null),ze({pathname:typeof n=="string"?n:n.pathname,search:"",hash:""},typeof e=="string"?Li(e):e,{state:t,key:e&&e.key||r||GL()})}function pi(n){let{pathname:e="/",search:t="",hash:r=""}=n;return t&&t!=="?"&&(e+=t.charAt(0)==="?"?t:"?"+t),r&&r!=="#"&&(e+=r.charAt(0)==="#"?r:"#"+r),e}function Li(n){let e={};if(n){let t=n.indexOf("#");t>=0&&(e.hash=n.substr(t),n=n.substr(0,t));let r=n.indexOf("?");r>=0&&(e.search=n.substr(r),n=n.substr(0,r)),n&&(e.pathname=n)}return e}function KL(n,e,t,r){r===void 0&&(r={});let{window:i=document.defaultView,v5Compat:s=!1}=r,a=i.history,o=st.Pop,l=null,u=c();u==null&&(u=0,a.replaceState(ze({},a.state,{idx:u}),""));function c(){return(a.state||{idx:null}).idx}function d(){o=st.Pop;let y=c(),p=y==null?null:y-u;u=y,l&&l({action:o,location:m.location,delta:p})}function h(y,p){o=st.Push;let v=Lo(m.location,y,p);u=c()+1;let E=lp(v,u),T=m.createHref(v);try{a.pushState(E,"",T)}catch(A){if(A instanceof DOMException&&A.name==="DataCloneError")throw A;i.location.assign(T)}s&&l&&l({action:o,location:m.location,delta:1})}function f(y,p){o=st.Replace;let v=Lo(m.location,y,p);u=c();let E=lp(v,u),T=m.createHref(v);a.replaceState(E,"",T),s&&l&&l({action:o,location:m.location,delta:0})}function g(y){let p=i.location.origin!=="null"?i.location.origin:i.location.href,v=typeof y=="string"?y:pi(y);return v=v.replace(/ $/,"%20"),Ee(p,"No window.location.(origin|href) available to create URL for href: "+v),new URL(v,p)}let m={get action(){return o},get location(){return n(i,a)},listen(y){if(l)throw new Error("A history only accepts one active listener");return i.addEventListener(op,d),l=y,()=>{i.removeEventListener(op,d),l=null}},createHref(y){return e(i,y)},createURL:g,encodeLocation(y){let p=g(y);return{pathname:p.pathname,search:p.search,hash:p.hash}},push:h,replace:f,go(y){return a.go(y)}};return m}var Me;(function(n){n.data="data",n.deferred="deferred",n.redirect="redirect",n.error="error"})(Me||(Me={}));const VL=new Set(["lazy","caseSensitive","path","id","index","children"]);function HL(n){return n.index===!0}function Ao(n,e,t,r){return t===void 0&&(t=[]),r===void 0&&(r={}),n.map((i,s)=>{let a=[...t,String(s)],o=typeof i.id=="string"?i.id:a.join("-");if(Ee(i.index!==!0||!i.children,"Cannot specify children on an index route"),Ee(!r[o],'Found a route id collision on id "'+o+`".  Route id's must be globally unique within Data Router usages`),HL(i)){let l=ze({},i,e(i),{id:o});return r[o]=l,l}else{let l=ze({},i,e(i),{id:o,children:void 0});return r[o]=l,i.children&&(l.children=Ao(i.children,e,a,r)),l}})}function Pi(n,e,t){return t===void 0&&(t="/"),nu(n,e,t,!1)}function nu(n,e,t,r){let i=typeof e=="string"?Li(e):e,s=yi(i.pathname||"/",t);if(s==null)return null;let a=$E(n);WL(a);let o=null;for(let l=0;o==null&&l<a.length;++l){let u=iA(s);o=nA(a[l],u,r)}return o}function zL(n,e){let{route:t,pathname:r,params:i}=n;return{id:t.id,pathname:r,params:i,data:e[t.id],handle:t.handle}}function $E(n,e,t,r){e===void 0&&(e=[]),t===void 0&&(t=[]),r===void 0&&(r="");let i=(s,a,o)=>{let l={relativePath:o===void 0?s.path||"":o,caseSensitive:s.caseSensitive===!0,childrenIndex:a,route:s};l.relativePath.startsWith("/")&&(Ee(l.relativePath.startsWith(r),'Absolute route path "'+l.relativePath+'" nested under path '+('"'+r+'" is not valid. An absolute child route path ')+"must start with the combined path of all its parent routes."),l.relativePath=l.relativePath.slice(r.length));let u=nr([r,l.relativePath]),c=t.concat(l);s.children&&s.children.length>0&&(Ee(s.index!==!0,"Index routes must not have child routes. Please remove "+('all child routes from route path "'+u+'".')),$E(s.children,e,c,u)),!(s.path==null&&!s.index)&&e.push({path:u,score:eA(u,s.index),routesMeta:c})};return n.forEach((s,a)=>{var o;if(s.path===""||!((o=s.path)!=null&&o.includes("?")))i(s,a);else for(let l of jE(s.path))i(s,a,l)}),e}function jE(n){let e=n.split("/");if(e.length===0)return[];let[t,...r]=e,i=t.endsWith("?"),s=t.replace(/\?$/,"");if(r.length===0)return i?[s,""]:[s];let a=jE(r.join("/")),o=[];return o.push(...a.map(l=>l===""?s:[s,l].join("/"))),i&&o.push(...a),o.map(l=>n.startsWith("/")&&l===""?"/":l)}function WL(n){n.sort((e,t)=>e.score!==t.score?t.score-e.score:tA(e.routesMeta.map(r=>r.childrenIndex),t.routesMeta.map(r=>r.childrenIndex)))}const YL=/^:[\w-]+$/,qL=3,QL=2,XL=1,ZL=10,JL=-2,up=n=>n==="*";function eA(n,e){let t=n.split("/"),r=t.length;return t.some(up)&&(r+=JL),e&&(r+=QL),t.filter(i=>!up(i)).reduce((i,s)=>i+(YL.test(s)?qL:s===""?XL:ZL),r)}function tA(n,e){return n.length===e.length&&n.slice(0,-1).every((r,i)=>r===e[i])?n[n.length-1]-e[e.length-1]:0}function nA(n,e,t){t===void 0&&(t=!1);let{routesMeta:r}=n,i={},s="/",a=[];for(let o=0;o<r.length;++o){let l=r[o],u=o===r.length-1,c=s==="/"?e:e.slice(s.length)||"/",d=cp({path:l.relativePath,caseSensitive:l.caseSensitive,end:u},c),h=l.route;if(!d&&u&&t&&!r[r.length-1].route.index&&(d=cp({path:l.relativePath,caseSensitive:l.caseSensitive,end:!1},c)),!d)return null;Object.assign(i,d.params),a.push({params:i,pathname:nr([s,d.pathname]),pathnameBase:oA(nr([s,d.pathnameBase])),route:h}),d.pathnameBase!=="/"&&(s=nr([s,d.pathnameBase]))}return a}function cp(n,e){typeof n=="string"&&(n={path:n,caseSensitive:!1,end:!0});let[t,r]=rA(n.path,n.caseSensitive,n.end),i=e.match(t);if(!i)return null;let s=i[0],a=s.replace(/(.)\/+$/,"$1"),o=i.slice(1);return{params:r.reduce((u,c,d)=>{let{paramName:h,isOptional:f}=c;if(h==="*"){let m=o[d]||"";a=s.slice(0,s.length-m.length).replace(/(.)\/+$/,"$1")}const g=o[d];return f&&!g?u[h]=void 0:u[h]=(g||"").replace(/%2F/g,"/"),u},{}),pathname:s,pathnameBase:a,pattern:n}}function rA(n,e,t){e===void 0&&(e=!1),t===void 0&&(t=!0),da(n==="*"||!n.endsWith("*")||n.endsWith("/*"),'Route path "'+n+'" will be treated as if it were '+('"'+n.replace(/\*$/,"/*")+'" because the `*` character must ')+"always follow a `/` in the pattern. To get rid of this warning, "+('please change the route path to "'+n.replace(/\*$/,"/*")+'".'));let r=[],i="^"+n.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(a,o,l)=>(r.push({paramName:o,isOptional:l!=null}),l?"/?([^\\/]+)?":"/([^\\/]+)"));return n.endsWith("*")?(r.push({paramName:"*"}),i+=n==="*"||n==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):t?i+="\\/*$":n!==""&&n!=="/"&&(i+="(?:(?=\\/|$))"),[new RegExp(i,e?void 0:"i"),r]}function iA(n){try{return n.split("/").map(e=>decodeURIComponent(e).replace(/\//g,"%2F")).join("/")}catch(e){return da(!1,'The URL path "'+n+'" could not be decoded because it is is a malformed URL segment. This is probably due to a bad percent '+("encoding ("+e+").")),n}}function yi(n,e){if(e==="/")return n;if(!n.toLowerCase().startsWith(e.toLowerCase()))return null;let t=e.endsWith("/")?e.length-1:e.length,r=n.charAt(t);return r&&r!=="/"?null:n.slice(t)||"/"}function sA(n,e){e===void 0&&(e="/");let{pathname:t,search:r="",hash:i=""}=typeof n=="string"?Li(n):n;return{pathname:t?t.startsWith("/")?t:aA(t,e):e,search:lA(r),hash:uA(i)}}function aA(n,e){let t=e.replace(/\/+$/,"").split("/");return n.split("/").forEach(i=>{i===".."?t.length>1&&t.pop():i!=="."&&t.push(i)}),t.length>1?t.join("/"):"/"}function td(n,e,t,r){return"Cannot include a '"+n+"' character in a manually specified "+("`to."+e+"` field ["+JSON.stringify(r)+"].  Please separate it out to the ")+("`to."+t+"` field. Alternatively you may provide the full path as ")+'a string in <Link to="..."> and the router will parse it for you.'}function GE(n){return n.filter((e,t)=>t===0||e.route.path&&e.route.path.length>0)}function mc(n,e){let t=GE(n);return e?t.map((r,i)=>i===t.length-1?r.pathname:r.pathnameBase):t.map(r=>r.pathnameBase)}function pc(n,e,t,r){r===void 0&&(r=!1);let i;typeof n=="string"?i=Li(n):(i=ze({},n),Ee(!i.pathname||!i.pathname.includes("?"),td("?","pathname","search",i)),Ee(!i.pathname||!i.pathname.includes("#"),td("#","pathname","hash",i)),Ee(!i.search||!i.search.includes("#"),td("#","search","hash",i)));let s=n===""||i.pathname==="",a=s?"/":i.pathname,o;if(a==null)o=t;else{let d=e.length-1;if(!r&&a.startsWith("..")){let h=a.split("/");for(;h[0]==="..";)h.shift(),d-=1;i.pathname=h.join("/")}o=d>=0?e[d]:"/"}let l=sA(i,o),u=a&&a!=="/"&&a.endsWith("/"),c=(s||a===".")&&t.endsWith("/");return!l.pathname.endsWith("/")&&(u||c)&&(l.pathname+="/"),l}const nr=n=>n.join("/").replace(/\/\/+/g,"/"),oA=n=>n.replace(/\/+$/,"").replace(/^\/*/,"/"),lA=n=>!n||n==="?"?"":n.startsWith("?")?n:"?"+n,uA=n=>!n||n==="#"?"":n.startsWith("#")?n:"#"+n;class Uu{constructor(e,t,r,i){i===void 0&&(i=!1),this.status=e,this.statusText=t||"",this.internal=i,r instanceof Error?(this.data=r.toString(),this.error=r):this.data=r}}function yc(n){return n!=null&&typeof n.status=="number"&&typeof n.statusText=="string"&&typeof n.internal=="boolean"&&"data"in n}const KE=["post","put","patch","delete"],cA=new Set(KE),dA=["get",...KE],hA=new Set(dA),fA=new Set([301,302,303,307,308]),gA=new Set([307,308]),nd={state:"idle",location:void 0,formMethod:void 0,formAction:void 0,formEncType:void 0,formData:void 0,json:void 0,text:void 0},mA={state:"idle",data:void 0,formMethod:void 0,formAction:void 0,formEncType:void 0,formData:void 0,json:void 0,text:void 0},ka={state:"unblocked",proceed:void 0,reset:void 0,location:void 0},ag=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,pA=n=>({hasErrorBoundary:!!n.hasErrorBoundary}),VE="remix-router-transitions";function yA(n){const e=n.window?n.window:typeof window<"u"?window:void 0,t=typeof e<"u"&&typeof e.document<"u"&&typeof e.document.createElement<"u",r=!t;Ee(n.routes.length>0,"You must provide a non-empty routes array to createRouter");let i;if(n.mapRouteProperties)i=n.mapRouteProperties;else if(n.detectErrorBoundary){let C=n.detectErrorBoundary;i=k=>({hasErrorBoundary:C(k)})}else i=pA;let s={},a=Ao(n.routes,i,void 0,s),o,l=n.basename||"/",u=n.unstable_dataStrategy||LA,c=n.unstable_patchRoutesOnNavigation,d=ze({v7_fetcherPersist:!1,v7_normalizeFormMethod:!1,v7_partialHydration:!1,v7_prependBasename:!1,v7_relativeSplatPath:!1,v7_skipActionErrorRevalidation:!1},n.future),h=null,f=new Set,g=1e3,m=new Set,y=null,p=null,v=null,E=n.hydrationData!=null,T=Pi(a,n.history.location,l),A=null;if(T==null&&!c){let C=Pt(404,{pathname:n.history.location.pathname}),{matches:k,route:N}=Ep(a);T=k,A={[N.id]:C}}T&&!n.hydrationData&&Zo(T,a,n.history.location.pathname).active&&(T=null);let I;if(T)if(T.some(C=>C.route.lazy))I=!1;else if(!T.some(C=>C.route.loader))I=!0;else if(d.v7_partialHydration){let C=n.hydrationData?n.hydrationData.loaderData:null,k=n.hydrationData?n.hydrationData.errors:null,N=G=>G.route.loader?typeof G.route.loader=="function"&&G.route.loader.hydrate===!0?!1:C&&C[G.route.id]!==void 0||k&&k[G.route.id]!==void 0:!0;if(k){let G=T.findIndex(ee=>k[ee.route.id]!==void 0);I=T.slice(0,G+1).every(N)}else I=T.every(N)}else I=n.hydrationData!=null;else if(I=!1,T=[],d.v7_partialHydration){let C=Zo(null,a,n.history.location.pathname);C.active&&C.matches&&(T=C.matches)}let R,x={historyAction:n.history.action,location:n.history.location,matches:T,initialized:I,navigation:nd,restoreScrollPosition:n.hydrationData!=null?!1:null,preventScrollReset:!1,revalidation:"idle",loaderData:n.hydrationData&&n.hydrationData.loaderData||{},actionData:n.hydrationData&&n.hydrationData.actionData||null,errors:n.hydrationData&&n.hydrationData.errors||A,fetchers:new Map,blockers:new Map},D=st.Pop,_=!1,M,j=!1,z=new Map,H=null,W=!1,V=!1,X=[],B=new Set,F=new Map,U=0,Q=-1,q=new Map,oe=new Set,de=new Map,pe=new Map,he=new Set,Fe=new Map,Xe=new Map,Nn=new Map,_i;function Ac(){if(h=n.history.listen(C=>{let{action:k,location:N,delta:G}=C;if(_i){_i(),_i=void 0;return}da(Xe.size===0||G!=null,"You are trying to use a blocker on a POP navigation to a location that was not created by @remix-run/router. This will fail silently in production. This can happen if you are navigating outside the router via `window.history.pushState`/`window.location.hash` instead of using router navigation APIs.  This can also happen if you are using createHashRouter and the user manually changes the URL.");let ee=zg({currentLocation:x.location,nextLocation:N,historyAction:k});if(ee&&G!=null){let ae=new Promise(fe=>{_i=fe});n.history.go(G*-1),Qo(ee,{state:"blocked",location:N,proceed(){Qo(ee,{state:"proceeding",proceed:void 0,reset:void 0,location:N}),ae.then(()=>n.history.go(G))},reset(){let fe=new Map(x.blockers);fe.set(ee,ka),ot({blockers:fe})}});return}return rt(k,N)}),t){UA(e,z);let C=()=>BA(e,z);e.addEventListener("pagehide",C),H=()=>e.removeEventListener("pagehide",C)}return x.initialized||rt(st.Pop,x.location,{initialHydration:!0}),R}function Rc(){h&&h(),H&&H(),f.clear(),M&&M.abort(),x.fetchers.forEach((C,k)=>qo(k)),x.blockers.forEach((C,k)=>Hg(k))}function Ta(C){return f.add(C),()=>f.delete(C)}function ot(C,k){k===void 0&&(k={}),x=ze({},x,C);let N=[],G=[];d.v7_fetcherPersist&&x.fetchers.forEach((ee,ae)=>{ee.state==="idle"&&(he.has(ae)?G.push(ae):N.push(ae))}),[...f].forEach(ee=>ee(x,{deletedFetchers:G,unstable_viewTransitionOpts:k.viewTransitionOpts,unstable_flushSync:k.flushSync===!0})),d.v7_fetcherPersist&&(N.forEach(ee=>x.fetchers.delete(ee)),G.forEach(ee=>qo(ee)))}function Ii(C,k,N){var G,ee;let{flushSync:ae}=N===void 0?{}:N,fe=x.actionData!=null&&x.navigation.formMethod!=null&&wn(x.navigation.formMethod)&&x.navigation.state==="loading"&&((G=C.state)==null?void 0:G._isRedirect)!==!0,Y;k.actionData?Object.keys(k.actionData).length>0?Y=k.actionData:Y=null:fe?Y=x.actionData:Y=null;let le=k.loaderData?yp(x.loaderData,k.loaderData,k.matches||[],k.errors):x.loaderData,ie=x.blockers;ie.size>0&&(ie=new Map(ie),ie.forEach((ke,Be)=>ie.set(Be,ka)));let se=_===!0||x.navigation.formMethod!=null&&wn(x.navigation.formMethod)&&((ee=C.state)==null?void 0:ee._isRedirect)!==!0;o&&(a=o,o=void 0),W||D===st.Pop||(D===st.Push?n.history.push(C,C.state):D===st.Replace&&n.history.replace(C,C.state));let De;if(D===st.Pop){let ke=z.get(x.location.pathname);ke&&ke.has(C.pathname)?De={currentLocation:x.location,nextLocation:C}:z.has(C.pathname)&&(De={currentLocation:C,nextLocation:x.location})}else if(j){let ke=z.get(x.location.pathname);ke?ke.add(C.pathname):(ke=new Set([C.pathname]),z.set(x.location.pathname,ke)),De={currentLocation:x.location,nextLocation:C}}ot(ze({},k,{actionData:Y,loaderData:le,historyAction:D,location:C,initialized:!0,navigation:nd,revalidation:"idle",restoreScrollPosition:Yg(C,k.matches||x.matches),preventScrollReset:se,blockers:ie}),{viewTransitionOpts:De,flushSync:ae===!0}),D=st.Pop,_=!1,j=!1,W=!1,V=!1,X=[]}async function Te(C,k){if(typeof C=="number"){n.history.go(C);return}let N=Ch(x.location,x.matches,l,d.v7_prependBasename,C,d.v7_relativeSplatPath,k==null?void 0:k.fromRouteId,k==null?void 0:k.relative),{path:G,submission:ee,error:ae}=dp(d.v7_normalizeFormMethod,!1,N,k),fe=x.location,Y=Lo(x.location,G,k&&k.state);Y=ze({},Y,n.history.encodeLocation(Y));let le=k&&k.replace!=null?k.replace:void 0,ie=st.Push;le===!0?ie=st.Replace:le===!1||ee!=null&&wn(ee.formMethod)&&ee.formAction===x.location.pathname+x.location.search&&(ie=st.Replace);let se=k&&"preventScrollReset"in k?k.preventScrollReset===!0:void 0,De=(k&&k.unstable_flushSync)===!0,ke=zg({currentLocation:fe,nextLocation:Y,historyAction:ie});if(ke){Qo(ke,{state:"blocked",location:Y,proceed(){Qo(ke,{state:"proceeding",proceed:void 0,reset:void 0,location:Y}),Te(C,k)},reset(){let Be=new Map(x.blockers);Be.set(ke,ka),ot({blockers:Be})}});return}return await rt(ie,Y,{submission:ee,pendingError:ae,preventScrollReset:se,replace:k&&k.replace,enableViewTransition:k&&k.unstable_viewTransition,flushSync:De})}function ft(){if(ls(),ot({revalidation:"loading"}),x.navigation.state!=="submitting"){if(x.navigation.state==="idle"){rt(x.historyAction,x.location,{startUninterruptedRevalidation:!0});return}rt(D||x.historyAction,x.navigation.location,{overrideNavigation:x.navigation,enableViewTransition:j===!0})}}async function rt(C,k,N){M&&M.abort(),M=null,D=C,W=(N&&N.startUninterruptedRevalidation)===!0,uT(x.location,x.matches),_=(N&&N.preventScrollReset)===!0,j=(N&&N.enableViewTransition)===!0;let G=o||a,ee=N&&N.overrideNavigation,ae=Pi(G,k,l),fe=(N&&N.flushSync)===!0,Y=Zo(ae,G,k.pathname);if(Y.active&&Y.matches&&(ae=Y.matches),!ae){let{error:Re,notFoundMatches:gt,route:it}=_c(k.pathname);Ii(k,{matches:gt,loaderData:{},errors:{[it.id]:Re}},{flushSync:fe});return}if(x.initialized&&!V&&CA(x.location,k)&&!(N&&N.submission&&wn(N.submission.formMethod))){Ii(k,{matches:ae},{flushSync:fe});return}M=new AbortController;let le=ds(n.history,k,M.signal,N&&N.submission),ie;if(N&&N.pendingError)ie=[bs(ae).route.id,{type:Me.error,error:N.pendingError}];else if(N&&N.submission&&wn(N.submission.formMethod)){let Re=await sr(le,k,N.submission,ae,Y.active,{replace:N.replace,flushSync:fe});if(Re.shortCircuited)return;if(Re.pendingActionResult){let[gt,it]=Re.pendingActionResult;if(Jt(it)&&yc(it.error)&&it.error.status===404){M=null,Ii(k,{matches:Re.matches,loaderData:{},errors:{[gt]:it.error}});return}}ae=Re.matches||ae,ie=Re.pendingActionResult,ee=rd(k,N.submission),fe=!1,Y.active=!1,le=ds(n.history,le.url,le.signal)}let{shortCircuited:se,matches:De,loaderData:ke,errors:Be}=await Yt(le,k,ae,Y.active,ee,N&&N.submission,N&&N.fetcherSubmission,N&&N.replace,N&&N.initialHydration===!0,fe,ie);se||(M=null,Ii(k,ze({matches:De||ae},vp(ie),{loaderData:ke,errors:Be})))}async function sr(C,k,N,G,ee,ae){ae===void 0&&(ae={}),ls();let fe=MA(k,N);if(ot({navigation:fe},{flushSync:ae.flushSync===!0}),ee){let ie=await Jo(G,k.pathname,C.signal);if(ie.type==="aborted")return{shortCircuited:!0};if(ie.type==="error"){let{boundaryId:se,error:De}=Xo(k.pathname,ie);return{matches:ie.partialMatches,pendingActionResult:[se,{type:Me.error,error:De}]}}else if(ie.matches)G=ie.matches;else{let{notFoundMatches:se,error:De,route:ke}=_c(k.pathname);return{matches:se,pendingActionResult:[ke.id,{type:Me.error,error:De}]}}}let Y,le=Ga(G,k);if(!le.route.action&&!le.route.lazy)Y={type:Me.error,error:Pt(405,{method:C.method,pathname:k.pathname,routeId:le.route.id})};else if(Y=(await Pr("action",x,C,[le],G,null))[le.route.id],C.signal.aborted)return{shortCircuited:!0};if(Ni(Y)){let ie;return ae&&ae.replace!=null?ie=ae.replace:ie=gp(Y.response.headers.get("Location"),new URL(C.url),l)===x.location.pathname+x.location.search,await qt(C,Y,!0,{submission:N,replace:ie}),{shortCircuited:!0}}if(ii(Y))throw Pt(400,{type:"defer-action"});if(Jt(Y)){let ie=bs(G,le.route.id);return(ae&&ae.replace)!==!0&&(D=st.Push),{matches:G,pendingActionResult:[ie.route.id,Y]}}return{matches:G,pendingActionResult:[le.route.id,Y]}}async function Yt(C,k,N,G,ee,ae,fe,Y,le,ie,se){let De=ee||rd(k,ae),ke=ae||fe||xp(De),Be=!W&&(!d.v7_partialHydration||!le);if(G){if(Be){let Ze=ar(se);ot(ze({navigation:De},Ze!==void 0?{actionData:Ze}:{}),{flushSync:ie})}let ye=await Jo(N,k.pathname,C.signal);if(ye.type==="aborted")return{shortCircuited:!0};if(ye.type==="error"){let{boundaryId:Ze,error:Qt}=Xo(k.pathname,ye);return{matches:ye.partialMatches,loaderData:{},errors:{[Ze]:Qt}}}else if(ye.matches)N=ye.matches;else{let{error:Ze,notFoundMatches:Qt,route:Je}=_c(k.pathname);return{matches:Qt,loaderData:{},errors:{[Je.id]:Ze}}}}let Re=o||a,[gt,it]=hp(n.history,x,N,ke,k,d.v7_partialHydration&&le===!0,d.v7_skipActionErrorRevalidation,V,X,B,he,de,oe,Re,l,se);if(Ic(ye=>!(N&&N.some(Ze=>Ze.route.id===ye))||gt&&gt.some(Ze=>Ze.route.id===ye)),Q=++U,gt.length===0&&it.length===0){let ye=Kg();return Ii(k,ze({matches:N,loaderData:{},errors:se&&Jt(se[1])?{[se[0]]:se[1].error}:null},vp(se),ye?{fetchers:new Map(x.fetchers)}:{}),{flushSync:ie}),{shortCircuited:!0}}if(Be){let ye={};if(!G){ye.navigation=De;let Ze=ar(se);Ze!==void 0&&(ye.actionData=Ze)}it.length>0&&(ye.fetchers=or(it)),ot(ye,{flushSync:ie})}it.forEach(ye=>{F.has(ye.key)&&Or(ye.key),ye.controller&&F.set(ye.key,ye.controller)});let La=()=>it.forEach(ye=>Or(ye.key));M&&M.signal.addEventListener("abort",La);let{loaderResults:lr,fetcherResults:us}=await Yo(x,N,gt,it,C);if(C.signal.aborted)return{shortCircuited:!0};M&&M.signal.removeEventListener("abort",La),it.forEach(ye=>F.delete(ye.key));let Fr=Tl(lr);if(Fr)return await qt(C,Fr.result,!0,{replace:Y}),{shortCircuited:!0};if(Fr=Tl(us),Fr)return oe.add(Fr.key),await qt(C,Fr.result,!0,{replace:Y}),{shortCircuited:!0};let{loaderData:el,errors:ur}=pp(x,N,gt,lr,se,it,us,Fe);Fe.forEach((ye,Ze)=>{ye.subscribe(Qt=>{(Qt||ye.done)&&Fe.delete(Ze)})}),d.v7_partialHydration&&le&&x.errors&&Object.entries(x.errors).filter(ye=>{let[Ze]=ye;return!gt.some(Qt=>Qt.route.id===Ze)}).forEach(ye=>{let[Ze,Qt]=ye;ur=Object.assign(ur||{},{[Ze]:Qt})});let tl=Kg(),nl=Vg(Q),rl=tl||nl||it.length>0;return ze({matches:N,loaderData:el,errors:ur},rl?{fetchers:new Map(x.fetchers)}:{})}function ar(C){if(C&&!Jt(C[1]))return{[C[0]]:C[1].data};if(x.actionData)return Object.keys(x.actionData).length===0?null:x.actionData}function or(C){return C.forEach(k=>{let N=x.fetchers.get(k.key),G=Pa(void 0,N?N.data:void 0);x.fetchers.set(k.key,G)}),new Map(x.fetchers)}function zo(C,k,N,G){if(r)throw new Error("router.fetch() was called during the server render, but it shouldn't be. You are likely calling a useFetcher() method in the body of your component. Try moving it to a useEffect or a callback.");F.has(C)&&Or(C);let ee=(G&&G.unstable_flushSync)===!0,ae=o||a,fe=Ch(x.location,x.matches,l,d.v7_prependBasename,N,d.v7_relativeSplatPath,k,G==null?void 0:G.relative),Y=Pi(ae,fe,l),le=Zo(Y,ae,fe);if(le.active&&le.matches&&(Y=le.matches),!Y){wt(C,k,Pt(404,{pathname:fe}),{flushSync:ee});return}let{path:ie,submission:se,error:De}=dp(d.v7_normalizeFormMethod,!0,fe,G);if(De){wt(C,k,De,{flushSync:ee});return}let ke=Ga(Y,ie);if(_=(G&&G.preventScrollReset)===!0,se&&wn(se.formMethod)){os(C,k,ie,ke,Y,le.active,ee,se);return}de.set(C,{routeId:k,path:ie}),Wo(C,k,ie,ke,Y,le.active,ee,se)}async function os(C,k,N,G,ee,ae,fe,Y){ls(),de.delete(C);function le(Je){if(!Je.route.action&&!Je.route.lazy){let cr=Pt(405,{method:Y.formMethod,pathname:N,routeId:k});return wt(C,k,cr,{flushSync:fe}),!0}return!1}if(!ae&&le(G))return;let ie=x.fetchers.get(C);Ln(C,NA(Y,ie),{flushSync:fe});let se=new AbortController,De=ds(n.history,N,se.signal,Y);if(ae){let Je=await Jo(ee,N,De.signal);if(Je.type==="aborted")return;if(Je.type==="error"){let{error:cr}=Xo(N,Je);wt(C,k,cr,{flushSync:fe});return}else if(Je.matches){if(ee=Je.matches,G=Ga(ee,N),le(G))return}else{wt(C,k,Pt(404,{pathname:N}),{flushSync:fe});return}}F.set(C,se);let ke=U,Re=(await Pr("action",x,De,[G],ee,C))[G.route.id];if(De.signal.aborted){F.get(C)===se&&F.delete(C);return}if(d.v7_fetcherPersist&&he.has(C)){if(Ni(Re)||Jt(Re)){Ln(C,Br(void 0));return}}else{if(Ni(Re))if(F.delete(C),Q>ke){Ln(C,Br(void 0));return}else return oe.add(C),Ln(C,Pa(Y)),qt(De,Re,!1,{fetcherSubmission:Y});if(Jt(Re)){wt(C,k,Re.error);return}}if(ii(Re))throw Pt(400,{type:"defer-action"});let gt=x.navigation.location||x.location,it=ds(n.history,gt,se.signal),La=o||a,lr=x.navigation.state!=="idle"?Pi(La,x.navigation.location,l):x.matches;Ee(lr,"Didn't find any matches after fetcher action");let us=++U;q.set(C,us);let Fr=Pa(Y,Re.data);x.fetchers.set(C,Fr);let[el,ur]=hp(n.history,x,lr,Y,gt,!1,d.v7_skipActionErrorRevalidation,V,X,B,he,de,oe,La,l,[G.route.id,Re]);ur.filter(Je=>Je.key!==C).forEach(Je=>{let cr=Je.key,Qg=x.fetchers.get(cr),hT=Pa(void 0,Qg?Qg.data:void 0);x.fetchers.set(cr,hT),F.has(cr)&&Or(cr),Je.controller&&F.set(cr,Je.controller)}),ot({fetchers:new Map(x.fetchers)});let tl=()=>ur.forEach(Je=>Or(Je.key));se.signal.addEventListener("abort",tl);let{loaderResults:nl,fetcherResults:rl}=await Yo(x,lr,el,ur,it);if(se.signal.aborted)return;se.signal.removeEventListener("abort",tl),q.delete(C),F.delete(C),ur.forEach(Je=>F.delete(Je.key));let ye=Tl(nl);if(ye)return qt(it,ye.result,!1);if(ye=Tl(rl),ye)return oe.add(ye.key),qt(it,ye.result,!1);let{loaderData:Ze,errors:Qt}=pp(x,lr,el,nl,void 0,ur,rl,Fe);if(x.fetchers.has(C)){let Je=Br(Re.data);x.fetchers.set(C,Je)}Vg(us),x.navigation.state==="loading"&&us>Q?(Ee(D,"Expected pending action"),M&&M.abort(),Ii(x.navigation.location,{matches:lr,loaderData:Ze,errors:Qt,fetchers:new Map(x.fetchers)})):(ot({errors:Qt,loaderData:yp(x.loaderData,Ze,lr,Qt),fetchers:new Map(x.fetchers)}),V=!1)}async function Wo(C,k,N,G,ee,ae,fe,Y){let le=x.fetchers.get(C);Ln(C,Pa(Y,le?le.data:void 0),{flushSync:fe});let ie=new AbortController,se=ds(n.history,N,ie.signal);if(ae){let Re=await Jo(ee,N,se.signal);if(Re.type==="aborted")return;if(Re.type==="error"){let{error:gt}=Xo(N,Re);wt(C,k,gt,{flushSync:fe});return}else if(Re.matches)ee=Re.matches,G=Ga(ee,N);else{wt(C,k,Pt(404,{pathname:N}),{flushSync:fe});return}}F.set(C,ie);let De=U,Be=(await Pr("loader",x,se,[G],ee,C))[G.route.id];if(ii(Be)&&(Be=await og(Be,se.signal,!0)||Be),F.get(C)===ie&&F.delete(C),!se.signal.aborted){if(he.has(C)){Ln(C,Br(void 0));return}if(Ni(Be))if(Q>De){Ln(C,Br(void 0));return}else{oe.add(C),await qt(se,Be,!1);return}if(Jt(Be)){wt(C,k,Be.error);return}Ee(!ii(Be),"Unhandled fetcher deferred data"),Ln(C,Br(Be.data))}}async function qt(C,k,N,G){let{submission:ee,fetcherSubmission:ae,replace:fe}=G===void 0?{}:G;k.response.headers.has("X-Remix-Revalidate")&&(V=!0);let Y=k.response.headers.get("Location");Ee(Y,"Expected a Location header on the redirect Response"),Y=gp(Y,new URL(C.url),l);let le=Lo(x.location,Y,{_isRedirect:!0});if(t){let Re=!1;if(k.response.headers.has("X-Remix-Reload-Document"))Re=!0;else if(ag.test(Y)){const gt=n.history.createURL(Y);Re=gt.origin!==e.location.origin||yi(gt.pathname,l)==null}if(Re){fe?e.location.replace(Y):e.location.assign(Y);return}}M=null;let ie=fe===!0||k.response.headers.has("X-Remix-Replace")?st.Replace:st.Push,{formMethod:se,formAction:De,formEncType:ke}=x.navigation;!ee&&!ae&&se&&De&&ke&&(ee=xp(x.navigation));let Be=ee||ae;if(gA.has(k.response.status)&&Be&&wn(Be.formMethod))await rt(ie,le,{submission:ze({},Be,{formAction:Y}),preventScrollReset:_,enableViewTransition:N?j:void 0});else{let Re=rd(le,ee);await rt(ie,le,{overrideNavigation:Re,fetcherSubmission:ae,preventScrollReset:_,enableViewTransition:N?j:void 0})}}async function Pr(C,k,N,G,ee,ae){let fe,Y={};try{fe=await AA(u,C,k,N,G,ee,ae,s,i)}catch(le){return G.forEach(ie=>{Y[ie.route.id]={type:Me.error,error:le}}),Y}for(let[le,ie]of Object.entries(fe))if(bA(ie)){let se=ie.result;Y[le]={type:Me.redirect,response:IA(se,N,le,ee,l,d.v7_relativeSplatPath)}}else Y[le]=await _A(ie);return Y}async function Yo(C,k,N,G,ee){let ae=C.matches,fe=Pr("loader",C,ee,N,k,null),Y=Promise.all(G.map(async se=>{if(se.matches&&se.match&&se.controller){let ke=(await Pr("loader",C,ds(n.history,se.path,se.controller.signal),[se.match],se.matches,se.key))[se.match.route.id];return{[se.key]:ke}}else return Promise.resolve({[se.key]:{type:Me.error,error:Pt(404,{pathname:se.path})}})})),le=await fe,ie=(await Y).reduce((se,De)=>Object.assign(se,De),{});return await Promise.all([OA(k,le,ee.signal,ae,C.loaderData),FA(k,ie,G)]),{loaderResults:le,fetcherResults:ie}}function ls(){V=!0,X.push(...Ic()),de.forEach((C,k)=>{F.has(k)&&(B.add(k),Or(k))})}function Ln(C,k,N){N===void 0&&(N={}),x.fetchers.set(C,k),ot({fetchers:new Map(x.fetchers)},{flushSync:(N&&N.flushSync)===!0})}function wt(C,k,N,G){G===void 0&&(G={});let ee=bs(x.matches,k);qo(C),ot({errors:{[ee.route.id]:N},fetchers:new Map(x.fetchers)},{flushSync:(G&&G.flushSync)===!0})}function jg(C){return d.v7_fetcherPersist&&(pe.set(C,(pe.get(C)||0)+1),he.has(C)&&he.delete(C)),x.fetchers.get(C)||mA}function qo(C){let k=x.fetchers.get(C);F.has(C)&&!(k&&k.state==="loading"&&q.has(C))&&Or(C),de.delete(C),q.delete(C),oe.delete(C),he.delete(C),B.delete(C),x.fetchers.delete(C)}function aT(C){if(d.v7_fetcherPersist){let k=(pe.get(C)||0)-1;k<=0?(pe.delete(C),he.add(C)):pe.set(C,k)}else qo(C);ot({fetchers:new Map(x.fetchers)})}function Or(C){let k=F.get(C);Ee(k,"Expected fetch controller: "+C),k.abort(),F.delete(C)}function Gg(C){for(let k of C){let N=jg(k),G=Br(N.data);x.fetchers.set(k,G)}}function Kg(){let C=[],k=!1;for(let N of oe){let G=x.fetchers.get(N);Ee(G,"Expected fetcher: "+N),G.state==="loading"&&(oe.delete(N),C.push(N),k=!0)}return Gg(C),k}function Vg(C){let k=[];for(let[N,G]of q)if(G<C){let ee=x.fetchers.get(N);Ee(ee,"Expected fetcher: "+N),ee.state==="loading"&&(Or(N),q.delete(N),k.push(N))}return Gg(k),k.length>0}function oT(C,k){let N=x.blockers.get(C)||ka;return Xe.get(C)!==k&&Xe.set(C,k),N}function Hg(C){x.blockers.delete(C),Xe.delete(C)}function Qo(C,k){let N=x.blockers.get(C)||ka;Ee(N.state==="unblocked"&&k.state==="blocked"||N.state==="blocked"&&k.state==="blocked"||N.state==="blocked"&&k.state==="proceeding"||N.state==="blocked"&&k.state==="unblocked"||N.state==="proceeding"&&k.state==="unblocked","Invalid blocker state transition: "+N.state+" -> "+k.state);let G=new Map(x.blockers);G.set(C,k),ot({blockers:G})}function zg(C){let{currentLocation:k,nextLocation:N,historyAction:G}=C;if(Xe.size===0)return;Xe.size>1&&da(!1,"A router only supports one blocker at a time");let ee=Array.from(Xe.entries()),[ae,fe]=ee[ee.length-1],Y=x.blockers.get(ae);if(!(Y&&Y.state==="proceeding")&&fe({currentLocation:k,nextLocation:N,historyAction:G}))return ae}function _c(C){let k=Pt(404,{pathname:C}),N=o||a,{matches:G,route:ee}=Ep(N);return Ic(),{notFoundMatches:G,route:ee,error:k}}function Xo(C,k){return{boundaryId:bs(k.partialMatches).route.id,error:Pt(400,{type:"route-discovery",pathname:C,message:k.error!=null&&"message"in k.error?k.error:String(k.error)})}}function Ic(C){let k=[];return Fe.forEach((N,G)=>{(!C||C(G))&&(N.cancel(),k.push(G),Fe.delete(G))}),k}function lT(C,k,N){if(y=C,v=k,p=N||null,!E&&x.navigation===nd){E=!0;let G=Yg(x.location,x.matches);G!=null&&ot({restoreScrollPosition:G})}return()=>{y=null,v=null,p=null}}function Wg(C,k){return p&&p(C,k.map(G=>zL(G,x.loaderData)))||C.key}function uT(C,k){if(y&&v){let N=Wg(C,k);y[N]=v()}}function Yg(C,k){if(y){let N=Wg(C,k),G=y[N];if(typeof G=="number")return G}return null}function Zo(C,k,N){if(c){if(m.has(N))return{active:!1,matches:C};if(C){if(Object.keys(C[0].params).length>0)return{active:!0,matches:nu(k,N,l,!0)}}else return{active:!0,matches:nu(k,N,l,!0)||[]}}return{active:!1,matches:null}}async function Jo(C,k,N){let G=C;for(;;){let ee=o==null,ae=o||a;try{await xA(c,k,G,ae,s,i,Nn,N)}catch(le){return{type:"error",error:le,partialMatches:G}}finally{ee&&(a=[...a])}if(N.aborted)return{type:"aborted"};let fe=Pi(ae,k,l);if(fe)return qg(k,m),{type:"success",matches:fe};let Y=nu(ae,k,l,!0);if(!Y||G.length===Y.length&&G.every((le,ie)=>le.route.id===Y[ie].route.id))return qg(k,m),{type:"success",matches:null};G=Y}}function qg(C,k){if(k.size>=g){let N=k.values().next().value;k.delete(N)}k.add(C)}function cT(C){s={},o=Ao(C,i,void 0,s)}function dT(C,k){let N=o==null;zE(C,k,o||a,s,i),N&&(a=[...a],ot({}))}return R={get basename(){return l},get future(){return d},get state(){return x},get routes(){return a},get window(){return e},initialize:Ac,subscribe:Ta,enableScrollRestoration:lT,navigate:Te,fetch:zo,revalidate:ft,createHref:C=>n.history.createHref(C),encodeLocation:C=>n.history.encodeLocation(C),getFetcher:jg,deleteFetcher:aT,dispose:Rc,getBlocker:oT,deleteBlocker:Hg,patchRoutes:dT,_internalFetchControllers:F,_internalActiveDeferreds:Fe,_internalSetRoutes:cT},R}function vA(n){return n!=null&&("formData"in n&&n.formData!=null||"body"in n&&n.body!==void 0)}function Ch(n,e,t,r,i,s,a,o){let l,u;if(a){l=[];for(let d of e)if(l.push(d),d.route.id===a){u=d;break}}else l=e,u=e[e.length-1];let c=pc(i||".",mc(l,s),yi(n.pathname,t)||n.pathname,o==="path");return i==null&&(c.search=n.search,c.hash=n.hash),(i==null||i===""||i===".")&&u&&u.route.index&&!lg(c.search)&&(c.search=c.search?c.search.replace(/^\?/,"?index&"):"?index"),r&&t!=="/"&&(c.pathname=c.pathname==="/"?t:nr([t,c.pathname])),pi(c)}function dp(n,e,t,r){if(!r||!vA(r))return{path:t};if(r.formMethod&&!PA(r.formMethod))return{path:t,error:Pt(405,{method:r.formMethod})};let i=()=>({path:t,error:Pt(400,{type:"invalid-body"})}),s=r.formMethod||"get",a=n?s.toUpperCase():s.toLowerCase(),o=WE(t);if(r.body!==void 0){if(r.formEncType==="text/plain"){if(!wn(a))return i();let h=typeof r.body=="string"?r.body:r.body instanceof FormData||r.body instanceof URLSearchParams?Array.from(r.body.entries()).reduce((f,g)=>{let[m,y]=g;return""+f+m+"="+y+`
`},""):String(r.body);return{path:t,submission:{formMethod:a,formAction:o,formEncType:r.formEncType,formData:void 0,json:void 0,text:h}}}else if(r.formEncType==="application/json"){if(!wn(a))return i();try{let h=typeof r.body=="string"?JSON.parse(r.body):r.body;return{path:t,submission:{formMethod:a,formAction:o,formEncType:r.formEncType,formData:void 0,json:h,text:void 0}}}catch{return i()}}}Ee(typeof FormData=="function","FormData is not available in this environment");let l,u;if(r.formData)l=wh(r.formData),u=r.formData;else if(r.body instanceof FormData)l=wh(r.body),u=r.body;else if(r.body instanceof URLSearchParams)l=r.body,u=mp(l);else if(r.body==null)l=new URLSearchParams,u=new FormData;else try{l=new URLSearchParams(r.body),u=mp(l)}catch{return i()}let c={formMethod:a,formAction:o,formEncType:r&&r.formEncType||"application/x-www-form-urlencoded",formData:u,json:void 0,text:void 0};if(wn(c.formMethod))return{path:t,submission:c};let d=Li(t);return e&&d.search&&lg(d.search)&&l.append("index",""),d.search="?"+l,{path:pi(d),submission:c}}function EA(n,e){let t=n;if(e){let r=n.findIndex(i=>i.route.id===e);r>=0&&(t=n.slice(0,r))}return t}function hp(n,e,t,r,i,s,a,o,l,u,c,d,h,f,g,m){let y=m?Jt(m[1])?m[1].error:m[1].data:void 0,p=n.createURL(e.location),v=n.createURL(i),E=m&&Jt(m[1])?m[0]:void 0,T=E?EA(t,E):t,A=m?m[1].statusCode:void 0,I=a&&A&&A>=400,R=T.filter((D,_)=>{let{route:M}=D;if(M.lazy)return!0;if(M.loader==null)return!1;if(s)return typeof M.loader!="function"||M.loader.hydrate?!0:e.loaderData[M.id]===void 0&&(!e.errors||e.errors[M.id]===void 0);if(SA(e.loaderData,e.matches[_],D)||l.some(H=>H===D.route.id))return!0;let j=e.matches[_],z=D;return fp(D,ze({currentUrl:p,currentParams:j.params,nextUrl:v,nextParams:z.params},r,{actionResult:y,actionStatus:A,defaultShouldRevalidate:I?!1:o||p.pathname+p.search===v.pathname+v.search||p.search!==v.search||HE(j,z)}))}),x=[];return d.forEach((D,_)=>{if(s||!t.some(W=>W.route.id===D.routeId)||c.has(_))return;let M=Pi(f,D.path,g);if(!M){x.push({key:_,routeId:D.routeId,path:D.path,matches:null,match:null,controller:null});return}let j=e.fetchers.get(_),z=Ga(M,D.path),H=!1;h.has(_)?H=!1:u.has(_)?(u.delete(_),H=!0):j&&j.state!=="idle"&&j.data===void 0?H=o:H=fp(z,ze({currentUrl:p,currentParams:e.matches[e.matches.length-1].params,nextUrl:v,nextParams:t[t.length-1].params},r,{actionResult:y,actionStatus:A,defaultShouldRevalidate:I?!1:o})),H&&x.push({key:_,routeId:D.routeId,path:D.path,matches:M,match:z,controller:new AbortController})}),[R,x]}function SA(n,e,t){let r=!e||t.route.id!==e.route.id,i=n[t.route.id]===void 0;return r||i}function HE(n,e){let t=n.route.path;return n.pathname!==e.pathname||t!=null&&t.endsWith("*")&&n.params["*"]!==e.params["*"]}function fp(n,e){if(n.route.shouldRevalidate){let t=n.route.shouldRevalidate(e);if(typeof t=="boolean")return t}return e.defaultShouldRevalidate}async function xA(n,e,t,r,i,s,a,o){let l=[e,...t.map(u=>u.route.id)].join("-");try{let u=a.get(l);u||(u=n({path:e,matches:t,patch:(c,d)=>{o.aborted||zE(c,d,r,i,s)}}),a.set(l,u)),u&&wA(u)&&await u}finally{a.delete(l)}}function zE(n,e,t,r,i){if(n){var s;let a=r[n];Ee(a,"No route found to patch children into: routeId = "+n);let o=Ao(e,i,[n,"patch",String(((s=a.children)==null?void 0:s.length)||"0")],r);a.children?a.children.push(...o):a.children=o}else{let a=Ao(e,i,["patch",String(t.length||"0")],r);t.push(...a)}}async function TA(n,e,t){if(!n.lazy)return;let r=await n.lazy();if(!n.lazy)return;let i=t[n.id];Ee(i,"No route found in manifest");let s={};for(let a in r){let l=i[a]!==void 0&&a!=="hasErrorBoundary";da(!l,'Route "'+i.id+'" has a static property "'+a+'" defined but its lazy function is also returning a value for this property. '+('The lazy route property "'+a+'" will be ignored.')),!l&&!VL.has(a)&&(s[a]=r[a])}Object.assign(i,s),Object.assign(i,ze({},e(i),{lazy:void 0}))}async function LA(n){let{matches:e}=n,t=e.filter(i=>i.shouldLoad);return(await Promise.all(t.map(i=>i.resolve()))).reduce((i,s,a)=>Object.assign(i,{[t[a].route.id]:s}),{})}async function AA(n,e,t,r,i,s,a,o,l,u){let c=s.map(f=>f.route.lazy?TA(f.route,l,o):void 0),d=s.map((f,g)=>{let m=c[g],y=i.some(v=>v.route.id===f.route.id);return ze({},f,{shouldLoad:y,resolve:async v=>(v&&r.method==="GET"&&(f.route.lazy||f.route.loader)&&(y=!0),y?RA(e,r,f,m,v,u):Promise.resolve({type:Me.data,result:void 0}))})}),h=await n({matches:d,request:r,params:s[0].params,fetcherKey:a,context:u});try{await Promise.all(c)}catch{}return h}async function RA(n,e,t,r,i,s){let a,o,l=u=>{let c,d=new Promise((g,m)=>c=m);o=()=>c(),e.signal.addEventListener("abort",o);let h=g=>typeof u!="function"?Promise.reject(new Error("You cannot call the handler for a route which defines a boolean "+('"'+n+'" [routeId: '+t.route.id+"]"))):u({request:e,params:t.params,context:s},...g!==void 0?[g]:[]),f=(async()=>{try{return{type:"data",result:await(i?i(m=>h(m)):h())}}catch(g){return{type:"error",result:g}}})();return Promise.race([f,d])};try{let u=t.route[n];if(r)if(u){let c,[d]=await Promise.all([l(u).catch(h=>{c=h}),r]);if(c!==void 0)throw c;a=d}else if(await r,u=t.route[n],u)a=await l(u);else if(n==="action"){let c=new URL(e.url),d=c.pathname+c.search;throw Pt(405,{method:e.method,pathname:d,routeId:t.route.id})}else return{type:Me.data,result:void 0};else if(u)a=await l(u);else{let c=new URL(e.url),d=c.pathname+c.search;throw Pt(404,{pathname:d})}Ee(a.result!==void 0,"You defined "+(n==="action"?"an action":"a loader")+" for route "+('"'+t.route.id+"\" but didn't return anything from your `"+n+"` ")+"function. Please return a value or `null`.")}catch(u){return{type:Me.error,result:u}}finally{o&&e.signal.removeEventListener("abort",o)}return a}async function _A(n){let{result:e,type:t}=n;if(YE(e)){let u;try{let c=e.headers.get("Content-Type");c&&/\bapplication\/json\b/.test(c)?e.body==null?u=null:u=await e.json():u=await e.text()}catch(c){return{type:Me.error,error:c}}return t===Me.error?{type:Me.error,error:new Uu(e.status,e.statusText,u),statusCode:e.status,headers:e.headers}:{type:Me.data,data:u,statusCode:e.status,headers:e.headers}}if(t===Me.error){if(Sp(e)){var r;if(e.data instanceof Error){var i;return{type:Me.error,error:e.data,statusCode:(i=e.init)==null?void 0:i.status}}e=new Uu(((r=e.init)==null?void 0:r.status)||500,void 0,e.data)}return{type:Me.error,error:e,statusCode:yc(e)?e.status:void 0}}if(kA(e)){var s,a;return{type:Me.deferred,deferredData:e,statusCode:(s=e.init)==null?void 0:s.status,headers:((a=e.init)==null?void 0:a.headers)&&new Headers(e.init.headers)}}if(Sp(e)){var o,l;return{type:Me.data,data:e.data,statusCode:(o=e.init)==null?void 0:o.status,headers:(l=e.init)!=null&&l.headers?new Headers(e.init.headers):void 0}}return{type:Me.data,data:e}}function IA(n,e,t,r,i,s){let a=n.headers.get("Location");if(Ee(a,"Redirects returned/thrown from loaders/actions must have a Location header"),!ag.test(a)){let o=r.slice(0,r.findIndex(l=>l.route.id===t)+1);a=Ch(new URL(e.url),o,i,!0,a,s),n.headers.set("Location",a)}return n}function gp(n,e,t){if(ag.test(n)){let r=n,i=r.startsWith("//")?new URL(e.protocol+r):new URL(r),s=yi(i.pathname,t)!=null;if(i.origin===e.origin&&s)return i.pathname+i.search+i.hash}return n}function ds(n,e,t,r){let i=n.createURL(WE(e)).toString(),s={signal:t};if(r&&wn(r.formMethod)){let{formMethod:a,formEncType:o}=r;s.method=a.toUpperCase(),o==="application/json"?(s.headers=new Headers({"Content-Type":o}),s.body=JSON.stringify(r.json)):o==="text/plain"?s.body=r.text:o==="application/x-www-form-urlencoded"&&r.formData?s.body=wh(r.formData):s.body=r.formData}return new Request(i,s)}function wh(n){let e=new URLSearchParams;for(let[t,r]of n.entries())e.append(t,typeof r=="string"?r:r.name);return e}function mp(n){let e=new FormData;for(let[t,r]of n.entries())e.append(t,r);return e}function DA(n,e,t,r,i){let s={},a=null,o,l=!1,u={},c=t&&Jt(t[1])?t[1].error:void 0;return n.forEach(d=>{if(!(d.route.id in e))return;let h=d.route.id,f=e[h];if(Ee(!Ni(f),"Cannot handle redirect results in processLoaderData"),Jt(f)){let g=f.error;c!==void 0&&(g=c,c=void 0),a=a||{};{let m=bs(n,h);a[m.route.id]==null&&(a[m.route.id]=g)}s[h]=void 0,l||(l=!0,o=yc(f.error)?f.error.status:500),f.headers&&(u[h]=f.headers)}else ii(f)?(r.set(h,f.deferredData),s[h]=f.deferredData.data,f.statusCode!=null&&f.statusCode!==200&&!l&&(o=f.statusCode),f.headers&&(u[h]=f.headers)):(s[h]=f.data,f.statusCode&&f.statusCode!==200&&!l&&(o=f.statusCode),f.headers&&(u[h]=f.headers))}),c!==void 0&&t&&(a={[t[0]]:c},s[t[0]]=void 0),{loaderData:s,errors:a,statusCode:o||200,loaderHeaders:u}}function pp(n,e,t,r,i,s,a,o){let{loaderData:l,errors:u}=DA(e,r,i,o);return s.forEach(c=>{let{key:d,match:h,controller:f}=c,g=a[d];if(Ee(g,"Did not find corresponding fetcher result"),!(f&&f.signal.aborted))if(Jt(g)){let m=bs(n.matches,h==null?void 0:h.route.id);u&&u[m.route.id]||(u=ze({},u,{[m.route.id]:g.error})),n.fetchers.delete(d)}else if(Ni(g))Ee(!1,"Unhandled fetcher revalidation redirect");else if(ii(g))Ee(!1,"Unhandled fetcher deferred data");else{let m=Br(g.data);n.fetchers.set(d,m)}}),{loaderData:l,errors:u}}function yp(n,e,t,r){let i=ze({},e);for(let s of t){let a=s.route.id;if(e.hasOwnProperty(a)?e[a]!==void 0&&(i[a]=e[a]):n[a]!==void 0&&s.route.loader&&(i[a]=n[a]),r&&r.hasOwnProperty(a))break}return i}function vp(n){return n?Jt(n[1])?{actionData:{}}:{actionData:{[n[0]]:n[1].data}}:{}}function bs(n,e){return(e?n.slice(0,n.findIndex(r=>r.route.id===e)+1):[...n]).reverse().find(r=>r.route.hasErrorBoundary===!0)||n[0]}function Ep(n){let e=n.length===1?n[0]:n.find(t=>t.index||!t.path||t.path==="/")||{id:"__shim-error-route__"};return{matches:[{params:{},pathname:"",pathnameBase:"",route:e}],route:e}}function Pt(n,e){let{pathname:t,routeId:r,method:i,type:s,message:a}=e===void 0?{}:e,o="Unknown Server Error",l="Unknown @remix-run/router error";return n===400?(o="Bad Request",s==="route-discovery"?l='Unable to match URL "'+t+'" - the `unstable_patchRoutesOnNavigation()` '+(`function threw the following error:
`+a):i&&t&&r?l="You made a "+i+' request to "'+t+'" but '+('did not provide a `loader` for route "'+r+'", ')+"so there is no way to handle the request.":s==="defer-action"?l="defer() is not supported in actions":s==="invalid-body"&&(l="Unable to encode submission body")):n===403?(o="Forbidden",l='Route "'+r+'" does not match URL "'+t+'"'):n===404?(o="Not Found",l='No route matches URL "'+t+'"'):n===405&&(o="Method Not Allowed",i&&t&&r?l="You made a "+i.toUpperCase()+' request to "'+t+'" but '+('did not provide an `action` for route "'+r+'", ')+"so there is no way to handle the request.":i&&(l='Invalid request method "'+i.toUpperCase()+'"')),new Uu(n||500,o,new Error(l),!0)}function Tl(n){let e=Object.entries(n);for(let t=e.length-1;t>=0;t--){let[r,i]=e[t];if(Ni(i))return{key:r,result:i}}}function WE(n){let e=typeof n=="string"?Li(n):n;return pi(ze({},e,{hash:""}))}function CA(n,e){return n.pathname!==e.pathname||n.search!==e.search?!1:n.hash===""?e.hash!=="":n.hash===e.hash?!0:e.hash!==""}function wA(n){return typeof n=="object"&&n!=null&&"then"in n}function bA(n){return YE(n.result)&&fA.has(n.result.status)}function ii(n){return n.type===Me.deferred}function Jt(n){return n.type===Me.error}function Ni(n){return(n&&n.type)===Me.redirect}function Sp(n){return typeof n=="object"&&n!=null&&"type"in n&&"data"in n&&"init"in n&&n.type==="DataWithResponseInit"}function kA(n){let e=n;return e&&typeof e=="object"&&typeof e.data=="object"&&typeof e.subscribe=="function"&&typeof e.cancel=="function"&&typeof e.resolveData=="function"}function YE(n){return n!=null&&typeof n.status=="number"&&typeof n.statusText=="string"&&typeof n.headers=="object"&&typeof n.body<"u"}function PA(n){return hA.has(n.toLowerCase())}function wn(n){return cA.has(n.toLowerCase())}async function OA(n,e,t,r,i){let s=Object.entries(e);for(let a=0;a<s.length;a++){let[o,l]=s[a],u=n.find(h=>(h==null?void 0:h.route.id)===o);if(!u)continue;let c=r.find(h=>h.route.id===u.route.id),d=c!=null&&!HE(c,u)&&(i&&i[u.route.id])!==void 0;ii(l)&&d&&await og(l,t,!1).then(h=>{h&&(e[o]=h)})}}async function FA(n,e,t){for(let r=0;r<t.length;r++){let{key:i,routeId:s,controller:a}=t[r],o=e[i];n.find(u=>(u==null?void 0:u.route.id)===s)&&ii(o)&&(Ee(a,"Expected an AbortController for revalidating fetcher deferred result"),await og(o,a.signal,!0).then(u=>{u&&(e[i]=u)}))}}async function og(n,e,t){if(t===void 0&&(t=!1),!await n.deferredData.resolveData(e)){if(t)try{return{type:Me.data,data:n.deferredData.unwrappedData}}catch(i){return{type:Me.error,error:i}}return{type:Me.data,data:n.deferredData.data}}}function lg(n){return new URLSearchParams(n).getAll("index").some(e=>e==="")}function Ga(n,e){let t=typeof e=="string"?Li(e).search:e.search;if(n[n.length-1].route.index&&lg(t||""))return n[n.length-1];let r=GE(n);return r[r.length-1]}function xp(n){let{formMethod:e,formAction:t,formEncType:r,text:i,formData:s,json:a}=n;if(!(!e||!t||!r)){if(i!=null)return{formMethod:e,formAction:t,formEncType:r,formData:void 0,json:void 0,text:i};if(s!=null)return{formMethod:e,formAction:t,formEncType:r,formData:s,json:void 0,text:void 0};if(a!==void 0)return{formMethod:e,formAction:t,formEncType:r,formData:void 0,json:a,text:void 0}}}function rd(n,e){return e?{state:"loading",location:n,formMethod:e.formMethod,formAction:e.formAction,formEncType:e.formEncType,formData:e.formData,json:e.json,text:e.text}:{state:"loading",location:n,formMethod:void 0,formAction:void 0,formEncType:void 0,formData:void 0,json:void 0,text:void 0}}function MA(n,e){return{state:"submitting",location:n,formMethod:e.formMethod,formAction:e.formAction,formEncType:e.formEncType,formData:e.formData,json:e.json,text:e.text}}function Pa(n,e){return n?{state:"loading",formMethod:n.formMethod,formAction:n.formAction,formEncType:n.formEncType,formData:n.formData,json:n.json,text:n.text,data:e}:{state:"loading",formMethod:void 0,formAction:void 0,formEncType:void 0,formData:void 0,json:void 0,text:void 0,data:e}}function NA(n,e){return{state:"submitting",formMethod:n.formMethod,formAction:n.formAction,formEncType:n.formEncType,formData:n.formData,json:n.json,text:n.text,data:e?e.data:void 0}}function Br(n){return{state:"idle",formMethod:void 0,formAction:void 0,formEncType:void 0,formData:void 0,json:void 0,text:void 0,data:n}}function UA(n,e){try{let t=n.sessionStorage.getItem(VE);if(t){let r=JSON.parse(t);for(let[i,s]of Object.entries(r||{}))s&&Array.isArray(s)&&e.set(i,new Set(s||[]))}}catch{}}function BA(n,e){if(e.size>0){let t={};for(let[r,i]of e)t[r]=[...i];try{n.sessionStorage.setItem(VE,JSON.stringify(t))}catch(r){da(!1,"Failed to save applied view transitions in sessionStorage ("+r+").")}}}/**
 * React Router v6.26.2
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function Bu(){return Bu=Object.assign?Object.assign.bind():function(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(n[r]=t[r])}return n},Bu.apply(this,arguments)}const Ko=b.createContext(null),qE=b.createContext(null),ir=b.createContext(null),ug=b.createContext(null),Mn=b.createContext({outlet:null,matches:[],isDataRoute:!1}),QE=b.createContext(null);function $A(n,e){let{relative:t}=e===void 0?{}:e;va()||Ee(!1);let{basename:r,navigator:i}=b.useContext(ir),{hash:s,pathname:a,search:o}=cg(n,{relative:t}),l=a;return r!=="/"&&(l=a==="/"?r:nr([r,a])),i.createHref({pathname:l,search:o,hash:s})}function va(){return b.useContext(ug)!=null}function Ai(){return va()||Ee(!1),b.useContext(ug).location}function XE(n){b.useContext(ir).static||b.useLayoutEffect(n)}function wr(){let{isDataRoute:n}=b.useContext(Mn);return n?eR():jA()}function jA(){va()||Ee(!1);let n=b.useContext(Ko),{basename:e,future:t,navigator:r}=b.useContext(ir),{matches:i}=b.useContext(Mn),{pathname:s}=Ai(),a=JSON.stringify(mc(i,t.v7_relativeSplatPath)),o=b.useRef(!1);return XE(()=>{o.current=!0}),b.useCallback(function(u,c){if(c===void 0&&(c={}),!o.current)return;if(typeof u=="number"){r.go(u);return}let d=pc(u,JSON.parse(a),s,c.relative==="path");n==null&&e!=="/"&&(d.pathname=d.pathname==="/"?e:nr([e,d.pathname])),(c.replace?r.replace:r.push)(d,c.state,c)},[e,r,a,s,n])}const GA=b.createContext(null);function KA(n){let e=b.useContext(Mn).outlet;return e&&b.createElement(GA.Provider,{value:n},e)}function as(){let{matches:n}=b.useContext(Mn),e=n[n.length-1];return e?e.params:{}}function cg(n,e){let{relative:t}=e===void 0?{}:e,{future:r}=b.useContext(ir),{matches:i}=b.useContext(Mn),{pathname:s}=Ai(),a=JSON.stringify(mc(i,r.v7_relativeSplatPath));return b.useMemo(()=>pc(n,JSON.parse(a),s,t==="path"),[n,a,s,t])}function VA(n,e,t,r){va()||Ee(!1);let{navigator:i}=b.useContext(ir),{matches:s}=b.useContext(Mn),a=s[s.length-1],o=a?a.params:{};a&&a.pathname;let l=a?a.pathnameBase:"/";a&&a.route;let u=Ai(),c;c=u;let d=c.pathname||"/",h=d;if(l!=="/"){let m=l.replace(/^\//,"").split("/");h="/"+d.replace(/^\//,"").split("/").slice(m.length).join("/")}let f=Pi(n,{pathname:h});return qA(f&&f.map(m=>Object.assign({},m,{params:Object.assign({},o,m.params),pathname:nr([l,i.encodeLocation?i.encodeLocation(m.pathname).pathname:m.pathname]),pathnameBase:m.pathnameBase==="/"?l:nr([l,i.encodeLocation?i.encodeLocation(m.pathnameBase).pathname:m.pathnameBase])})),s,t,r)}function HA(){let n=JA(),e=yc(n)?n.status+" "+n.statusText:n instanceof Error?n.message:JSON.stringify(n),t=n instanceof Error?n.stack:null,i={padding:"0.5rem",backgroundColor:"rgba(200,200,200, 0.5)"};return b.createElement(b.Fragment,null,b.createElement("h2",null,"Unexpected Application Error!"),b.createElement("h3",{style:{fontStyle:"italic"}},e),t?b.createElement("pre",{style:i},t):null,null)}const zA=b.createElement(HA,null);class WA extends b.Component{constructor(e){super(e),this.state={location:e.location,revalidation:e.revalidation,error:e.error}}static getDerivedStateFromError(e){return{error:e}}static getDerivedStateFromProps(e,t){return t.location!==e.location||t.revalidation!=="idle"&&e.revalidation==="idle"?{error:e.error,location:e.location,revalidation:e.revalidation}:{error:e.error!==void 0?e.error:t.error,location:t.location,revalidation:e.revalidation||t.revalidation}}componentDidCatch(e,t){console.error("React Router caught the following error during render",e,t)}render(){return this.state.error!==void 0?b.createElement(Mn.Provider,{value:this.props.routeContext},b.createElement(QE.Provider,{value:this.state.error,children:this.props.component})):this.props.children}}function YA(n){let{routeContext:e,match:t,children:r}=n,i=b.useContext(Ko);return i&&i.static&&i.staticContext&&(t.route.errorElement||t.route.ErrorBoundary)&&(i.staticContext._deepestRenderedBoundaryId=t.route.id),b.createElement(Mn.Provider,{value:e},r)}function qA(n,e,t,r){var i;if(e===void 0&&(e=[]),t===void 0&&(t=null),r===void 0&&(r=null),n==null){var s;if(!t)return null;if(t.errors)n=t.matches;else if((s=r)!=null&&s.v7_partialHydration&&e.length===0&&!t.initialized&&t.matches.length>0)n=t.matches;else return null}let a=n,o=(i=t)==null?void 0:i.errors;if(o!=null){let c=a.findIndex(d=>d.route.id&&(o==null?void 0:o[d.route.id])!==void 0);c>=0||Ee(!1),a=a.slice(0,Math.min(a.length,c+1))}let l=!1,u=-1;if(t&&r&&r.v7_partialHydration)for(let c=0;c<a.length;c++){let d=a[c];if((d.route.HydrateFallback||d.route.hydrateFallbackElement)&&(u=c),d.route.id){let{loaderData:h,errors:f}=t,g=d.route.loader&&h[d.route.id]===void 0&&(!f||f[d.route.id]===void 0);if(d.route.lazy||g){l=!0,u>=0?a=a.slice(0,u+1):a=[a[0]];break}}}return a.reduceRight((c,d,h)=>{let f,g=!1,m=null,y=null;t&&(f=o&&d.route.id?o[d.route.id]:void 0,m=d.route.errorElement||zA,l&&(u<0&&h===0?(tR("route-fallback"),g=!0,y=null):u===h&&(g=!0,y=d.route.hydrateFallbackElement||null)));let p=e.concat(a.slice(0,h+1)),v=()=>{let E;return f?E=m:g?E=y:d.route.Component?E=b.createElement(d.route.Component,null):d.route.element?E=d.route.element:E=c,b.createElement(YA,{match:d,routeContext:{outlet:c,matches:p,isDataRoute:t!=null},children:E})};return t&&(d.route.ErrorBoundary||d.route.errorElement||h===0)?b.createElement(WA,{location:t.location,revalidation:t.revalidation,component:m,error:f,children:v(),routeContext:{outlet:null,matches:p,isDataRoute:!0}}):v()},null)}var ZE=function(n){return n.UseBlocker="useBlocker",n.UseRevalidator="useRevalidator",n.UseNavigateStable="useNavigate",n}(ZE||{}),Ji=function(n){return n.UseBlocker="useBlocker",n.UseLoaderData="useLoaderData",n.UseActionData="useActionData",n.UseRouteError="useRouteError",n.UseNavigation="useNavigation",n.UseRouteLoaderData="useRouteLoaderData",n.UseMatches="useMatches",n.UseRevalidator="useRevalidator",n.UseNavigateStable="useNavigate",n.UseRouteId="useRouteId",n}(Ji||{});function QA(n){let e=b.useContext(Ko);return e||Ee(!1),e}function JE(n){let e=b.useContext(qE);return e||Ee(!1),e}function XA(n){let e=b.useContext(Mn);return e||Ee(!1),e}function vc(n){let e=XA(),t=e.matches[e.matches.length-1];return t.route.id||Ee(!1),t.route.id}function ZA(){return vc(Ji.UseRouteId)}function eS(){let n=JE(Ji.UseActionData),e=vc(Ji.UseLoaderData);return n.actionData?n.actionData[e]:void 0}function JA(){var n;let e=b.useContext(QE),t=JE(Ji.UseRouteError),r=vc(Ji.UseRouteError);return e!==void 0?e:(n=t.errors)==null?void 0:n[r]}function eR(){let{router:n}=QA(ZE.UseNavigateStable),e=vc(Ji.UseNavigateStable),t=b.useRef(!1);return XE(()=>{t.current=!0}),b.useCallback(function(i,s){s===void 0&&(s={}),t.current&&(typeof i=="number"?n.navigate(i):n.navigate(i,Bu({fromRouteId:e},s)))},[n,e])}const Tp={};function tR(n,e,t){Tp[n]||(Tp[n]=!0)}function nR(n){let{to:e,replace:t,state:r,relative:i}=n;va()||Ee(!1);let{future:s,static:a}=b.useContext(ir),{matches:o}=b.useContext(Mn),{pathname:l}=Ai(),u=wr(),c=pc(e,mc(o,s.v7_relativeSplatPath),l,i==="path"),d=JSON.stringify(c);return b.useEffect(()=>u(JSON.parse(d),{replace:t,state:r,relative:i}),[u,d,i,t,r]),null}function rR(n){return KA(n.context)}function iR(n){let{basename:e="/",children:t=null,location:r,navigationType:i=st.Pop,navigator:s,static:a=!1,future:o}=n;va()&&Ee(!1);let l=e.replace(/^\/*/,"/"),u=b.useMemo(()=>({basename:l,navigator:s,static:a,future:Bu({v7_relativeSplatPath:!1},o)}),[l,o,s,a]);typeof r=="string"&&(r=Li(r));let{pathname:c="/",search:d="",hash:h="",state:f=null,key:g="default"}=r,m=b.useMemo(()=>{let y=yi(c,l);return y==null?null:{location:{pathname:y,search:d,hash:h,state:f,key:g},navigationType:i}},[l,c,d,h,f,g,i]);return m==null?null:b.createElement(ir.Provider,{value:u},b.createElement(ug.Provider,{children:t,value:m}))}new Promise(()=>{});function sR(n){let e={hasErrorBoundary:n.ErrorBoundary!=null||n.errorElement!=null};return n.Component&&Object.assign(e,{element:b.createElement(n.Component),Component:void 0}),n.HydrateFallback&&Object.assign(e,{hydrateFallbackElement:b.createElement(n.HydrateFallback),HydrateFallback:void 0}),n.ErrorBoundary&&Object.assign(e,{errorElement:b.createElement(n.ErrorBoundary),ErrorBoundary:void 0}),e}/**
 * React Router DOM v6.26.2
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function es(){return es=Object.assign?Object.assign.bind():function(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(n[r]=t[r])}return n},es.apply(this,arguments)}function tS(n,e){if(n==null)return{};var t={},r=Object.keys(n),i,s;for(s=0;s<r.length;s++)i=r[s],!(e.indexOf(i)>=0)&&(t[i]=n[i]);return t}const ru="get",id="application/x-www-form-urlencoded";function Ec(n){return n!=null&&typeof n.tagName=="string"}function aR(n){return Ec(n)&&n.tagName.toLowerCase()==="button"}function oR(n){return Ec(n)&&n.tagName.toLowerCase()==="form"}function lR(n){return Ec(n)&&n.tagName.toLowerCase()==="input"}function uR(n){return!!(n.metaKey||n.altKey||n.ctrlKey||n.shiftKey)}function cR(n,e){return n.button===0&&(!e||e==="_self")&&!uR(n)}let Ll=null;function dR(){if(Ll===null)try{new FormData(document.createElement("form"),0),Ll=!1}catch{Ll=!0}return Ll}const hR=new Set(["application/x-www-form-urlencoded","multipart/form-data","text/plain"]);function sd(n){return n!=null&&!hR.has(n)?null:n}function fR(n,e){let t,r,i,s,a;if(oR(n)){let o=n.getAttribute("action");r=o?yi(o,e):null,t=n.getAttribute("method")||ru,i=sd(n.getAttribute("enctype"))||id,s=new FormData(n)}else if(aR(n)||lR(n)&&(n.type==="submit"||n.type==="image")){let o=n.form;if(o==null)throw new Error('Cannot submit a <button> or <input type="submit"> without a <form>');let l=n.getAttribute("formaction")||o.getAttribute("action");if(r=l?yi(l,e):null,t=n.getAttribute("formmethod")||o.getAttribute("method")||ru,i=sd(n.getAttribute("formenctype"))||sd(o.getAttribute("enctype"))||id,s=new FormData(o,n),!dR()){let{name:u,type:c,value:d}=n;if(c==="image"){let h=u?u+".":"";s.append(h+"x","0"),s.append(h+"y","0")}else u&&s.append(u,d)}}else{if(Ec(n))throw new Error('Cannot submit element that is not <form>, <button>, or <input type="submit|image">');t=ru,r=null,i=id,a=n}return s&&i==="text/plain"&&(a=s,s=void 0),{action:r,method:t.toLowerCase(),encType:i,formData:s,body:a}}const gR=["onClick","relative","reloadDocument","replace","state","target","to","preventScrollReset","unstable_viewTransition"],mR=["fetcherKey","navigate","reloadDocument","replace","state","method","action","onSubmit","relative","preventScrollReset","unstable_viewTransition"],pR="6";try{window.__reactRouterVersion=pR}catch{}function yR(n,e){return yA({basename:void 0,future:es({},void 0,{v7_prependBasename:!0}),history:jL({window:void 0}),hydrationData:vR(),routes:n,mapRouteProperties:sR,unstable_dataStrategy:void 0,unstable_patchRoutesOnNavigation:void 0,window:void 0}).initialize()}function vR(){var n;let e=(n=window)==null?void 0:n.__staticRouterHydrationData;return e&&e.errors&&(e=es({},e,{errors:ER(e.errors)})),e}function ER(n){if(!n)return null;let e=Object.entries(n),t={};for(let[r,i]of e)if(i&&i.__type==="RouteErrorResponse")t[r]=new Uu(i.status,i.statusText,i.data,i.internal===!0);else if(i&&i.__type==="Error"){if(i.__subType){let s=window[i.__subType];if(typeof s=="function")try{let a=new s(i.message);a.stack="",t[r]=a}catch{}}if(t[r]==null){let s=new Error(i.message);s.stack="",t[r]=s}}else t[r]=i;return t}const SR=b.createContext({isTransitioning:!1}),xR=b.createContext(new Map),TR="startTransition",Lp=DT[TR],LR="flushSync",Ap=$L[LR];function AR(n){Lp?Lp(n):n()}function Oa(n){Ap?Ap(n):n()}class RR{constructor(){this.status="pending",this.promise=new Promise((e,t)=>{this.resolve=r=>{this.status==="pending"&&(this.status="resolved",e(r))},this.reject=r=>{this.status==="pending"&&(this.status="rejected",t(r))}})}}function _R(n){let{fallbackElement:e,router:t,future:r}=n,[i,s]=b.useState(t.state),[a,o]=b.useState(),[l,u]=b.useState({isTransitioning:!1}),[c,d]=b.useState(),[h,f]=b.useState(),[g,m]=b.useState(),y=b.useRef(new Map),{v7_startTransition:p}=r||{},v=b.useCallback(x=>{p?AR(x):x()},[p]),E=b.useCallback((x,D)=>{let{deletedFetchers:_,unstable_flushSync:M,unstable_viewTransitionOpts:j}=D;_.forEach(H=>y.current.delete(H)),x.fetchers.forEach((H,W)=>{H.data!==void 0&&y.current.set(W,H.data)});let z=t.window==null||t.window.document==null||typeof t.window.document.startViewTransition!="function";if(!j||z){M?Oa(()=>s(x)):v(()=>s(x));return}if(M){Oa(()=>{h&&(c&&c.resolve(),h.skipTransition()),u({isTransitioning:!0,flushSync:!0,currentLocation:j.currentLocation,nextLocation:j.nextLocation})});let H=t.window.document.startViewTransition(()=>{Oa(()=>s(x))});H.finished.finally(()=>{Oa(()=>{d(void 0),f(void 0),o(void 0),u({isTransitioning:!1})})}),Oa(()=>f(H));return}h?(c&&c.resolve(),h.skipTransition(),m({state:x,currentLocation:j.currentLocation,nextLocation:j.nextLocation})):(o(x),u({isTransitioning:!0,flushSync:!1,currentLocation:j.currentLocation,nextLocation:j.nextLocation}))},[t.window,h,c,y,v]);b.useLayoutEffect(()=>t.subscribe(E),[t,E]),b.useEffect(()=>{l.isTransitioning&&!l.flushSync&&d(new RR)},[l]),b.useEffect(()=>{if(c&&a&&t.window){let x=a,D=c.promise,_=t.window.document.startViewTransition(async()=>{v(()=>s(x)),await D});_.finished.finally(()=>{d(void 0),f(void 0),o(void 0),u({isTransitioning:!1})}),f(_)}},[v,a,c,t.window]),b.useEffect(()=>{c&&a&&i.location.key===a.location.key&&c.resolve()},[c,h,i.location,a]),b.useEffect(()=>{!l.isTransitioning&&g&&(o(g.state),u({isTransitioning:!0,flushSync:!1,currentLocation:g.currentLocation,nextLocation:g.nextLocation}),m(void 0))},[l.isTransitioning,g]),b.useEffect(()=>{},[]);let T=b.useMemo(()=>({createHref:t.createHref,encodeLocation:t.encodeLocation,go:x=>t.navigate(x),push:(x,D,_)=>t.navigate(x,{state:D,preventScrollReset:_==null?void 0:_.preventScrollReset}),replace:(x,D,_)=>t.navigate(x,{replace:!0,state:D,preventScrollReset:_==null?void 0:_.preventScrollReset})}),[t]),A=t.basename||"/",I=b.useMemo(()=>({router:t,navigator:T,static:!1,basename:A}),[t,T,A]),R=b.useMemo(()=>({v7_relativeSplatPath:t.future.v7_relativeSplatPath}),[t.future.v7_relativeSplatPath]);return b.createElement(b.Fragment,null,b.createElement(Ko.Provider,{value:I},b.createElement(qE.Provider,{value:i},b.createElement(xR.Provider,{value:y.current},b.createElement(SR.Provider,{value:l},b.createElement(iR,{basename:A,location:i.location,navigationType:i.historyAction,navigator:T,future:R},i.initialized||t.future.v7_partialHydration?b.createElement(IR,{routes:t.routes,future:t.future,state:i}):e))))),null)}const IR=b.memo(DR);function DR(n){let{routes:e,future:t,state:r}=n;return VA(e,void 0,r,t)}const CR=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u",wR=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,bi=b.forwardRef(function(e,t){let{onClick:r,relative:i,reloadDocument:s,replace:a,state:o,target:l,to:u,preventScrollReset:c,unstable_viewTransition:d}=e,h=tS(e,gR),{basename:f}=b.useContext(ir),g,m=!1;if(typeof u=="string"&&wR.test(u)&&(g=u,CR))try{let E=new URL(window.location.href),T=u.startsWith("//")?new URL(E.protocol+u):new URL(u),A=yi(T.pathname,f);T.origin===E.origin&&A!=null?u=A+T.search+T.hash:m=!0}catch{}let y=$A(u,{relative:i}),p=kR(u,{replace:a,state:o,target:l,preventScrollReset:c,relative:i,unstable_viewTransition:d});function v(E){r&&r(E),E.defaultPrevented||p(E)}return b.createElement("a",es({},h,{href:g||y,onClick:m||s?r:v,ref:t,target:l}))}),nS=b.forwardRef((n,e)=>{let{fetcherKey:t,navigate:r,reloadDocument:i,replace:s,state:a,method:o=ru,action:l,onSubmit:u,relative:c,preventScrollReset:d,unstable_viewTransition:h}=n,f=tS(n,mR),g=MR(),m=NR(l,{relative:c}),y=o.toLowerCase()==="get"?"get":"post",p=v=>{if(u&&u(v),v.defaultPrevented)return;v.preventDefault();let E=v.nativeEvent.submitter,T=(E==null?void 0:E.getAttribute("formmethod"))||o;g(E||v.currentTarget,{fetcherKey:t,method:T,navigate:r,replace:s,state:a,relative:c,preventScrollReset:d,unstable_viewTransition:h})};return b.createElement("form",es({ref:e,method:y,action:m,onSubmit:i?u:p},f))});var bh;(function(n){n.UseScrollRestoration="useScrollRestoration",n.UseSubmit="useSubmit",n.UseSubmitFetcher="useSubmitFetcher",n.UseFetcher="useFetcher",n.useViewTransitionState="useViewTransitionState"})(bh||(bh={}));var Rp;(function(n){n.UseFetcher="useFetcher",n.UseFetchers="useFetchers",n.UseScrollRestoration="useScrollRestoration"})(Rp||(Rp={}));function bR(n){let e=b.useContext(Ko);return e||Ee(!1),e}function kR(n,e){let{target:t,replace:r,state:i,preventScrollReset:s,relative:a,unstable_viewTransition:o}=e===void 0?{}:e,l=wr(),u=Ai(),c=cg(n,{relative:a});return b.useCallback(d=>{if(cR(d,t)){d.preventDefault();let h=r!==void 0?r:pi(u)===pi(c);l(n,{replace:h,state:i,preventScrollReset:s,relative:a,unstable_viewTransition:o})}},[u,l,c,r,i,t,n,s,a,o])}function PR(){if(typeof document>"u")throw new Error("You are calling submit during the server render. Try calling submit within a `useEffect` or callback instead.")}let OR=0,FR=()=>"__"+String(++OR)+"__";function MR(){let{router:n}=bR(bh.UseSubmit),{basename:e}=b.useContext(ir),t=ZA();return b.useCallback(function(r,i){i===void 0&&(i={}),PR();let{action:s,method:a,encType:o,formData:l,body:u}=fR(r,e);if(i.navigate===!1){let c=i.fetcherKey||FR();n.fetch(c,t,i.action||s,{preventScrollReset:i.preventScrollReset,formData:l,body:u,formMethod:i.method||a,formEncType:i.encType||o,unstable_flushSync:i.unstable_flushSync})}else n.navigate(i.action||s,{preventScrollReset:i.preventScrollReset,formData:l,body:u,formMethod:i.method||a,formEncType:i.encType||o,replace:i.replace,state:i.state,fromRouteId:t,unstable_flushSync:i.unstable_flushSync,unstable_viewTransition:i.unstable_viewTransition})},[n,e,t])}function NR(n,e){let{relative:t}=e===void 0?{}:e,{basename:r}=b.useContext(ir),i=b.useContext(Mn);i||Ee(!1);let[s]=i.matches.slice(-1),a=es({},cg(n||".",{relative:t})),o=Ai();if(n==null){a.search=o.search;let l=new URLSearchParams(a.search);l.has("index")&&l.get("index")===""&&(l.delete("index"),a.search=l.toString()?"?"+l.toString():"")}return(!n||n===".")&&s.route.index&&(a.search=a.search?a.search.replace(/^\?/,"?index&"):"?index"),r!=="/"&&(a.pathname=a.pathname==="/"?r:nr([r,a.pathname])),pi(a)}var Ea=class{constructor(){this.listeners=new Set,this.subscribe=this.subscribe.bind(this)}subscribe(n){return this.listeners.add(n),this.onSubscribe(),()=>{this.listeners.delete(n),this.onUnsubscribe()}}hasListeners(){return this.listeners.size>0}onSubscribe(){}onUnsubscribe(){}},ts=typeof window>"u"||"Deno"in globalThis;function fn(){}function UR(n,e){return typeof n=="function"?n(e):n}function kh(n){return typeof n=="number"&&n>=0&&n!==1/0}function rS(n,e){return Math.max(n+(e||0)-Date.now(),0)}function js(n,e){return typeof n=="function"?n(e):n}function kn(n,e){return typeof n=="function"?n(e):n}function _p(n,e){const{type:t="all",exact:r,fetchStatus:i,predicate:s,queryKey:a,stale:o}=n;if(a){if(r){if(e.queryHash!==dg(a,e.options))return!1}else if(!Ro(e.queryKey,a))return!1}if(t!=="all"){const l=e.isActive();if(t==="active"&&!l||t==="inactive"&&l)return!1}return!(typeof o=="boolean"&&e.isStale()!==o||i&&i!==e.state.fetchStatus||s&&!s(e))}function Ip(n,e){const{exact:t,status:r,predicate:i,mutationKey:s}=n;if(s){if(!e.options.mutationKey)return!1;if(t){if(ns(e.options.mutationKey)!==ns(s))return!1}else if(!Ro(e.options.mutationKey,s))return!1}return!(r&&e.state.status!==r||i&&!i(e))}function dg(n,e){return((e==null?void 0:e.queryKeyHashFn)||ns)(n)}function ns(n){return JSON.stringify(n,(e,t)=>Ph(t)?Object.keys(t).sort().reduce((r,i)=>(r[i]=t[i],r),{}):t)}function Ro(n,e){return n===e?!0:typeof n!=typeof e?!1:n&&e&&typeof n=="object"&&typeof e=="object"?!Object.keys(e).some(t=>!Ro(n[t],e[t])):!1}function iS(n,e){if(n===e)return n;const t=Dp(n)&&Dp(e);if(t||Ph(n)&&Ph(e)){const r=t?n:Object.keys(n),i=r.length,s=t?e:Object.keys(e),a=s.length,o=t?[]:{};let l=0;for(let u=0;u<a;u++){const c=t?u:s[u];(!t&&r.includes(c)||t)&&n[c]===void 0&&e[c]===void 0?(o[c]=void 0,l++):(o[c]=iS(n[c],e[c]),o[c]===n[c]&&n[c]!==void 0&&l++)}return i===a&&l===i?n:o}return e}function $u(n,e){if(!e||Object.keys(n).length!==Object.keys(e).length)return!1;for(const t in n)if(n[t]!==e[t])return!1;return!0}function Dp(n){return Array.isArray(n)&&n.length===Object.keys(n).length}function Ph(n){if(!Cp(n))return!1;const e=n.constructor;if(e===void 0)return!0;const t=e.prototype;return!(!Cp(t)||!t.hasOwnProperty("isPrototypeOf")||Object.getPrototypeOf(n)!==Object.prototype)}function Cp(n){return Object.prototype.toString.call(n)==="[object Object]"}function BR(n){return new Promise(e=>{setTimeout(e,n)})}function Oh(n,e,t){return typeof t.structuralSharing=="function"?t.structuralSharing(n,e):t.structuralSharing!==!1?iS(n,e):e}function $R(n,e,t=0){const r=[...n,e];return t&&r.length>t?r.slice(1):r}function jR(n,e,t=0){const r=[e,...n];return t&&r.length>t?r.slice(0,-1):r}var hg=Symbol();function sS(n,e){return!n.queryFn&&(e!=null&&e.initialPromise)?()=>e.initialPromise:!n.queryFn||n.queryFn===hg?()=>Promise.reject(new Error(`Missing queryFn: '${n.queryHash}'`)):n.queryFn}var Ui,Wr,Hs,my,GR=(my=class extends Ea{constructor(){super();ue(this,Ui);ue(this,Wr);ue(this,Hs);J(this,Hs,e=>{if(!ts&&window.addEventListener){const t=()=>e();return window.addEventListener("visibilitychange",t,!1),()=>{window.removeEventListener("visibilitychange",t)}}})}onSubscribe(){w(this,Wr)||this.setEventListener(w(this,Hs))}onUnsubscribe(){var e;this.hasListeners()||((e=w(this,Wr))==null||e.call(this),J(this,Wr,void 0))}setEventListener(e){var t;J(this,Hs,e),(t=w(this,Wr))==null||t.call(this),J(this,Wr,e(r=>{typeof r=="boolean"?this.setFocused(r):this.onFocus()}))}setFocused(e){w(this,Ui)!==e&&(J(this,Ui,e),this.onFocus())}onFocus(){const e=this.isFocused();this.listeners.forEach(t=>{t(e)})}isFocused(){var e;return typeof w(this,Ui)=="boolean"?w(this,Ui):((e=globalThis.document)==null?void 0:e.visibilityState)!=="hidden"}},Ui=new WeakMap,Wr=new WeakMap,Hs=new WeakMap,my),fg=new GR,zs,Yr,Ws,py,KR=(py=class extends Ea{constructor(){super();ue(this,zs,!0);ue(this,Yr);ue(this,Ws);J(this,Ws,e=>{if(!ts&&window.addEventListener){const t=()=>e(!0),r=()=>e(!1);return window.addEventListener("online",t,!1),window.addEventListener("offline",r,!1),()=>{window.removeEventListener("online",t),window.removeEventListener("offline",r)}}})}onSubscribe(){w(this,Yr)||this.setEventListener(w(this,Ws))}onUnsubscribe(){var e;this.hasListeners()||((e=w(this,Yr))==null||e.call(this),J(this,Yr,void 0))}setEventListener(e){var t;J(this,Ws,e),(t=w(this,Yr))==null||t.call(this),J(this,Yr,e(this.setOnline.bind(this)))}setOnline(e){w(this,zs)!==e&&(J(this,zs,e),this.listeners.forEach(r=>{r(e)}))}isOnline(){return w(this,zs)}},zs=new WeakMap,Yr=new WeakMap,Ws=new WeakMap,py),ju=new KR;function Fh(){let n,e;const t=new Promise((i,s)=>{n=i,e=s});t.status="pending",t.catch(()=>{});function r(i){Object.assign(t,i),delete t.resolve,delete t.reject}return t.resolve=i=>{r({status:"fulfilled",value:i}),n(i)},t.reject=i=>{r({status:"rejected",reason:i}),e(i)},t}function VR(n){return Math.min(1e3*2**n,3e4)}function aS(n){return(n??"online")==="online"?ju.isOnline():!0}var oS=class extends Error{constructor(n){super("CancelledError"),this.revert=n==null?void 0:n.revert,this.silent=n==null?void 0:n.silent}};function ad(n){return n instanceof oS}function lS(n){let e=!1,t=0,r=!1,i;const s=Fh(),a=m=>{var y;r||(h(new oS(m)),(y=n.abort)==null||y.call(n))},o=()=>{e=!0},l=()=>{e=!1},u=()=>fg.isFocused()&&(n.networkMode==="always"||ju.isOnline())&&n.canRun(),c=()=>aS(n.networkMode)&&n.canRun(),d=m=>{var y;r||(r=!0,(y=n.onSuccess)==null||y.call(n,m),i==null||i(),s.resolve(m))},h=m=>{var y;r||(r=!0,(y=n.onError)==null||y.call(n,m),i==null||i(),s.reject(m))},f=()=>new Promise(m=>{var y;i=p=>{(r||u())&&m(p)},(y=n.onPause)==null||y.call(n)}).then(()=>{var m;i=void 0,r||(m=n.onContinue)==null||m.call(n)}),g=()=>{if(r)return;let m;const y=t===0?n.initialPromise:void 0;try{m=y??n.fn()}catch(p){m=Promise.reject(p)}Promise.resolve(m).then(d).catch(p=>{var I;if(r)return;const v=n.retry??(ts?0:3),E=n.retryDelay??VR,T=typeof E=="function"?E(t,p):E,A=v===!0||typeof v=="number"&&t<v||typeof v=="function"&&v(t,p);if(e||!A){h(p);return}t++,(I=n.onFail)==null||I.call(n,t,p),BR(T).then(()=>u()?void 0:f()).then(()=>{e?h(p):g()})})};return{promise:s,cancel:a,continue:()=>(i==null||i(),s),cancelRetry:o,continueRetry:l,canStart:c,start:()=>(c()?g():f().then(g),s)}}function HR(){let n=[],e=0,t=o=>{o()},r=o=>{o()},i=o=>setTimeout(o,0);const s=o=>{e?n.push(o):i(()=>{t(o)})},a=()=>{const o=n;n=[],o.length&&i(()=>{r(()=>{o.forEach(l=>{t(l)})})})};return{batch:o=>{let l;e++;try{l=o()}finally{e--,e||a()}return l},batchCalls:o=>(...l)=>{s(()=>{o(...l)})},schedule:s,setNotifyFunction:o=>{t=o},setBatchNotifyFunction:o=>{r=o},setScheduler:o=>{i=o}}}var dt=HR(),Bi,yy,uS=(yy=class{constructor(){ue(this,Bi)}destroy(){this.clearGcTimeout()}scheduleGc(){this.clearGcTimeout(),kh(this.gcTime)&&J(this,Bi,setTimeout(()=>{this.optionalRemove()},this.gcTime))}updateGcTime(n){this.gcTime=Math.max(this.gcTime||0,n??(ts?1/0:5*60*1e3))}clearGcTimeout(){w(this,Bi)&&(clearTimeout(w(this,Bi)),J(this,Bi,void 0))}},Bi=new WeakMap,yy),Ys,qs,hn,_t,Oo,$i,Dn,gr,vy,zR=(vy=class extends uS{constructor(e){super();ue(this,Dn);ue(this,Ys);ue(this,qs);ue(this,hn);ue(this,_t);ue(this,Oo);ue(this,$i);J(this,$i,!1),J(this,Oo,e.defaultOptions),this.setOptions(e.options),this.observers=[],J(this,hn,e.cache),this.queryKey=e.queryKey,this.queryHash=e.queryHash,J(this,Ys,WR(this.options)),this.state=e.state??w(this,Ys),this.scheduleGc()}get meta(){return this.options.meta}get promise(){var e;return(e=w(this,_t))==null?void 0:e.promise}setOptions(e){this.options={...w(this,Oo),...e},this.updateGcTime(this.options.gcTime)}optionalRemove(){!this.observers.length&&this.state.fetchStatus==="idle"&&w(this,hn).remove(this)}setData(e,t){const r=Oh(this.state.data,e,this.options);return ve(this,Dn,gr).call(this,{data:r,type:"success",dataUpdatedAt:t==null?void 0:t.updatedAt,manual:t==null?void 0:t.manual}),r}setState(e,t){ve(this,Dn,gr).call(this,{type:"setState",state:e,setStateOptions:t})}cancel(e){var r,i;const t=(r=w(this,_t))==null?void 0:r.promise;return(i=w(this,_t))==null||i.cancel(e),t?t.then(fn).catch(fn):Promise.resolve()}destroy(){super.destroy(),this.cancel({silent:!0})}reset(){this.destroy(),this.setState(w(this,Ys))}isActive(){return this.observers.some(e=>kn(e.options.enabled,this)!==!1)}isDisabled(){return this.getObserversCount()>0?!this.isActive():this.options.queryFn===hg||this.state.dataUpdateCount+this.state.errorUpdateCount===0}isStale(){return this.state.isInvalidated?!0:this.getObserversCount()>0?this.observers.some(e=>e.getCurrentResult().isStale):this.state.data===void 0}isStaleByTime(e=0){return this.state.isInvalidated||this.state.data===void 0||!rS(this.state.dataUpdatedAt,e)}onFocus(){var t;const e=this.observers.find(r=>r.shouldFetchOnWindowFocus());e==null||e.refetch({cancelRefetch:!1}),(t=w(this,_t))==null||t.continue()}onOnline(){var t;const e=this.observers.find(r=>r.shouldFetchOnReconnect());e==null||e.refetch({cancelRefetch:!1}),(t=w(this,_t))==null||t.continue()}addObserver(e){this.observers.includes(e)||(this.observers.push(e),this.clearGcTimeout(),w(this,hn).notify({type:"observerAdded",query:this,observer:e}))}removeObserver(e){this.observers.includes(e)&&(this.observers=this.observers.filter(t=>t!==e),this.observers.length||(w(this,_t)&&(w(this,$i)?w(this,_t).cancel({revert:!0}):w(this,_t).cancelRetry()),this.scheduleGc()),w(this,hn).notify({type:"observerRemoved",query:this,observer:e}))}getObserversCount(){return this.observers.length}invalidate(){this.state.isInvalidated||ve(this,Dn,gr).call(this,{type:"invalidate"})}fetch(e,t){var l,u,c;if(this.state.fetchStatus!=="idle"){if(this.state.data!==void 0&&(t!=null&&t.cancelRefetch))this.cancel({silent:!0});else if(w(this,_t))return w(this,_t).continueRetry(),w(this,_t).promise}if(e&&this.setOptions(e),!this.options.queryFn){const d=this.observers.find(h=>h.options.queryFn);d&&this.setOptions(d.options)}const r=new AbortController,i=d=>{Object.defineProperty(d,"signal",{enumerable:!0,get:()=>(J(this,$i,!0),r.signal)})},s=()=>{const d=sS(this.options,t),h={queryKey:this.queryKey,meta:this.meta};return i(h),J(this,$i,!1),this.options.persister?this.options.persister(d,h,this):d(h)},a={fetchOptions:t,options:this.options,queryKey:this.queryKey,state:this.state,fetchFn:s};i(a),(l=this.options.behavior)==null||l.onFetch(a,this),J(this,qs,this.state),(this.state.fetchStatus==="idle"||this.state.fetchMeta!==((u=a.fetchOptions)==null?void 0:u.meta))&&ve(this,Dn,gr).call(this,{type:"fetch",meta:(c=a.fetchOptions)==null?void 0:c.meta});const o=d=>{var h,f,g,m;ad(d)&&d.silent||ve(this,Dn,gr).call(this,{type:"error",error:d}),ad(d)||((f=(h=w(this,hn).config).onError)==null||f.call(h,d,this),(m=(g=w(this,hn).config).onSettled)==null||m.call(g,this.state.data,d,this)),this.scheduleGc()};return J(this,_t,lS({initialPromise:t==null?void 0:t.initialPromise,fn:a.fetchFn,abort:r.abort.bind(r),onSuccess:d=>{var h,f,g,m;if(d===void 0){o(new Error(`${this.queryHash} data is undefined`));return}try{this.setData(d)}catch(y){o(y);return}(f=(h=w(this,hn).config).onSuccess)==null||f.call(h,d,this),(m=(g=w(this,hn).config).onSettled)==null||m.call(g,d,this.state.error,this),this.scheduleGc()},onError:o,onFail:(d,h)=>{ve(this,Dn,gr).call(this,{type:"failed",failureCount:d,error:h})},onPause:()=>{ve(this,Dn,gr).call(this,{type:"pause"})},onContinue:()=>{ve(this,Dn,gr).call(this,{type:"continue"})},retry:a.options.retry,retryDelay:a.options.retryDelay,networkMode:a.options.networkMode,canRun:()=>!0})),w(this,_t).start()}},Ys=new WeakMap,qs=new WeakMap,hn=new WeakMap,_t=new WeakMap,Oo=new WeakMap,$i=new WeakMap,Dn=new WeakSet,gr=function(e){const t=r=>{switch(e.type){case"failed":return{...r,fetchFailureCount:e.failureCount,fetchFailureReason:e.error};case"pause":return{...r,fetchStatus:"paused"};case"continue":return{...r,fetchStatus:"fetching"};case"fetch":return{...r,...cS(r.data,this.options),fetchMeta:e.meta??null};case"success":return{...r,data:e.data,dataUpdateCount:r.dataUpdateCount+1,dataUpdatedAt:e.dataUpdatedAt??Date.now(),error:null,isInvalidated:!1,status:"success",...!e.manual&&{fetchStatus:"idle",fetchFailureCount:0,fetchFailureReason:null}};case"error":const i=e.error;return ad(i)&&i.revert&&w(this,qs)?{...w(this,qs),fetchStatus:"idle"}:{...r,error:i,errorUpdateCount:r.errorUpdateCount+1,errorUpdatedAt:Date.now(),fetchFailureCount:r.fetchFailureCount+1,fetchFailureReason:i,fetchStatus:"idle",status:"error"};case"invalidate":return{...r,isInvalidated:!0};case"setState":return{...r,...e.state}}};this.state=t(this.state),dt.batch(()=>{this.observers.forEach(r=>{r.onQueryUpdate()}),w(this,hn).notify({query:this,type:"updated",action:e})})},vy);function cS(n,e){return{fetchFailureCount:0,fetchFailureReason:null,fetchStatus:aS(e.networkMode)?"fetching":"paused",...n===void 0&&{error:null,status:"pending"}}}function WR(n){const e=typeof n.initialData=="function"?n.initialData():n.initialData,t=e!==void 0,r=t?typeof n.initialDataUpdatedAt=="function"?n.initialDataUpdatedAt():n.initialDataUpdatedAt:0;return{data:e,dataUpdateCount:0,dataUpdatedAt:t?r??Date.now():0,error:null,errorUpdateCount:0,errorUpdatedAt:0,fetchFailureCount:0,fetchFailureReason:null,fetchMeta:null,isInvalidated:!1,status:t?"success":"pending",fetchStatus:"idle"}}var Vn,Ey,YR=(Ey=class extends Ea{constructor(e={}){super();ue(this,Vn);this.config=e,J(this,Vn,new Map)}build(e,t,r){const i=t.queryKey,s=t.queryHash??dg(i,t);let a=this.get(s);return a||(a=new zR({cache:this,queryKey:i,queryHash:s,options:e.defaultQueryOptions(t),state:r,defaultOptions:e.getQueryDefaults(i)}),this.add(a)),a}add(e){w(this,Vn).has(e.queryHash)||(w(this,Vn).set(e.queryHash,e),this.notify({type:"added",query:e}))}remove(e){const t=w(this,Vn).get(e.queryHash);t&&(e.destroy(),t===e&&w(this,Vn).delete(e.queryHash),this.notify({type:"removed",query:e}))}clear(){dt.batch(()=>{this.getAll().forEach(e=>{this.remove(e)})})}get(e){return w(this,Vn).get(e)}getAll(){return[...w(this,Vn).values()]}find(e){const t={exact:!0,...e};return this.getAll().find(r=>_p(t,r))}findAll(e={}){const t=this.getAll();return Object.keys(e).length>0?t.filter(r=>_p(e,r)):t}notify(e){dt.batch(()=>{this.listeners.forEach(t=>{t(e)})})}onFocus(){dt.batch(()=>{this.getAll().forEach(e=>{e.onFocus()})})}onOnline(){dt.batch(()=>{this.getAll().forEach(e=>{e.onOnline()})})}},Vn=new WeakMap,Ey),Hn,bt,ji,zn,$r,Sy,qR=(Sy=class extends uS{constructor(e){super();ue(this,zn);ue(this,Hn);ue(this,bt);ue(this,ji);this.mutationId=e.mutationId,J(this,bt,e.mutationCache),J(this,Hn,[]),this.state=e.state||dS(),this.setOptions(e.options),this.scheduleGc()}setOptions(e){this.options=e,this.updateGcTime(this.options.gcTime)}get meta(){return this.options.meta}addObserver(e){w(this,Hn).includes(e)||(w(this,Hn).push(e),this.clearGcTimeout(),w(this,bt).notify({type:"observerAdded",mutation:this,observer:e}))}removeObserver(e){J(this,Hn,w(this,Hn).filter(t=>t!==e)),this.scheduleGc(),w(this,bt).notify({type:"observerRemoved",mutation:this,observer:e})}optionalRemove(){w(this,Hn).length||(this.state.status==="pending"?this.scheduleGc():w(this,bt).remove(this))}continue(){var e;return((e=w(this,ji))==null?void 0:e.continue())??this.execute(this.state.variables)}async execute(e){var i,s,a,o,l,u,c,d,h,f,g,m,y,p,v,E,T,A,I,R;J(this,ji,lS({fn:()=>this.options.mutationFn?this.options.mutationFn(e):Promise.reject(new Error("No mutationFn found")),onFail:(x,D)=>{ve(this,zn,$r).call(this,{type:"failed",failureCount:x,error:D})},onPause:()=>{ve(this,zn,$r).call(this,{type:"pause"})},onContinue:()=>{ve(this,zn,$r).call(this,{type:"continue"})},retry:this.options.retry??0,retryDelay:this.options.retryDelay,networkMode:this.options.networkMode,canRun:()=>w(this,bt).canRun(this)}));const t=this.state.status==="pending",r=!w(this,ji).canStart();try{if(!t){ve(this,zn,$r).call(this,{type:"pending",variables:e,isPaused:r}),await((s=(i=w(this,bt).config).onMutate)==null?void 0:s.call(i,e,this));const D=await((o=(a=this.options).onMutate)==null?void 0:o.call(a,e));D!==this.state.context&&ve(this,zn,$r).call(this,{type:"pending",context:D,variables:e,isPaused:r})}const x=await w(this,ji).start();return await((u=(l=w(this,bt).config).onSuccess)==null?void 0:u.call(l,x,e,this.state.context,this)),await((d=(c=this.options).onSuccess)==null?void 0:d.call(c,x,e,this.state.context)),await((f=(h=w(this,bt).config).onSettled)==null?void 0:f.call(h,x,null,this.state.variables,this.state.context,this)),await((m=(g=this.options).onSettled)==null?void 0:m.call(g,x,null,e,this.state.context)),ve(this,zn,$r).call(this,{type:"success",data:x}),x}catch(x){try{throw await((p=(y=w(this,bt).config).onError)==null?void 0:p.call(y,x,e,this.state.context,this)),await((E=(v=this.options).onError)==null?void 0:E.call(v,x,e,this.state.context)),await((A=(T=w(this,bt).config).onSettled)==null?void 0:A.call(T,void 0,x,this.state.variables,this.state.context,this)),await((R=(I=this.options).onSettled)==null?void 0:R.call(I,void 0,x,e,this.state.context)),x}finally{ve(this,zn,$r).call(this,{type:"error",error:x})}}finally{w(this,bt).runNext(this)}}},Hn=new WeakMap,bt=new WeakMap,ji=new WeakMap,zn=new WeakSet,$r=function(e){const t=r=>{switch(e.type){case"failed":return{...r,failureCount:e.failureCount,failureReason:e.error};case"pause":return{...r,isPaused:!0};case"continue":return{...r,isPaused:!1};case"pending":return{...r,context:e.context,data:void 0,failureCount:0,failureReason:null,error:null,isPaused:e.isPaused,status:"pending",variables:e.variables,submittedAt:Date.now()};case"success":return{...r,data:e.data,failureCount:0,failureReason:null,error:null,status:"success",isPaused:!1};case"error":return{...r,data:void 0,error:e.error,failureCount:r.failureCount+1,failureReason:e.error,isPaused:!1,status:"error"}}};this.state=t(this.state),dt.batch(()=>{w(this,Hn).forEach(r=>{r.onMutationUpdate(e)}),w(this,bt).notify({mutation:this,type:"updated",action:e})})},Sy);function dS(){return{context:void 0,data:void 0,error:null,failureCount:0,failureReason:null,isPaused:!1,status:"idle",variables:void 0,submittedAt:0}}var Xt,Fo,xy,QR=(xy=class extends Ea{constructor(e={}){super();ue(this,Xt);ue(this,Fo);this.config=e,J(this,Xt,new Map),J(this,Fo,Date.now())}build(e,t,r){const i=new qR({mutationCache:this,mutationId:++il(this,Fo)._,options:e.defaultMutationOptions(t),state:r});return this.add(i),i}add(e){const t=Al(e),r=w(this,Xt).get(t)??[];r.push(e),w(this,Xt).set(t,r),this.notify({type:"added",mutation:e})}remove(e){var r;const t=Al(e);if(w(this,Xt).has(t)){const i=(r=w(this,Xt).get(t))==null?void 0:r.filter(s=>s!==e);i&&(i.length===0?w(this,Xt).delete(t):w(this,Xt).set(t,i))}this.notify({type:"removed",mutation:e})}canRun(e){var r;const t=(r=w(this,Xt).get(Al(e)))==null?void 0:r.find(i=>i.state.status==="pending");return!t||t===e}runNext(e){var r;const t=(r=w(this,Xt).get(Al(e)))==null?void 0:r.find(i=>i!==e&&i.state.isPaused);return(t==null?void 0:t.continue())??Promise.resolve()}clear(){dt.batch(()=>{this.getAll().forEach(e=>{this.remove(e)})})}getAll(){return[...w(this,Xt).values()].flat()}find(e){const t={exact:!0,...e};return this.getAll().find(r=>Ip(t,r))}findAll(e={}){return this.getAll().filter(t=>Ip(e,t))}notify(e){dt.batch(()=>{this.listeners.forEach(t=>{t(e)})})}resumePausedMutations(){const e=this.getAll().filter(t=>t.state.isPaused);return dt.batch(()=>Promise.all(e.map(t=>t.continue().catch(fn))))}},Xt=new WeakMap,Fo=new WeakMap,xy);function Al(n){var e;return((e=n.options.scope)==null?void 0:e.id)??String(n.mutationId)}function wp(n){return{onFetch:(e,t)=>{var c,d,h,f,g;const r=e.options,i=(h=(d=(c=e.fetchOptions)==null?void 0:c.meta)==null?void 0:d.fetchMore)==null?void 0:h.direction,s=((f=e.state.data)==null?void 0:f.pages)||[],a=((g=e.state.data)==null?void 0:g.pageParams)||[];let o={pages:[],pageParams:[]},l=0;const u=async()=>{let m=!1;const y=E=>{Object.defineProperty(E,"signal",{enumerable:!0,get:()=>(e.signal.aborted?m=!0:e.signal.addEventListener("abort",()=>{m=!0}),e.signal)})},p=sS(e.options,e.fetchOptions),v=async(E,T,A)=>{if(m)return Promise.reject();if(T==null&&E.pages.length)return Promise.resolve(E);const I={queryKey:e.queryKey,pageParam:T,direction:A?"backward":"forward",meta:e.options.meta};y(I);const R=await p(I),{maxPages:x}=e.options,D=A?jR:$R;return{pages:D(E.pages,R,x),pageParams:D(E.pageParams,T,x)}};if(i&&s.length){const E=i==="backward",T=E?XR:bp,A={pages:s,pageParams:a},I=T(r,A);o=await v(A,I,E)}else{const E=n??s.length;do{const T=l===0?a[0]??r.initialPageParam:bp(r,o);if(l>0&&T==null)break;o=await v(o,T),l++}while(l<E)}return o};e.options.persister?e.fetchFn=()=>{var m,y;return(y=(m=e.options).persister)==null?void 0:y.call(m,u,{queryKey:e.queryKey,meta:e.options.meta,signal:e.signal},t)}:e.fetchFn=u}}}function bp(n,{pages:e,pageParams:t}){const r=e.length-1;return e.length>0?n.getNextPageParam(e[r],e,t[r],t):void 0}function XR(n,{pages:e,pageParams:t}){var r;return e.length>0?(r=n.getPreviousPageParam)==null?void 0:r.call(n,e[0],e,t[0],t):void 0}var et,qr,Qr,Qs,Xs,Xr,Zs,Js,Ty,ZR=(Ty=class{constructor(n={}){ue(this,et);ue(this,qr);ue(this,Qr);ue(this,Qs);ue(this,Xs);ue(this,Xr);ue(this,Zs);ue(this,Js);J(this,et,n.queryCache||new YR),J(this,qr,n.mutationCache||new QR),J(this,Qr,n.defaultOptions||{}),J(this,Qs,new Map),J(this,Xs,new Map),J(this,Xr,0)}mount(){il(this,Xr)._++,w(this,Xr)===1&&(J(this,Zs,fg.subscribe(async n=>{n&&(await this.resumePausedMutations(),w(this,et).onFocus())})),J(this,Js,ju.subscribe(async n=>{n&&(await this.resumePausedMutations(),w(this,et).onOnline())})))}unmount(){var n,e;il(this,Xr)._--,w(this,Xr)===0&&((n=w(this,Zs))==null||n.call(this),J(this,Zs,void 0),(e=w(this,Js))==null||e.call(this),J(this,Js,void 0))}isFetching(n){return w(this,et).findAll({...n,fetchStatus:"fetching"}).length}isMutating(n){return w(this,qr).findAll({...n,status:"pending"}).length}getQueryData(n){var t;const e=this.defaultQueryOptions({queryKey:n});return(t=w(this,et).get(e.queryHash))==null?void 0:t.state.data}ensureQueryData(n){const e=this.defaultQueryOptions(n),t=w(this,et).build(this,e),r=t.state.data;return r===void 0?this.fetchQuery(n):(n.revalidateIfStale&&t.isStaleByTime(js(e.staleTime,t))&&this.prefetchQuery(e),Promise.resolve(r))}getQueriesData(n){return w(this,et).findAll(n).map(({queryKey:e,state:t})=>{const r=t.data;return[e,r]})}setQueryData(n,e,t){const r=this.defaultQueryOptions({queryKey:n}),i=w(this,et).get(r.queryHash),s=i==null?void 0:i.state.data,a=UR(e,s);if(a!==void 0)return w(this,et).build(this,r).setData(a,{...t,manual:!0})}setQueriesData(n,e,t){return dt.batch(()=>w(this,et).findAll(n).map(({queryKey:r})=>[r,this.setQueryData(r,e,t)]))}getQueryState(n){var t;const e=this.defaultQueryOptions({queryKey:n});return(t=w(this,et).get(e.queryHash))==null?void 0:t.state}removeQueries(n){const e=w(this,et);dt.batch(()=>{e.findAll(n).forEach(t=>{e.remove(t)})})}resetQueries(n,e){const t=w(this,et),r={type:"active",...n};return dt.batch(()=>(t.findAll(n).forEach(i=>{i.reset()}),this.refetchQueries(r,e)))}cancelQueries(n,e={}){const t={revert:!0,...e},r=dt.batch(()=>w(this,et).findAll(n).map(i=>i.cancel(t)));return Promise.all(r).then(fn).catch(fn)}invalidateQueries(n,e={}){return dt.batch(()=>{if(w(this,et).findAll(n).forEach(r=>{r.invalidate()}),(n==null?void 0:n.refetchType)==="none")return Promise.resolve();const t={...n,type:(n==null?void 0:n.refetchType)??(n==null?void 0:n.type)??"active"};return this.refetchQueries(t,e)})}refetchQueries(n,e={}){const t={...e,cancelRefetch:e.cancelRefetch??!0},r=dt.batch(()=>w(this,et).findAll(n).filter(i=>!i.isDisabled()).map(i=>{let s=i.fetch(void 0,t);return t.throwOnError||(s=s.catch(fn)),i.state.fetchStatus==="paused"?Promise.resolve():s}));return Promise.all(r).then(fn)}fetchQuery(n){const e=this.defaultQueryOptions(n);e.retry===void 0&&(e.retry=!1);const t=w(this,et).build(this,e);return t.isStaleByTime(js(e.staleTime,t))?t.fetch(e):Promise.resolve(t.state.data)}prefetchQuery(n){return this.fetchQuery(n).then(fn).catch(fn)}fetchInfiniteQuery(n){return n.behavior=wp(n.pages),this.fetchQuery(n)}prefetchInfiniteQuery(n){return this.fetchInfiniteQuery(n).then(fn).catch(fn)}ensureInfiniteQueryData(n){return n.behavior=wp(n.pages),this.ensureQueryData(n)}resumePausedMutations(){return ju.isOnline()?w(this,qr).resumePausedMutations():Promise.resolve()}getQueryCache(){return w(this,et)}getMutationCache(){return w(this,qr)}getDefaultOptions(){return w(this,Qr)}setDefaultOptions(n){J(this,Qr,n)}setQueryDefaults(n,e){w(this,Qs).set(ns(n),{queryKey:n,defaultOptions:e})}getQueryDefaults(n){const e=[...w(this,Qs).values()],t={};return e.forEach(r=>{Ro(n,r.queryKey)&&Object.assign(t,r.defaultOptions)}),t}setMutationDefaults(n,e){w(this,Xs).set(ns(n),{mutationKey:n,defaultOptions:e})}getMutationDefaults(n){const e=[...w(this,Xs).values()];let t={};return e.forEach(r=>{Ro(n,r.mutationKey)&&(t={...t,...r.defaultOptions})}),t}defaultQueryOptions(n){if(n._defaulted)return n;const e={...w(this,Qr).queries,...this.getQueryDefaults(n.queryKey),...n,_defaulted:!0};return e.queryHash||(e.queryHash=dg(e.queryKey,e)),e.refetchOnReconnect===void 0&&(e.refetchOnReconnect=e.networkMode!=="always"),e.throwOnError===void 0&&(e.throwOnError=!!e.suspense),!e.networkMode&&e.persister&&(e.networkMode="offlineFirst"),e.queryFn===hg&&(e.enabled=!1),e}defaultMutationOptions(n){return n!=null&&n._defaulted?n:{...w(this,Qr).mutations,...(n==null?void 0:n.mutationKey)&&this.getMutationDefaults(n.mutationKey),...n,_defaulted:!0}}clear(){w(this,et).clear(),w(this,qr).clear()}},et=new WeakMap,qr=new WeakMap,Qr=new WeakMap,Qs=new WeakMap,Xs=new WeakMap,Xr=new WeakMap,Zs=new WeakMap,Js=new WeakMap,Ty),Bt,Le,Mo,kt,Gi,ea,Zr,Wn,No,ta,na,Ki,Vi,Jr,ra,be,Ka,Mh,Nh,Uh,Bh,$h,jh,Gh,hS,Ly,JR=(Ly=class extends Ea{constructor(e,t){super();ue(this,be);ue(this,Bt);ue(this,Le);ue(this,Mo);ue(this,kt);ue(this,Gi);ue(this,ea);ue(this,Zr);ue(this,Wn);ue(this,No);ue(this,ta);ue(this,na);ue(this,Ki);ue(this,Vi);ue(this,Jr);ue(this,ra,new Set);this.options=t,J(this,Bt,e),J(this,Wn,null),J(this,Zr,Fh()),this.options.experimental_prefetchInRender||w(this,Zr).reject(new Error("experimental_prefetchInRender feature flag is not enabled")),this.bindMethods(),this.setOptions(t)}bindMethods(){this.refetch=this.refetch.bind(this)}onSubscribe(){this.listeners.size===1&&(w(this,Le).addObserver(this),kp(w(this,Le),this.options)?ve(this,be,Ka).call(this):this.updateResult(),ve(this,be,Bh).call(this))}onUnsubscribe(){this.hasListeners()||this.destroy()}shouldFetchOnReconnect(){return Kh(w(this,Le),this.options,this.options.refetchOnReconnect)}shouldFetchOnWindowFocus(){return Kh(w(this,Le),this.options,this.options.refetchOnWindowFocus)}destroy(){this.listeners=new Set,ve(this,be,$h).call(this),ve(this,be,jh).call(this),w(this,Le).removeObserver(this)}setOptions(e,t){const r=this.options,i=w(this,Le);if(this.options=w(this,Bt).defaultQueryOptions(e),this.options.enabled!==void 0&&typeof this.options.enabled!="boolean"&&typeof this.options.enabled!="function"&&typeof kn(this.options.enabled,w(this,Le))!="boolean")throw new Error("Expected enabled to be a boolean or a callback that returns a boolean");ve(this,be,Gh).call(this),w(this,Le).setOptions(this.options),r._defaulted&&!$u(this.options,r)&&w(this,Bt).getQueryCache().notify({type:"observerOptionsUpdated",query:w(this,Le),observer:this});const s=this.hasListeners();s&&Pp(w(this,Le),i,this.options,r)&&ve(this,be,Ka).call(this),this.updateResult(t),s&&(w(this,Le)!==i||kn(this.options.enabled,w(this,Le))!==kn(r.enabled,w(this,Le))||js(this.options.staleTime,w(this,Le))!==js(r.staleTime,w(this,Le)))&&ve(this,be,Mh).call(this);const a=ve(this,be,Nh).call(this);s&&(w(this,Le)!==i||kn(this.options.enabled,w(this,Le))!==kn(r.enabled,w(this,Le))||a!==w(this,Jr))&&ve(this,be,Uh).call(this,a)}getOptimisticResult(e){const t=w(this,Bt).getQueryCache().build(w(this,Bt),e),r=this.createResult(t,e);return t_(this,r)&&(J(this,kt,r),J(this,ea,this.options),J(this,Gi,w(this,Le).state)),r}getCurrentResult(){return w(this,kt)}trackResult(e,t){const r={};return Object.keys(e).forEach(i=>{Object.defineProperty(r,i,{configurable:!1,enumerable:!0,get:()=>(this.trackProp(i),t==null||t(i),e[i])})}),r}trackProp(e){w(this,ra).add(e)}getCurrentQuery(){return w(this,Le)}refetch({...e}={}){return this.fetch({...e})}fetchOptimistic(e){const t=w(this,Bt).defaultQueryOptions(e),r=w(this,Bt).getQueryCache().build(w(this,Bt),t);return r.fetch().then(()=>this.createResult(r,t))}fetch(e){return ve(this,be,Ka).call(this,{...e,cancelRefetch:e.cancelRefetch??!0}).then(()=>(this.updateResult(),w(this,kt)))}createResult(e,t){var x;const r=w(this,Le),i=this.options,s=w(this,kt),a=w(this,Gi),o=w(this,ea),u=e!==r?e.state:w(this,Mo),{state:c}=e;let d={...c},h=!1,f;if(t._optimisticResults){const D=this.hasListeners(),_=!D&&kp(e,t),M=D&&Pp(e,r,t,i);(_||M)&&(d={...d,...cS(c.data,e.options)}),t._optimisticResults==="isRestoring"&&(d.fetchStatus="idle")}let{error:g,errorUpdatedAt:m,status:y}=d;if(t.select&&d.data!==void 0)if(s&&d.data===(a==null?void 0:a.data)&&t.select===w(this,No))f=w(this,ta);else try{J(this,No,t.select),f=t.select(d.data),f=Oh(s==null?void 0:s.data,f,t),J(this,ta,f),J(this,Wn,null)}catch(D){J(this,Wn,D)}else f=d.data;if(t.placeholderData!==void 0&&f===void 0&&y==="pending"){let D;if(s!=null&&s.isPlaceholderData&&t.placeholderData===(o==null?void 0:o.placeholderData))D=s.data;else if(D=typeof t.placeholderData=="function"?t.placeholderData((x=w(this,na))==null?void 0:x.state.data,w(this,na)):t.placeholderData,t.select&&D!==void 0)try{D=t.select(D),J(this,Wn,null)}catch(_){J(this,Wn,_)}D!==void 0&&(y="success",f=Oh(s==null?void 0:s.data,D,t),h=!0)}w(this,Wn)&&(g=w(this,Wn),f=w(this,ta),m=Date.now(),y="error");const p=d.fetchStatus==="fetching",v=y==="pending",E=y==="error",T=v&&p,A=f!==void 0,R={status:y,fetchStatus:d.fetchStatus,isPending:v,isSuccess:y==="success",isError:E,isInitialLoading:T,isLoading:T,data:f,dataUpdatedAt:d.dataUpdatedAt,error:g,errorUpdatedAt:m,failureCount:d.fetchFailureCount,failureReason:d.fetchFailureReason,errorUpdateCount:d.errorUpdateCount,isFetched:d.dataUpdateCount>0||d.errorUpdateCount>0,isFetchedAfterMount:d.dataUpdateCount>u.dataUpdateCount||d.errorUpdateCount>u.errorUpdateCount,isFetching:p,isRefetching:p&&!v,isLoadingError:E&&!A,isPaused:d.fetchStatus==="paused",isPlaceholderData:h,isRefetchError:E&&A,isStale:gg(e,t),refetch:this.refetch,promise:w(this,Zr)};if(this.options.experimental_prefetchInRender){const D=j=>{R.status==="error"?j.reject(R.error):R.data!==void 0&&j.resolve(R.data)},_=()=>{const j=J(this,Zr,R.promise=Fh());D(j)},M=w(this,Zr);switch(M.status){case"pending":e.queryHash===r.queryHash&&D(M);break;case"fulfilled":(R.status==="error"||R.data!==M.value)&&_();break;case"rejected":(R.status!=="error"||R.error!==M.reason)&&_();break}}return R}updateResult(e){const t=w(this,kt),r=this.createResult(w(this,Le),this.options);if(J(this,Gi,w(this,Le).state),J(this,ea,this.options),w(this,Gi).data!==void 0&&J(this,na,w(this,Le)),$u(r,t))return;J(this,kt,r);const i={},s=()=>{if(!t)return!0;const{notifyOnChangeProps:a}=this.options,o=typeof a=="function"?a():a;if(o==="all"||!o&&!w(this,ra).size)return!0;const l=new Set(o??w(this,ra));return this.options.throwOnError&&l.add("error"),Object.keys(w(this,kt)).some(u=>{const c=u;return w(this,kt)[c]!==t[c]&&l.has(c)})};(e==null?void 0:e.listeners)!==!1&&s()&&(i.listeners=!0),ve(this,be,hS).call(this,{...i,...e})}onQueryUpdate(){this.updateResult(),this.hasListeners()&&ve(this,be,Bh).call(this)}},Bt=new WeakMap,Le=new WeakMap,Mo=new WeakMap,kt=new WeakMap,Gi=new WeakMap,ea=new WeakMap,Zr=new WeakMap,Wn=new WeakMap,No=new WeakMap,ta=new WeakMap,na=new WeakMap,Ki=new WeakMap,Vi=new WeakMap,Jr=new WeakMap,ra=new WeakMap,be=new WeakSet,Ka=function(e){ve(this,be,Gh).call(this);let t=w(this,Le).fetch(this.options,e);return e!=null&&e.throwOnError||(t=t.catch(fn)),t},Mh=function(){ve(this,be,$h).call(this);const e=js(this.options.staleTime,w(this,Le));if(ts||w(this,kt).isStale||!kh(e))return;const r=rS(w(this,kt).dataUpdatedAt,e)+1;J(this,Ki,setTimeout(()=>{w(this,kt).isStale||this.updateResult()},r))},Nh=function(){return(typeof this.options.refetchInterval=="function"?this.options.refetchInterval(w(this,Le)):this.options.refetchInterval)??!1},Uh=function(e){ve(this,be,jh).call(this),J(this,Jr,e),!(ts||kn(this.options.enabled,w(this,Le))===!1||!kh(w(this,Jr))||w(this,Jr)===0)&&J(this,Vi,setInterval(()=>{(this.options.refetchIntervalInBackground||fg.isFocused())&&ve(this,be,Ka).call(this)},w(this,Jr)))},Bh=function(){ve(this,be,Mh).call(this),ve(this,be,Uh).call(this,ve(this,be,Nh).call(this))},$h=function(){w(this,Ki)&&(clearTimeout(w(this,Ki)),J(this,Ki,void 0))},jh=function(){w(this,Vi)&&(clearInterval(w(this,Vi)),J(this,Vi,void 0))},Gh=function(){const e=w(this,Bt).getQueryCache().build(w(this,Bt),this.options);if(e===w(this,Le))return;const t=w(this,Le);J(this,Le,e),J(this,Mo,e.state),this.hasListeners()&&(t==null||t.removeObserver(this),e.addObserver(this))},hS=function(e){dt.batch(()=>{e.listeners&&this.listeners.forEach(t=>{t(w(this,kt))}),w(this,Bt).getQueryCache().notify({query:w(this,Le),type:"observerResultsUpdated"})})},Ly);function e_(n,e){return kn(e.enabled,n)!==!1&&n.state.data===void 0&&!(n.state.status==="error"&&e.retryOnMount===!1)}function kp(n,e){return e_(n,e)||n.state.data!==void 0&&Kh(n,e,e.refetchOnMount)}function Kh(n,e,t){if(kn(e.enabled,n)!==!1){const r=typeof t=="function"?t(n):t;return r==="always"||r!==!1&&gg(n,e)}return!1}function Pp(n,e,t,r){return(n!==e||kn(r.enabled,n)===!1)&&(!t.suspense||n.state.status!=="error")&&gg(n,t)}function gg(n,e){return kn(e.enabled,n)!==!1&&n.isStaleByTime(js(e.staleTime,n))}function t_(n,e){return!$u(n.getCurrentResult(),e)}var ei,ti,$t,Er,Ar,iu,Vh,Ay,n_=(Ay=class extends Ea{constructor(t,r){super();ue(this,Ar);ue(this,ei);ue(this,ti);ue(this,$t);ue(this,Er);J(this,ei,t),this.setOptions(r),this.bindMethods(),ve(this,Ar,iu).call(this)}bindMethods(){this.mutate=this.mutate.bind(this),this.reset=this.reset.bind(this)}setOptions(t){var i;const r=this.options;this.options=w(this,ei).defaultMutationOptions(t),$u(this.options,r)||w(this,ei).getMutationCache().notify({type:"observerOptionsUpdated",mutation:w(this,$t),observer:this}),r!=null&&r.mutationKey&&this.options.mutationKey&&ns(r.mutationKey)!==ns(this.options.mutationKey)?this.reset():((i=w(this,$t))==null?void 0:i.state.status)==="pending"&&w(this,$t).setOptions(this.options)}onUnsubscribe(){var t;this.hasListeners()||(t=w(this,$t))==null||t.removeObserver(this)}onMutationUpdate(t){ve(this,Ar,iu).call(this),ve(this,Ar,Vh).call(this,t)}getCurrentResult(){return w(this,ti)}reset(){var t;(t=w(this,$t))==null||t.removeObserver(this),J(this,$t,void 0),ve(this,Ar,iu).call(this),ve(this,Ar,Vh).call(this)}mutate(t,r){var i;return J(this,Er,r),(i=w(this,$t))==null||i.removeObserver(this),J(this,$t,w(this,ei).getMutationCache().build(w(this,ei),this.options)),w(this,$t).addObserver(this),w(this,$t).execute(t)}},ei=new WeakMap,ti=new WeakMap,$t=new WeakMap,Er=new WeakMap,Ar=new WeakSet,iu=function(){var r;const t=((r=w(this,$t))==null?void 0:r.state)??dS();J(this,ti,{...t,isPending:t.status==="pending",isSuccess:t.status==="success",isError:t.status==="error",isIdle:t.status==="idle",mutate:this.mutate,reset:this.reset})},Vh=function(t){dt.batch(()=>{var r,i,s,a,o,l,u,c;if(w(this,Er)&&this.hasListeners()){const d=w(this,ti).variables,h=w(this,ti).context;(t==null?void 0:t.type)==="success"?((i=(r=w(this,Er)).onSuccess)==null||i.call(r,t.data,d,h),(a=(s=w(this,Er)).onSettled)==null||a.call(s,t.data,null,d,h)):(t==null?void 0:t.type)==="error"&&((l=(o=w(this,Er)).onError)==null||l.call(o,t.error,d,h),(c=(u=w(this,Er)).onSettled)==null||c.call(u,void 0,t.error,d,h))}this.listeners.forEach(d=>{d(w(this,ti))})})},Ay),fS=b.createContext(void 0),cn=n=>{const e=b.useContext(fS);if(!e)throw new Error("No QueryClient set, use QueryClientProvider to set one");return e},r_=({client:n,children:e})=>(b.useEffect(()=>(n.mount(),()=>{n.unmount()}),[n]),L.jsx(fS.Provider,{value:n,children:e})),gS=b.createContext(!1),i_=()=>b.useContext(gS);gS.Provider;function s_(){let n=!1;return{clearReset:()=>{n=!1},reset:()=>{n=!0},isReset:()=>n}}var a_=b.createContext(s_()),o_=()=>b.useContext(a_);function mS(n,e){return typeof n=="function"?n(...e):!!n}function Hh(){}var l_=(n,e)=>{(n.suspense||n.throwOnError||n.experimental_prefetchInRender)&&(e.isReset()||(n.retryOnMount=!1))},u_=n=>{b.useEffect(()=>{n.clearReset()},[n])},c_=({result:n,errorResetBoundary:e,throwOnError:t,query:r})=>n.isError&&!e.isReset()&&!n.isFetching&&r&&mS(t,[n.error,r]),d_=n=>{n.suspense&&(n.staleTime===void 0&&(n.staleTime=1e3),typeof n.gcTime=="number"&&(n.gcTime=Math.max(n.gcTime,1e3)))},h_=(n,e)=>n.isLoading&&n.isFetching&&!e,f_=(n,e)=>(n==null?void 0:n.suspense)&&e.isPending,Op=(n,e,t)=>e.fetchOptimistic(n).catch(()=>{t.clearReset()});function g_(n,e,t){var c,d,h,f,g;const r=cn(),i=i_(),s=o_(),a=r.defaultQueryOptions(n);(d=(c=r.getDefaultOptions().queries)==null?void 0:c._experimental_beforeQuery)==null||d.call(c,a),a._optimisticResults=i?"isRestoring":"optimistic",d_(a),l_(a,s),u_(s);const o=!r.getQueryCache().get(a.queryHash),[l]=b.useState(()=>new e(r,a)),u=l.getOptimisticResult(a);if(b.useSyncExternalStore(b.useCallback(m=>{const y=i?Hh:l.subscribe(dt.batchCalls(m));return l.updateResult(),y},[l,i]),()=>l.getCurrentResult(),()=>l.getCurrentResult()),b.useEffect(()=>{l.setOptions(a,{listeners:!1})},[a,l]),f_(a,u))throw Op(a,l,s);if(c_({result:u,errorResetBoundary:s,throwOnError:a.throwOnError,query:r.getQueryCache().get(a.queryHash)}))throw u.error;if((f=(h=r.getDefaultOptions().queries)==null?void 0:h._experimental_afterQuery)==null||f.call(h,a,u),a.experimental_prefetchInRender&&!ts&&h_(u,i)){const m=o?Op(a,l,s):(g=r.getQueryCache().get(a.queryHash))==null?void 0:g.promise;m==null||m.catch(Hh).finally(()=>{l.updateResult()})}return a.notifyOnChangeProps?u:l.trackResult(u)}function Wt(n,e){return g_(n,JR)}function on(n,e){const t=cn(),[r]=b.useState(()=>new n_(t,n));b.useEffect(()=>{r.setOptions(n)},[r,n]);const i=b.useSyncExternalStore(b.useCallback(a=>r.subscribe(dt.batchCalls(a)),[r]),()=>r.getCurrentResult(),()=>r.getCurrentResult()),s=b.useCallback((a,o)=>{r.mutate(a,o).catch(Hh)},[r]);if(i.error&&mS(r.options.throwOnError,[i.error]))throw i.error;return{...i,mutate:s,mutateAsync:i.mutate}}const m_="wss://3126-91-227-219-94.ngrok-free.app",mt="https://3126-91-227-219-94.ngrok-free.app",Ae={refreshToken:mt+"/api/token/refresh/",login:mt+"/api/login/",logout:mt+"/api/logout/",registration:mt+"/api/registration/",room:mt+"/api/room/",favourite:mt+"/api/favourite/",aquarium:mt+"/api/aquarium/",rfid:mt+"/api/rfid/",card:mt+"/api/rfid/card/",lamp:mt+"/api/lamp/",button:mt+"/api/button/",device:mt+"/api/device/",unassignedDevice:mt+"/api/device/?unassigned=true",router:mt+"/api/device/router/",event:mt+"/api/event/",action:mt+"/api/event/action/",getUpdateLamp:mt+"/api/lamp/",getAllEvents:mt+"/api/device/get/event/"},pS=b.createContext(void 0),Vo=()=>{const n=b.useContext(pS);if(n===void 0)throw Error("Auth context is undefined");return n},p_=({children:n})=>{const[e,t]=b.useState(null),[r,i]=b.useState(!0),[s,a]=b.useState(!1),{data:o,isSuccess:l,isError:u,isPending:c}=Wt({queryKey:["token"],queryFn:y_,staleTime:5*60*1e3,refetchInterval:60*60*1e3,enabled:!s,refetchIntervalInBackground:!0});b.useEffect(()=>{c||((o==null?void 0:o.status)===200&&l?d(o.token):h(),i(!1))},[o,c,l,u]);const d=f=>{t(f),a(!1)},h=()=>{t(null),a(!0)};return c||r?null:L.jsx(pS.Provider,{value:{login:d,logout:h,invalidToken:s,access:e},children:n})};async function y_(){const n=await fetch(Ae.refreshToken,{credentials:"include"});return{token:(await n.json()).access,status:n.status}}const v_="_field_12nas_1",E_="_pulse_12nas_1",S_={field:v_,pulse:E_},Lr=({onChange:n,type:e,name:t,placeholder:r,pattern:i,inputMode:s})=>{const a=new RegExp(i||".*"),o=l=>{const u=l.target.value;if(a.test(u)){n&&n(l);return}l.target.value=u.slice(0,-1)};return L.jsx("input",{onChange:n?l=>o(l):()=>{},placeholder:r,className:S_.field,type:e,name:t,inputMode:s})},x_="_button_9yth2_1",T_="_long_9yth2_20",L_={button:x_,long:T_};function Ge({callback:n,className:e,children:t}){return L.jsx("button",{className:`${L_.button} ${e}`,onClick:n,children:t})}const mg=()=>{const n=Ai();return b.useEffect(()=>{const e={"":"url('/static/images/home.png')",login:"url('/static/images/login_full_hd.png')",registartion:"url('/static/images/login_full_hd.png')",room:"url('/static/images/rooms.png')",aquarium:"url('/static/images/aquariums.png')",rfid:"url('/static/images/rfid.png')",lamp:"url('/static/images/lamps.png')",router:"url('/static/images/router.png')"},t=e[n.pathname.split("/")[1]]||"none",r=document.getElementById("root");r&&(r.style.backgroundImage=t,r.style.backgroundSize="cover",r.style.backgroundPosition="center",r.style.transition="background 0.5s ease-in-out");const i=n.pathname.split("/")[1];new Set(Object.entries(e).filter(([a])=>a!==i).map(([,a])=>{var o;return((o=a.match(/url\(['"]?(.*?)['"]?\)/))==null?void 0:o[1])||""})).forEach(a=>{const o=new Image;o.src=a})},[n]),null},A_="_container_1ogzl_1",R_="_form_1ogzl_29",__="_link_1ogzl_45",Fp={container:A_,form:R_,link:__},I_="_link_1bfse_1",D_="_button_1bfse_11",Mp={link:I_,button:D_};function Ri({children:n,className:e,to:t,type:r}){return L.jsx(bi,{to:t,className:`${Mp.link} ${e} ${r&&Mp[r]}`,children:n})}const C_="_message_tmul3_1",w_="_backgroundBlur_tmul3_7",b_="_messageText_tmul3_17",k_="_error_tmul3_25",P_="_success_tmul3_28",Rl={message:C_,backgroundBlur:w_,messageText:b_,error:k_,success:P_},Et=({children:n,type:e})=>L.jsxs("div",{className:Rl.message,children:[L.jsx("div",{className:Rl.backgroundBlur}),L.jsx("p",{className:`${Rl.messageText} ${Rl[e]}`,children:n})]}),O_="_basic_7vu8q_1",F_={basic:O_};function br({children:n,className:e}){return L.jsx("h1",{className:`${F_.basic} ${e}`,children:n})}function M_(){const n=eS(),{login:e,access:t}=Vo(),r=wr(),i=cn();return b.useEffect(()=>{n!=null&&n.body.access?(e(n.body.access),r("/")):i.clear()},[n,e]),b.useEffect(()=>{t?r("/"):i.clear()},[]),L.jsxs("div",{className:Fp.container,children:[L.jsx(mg,{}),L.jsx(br,{children:"Logowanie"}),L.jsxs(nS,{method:"POST",className:Fp.form,children:[L.jsx(Lr,{type:"text",name:"username",placeholder:"Login"}),L.jsx(Lr,{type:"password",name:"password",placeholder:"Haso"}),(n==null?void 0:n.status)===400&&L.jsx(Et,{type:"error",children:n.body.message}),L.jsx(Ge,{children:"Zaloguj"}),L.jsx(Ri,{to:"/registartion",type:"button",children:"Zarejestruj si"})]})]})}const N_=async({request:n})=>{const e=await n.formData(),t=Object.fromEntries(e),r={username:t.username,password:t.password},i=await fetch(Ae.login,{method:"POST",credentials:"include",headers:{"Content-Type":"application/json","ngrok-skip-browser-warning":"1234"},body:JSON.stringify(r)}),s=await i.json();return{status:i.status,body:s}},U_={email:"M13.106 7.222c0-2.967-2.249-5.032-5.482-5.032-3.35 0-5.646 2.318-5.646 5.702 0 3.493 2.235 5.708 5.762 5.708.862 0 1.689-.123 2.304-.335v-.862c-.43.199-1.354.328-2.29.328-2.926 0-4.813-1.88-4.813-4.798 0-2.844 1.921-4.881 4.594-4.881 2.735 0 4.608 1.688 4.608 4.156 0 1.682-.554 2.769-1.416 2.769-.492 0-.772-.28-.772-.76V5.206H8.923v.834h-.11c-.266-.595-.881-.964-1.6-.964-1.4 0-2.378 1.162-2.378 2.823 0 1.737.957 2.906 2.379 2.906.8 0 1.415-.39 1.709-1.087h.11c.081.67.703 1.148 1.503 1.148 1.572 0 2.57-1.415 2.57-3.643zm-7.177.704c0-1.197.54-1.907 1.456-1.907.93 0 1.524.738 1.524 1.907S8.308 9.84 7.371 9.84c-.895 0-1.442-.725-1.442-1.914z",password:"M8 1a2 2 0 0 1 2 2v4H6V3a2 2 0 0 1 2-2zm3 6V3a3 3 0 0 0-6 0v4a2 2 0 0 0-2 2v5a2 2 0 0 0 2 2h6a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2z",user:"M15.992 2c3.396 0 6.998 2.86 6.998 4.995v4.997c0 1.924-0.8 5.604-2.945 7.293-0.547 0.43-0.831 1.115-0.749 1.807 0.082 0.692 0.518 1.291 1.151 1.582l8.703 4.127c0.068 0.031 0.834 0.16 0.834 1.23l0.001 1.952-27.984 0.002v-2.029c0-0.795 0.596-1.045 0.835-1.154l8.782-4.145c0.63-0.289 1.065-0.885 1.149-1.573s-0.193-1.37-0.733-1.803c-2.078-1.668-3.046-5.335-3.046-7.287v-4.997c0.001-2.089 3.638-4.995 7.004-4.995zM15.992-0c-4.416 0-9.004 3.686-9.004 6.996v4.997c0 2.184 0.997 6.601 3.793 8.847l-8.783 4.145s-1.998 0.89-1.998 1.999v3.001c0 1.105 0.895 1.999 1.998 1.999h27.986c1.105 0 1.999-0.895 1.999-1.999v-3.001c0-1.175-1.999-1.999-1.999-1.999l-8.703-4.127c2.77-2.18 3.708-6.464 3.708-8.865v-4.997c0-3.31-4.582-6.995-8.998-6.995v0z",backArrow:"M14.389 7.956v4.374l1.056 0.010c7.335 0.071 11.466 3.333 12.543 9.944-4.029-4.661-8.675-4.663-12.532-4.664h-1.067v4.337l-9.884-7.001 9.884-7zM15.456 5.893l-12.795 9.063 12.795 9.063v-5.332c5.121 0.002 9.869 0.26 13.884 7.42 0-4.547-0.751-14.706-13.884-14.833v-5.381z",settings:"M10.65 3L9.93163 3.53449L9.32754 5.54812L7.47651 4.55141L6.5906 4.68143L4.68141 6.59062L4.55139 7.47652L5.5481 9.32755L3.53449 9.93163L3 10.65V13.35L3.53449 14.0684L5.54811 14.6725L4.55142 16.5235L4.68144 17.4094L6.59063 19.3186L7.47653 19.4486L9.32754 18.4519L9.93163 20.4655L10.65 21H13.35L14.0684 20.4655L14.6725 18.4519L16.5235 19.4486L17.4094 19.3185L19.3186 17.4094L19.4486 16.5235L18.4519 14.6724L20.4655 14.0684L21 13.35V10.65L20.4655 9.93163L18.4519 9.32754L19.4486 7.47654L19.3186 6.59063L17.4094 4.68144L16.5235 4.55142L14.6725 5.54812L14.0684 3.53449L13.35 3H10.65ZM10.4692 6.96284L11.208 4.5H12.792L13.5308 6.96284L13.8753 7.0946C13.9654 7.12908 14.0543 7.16597 14.142 7.2052L14.4789 7.35598L16.7433 6.13668L17.8633 7.25671L16.644 9.52111L16.7948 9.85803C16.834 9.9457 16.8709 10.0346 16.9054 10.1247L17.0372 10.4692L19.5 11.208V12.792L17.0372 13.5308L16.9054 13.8753C16.8709 13.9654 16.834 14.0543 16.7948 14.1419L16.644 14.4789L17.8633 16.7433L16.7433 17.8633L14.4789 16.644L14.142 16.7948C14.0543 16.834 13.9654 16.8709 13.8753 16.9054L13.5308 17.0372L12.792 19.5H11.208L10.4692 17.0372L10.1247 16.9054C10.0346 16.8709 9.94569 16.834 9.85803 16.7948L9.52111 16.644L7.25671 17.8633L6.13668 16.7433L7.35597 14.4789L7.2052 14.142C7.16597 14.0543 7.12908 13.9654 7.0946 13.8753L6.96284 13.5308L4.5 12.792L4.5 11.208L6.96284 10.4692L7.0946 10.1247C7.12907 10.0346 7.16596 9.94571 7.20519 9.85805L7.35596 9.52113L6.13666 7.2567L7.25668 6.13667L9.5211 7.35598L9.85803 7.2052C9.9457 7.16597 10.0346 7.12908 10.1247 7.0946L10.4692 6.96284ZM14.25 12C14.25 13.2426 13.2426 14.25 12 14.25C10.7574 14.25 9.75 13.2426 9.75 12C9.75 10.7574 10.7574 9.75 12 9.75C13.2426 9.75 14.25 10.7574 14.25 12ZM15.75 12C15.75 14.0711 14.0711 15.75 12 15.75C9.92893 15.75 8.25 14.0711 8.25 12C8.25 9.92893 9.92893 8.25 12 8.25C14.0711 8.25 15.75 9.92893 15.75 12Z",plus:"M12 3a1 1 0 0 0-1 1v7H4a1 1 0 1 0 0 2h7v7a1 1 0 1 0 2 0v-7h7a1 1 0 1 0 0-2h-7V4a1 1 0 0 0-1-1z"},B_="_iconBack_513pj_1",$_={iconBack:B_},Ho=({className:n})=>{const e=wr();return L.jsx("button",{className:`${$_.iconBack} ${n}`,onClick:()=>{e(-1)},children:L.jsx("svg",{viewBox:"0 0 30 30",children:L.jsx("path",{d:U_.backArrow,fill:"#FFFFFF"})})})},j_="_container_1v9nr_1",G_="_form_1v9nr_31",K_="_backArrow_1v9nr_47",od={container:j_,form:G_,backArrow:K_},V_=()=>{const n=eS(),e=wr(),{access:t}=Vo();return b.useEffect(()=>{t&&e("/")},[t]),n&&n.status===201&&setTimeout(()=>{e("/")},2e3),L.jsxs("div",{className:od.container,children:[L.jsx(mg,{}),L.jsx(Ho,{className:od.backArrow}),L.jsx(br,{children:"Rejestracja"}),L.jsxs(nS,{method:"POST",className:od.form,children:[L.jsx(Lr,{type:"text",name:"username",placeholder:"Login"}),(n==null?void 0:n.status)===400&&n.body.username&&L.jsx(Et,{type:"error",children:n.body.username}),L.jsx(Lr,{type:"password",name:"password",placeholder:"Haso"}),(n==null?void 0:n.status)===400&&n.body.password&&L.jsxs(Et,{type:"error",children:[n.body.password," "]}),L.jsx(Lr,{type:"password",name:"password2",placeholder:"Powtrz haso"}),(n==null?void 0:n.status)===400&&n.body.password2&&L.jsxs(Et,{type:"error",children:[n.body.password2," "]}),L.jsx(Ge,{children:"Rejestracja"})]}),(n==null?void 0:n.status)===400&&n.body.empty&&L.jsxs(Et,{type:"error",children:[n.body.empty," "]}),L.jsx(Et,{type:"success",children:(n==null?void 0:n.status)===201&&"Rejestracja przebiega pomylnie. Za chwil zostaniesz przekierowany na stron"})]})},H_=async({request:n})=>{const e=await n.formData(),t=Object.fromEntries(e),r={username:t.username,password:t.password,password2:t.password2},i=await fetch(Ae.registration,{method:"POST",credentials:"include",headers:{"Content-Type":"application/json","ngrok-skip-browser-warning":"1234"},body:JSON.stringify(r)}),s=await i.json();return{status:i.status,body:s}},z_="_container_ull1k_1",W_="_star_ull1k_37",Y_="_lock_ull1k_57",ld={container:z_,star:W_,lock:Y_},q_="/static/svg/favourite_select.svg",Q_="/static/svg/favourite_not_select.svg";class Np extends Error{constructor(e,t){super(e),this.details=t}}function Qe(){const{access:n}=Vo(),e={credentials:"include",headers:{"Content-Type":"application/json","ngrok-skip-browser-warning":"1234",Authorization:`Bearer ${n}`}};async function t(a,o=null){const l=await fetch(a,{method:"POST",...e,body:o?JSON.stringify(o):null}),u=await l.json();if(!l.ok)throw new Np("Bd podczas wysyania danych",u);return{status:l.status,data:u}}async function r(a){const o=await fetch(a,{method:"GET",...e}),l=await o.json();return{status:o.status,data:l}}async function i(a,o=null){const l=await fetch(a,{method:"PUT",...e,body:o?JSON.stringify(o):null}),u=await l.json();if(!l.ok)throw new Np("Bd podczas wysyania danych",{...u,status:l.status});return{status:l.status,data:u}}async function s(a){return{status:(await fetch(a,{method:"DELETE",...e})).status}}return{createData:t,readData:r,updateData:i,deleteData:s}}function pg(n,e,t){const r=n.getQueryData(["favourite"]);if(!r)return;let i=r.data.devices,s=r.data.rooms;t==="device"?(i=i.filter(o=>o.id!==e.data.id),e.data.is_favourite&&i.push(e.data)):t==="room"&&(e.data.is_favourite?s.push(e.data):s=s.filter(o=>o.id!==e.data.id));const a={status:e.status,data:{rooms:s,devices:i}};n.setQueryData(["favourite"],a)}function X_(n,e){const t=n.getQueryData(["rooms"]);for(let r=0;r<t.data.length;r++)t.data[r].id===e.data.id&&(t.data[r]=e.data);n.setQueryData(["rooms"],t)}function yg(n,e){const t=e.data.room,r=n.getQueryData(["room",t]);if(!r)return;const i=r.data,s=i.device;for(let o=0;o<s.length;o++)s[o].id===e.data.id&&(s[o]=e.data);const a={...i,device:s};n.setQueryData(["room",t],{status:e.status,data:a})}function Z_(n){const e=cn(),{updateData:t}=Qe();return on({mutationFn:i=>t(Ae.favourite,i),onSuccess:(i,s)=>{pg(e,i,s.type),s.type==="room"?X_(e,i):yg(e,i),n&&n(!s.is_favourite)}})}function yS({isFavourite:n,onClick:e,className:t,id:r,type:i}){const s=Z_(e),a=()=>{s.mutate({id:r,is_favourite:n,type:i})};return L.jsx(L.Fragment,{children:L.jsx("img",{src:n?q_:Q_,alt:"Star",width:"24",height:"24",onClick:a,className:t})})}const J_="/static/svg/lock_unlocked.svg",eI="/static/svg/lock_locked.svg";function tI({visibility:n,className:e}){return L.jsx("img",{src:n==="public"?J_:eI,alt:"Lock",width:"24",height:"24",className:e})}function vS({room:n}){const[e,t]=b.useState(n.is_favourite),r=wr(),i=()=>{r(`/room/${n.id}/`)},s=()=>t(!e);return L.jsxs("div",{className:ld.container,children:[L.jsx(yS,{className:ld.star,isFavourite:e,onClick:s,id:n.id,type:"room"}),L.jsx(tI,{visibility:n.visibility,className:ld.lock}),L.jsx(br,{children:n.name}),L.jsxs("p",{children:["Aktywne urzadzenia: ",n.active_device_count]}),L.jsxs("p",{children:["Wszystkie urzadzenia: ",n.device_count]}),L.jsx(Ge,{callback:i,children:"Wybierz"})]})}function nI(){const{readData:n}=Qe(),{data:e,isLoading:t}=Wt({queryFn:()=>n(Ae.favourite),queryKey:["favourite"],staleTime:10*60*1e3});return{status:e==null?void 0:e.status,favouriteData:e==null?void 0:e.data,isLoading:t}}const rI="_container_ux06r_1",iI="_dot_ux06r_15",Up={container:rI,dot:iI};function ud({color:n,children:e}){return L.jsxs("div",{className:Up.container,children:[e,L.jsx("div",{className:Up.dot,style:{backgroundColor:n}})]})}const _l=n=>n.length>5?n.slice(0,5):n,sI="_card_xgrld_1",aI="_star_xgrld_33",oI="_wifi_xgrld_57",cd={card:sI,star:aI,wifi:oI},lI="/static/svg/wifi_perfect.svg",uI="/static/svg/wifi_medium.svg",cI="/static/svg/wifi_low.svg",dI="/static/svg/wifi_no.svg",hI=n=>n<=-80?dI:n<=-60?cI:n<=-50?uI:lI;function ES({strength:n,className:e}){const t=hI(n);return L.jsx(L.Fragment,{children:L.jsx("img",{src:t,alt:"Wifi",width:"24",height:"24",className:e})})}function Sc({isFavourite:n,name:e,wifiStrength:t,isOnline:r,id:i,children:s}){const[a,o]=b.useState(n);return L.jsxs("div",{className:cd.card,children:[L.jsx(br,{children:e}),L.jsx(yS,{isFavourite:a,onClick:()=>o(l=>!l),className:cd.star,id:i,type:"device"}),L.jsx(ES,{strength:r?t:-100,className:cd.wifi}),s]})}function fI(n){return L.jsxs(Sc,{isFavourite:n.is_favourite,isOnline:n.is_online,wifiStrength:n.wifi_strength,name:n.name,id:n.id,children:[L.jsxs("div",{children:[L.jsx(ud,{color:`rgb(${n.color_r},${n.color_g},${n.color_b})`,children:"Kolor ledw"}),L.jsx(ud,{color:n.led_mode?"green":"red",children:"Ledy"}),L.jsx(ud,{color:n.fluo_mode?"green":"red",children:"wietlwka"})]}),L.jsx("span",{children:n.mode?"Automat":"Manual"}),n.mode&&L.jsxs(L.Fragment,{children:[L.jsxs("span",{children:["Ledy ",_l(n.led_start)," -",_l(n.led_stop)]}),L.jsxs("span",{children:["wietlwka ",_l(n.fluo_start)," -",_l(n.fluo_stop)]})]}),L.jsx(Ri,{type:"button",to:`/aquarium/${n.id}/`,children:"Wybierz"})]})}function xc({action:n,device:e,event:t}){return L.jsxs("span",{children:[t,"-",n,"-",e]})}function gI(n){var e;return L.jsxs(Sc,{isFavourite:n.is_favourite,name:n.name,wifiStrength:n.wifi_strength,isOnline:n.is_online,id:n.id,children:[(e=n.events)==null?void 0:e.map(t=>L.jsx(xc,{action:t.action,device:t.device,event:t.event},t.id)),L.jsx(Ri,{type:"button",to:`/button/${n.id}/`,children:"Wybierz"})]})}const mI="_time_19j31_1",pI="_p_19j31_15",Bp={time:mI,p:pI};function $p(n){return n.slice(0,5)}function yI(n){return L.jsxs(Sc,{isFavourite:n.is_favourite,name:n.name,wifiStrength:n.brightness,isOnline:n.is_online,id:n.id,children:[L.jsxs("span",{children:["Jasno: ",L.jsxs("strong",{children:[n.brightness,"%"]})]}),L.jsxs("span",{children:["Czas wiecenia: ",L.jsxs("strong",{children:[n.lighting_time,"s"]})]}),L.jsxs("span",{className:Bp.time,children:[L.jsx("p",{className:Bp.p,children:"Czas wiecenia:"}),L.jsxs("strong",{children:[$p(n.light_start)," - ",$p(n.light_stop)]})]}),L.jsx(Ri,{type:"button",to:`/lamp/${n.id}/`,children:"Wybierz"})]})}const vI="_eventsContainer_1yrha_1",EI={eventsContainer:vI};function SI(n){var e;return L.jsxs(Sc,{isFavourite:n.is_favourite,name:n.name,wifiStrength:n.wifi_strength,isOnline:n.is_online,id:n.id,children:[L.jsx("div",{className:EI.eventsContainer,children:(e=n.events)==null?void 0:e.map(t=>L.jsx(xc,{action:t.action,device:t.device,event:t.event},t.id))}),L.jsxs("p",{children:["Ilo kart: ",n.cards.length]}),L.jsx(Ri,{type:"button",to:`/rfid/${n.id}`,children:"Wybierz"})]})}function vg(n){switch(n.fun){case"lamp":return b.createElement(yI,{...n,key:n.id});case"rfid":return b.createElement(SI,{...n,key:n.id});case"button":return b.createElement(gI,{...n,key:n.id});case"aquarium":return b.createElement(fI,{...n,key:n.id})}}const xI="_container_vhe6y_1",TI={container:xI};function LI(){const[n,e]=b.useState([]),[t,r]=b.useState([]),{favouriteData:i}=nI();return b.useEffect(()=>{i&&(e(i.rooms),r(i.devices))},[i]),!t||!n?null:L.jsxs("div",{className:TI.container,children:[n.map(s=>L.jsx(vS,{room:s},s.id)),t.map(s=>vg(s))]})}function AI(){const{readData:n}=Qe(),{data:e}=Wt({queryFn:()=>n(Ae.unassignedDevice),queryKey:["unassignedDevice"],staleTime:10*60*1e3});return{status:e==null?void 0:e.status,unassignedDeviceData:e==null?void 0:e.data}}function RI(n,e){const t=n.getQueryData(["unassignedDevice"]),r=t.status,s=t.data.filter(a=>a.id!==e);n.setQueryData(["unassignedDevice"],{status:r,data:s})}function _I(n,e){n.invalidateQueries({queryKey:["room",e]})}function II(){const{createData:n}=Qe(),e=cn();function t(){return on({mutationFn:r=>n(`${Ae.device}`,{device_id:r.deviceId,room_id:r.roomId}),onSuccess:r=>{RI(e,r.data.device_id),_I(e,r.data.room_id)}})}return{selectDevice:t}}const DI="_container_e40ts_1",CI="_header_e40ts_19",wI="_backArrow_e40ts_23",bI="_row_e40ts_29",Il={container:DI,header:CI,backArrow:wI,row:bI};function kI(){const n=as(),{status:e,unassignedDeviceData:t}=AI(),{selectDevice:r}=II(),i=r(),s=parseInt(n.id?n.id:"0");function a(o){i.mutate({deviceId:o,roomId:s})}return t?L.jsxs("div",{className:Il.container,children:[L.jsx(Ho,{className:Il.backArrow}),L.jsx(br,{className:Il.header,children:"Przypisz urzdzenie"}),e===404&&L.jsx("p",{children:"Brak nowo dodanych urzdze"}),e===200&&t.map(o=>L.jsxs("div",{className:Il.row,children:[L.jsx("p",{children:o.fun}),L.jsx("p",{children:o.last_seen.split("T")[1].slice(0,5)}),L.jsx(Ge,{callback:()=>a(o.id),children:"Przypisz"})]},o.id))]}):null}const PI="_container_lymwv_1",OI="_link_lymwv_18",FI="_sh02_lymwv_1",MI={container:PI,link:OI,sh02:FI},NI=()=>(wr(),b.useEffect(()=>{(async()=>{})()},[]),L.jsx("div",{className:MI.container}));function Xn(){return Xn=Object.assign?Object.assign.bind():function(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var r in t)({}).hasOwnProperty.call(t,r)&&(n[r]=t[r])}return n},Xn.apply(null,arguments)}function SS(n,e){if(n==null)return{};var t={};for(var r in n)if({}.hasOwnProperty.call(n,r)){if(e.includes(r))continue;t[r]=n[r]}return t}var ks=255,si=100,xS=n=>{var{r:e,g:t,b:r,a:i}=n,s=Math.max(e,t,r),a=s-Math.min(e,t,r),o=a?s===e?(t-r)/a:s===t?2+(r-e)/a:4+(e-t)/a:0;return{h:60*(o<0?o+6:o),s:s?a/s*si:0,v:s/ks*si,a:i}},UI=n=>{var{h:e,s:t,v:r,a:i}=n,s=(200-t)*r/si;return{h:e,s:s>0&&s<200?t*r/si/(s<=si?s:200-s)*si:0,l:s/2,a:i}},TS=n=>{var{r:e,g:t,b:r}=n,i=e<<16|t<<8|r;return"#"+(s=>new Array(7-s.length).join("0")+s)(i.toString(16))},BI=n=>{var{r:e,g:t,b:r,a:i}=n,s=typeof i=="number"&&(i*255|256).toString(16).slice(1);return""+TS({r:e,g:t,b:r,a:i})+(s||"")},LS=n=>xS($I(n)),$I=n=>{var e=n.replace("#","");/^#?/.test(n)&&e.length===3&&(n="#"+e.charAt(0)+e.charAt(0)+e.charAt(1)+e.charAt(1)+e.charAt(2)+e.charAt(2));var t=new RegExp("[A-Za-z0-9]{2}","g"),[r,i,s=0,a]=n.match(t).map(o=>parseInt(o,16));return{r,g:i,b:s,a:(a??255)/ks}},AS=n=>{var{h:e,s:t,v:r,a:i}=n,s=e/60,a=t/si,o=r/si,l=Math.floor(s)%6,u=s-Math.floor(s),c=ks*o*(1-a),d=ks*o*(1-a*u),h=ks*o*(1-a*(1-u));o*=ks;var f={};switch(l){case 0:f.r=o,f.g=h,f.b=c;break;case 1:f.r=d,f.g=o,f.b=c;break;case 2:f.r=c,f.g=o,f.b=h;break;case 3:f.r=c,f.g=d,f.b=o;break;case 4:f.r=h,f.g=c,f.b=o;break;case 5:f.r=o,f.g=c,f.b=d;break}return f.r=Math.round(f.r),f.g=Math.round(f.g),f.b=Math.round(f.b),Xn({},f,{a:i})},jI=n=>{var{r:e,g:t,b:r}=n;return{r:e,g:t,b:r}},GI=n=>{var{h:e,s:t,l:r}=n;return{h:e,s:t,l:r}},RS=n=>TS(AS(n)),KI=n=>{var{h:e,s:t,v:r}=n;return{h:e,s:t,v:r}},VI=n=>{var{r:e,g:t,b:r}=n,i=function(c){return c<=.04045?c/12.92:Math.pow((c+.055)/1.055,2.4)},s=i(e/255),a=i(t/255),o=i(r/255),l={};return l.x=s*.4124+a*.3576+o*.1805,l.y=s*.2126+a*.7152+o*.0722,l.bri=s*.0193+a*.1192+o*.9505,l},HI=n=>{var e,t,r,i,s,a,o,l,u;return typeof n=="string"&&_S(n)?(a=LS(n),l=n):typeof n!="string"&&(a=n),a&&(r=KI(a),s=UI(a),i=AS(a),u=BI(i),l=RS(a),t=GI(s),e=jI(i),o=VI(e)),{rgb:e,hsl:t,hsv:r,rgba:i,hsla:s,hsva:a,hex:l,hexa:u,xy:o}},_S=n=>/^#?([A-Fa-f0-9]{3,4}){1,2}$/.test(n);function jp(n){var e=b.useRef(n);return b.useEffect(()=>{e.current=n}),b.useCallback((t,r)=>e.current&&e.current(t,r),[])}var to=n=>"touches"in n,Gp=n=>{!to(n)&&n.preventDefault&&n.preventDefault()},Kp=function(e,t,r){return t===void 0&&(t=0),r===void 0&&(r=1),e>r?r:e<t?t:e},Vp=(n,e)=>{var t=n.getBoundingClientRect(),r=to(e)?e.touches[0]:e;return{left:Kp((r.pageX-(t.left+window.pageXOffset))/t.width),top:Kp((r.pageY-(t.top+window.pageYOffset))/t.height),width:t.width,height:t.height,x:r.pageX-(t.left+window.pageXOffset),y:r.pageY-(t.top+window.pageYOffset)}},zI=["prefixCls","className","onMove","onDown"],IS=gf.forwardRef((n,e)=>{var{prefixCls:t="w-color-interactive",className:r,onMove:i,onDown:s}=n,a=SS(n,zI),o=b.useRef(null),l=b.useRef(!1),[u,c]=b.useState(!1),d=jp(i),h=jp(s),f=v=>l.current&&!to(v)?!1:(l.current=to(v),!0),g=b.useCallback(v=>{Gp(v);var E=to(v)?v.touches.length>0:v.buttons>0;E&&o.current?d&&d(Vp(o.current,v),v):c(!1)},[d]),m=b.useCallback(()=>c(!1),[]),y=b.useCallback(v=>{var E=v?window.addEventListener:window.removeEventListener;E(l.current?"touchmove":"mousemove",g),E(l.current?"touchend":"mouseup",m)},[]);b.useEffect(()=>(y(u),()=>{u&&y(!1)}),[u,y]);var p=b.useCallback(v=>{Gp(v.nativeEvent),f(v.nativeEvent)&&(h&&h(Vp(o.current,v.nativeEvent),v.nativeEvent),c(!0))},[h]);return L.jsx("div",Xn({},a,{className:[t,r||""].filter(Boolean).join(" "),style:Xn({},a.style,{touchAction:"none"}),ref:o,tabIndex:0,onMouseDown:p,onTouchStart:p}))});IS.displayName="Interactive";var WI="rgb(255 255 255) 0px 0px 0px 1.5px, rgb(0 0 0 / 30%) 0px 0px 1px 1px inset, rgb(0 0 0 / 40%) 0px 0px 1px 2px",YI=n=>{var{className:e,color:t,left:r,top:i,style:s,prefixCls:a}=n,o=Xn({},s,{position:"absolute",top:i,left:r}),l=a+"-pointer "+(e||"");return L.jsx("div",{className:l,style:o,children:L.jsx("div",{className:a+"-fill",style:{width:10,height:10,transform:"translate(-5px, -5px)",boxShadow:WI,borderRadius:"50%",backgroundColor:"#fff"},children:L.jsx("div",{style:{inset:0,borderRadius:"50%",position:"absolute",backgroundColor:t}})})})},DS=Math.PI*2,qI=(n,e)=>(n%e+e)%e,QI=(n,e)=>Math.sqrt(n*n+e*e);function CS(n){var{width:e=0}=n,t=e/2;return{width:e,radius:t,cx:t,cy:t}}function XI(n,e){var{cx:t,cy:r}=CS(n),i=wS(n),s=(180+bS(n,e.h,!0))*(DS/360),a=e.s/100*i,o=n.direction==="clockwise"?-1:1;return{x:t+a*Math.cos(s)*o,y:r+a*Math.sin(s)*o}}function wS(n){var{width:e=0}=n;return e/2}function bS(n,e,t){var r=n.angle||0,i=n.direction;return t&&i==="clockwise"?e=r+e:i==="clockwise"?e=360-r+e:t&&i==="anticlockwise"?e=r+180-e:i==="anticlockwise"&&(e=r-e),qI(e,360)}function ZI(n,e,t){var{cx:r,cy:i}=CS(n),s=wS(n);e=r-e,t=i-t;var a=bS(n,Math.atan2(-t,-e)*(360/DS)),o=Math.min(QI(e,t),s);return{h:Math.round(a),s:Math.round(100/s*o)}}var JI=["prefixCls","radius","pointer","className","style","width","height","oval","direction","angle","color","onChange"],eD="conic-gradient(red, yellow, lime, aqua, blue, magenta, red)",tD="conic-gradient(red, magenta, blue, aqua, lime, yellow, red)",kS=gf.forwardRef((n,e)=>{var{prefixCls:t="w-color-wheel",radius:r=0,pointer:i,className:s,style:a,width:o=200,height:l=200,oval:u,direction:c="anticlockwise",angle:d=180,color:h,onChange:f}=n,g=SS(n,JI),m=typeof h=="string"&&_S(h)?LS(h):h||{},y=h?RS(m):"",p=XI({width:o},m),v={top:"0",left:"0",color:y},E=(I,R)=>{var x=ZI({width:o},o-I.x,l-I.y),D={h:x.h,s:x.s,v:m.v,a:m.a};f&&f(HI(D))},T={zIndex:1,transform:"translate("+p.x+"px, "+p.y+"px) "+(u==="x"||u==="X"?"scaleY(2)":u==="y"||u==="Y"?"scaleX(2)":"")},A=i&&typeof i=="function"?i(Xn({prefixCls:t,style:T},v)):L.jsx(YI,Xn({prefixCls:t,style:T},v));return L.jsxs(IS,Xn({className:[t,s||""].filter(Boolean).join(" ")},g,{style:Xn({position:"relative",width:o,transform:u==="x"||u==="X"?"scaleY(0.5)":u==="y"||u==="Y"?"scaleX(0.5)":"",height:l},a),ref:e,onMove:E,onDown:E,children:[A,L.jsx("div",{style:{position:"absolute",borderRadius:"50%",background:c==="anticlockwise"?eD:tD,transform:"rotateZ("+(d+90)+"deg)",inset:0}}),L.jsx("div",{style:{position:"absolute",borderRadius:"50%",background:"radial-gradient(circle closest-side, #fff, transparent)",inset:0}}),L.jsx("div",{style:{backgroundColor:"#000",borderRadius:"50%",position:"absolute",inset:0,opacity:typeof m.v=="number"?1-m.v/100:0}})]}))});kS.displayName="Wheel";const nD="_container_1xrdl_1",rD="_times_1xrdl_7",iD="_button_1xrdl_12",sD={container:nD,times:rD,button:iD};function aD(n){const e=n?`${Ae.aquarium}${n}/`:Ae.aquarium,t=n?["aquarium",n]:["aquarium"],{readData:r}=Qe(),{data:i,isLoading:s}=Wt({queryKey:t,queryFn:()=>r(e),staleTime:10*60*1e3});return{isLoading:s,status:i==null?void 0:i.status,aquariumData:i==null?void 0:i.data}}function oD(n){const{updateData:e}=Qe(),t=cn();return on({mutationFn:i=>e(`${Ae.aquarium}${n}/`,i),onSuccess:i=>{t.setQueryData(["aquarium",n],i),t.invalidateQueries({queryKey:["room",i.data.room]})}})}const lD="_input_1a92l_1",uD={input:lD},Ps=({initialTime:n,onChange:e,className:t})=>{const[r,i]=b.useState(n);b.useEffect(()=>{e(r)},[r]);const s=a=>{i(a.target.value.slice(0,5))};return L.jsx("input",{className:`${uD.input} ${t}`,type:"time",step:"60",onChange:s,value:r.slice(0,5)})},cD="_times_1kgiv_1",Hp={times:cD};function dD({dispatch:n,state:e,saveFn:t}){return L.jsxs(L.Fragment,{children:[L.jsx("p",{children:"Czas ledw"}),L.jsxs("div",{className:Hp.times,children:[L.jsx(Ps,{initialTime:e.led_start,onChange:r=>n({type:"set/ledStart",payload:r})}),L.jsx(Ps,{initialTime:e.led_stop,onChange:r=>n({type:"set/ledStop",payload:r})})]}),L.jsx("p",{children:"Czas wietlwki"}),L.jsxs("div",{className:Hp.times,children:[L.jsx(Ps,{initialTime:e.fluo_start,onChange:r=>n({type:"set/fluoStart",payload:r})}),L.jsx(Ps,{initialTime:e.fluo_stop,onChange:r=>n({type:"set/fluoStop",payload:r})})]}),L.jsx(Ge,{callback:t,children:"Zapisz"})]})}const hD="_container_1iqpa_1",fD="_wifiIcon_1iqpa_39",gD="_backArrow_1iqpa_55",dd={container:hD,wifiIcon:fD,backArrow:gD},mD="_changeName_1abgn_1",pD={changeName:mD},yD="_buttonContainer_1d9al_1",vD={buttonContainer:yD};function Sa({children:n}){return L.jsx("div",{className:vD.buttonContainer,children:n})}const ED="_container_z7bt8_1",SD={container:ED};function xD({onClose:n,onConfirm:e}){const[t,r]=b.useState("");function i(s){s.stopPropagation(),n()}return L.jsxs("section",{className:SD.container,children:[L.jsx(Lr,{name:"nazwa",type:"text",placeholder:"Nazwa",onChange:s=>r(s.target.value)}),L.jsxs(Sa,{children:[L.jsx(Ge,{callback:()=>e(t),children:"Zapisz"}),L.jsx(Ge,{callback:i,children:"Anuluj"})]})]})}function PS(n,e){const t=e.data.fun,r=e.data.id;n.setQueryData([t,r],e)}function TD(){const{createData:n,updateData:e}=Qe(),t=cn();function r(){return on({mutationFn:s=>n(Ae.device,s),onSuccess:s=>{console.log(s)}})}function i(s){return on({mutationFn:a=>e(`${Ae.device}${s}/`,a),onSuccess:a=>{PS(t,a),yg(t,a),a.data.is_favourite&&pg(t,a,"device")}})}return{createDevice:r,updateDevice:i}}function LD({children:n,type:e,id:t}){var u;const[r,i]=b.useState(!1),{updateDevice:s}=TD(),a=s(t);b.useEffect(()=>{a.isSuccess&&i(!1)},[a.isSuccess]);function o(c){a.mutate({name:c})}const l=a.error;return L.jsxs("div",{className:pD.changeName,onClick:()=>{i(!0)},children:[r&&L.jsxs(L.Fragment,{children:[L.jsx(xD,{onClose:()=>i(!1),onConfirm:o}),(l==null?void 0:l.details)&&L.jsx(Et,{type:"error",children:(u=l.details)==null?void 0:u.non_field_errors})]}),!r&&n]})}function xa({name:n,wifi_strength:e,is_online:t,children:r,className:i,id:s,events:a}){return L.jsxs("div",{className:`${dd.container} ${i}`,children:[L.jsx(ES,{className:dd.wifiIcon,strength:t?e:-100}),L.jsx(Ho,{className:dd.backArrow}),L.jsx(LD,{type:"device",id:s,children:L.jsx(br,{children:n})}),a==null?void 0:a.map(o=>L.jsx(xc,{action:o.action,device:o.device,event:o.event},o.id)),r]})}const AD={aquariumData:{},hsva:{h:0,s:0,v:100,a:1}};function RD(n,e){switch(e.type){case"set/init_value":return{...n,...e.payload};case"set/color":return{...n,aquariumData:{...n.aquariumData,color_r:e.payload.rgb.r,color_g:e.payload.rgb.g,color_b:e.payload.rgb.b},hsva:e.payload.hsva};case"set/ledStart":return{...n,aquariumData:{...n.aquariumData,led_start:e.payload}};case"set/ledStop":return{...n,aquariumData:{...n.aquariumData,led_stop:e.payload}};case"set/fluoStart":return{...n,aquariumData:{...n.aquariumData,fluo_start:e.payload}};case"set/fluoStop":return{...n,aquariumData:{...n.aquariumData,fluo_stop:e.payload}};default:return n}}const _D=()=>{var c;const n=as(),e=n.id?parseInt(n.id):0,{aquariumData:t,isLoading:r}=aD(e),i=oD(e),s=i.error,a=(c=i==null?void 0:i.data)==null?void 0:c.status,[o,l]=b.useReducer(RD,AD);b.useEffect(()=>{!r&&t&&l({type:"set/init_value",payload:{aquariumData:t,hsva:xS({r:t.color_r,g:t.color_g,b:t.color_b,a:1})}})},[r,t]);const u=d=>{if(d){i.mutate({...o.aquariumData,[d]:!o.aquariumData[d]});return}i.mutate(o.aquariumData)};return Object.keys(o.aquariumData).length===0?null:L.jsxs(xa,{name:o.aquariumData.name,is_online:o.aquariumData.is_online,wifi_strength:o.aquariumData.wifi_strength,className:sD.container,id:e,children:[s&&L.jsx(Et,{type:"error",children:" Bd w komunikacji z akwarium. "}),a===200&&L.jsx(Et,{type:"success",children:" Zapisano dane "}),L.jsx(kS,{color:o.hsva,onChange:d=>{l({type:"set/color",payload:{hsva:d.hsva,rgb:d.rgb}})}}),o.aquariumData.mode?L.jsx(dD,{dispatch:l,state:{led_start:o.aquariumData.led_start,led_stop:o.aquariumData.led_stop,fluo_start:o.aquariumData.fluo_start,fluo_stop:o.aquariumData.fluo_stop},saveFn:()=>u(void 0)}):L.jsxs(L.Fragment,{children:[L.jsx(Ge,{callback:()=>u(void 0),children:"Zapisz"}),L.jsx("p",{children:"Ledy"}),L.jsx(Ge,{callback:()=>u("led_mode"),children:o.aquariumData.led_mode?"Wycz":"Wcz"}),L.jsx("p",{children:"wietlwka"}),L.jsx(Ge,{callback:()=>u("fluo_mode"),children:o.aquariumData.fluo_mode?"Wycz":"Wcz"})]}),L.jsx(Ge,{callback:()=>u("mode"),children:o.aquariumData.mode?"Rczny":"Automatyczny"})]})},ID="_navbar_1qxnk_1",DD="_burger_1qxnk_9",CD="_active_1qxnk_53",wD="_links_1qxnk_73",bD="_link_1qxnk_73",dr={navbar:ID,burger:DD,active:CD,links:wD,link:bD},kD="_icon_yeoky_1",PD={icon:kD};function hs({onClick:n,svg:e,className:t}){return L.jsx("img",{src:e,onClick:n,width:"42",height:"42",className:`${PD.icon} ${t}`})}const OD="/static/svg/room.svg",FD="/static/svg/logout.svg",MD="/static/svg/router.svg",ND="/static/svg/device.svg",UD="/static/svg/dashboard.svg",BD="/static/svg/settings.svg";function $D(){const[n,e]=b.useState(!1),{deleteData:t}=Qe(),{logout:r}=Vo(),i=on({mutationFn:()=>t(Ae.logout),onSuccess:()=>{r()}});async function s(){i.mutate()}return L.jsx(L.Fragment,{children:L.jsxs("nav",{className:dr.navbar,children:[L.jsxs("div",{className:dr.burger,onClick:()=>e(a=>!a),children:[L.jsx("p",{className:n?dr.active:""}),L.jsx("p",{className:n?dr.active:""}),L.jsx("p",{className:n?dr.active:""})]}),L.jsxs("div",{className:`${dr.links} ${n?dr.active:dr.deactive}`,children:[L.jsx(bi,{to:"/",onClick:()=>e(a=>!a),children:L.jsx(hs,{svg:UD})}),L.jsx(bi,{to:"/room",onClick:()=>e(a=>!a),children:L.jsx(hs,{svg:OD})}),L.jsx(bi,{to:"/device",onClick:()=>e(a=>!a),children:L.jsx(hs,{svg:ND})}),L.jsx(bi,{to:"/router",onClick:()=>e(a=>!a),children:L.jsx(hs,{svg:MD})}),L.jsx(bi,{to:"/settings",onClick:()=>e(a=>!a),children:L.jsx(hs,{svg:BD})}),L.jsx(bi,{className:dr.link,onClick:s,to:"/",children:L.jsx(hs,{svg:FD})})]})]})})}const jD="_logo_1fxph_1",GD={logo:jD};function KD(){const n=wr();return L.jsx("div",{className:GD.logo,onClick:()=>n("/")})}function VD(n,e){const t=n.getQueryData(["unassignedDevice"]),r=Array.isArray(t.data)?[...t.data,e.data]:[e.data],i={status:e.status,data:r};n.setQueryData(["unassignedDevice"],i)}var su=(n=>(n.UPDATE_ROUTER="update_router",n.UPDATE_DEVICE="update_device",n.NEW_DEVICE_CONNECTED="new_device_connected",n))(su||{});function HD(n,e){const t={status:e.status,data:[e.data]};n.setQueryData(["router"],t)}function zD(){const[n,e]=b.useState(),t=cn();return b.useEffect(()=>{const r=t.getQueryData(["token"]);if(!r)return;const i=new WebSocket(`${m_}/ws/user/${r.token}/`);return i.onopen=s=>{console.log(s)},i.onmessage=s=>{const a=JSON.parse(s.data);switch(console.log(s.data),a.action){case su.UPDATE_ROUTER:HD(t,a.data);break;case su.UPDATE_DEVICE:PS(t,a.data),yg(t,a.data),pg(t,{status:a.data.status,data:a.data.data},"device");break;case su.NEW_DEVICE_CONNECTED:VD(t,a.data)}},i.onerror=s=>{},i.onclose=()=>{},e(i),()=>i.close()},[]),null}const WD=()=>{const{invalidToken:n}=Vo(),e=Ai();return n?L.jsx(nR,{to:"/login",state:{from:e},replace:!0}):L.jsxs(L.Fragment,{children:[L.jsx(zD,{}),L.jsx(mg,{}),L.jsx(KD,{}),L.jsx($D,{}),L.jsx(rR,{})]})},YD="_container_zrhuq_1",qD="_link_zrhuq_35",QD="_sh02_zrhuq_1",XD={container:YD,link:qD,sh02:QD},ZD=()=>(wr(),L.jsx("div",{className:XD.container,children:L.jsx(Ho,{})})),JD="_label_mz9tl_1",eC="_name_mz9tl_11",Bn={label:JD,name:eC};function tC(n){const e=n?`${Ae.lamp}${n}/`:Ae.lamp,t=n?["lamp",n]:["lamp"],{readData:r}=Qe(),{data:i,isLoading:s}=Wt({queryFn:()=>r(e),queryKey:t,staleTime:10*60*1e3});return{status:i==null?void 0:i.status,lampData:i==null?void 0:i.data,isLoading:s}}const nC="_input_1q4bw_1",rC={input:nC};function iC({value:n,onChange:e,className:t}){return L.jsx("input",{className:`${rC.input} ${t}`,type:"number",onChange:r=>e?e(parseInt(r.target.value)):()=>{},value:n})}const sC="_range_11c6s_1",aC={range:sC};function zp({onChange:n,min:e,max:t,value:r,className:i}){return L.jsx("input",{className:`${aC.range} ${i}`,type:"range",onChange:s=>n&&n(parseInt(s.target.value)),value:r,min:e,max:t})}function oC(n,e){const t={...n},r=[...n.device],i=r.findIndex(s=>s.id===e.id);return r[i]=e,t.device=r,t}function lC(){const{updateData:n}=Qe(),e=cn();function t(r){return on({mutationFn:i=>n(`${Ae.lamp}${r}/`,i),onSuccess:i=>{e.setQueryData(["lamp",r],i);const s=e.getQueryData(["room",i.data.room]);if(!s)return;const a=s.status,o=oC(s.data,i.data);e.setQueryData(["room",r],{status:a,data:o})}})}return{updateLamp:t}}function uC(n,e){switch(e.type){case"INIT_DATA":return{...n,...e.payload};case"set/light_start":return{...n,light_start:e.payload};case"set/light_stop":return{...n,light_stop:e.payload};case"set/brightness":return{...n,brightness:e.payload};case"set/lighting_time":return{...n,lighting_time:e.payload};case"set/step":return{...n,step:e.payload};default:return n}}const cC=()=>{const n=as(),[e,t]=b.useReducer(uC,null),r=parseInt(n.id?n.id:"0"),{lampData:i}=tC(r),{updateLamp:s}=lC(),a=s(r);b.useEffect(()=>{i&&t({type:"INIT_DATA",payload:i})},[i]);function o(){a.mutate(e)}return e?L.jsxs(xa,{name:e.name,wifi_strength:e.wifi_strength,is_online:e.is_online,id:e.id,children:[a.isSuccess&&L.jsx(Et,{type:"success",children:"Zapisano dane"}),a.isError&&L.jsx(Et,{type:"error",children:"Wystpi bad podczas zapisu"}),L.jsxs("label",{className:Bn.label,children:[L.jsx("span",{className:Bn.name,children:"Godzina rozpoczcia"}),L.jsx(Ps,{initialTime:e.light_start,onChange:l=>t({type:"set/light_start",payload:l})})]}),L.jsxs("label",{className:Bn.label,children:[L.jsx("span",{className:Bn.name,children:"Godzina zakoczenia"}),L.jsx(Ps,{initialTime:e.light_stop,onChange:l=>t({type:"set/light_stop",payload:l})})]}),L.jsxs("label",{className:Bn.label,children:[L.jsx("span",{className:Bn.name,children:"Czas wiecenia [s]"}),L.jsx(iC,{value:e.lighting_time,onChange:l=>t({type:"set/lighting_time",payload:l})})]}),L.jsxs("label",{className:Bn.label,children:[L.jsxs("span",{className:Bn.name,children:["Jasno",` ${e.brightness} %`]}),L.jsx(zp,{value:e.brightness,onChange:l=>t({type:"set/brightness",payload:l}),min:"0",max:"100"})]}),L.jsxs("label",{className:Bn.label,children:[L.jsxs("span",{className:Bn.name,children:["Szybko",` ${e.step} %`]}),L.jsx(zp,{value:e.step,onChange:l=>t({type:"set/step",payload:l}),min:"0",max:"100"})]}),L.jsx(Ge,{callback:o,children:"Zapisz"})]}):L.jsx("div",{})};function dC(){const{readData:n}=Qe(),{data:e}=Wt({queryKey:["device"],queryFn:()=>n(Ae.device),staleTime:10*60*1e3});return{status:e==null?void 0:e.status,deviceData:e==null?void 0:e.data}}const hC="_container_7wvt7_1",fC="_expanded_7wvt7_29",gC="_input_7wvt7_37",mC="_searchIcon_7wvt7_69",Fa={container:hC,expanded:fC,input:gC,searchIcon:mC},pC="/static/svg/search.svg";function Eg({onChange:n,className:e}){const[t,r]=b.useState(!1),i=b.useRef(null);function s(){i.current&&i.current.focus(),r(a=>!a)}return L.jsxs("div",{className:`${Fa.container} ${t&&Fa.expanded}`,children:[L.jsx("img",{src:pC,width:"25px",height:"25px",className:Fa.searchIcon,onClick:s}),L.jsx("input",{ref:i,type:"text",onChange:a=>n(a.target.value),className:`${Fa.input} ${t&&Fa.expanded} ${e}`})]})}const yC="_container_26ai4_1",vC="_deviceContainer_26ai4_9",EC="_inputContainer_26ai4_33",hd={container:yC,deviceContainer:vC,inputContainer:EC};function SC(){const{deviceData:n}=dC(),[e,t]=b.useState([]);b.useEffect(()=>{n&&t(n)},[n]);const r=i=>{const s=i.toLowerCase(),a=n.filter(o=>o.name.toLowerCase().includes(s));t(a)};return e?L.jsxs("div",{className:hd.container,children:[L.jsx("div",{className:hd.inputContainer,children:L.jsx(Eg,{onChange:r})}),L.jsx("div",{className:hd.deviceContainer,children:e.map(i=>vg(i))})]}):null}const xC="_container_irbr7_1",TC="_form_irbr7_27",Wp={container:xC,form:TC},LC="_container_8nn2y_1",AC="_input_8nn2y_8",Yp={container:LC,input:AC},qp=({name:n,onSelect:e,value:t,checked:r})=>L.jsxs("div",{className:Yp.container,children:[L.jsx("input",{id:n,type:"radio",name:"select",value:t,className:Yp.input,onChange:e,defaultChecked:r}),L.jsx("label",{htmlFor:n,children:n})]});function RC({onClose:n}){var c,d;const e=cn(),[t,r]=b.useState({name:"",visibility:"public"}),{createData:i}=Qe(),s=on({mutationFn:h=>i(Ae.room,h),onSuccess:()=>{e.invalidateQueries({queryKey:["rooms"]}),n()}});function a(h){r({...t,visibility:h.target.value})}function o(h){r({...t,name:h.target.value})}const l=h=>{h.preventDefault(),s.mutate(t)},u=s.error;return L.jsx("section",{className:Wp.container,children:L.jsxs("form",{className:Wp.form,children:[L.jsx(br,{children:"Dodaj nowy pokoj"}),L.jsx(Lr,{name:"nazwa",type:"text",placeholder:"Nazwa",onChange:o}),((c=u==null?void 0:u.details)==null?void 0:c.name)&&L.jsx(Et,{type:"error",children:u.details.name[0]}),L.jsx(qp,{name:"Oglny",value:"public",onSelect:a,checked:!0}),L.jsx(qp,{name:"Prywatny",value:"private",onSelect:a}),((d=u==null?void 0:u.details)==null?void 0:d.visibility)&&L.jsx(Et,{type:"error",children:u.details.visibility[0]}),L.jsxs(Sa,{children:[L.jsx(Ge,{callback:l,children:"Dodaj"}),L.jsx(Ge,{callback:n,children:"Zamknij"})]})]})})}const _C="_rooms_lp4n1_1",IC={rooms:_C};function DC(){const[n,e]=b.useState(!1),{readData:t}=Qe(),{data:r}=Wt({queryKey:["rooms"],queryFn:()=>t(Ae.room),staleTime:10*60*60*1e3});return L.jsxs(L.Fragment,{children:[L.jsx(Ge,{callback:()=>e(!0),children:"Dodaj"}),n&&L.jsx(RC,{onClose:()=>e(!1)}),L.jsx("div",{className:IC.rooms,children:r==null?void 0:r.data.map(i=>L.jsx(vS,{room:i},i.id))})]})}function CC(n){const{readData:e}=Qe(),t=n?`${Ae.room}${n}/`:Ae.room,r=n?["room",n]:["room"],{data:i}=Wt({queryKey:r,queryFn:()=>e(t),staleTime:10*60*1e3});return{status:i==null?void 0:i.status,roomData:i==null?void 0:i.data}}const wC="_container_q9mo6_1",bC="_deviceContainer_q9mo6_5",Qp={container:wC,deviceContainer:bC};function kC(){const n=as(),{roomData:e}=CC(Number(n.id)),[t,r]=b.useState([]);b.useEffect(()=>{e&&r(e.device)},[e]);function i(s){const a=s.toLowerCase(),o=e.device.filter(l=>l.name.toLowerCase().includes(a));r(o)}return e?L.jsxs("div",{className:Qp.container,children:[L.jsxs(Sa,{children:[L.jsx(Ge,{children:"Edytuj"}),L.jsx(Eg,{onChange:i}),L.jsx(Ri,{type:"button",to:`/room/${n.id}/add`,children:"Dodaj urzdzenie"})]}),L.jsx("div",{className:Qp.deviceContainer,children:t.map(s=>vg(s))})]}):L.jsx("div",{})}function PC(n){const e=n?`${Ae.rfid}${n}/`:Ae.rfid,t=n?["rfid",n]:["rfid"],{readData:r}=Qe(),{data:i,isLoading:s}=Wt({queryFn:()=>r(e),queryKey:t,staleTime:10*60*1e3});return{status:i==null?void 0:i.status,rfidData:i==null?void 0:i.data,isLoading:s}}const OC="_card_64yhy_1",FC="_lastUsed_64yhy_37",MC="_headerName_64yhy_69",NC="_header_64yhy_69",Ma={card:OC,lastUsed:FC,delete:"_delete_64yhy_51",headerName:MC,header:NC},OS="/static/svg/delete.svg";function UC(n){const e=new Date(n),t=e.getFullYear(),r=String(e.getMonth()+1).padStart(2,"0"),i=String(e.getDate()).padStart(2,"0"),s=String(e.getHours()).padStart(2,"0"),a=String(e.getMinutes()).padStart(2,"0");return`${s}:${a} ${i}.${r}.${t} `}const BC="_container_1wzpg_1",Xp={container:BC};function FS({name:n,onConfirm:e,onCancel:t,className:r}){return L.jsxs("div",{className:`${Xp.container} ${r}`,children:[L.jsxs("p",{className:Xp.text,children:["Czy na pewno chcesz usun ",L.jsx("b",{children:n}),"?"]}),L.jsxs(Sa,{children:[L.jsx(Ge,{callback:e,children:"Tak"}),L.jsx(Ge,{callback:t,children:"Nie"})]})]})}function MS(){const n=cn(),{deleteData:e,createData:t}=Qe();function r(s){return on({mutationFn:()=>e(`${Ae.card}${s}/`)})}function i(s){return on({mutationFn:a=>t(`${Ae.card}`,{name:a,rfid:s}),onSuccess:a=>{n.setQueryData(["rfid",s],a)}})}return{mutationDelete:r,mutationCreate:i}}function $C({card:n}){const[e,t]=b.useState(!1),{mutationDelete:r}=MS(),i=r(n.id,n.rfid),s=()=>{i.mutate()};return L.jsxs("div",{className:Ma.card,children:[L.jsxs("div",{className:Ma.header,children:[L.jsx(br,{className:Ma.headerName,children:n.name}),L.jsx("img",{src:OS,width:24,height:24,className:Ma.delete,onClick:()=>t(!0)})]}),L.jsxs("div",{className:Ma.lastUsed,children:["Ostatnie uycie:",L.jsx("p",{children:UC(n.last_used)})]}),e&&L.jsx(FS,{onConfirm:s,onCancel:()=>t(!1)})]})}const jC="_container_1xt2q_1",GC="_cards_1xt2q_7",KC="_div_1xt2q_29",fd={container:jC,cards:GC,div:KC},VC="_form_1e9sz_29",Zp={form:VC};function HC({rfidID:n,handleAddFunction:e}){var a;const{mutationCreate:t}=MS(),r=t(n);b.useEffect(()=>{r.isSuccess&&e("success")},[r.isSuccess]);function i(o){o.preventDefault();const u=o.target.card.value;r.mutate(u)}const s=r.error;return L.jsx("div",{className:Zp.container,children:L.jsxs("form",{onSubmit:i,className:Zp.form,children:[L.jsx(br,{children:"Dodaj karte"}),L.jsx(Lr,{name:"card",type:"text",placeholder:"Nazwa karty"}),(s==null?void 0:s.details)&&L.jsx(Et,{type:"error",children:s.details.non_field_errors}),((a=s==null?void 0:s.details)==null?void 0:a.name)&&L.jsx(Et,{type:"error",children:"To pole jest wymagane"}),L.jsxs(Sa,{children:[L.jsx(Ge,{callback:()=>{},children:"Dodaj"}),L.jsx(Ge,{callback:()=>{e("closed")},children:"Zamknij"})]})]})})}function zC(){const[n,e]=b.useState([]),t=as(),r=t.id?parseInt(t.id):0,{rfidData:i,status:s}=PC(r),[a,o]=b.useState(!1);if(b.useEffect(()=>{i&&e(i.cards)},[i]),!i)return null;function l(c){const d=c.toLowerCase(),h=i.cards.filter(f=>f.name.toLowerCase().includes(d));e(h)}const u=s===400?"Nie udao si doda karty":"Karta jest ju dodana";return L.jsxs(xa,{name:i.name,wifi_strength:i.wifi_strength,is_online:i.is_online,id:i.id,className:fd.container,events:i.events,children:[L.jsx(Ri,{type:"button",to:`/rfid/${i.id}/event/wizard/`,children:"Ustawienia zdarzenia"}),L.jsxs("div",{className:fd.div,children:[L.jsx(Ge,{callback:()=>{o(!0)},children:"Dodaj Karte"}),L.jsx(Eg,{onChange:l})]}),a&&L.jsx(HC,{handleAddFunction:()=>o(!1),rfidID:i.id}),L.jsxs("div",{className:fd.cards,children:[i.pending.includes("add_tag")&&L.jsx("p",{children:"Prosze przyoy kart do czytnika."}),s&&s>=400&&L.jsx(Et,{type:"error",children:u}),n.map(c=>L.jsx($C,{card:c},c.id))]})]})}function WC(){const{readData:n}=Qe(),{data:e}=Wt({queryKey:["router"],queryFn:()=>n(Ae.router),staleTime:10*60*1e3});return{status:e==null?void 0:e.status,routerData:e==null?void 0:e.data}}const YC="_container_rzjqm_1",qC={container:YC};function QC(){const{createData:n}=Qe(),e=cn();function t(){return on({mutationFn:r=>n(Ae.router,{mac:r}),onSuccess:()=>{e.invalidateQueries({queryKey:["router"]})}})}return{createRouter:t}}function XC(){const[n,e]=b.useState(""),{createRouter:t}=QC(),r=t();function i(){r.mutate(n)}const s=r.error;return L.jsxs(xa,{name:"Dodaj router",wifi_strength:-100,is_online:!1,className:qC.container,id:0,children:[L.jsx(Lr,{name:"router",type:"text",placeholder:"Podaj adres mac",onChange:a=>e(a.target.value)}),(s==null?void 0:s.details)&&L.jsx(Et,{type:"error",children:s.details[Object.keys(s.details)[0]]}),L.jsx(Ge,{callback:i,children:"Dodaj"})]})}const ZC="_container_105s7_1",JC={container:ZC};function ew(){const{routerData:n,status:e}=WC();if(!n)return null;const t=n[0];return e===404?L.jsx(XC,{}):L.jsxs(xa,{name:"Ruter",wifi_strength:0,is_online:t.is_online,className:JC.container,id:t.id,children:[L.jsxs("p",{children:["IP: ",t.ip]}),L.jsxs("p",{children:["Mac: ",t.mac]}),L.jsxs("p",{children:["Przypisane urzdzenia: ",t.connected_devices]}),L.jsxs("p",{children:["Urzdzenia aktywne: ",t.online_device]})]})}function tw(n,e){const{readData:t}=Qe(),{data:r}=Wt({queryKey:["availableAction",n],queryFn:()=>t(`${Ae.event}?id=${n}&fun=${e}`),staleTime:10*60*1e3});return{status:r==null?void 0:r.status,availableAction:r==null?void 0:r.data}}const nw="_container_f6x04_1",rw="_section_f6x04_17",iw="_eventBox_f6x04_49",sw="_deleteIcon_f6x04_67",aw="_confirmDelete_f6x04_105",ow="_backArrow_f6x04_129",fs={container:nw,section:rw,eventBox:iw,deleteIcon:sw,confirmDelete:aw,backArrow:ow},lw="_container_1kmrd_1",uw="_addEventForm_1kmrd_25",Jp={container:lw,addEventForm:uw};function cw(n){const{readData:e}=Qe(),{data:t}=Wt({queryKey:["deviceByFunction",n],queryFn:()=>e(`${Ae.device}?function=${n}`),staleTime:10*60*1e3});return{status:t==null?void 0:t.status,deviceByFunction:t==null?void 0:t.data}}function dw(n){const{readData:e}=Qe(),{data:t}=Wt({queryKey:["actionByFunction",n],queryFn:()=>e(`${Ae.action}?function=${n}`),staleTime:10*60*1e3});return{status:t==null?void 0:t.status,actionByFunction:t==null?void 0:t.data}}function NS(){const{createData:n,deleteData:e}=Qe(),t=cn();function r(s){return on({mutationFn:a=>n(`${Ae.event}${s}/`,a),onSuccess:a=>{const o=t.getQueryData(["availableAction",s]);if(o){const l={...o,data:{...o.data,active_events:[...o.data.active_events,a.data]}};t.setQueryData(["availableAction",s],l)}}})}function i(s,a){return on({mutationFn:()=>e(`${Ae.event}${a}/`),onSuccess:()=>{const o=t.getQueryData(["availableAction",s]);if(o){const l={...o,data:{...o.data,active_events:o.data.active_events.filter(u=>u.id!==a)}};t.setQueryData(["availableAction",s],l)}}})}return{createEvent:r,deleteEvent:i}}function hw({availableEvent:n,availableDeviceModels:e,device_id:t,onClose:r}){const[i,s]=b.useState(""),[a,o]=b.useState(""),[l,u]=b.useState(""),[c,d]=b.useState(0),[h,f]=b.useState(!1),{deviceByFunction:g}=cw(i),{actionByFunction:m}=dw(i),{createEvent:y}=NS(),p=y(t);b.useEffect(()=>{p.isSuccess&&r()},[p.isSuccess]);function v(){if(!a||!i||!c||!l){f(!0);return}const E={target_device:c,action:l,device:t,event:a,extra_settings:{}};p.mutate(E)}return L.jsx("div",{className:Jp.container,children:L.jsxs("div",{className:Jp.addEventForm,children:[L.jsxs("select",{onChange:E=>o(E.target.value),children:[L.jsx("option",{children:"Wybierz event"}),n.map((E,T)=>L.jsx("option",{children:E},T))]}),L.jsxs("select",{onChange:E=>s(E.target.value),children:[L.jsx("option",{children:"Wybierz typ"}),e.map((E,T)=>L.jsx("option",{children:E},T))]}),L.jsxs("select",{onChange:E=>d(parseInt(E.target.selectedOptions[0].id)),children:[L.jsx("option",{children:"Wybierz urzadzenie"}),g==null?void 0:g.map(E=>L.jsx("option",{id:E.id.toString(),children:E.name},E.id))]}),L.jsxs("select",{onChange:E=>u(E.target.value),children:[L.jsx("option",{children:"Wybierz akcje"}),m==null?void 0:m.map((E,T)=>L.jsx("option",{children:E},T))]}),h&&L.jsx(Et,{type:"error",children:"Wypenij wszystkie pola"}),L.jsxs(Sa,{children:[L.jsx(Ge,{callback:r,children:"Anuluj"}),L.jsx(Ge,{callback:v,children:"Dodaj"})]})]})})}function fw(){var d,h;const n=as(),e=parseInt(n.id?n.id:"0"),[t,r]=b.useState(!1),[i,s]=b.useState(!1),[a,o]=b.useState(0),{availableAction:l}=tw(e,n.deviceFun?n.deviceFun:""),{deleteEvent:u}=NS(),c=u(e,a);return l?L.jsx("div",{className:fs.container,children:L.jsxs("section",{className:fs.section,children:[L.jsx(Ho,{className:fs.backArrow}),((d=l.active_events)==null?void 0:d.length)===0&&L.jsx("p",{children:"Brak akcji"}),(h=l.active_events)==null?void 0:h.map(f=>L.jsxs("div",{className:fs.eventBox,children:[L.jsx(xc,{action:f.action,device:f.device,event:f.event},`${f.id} DE`),L.jsx("img",{src:OS,alt:"Delete",width:"24",height:"24",className:fs.deleteIcon,onClick:()=>{s(!0),o(f.id)}},`${f.id} img`)]},`${f.id} div`)),i&&L.jsx(FS,{onCancel:()=>s(!1),onConfirm:()=>{c.mutate(),s(!1)},className:fs.confirmDelete,name:"akcje"}),L.jsx(Ge,{callback:()=>{r(!0)},children:"Dodaj akcje"}),t&&L.jsx(hw,{availableEvent:l.available_events,availableDeviceModels:l.models,device_id:e,onClose:()=>{r(!1)}})]})}):null}function gw(n){const{readData:e}=Qe(),t=n?`${Ae.button}${n}/`:Ae.button,r=n?["button",n]:["button"],{data:i}=Wt({queryKey:r,queryFn:()=>e(t),staleTime:10*60*1e3});return{status:i==null?void 0:i.status,buttonData:i==null?void 0:i.data}}const mw="_container_ej8og_1",pw={container:mw};function yw(){const n=as(),e=parseInt(n.id?n.id:"0"),{buttonData:t}=gw(e);return console.log(t),t?L.jsx(xa,{name:t.name,wifi_strength:t.wifi_strength,is_online:t.is_online,id:t.id,className:pw.container,events:t.events,children:L.jsx(Ri,{type:"button",to:`/button/${t.id}/event/wizard/`,children:"Ustawienia zdarzenia"})}):null}const vw="_container_1eixp_1",Ew={container:vw},Sw="_container_uw0tu_1",xw={container:Sw},Tw="_container_g7quk_1",Lw="_selected_g7quk_25",e0={container:Tw,selected:Lw};function Dl({onClick:n,value:e,name:t,children:r}){const i=e===t;return L.jsx("div",{className:`${e0.container} ${i?e0.selected:""}`,onClick:()=>n(t),children:r})}function Aw({onChange:n,value:e}){return L.jsxs("div",{className:xw.container,children:[L.jsx(Dl,{onClick:n,value:e,name:"passowrdChange",children:"Zmiana hasa"}),L.jsx(Dl,{onClick:n,value:e,name:"homeChange",children:"Zmiana domu"}),L.jsx(Dl,{onClick:n,value:e,name:"homeCode",children:"Kod domu"}),L.jsx(Dl,{onClick:n,value:e,name:"homeLeave",children:"Wyjd z domu"})]})}const Rw="_container_n7tf4_1",_w={container:Rw};function Iw(){return L.jsx("div",{className:_w.container,children:"ChangePasswordForm"})}const Z=Number.isFinite||function(n){return typeof n=="number"&&isFinite(n)},Dw=Number.isSafeInteger||function(n){return typeof n=="number"&&Math.abs(n)<=Cw},Cw=Number.MAX_SAFE_INTEGER||9007199254740991;let re=function(n){return n.NETWORK_ERROR="networkError",n.MEDIA_ERROR="mediaError",n.KEY_SYSTEM_ERROR="keySystemError",n.MUX_ERROR="muxError",n.OTHER_ERROR="otherError",n}({}),O=function(n){return n.KEY_SYSTEM_NO_KEYS="keySystemNoKeys",n.KEY_SYSTEM_NO_ACCESS="keySystemNoAccess",n.KEY_SYSTEM_NO_SESSION="keySystemNoSession",n.KEY_SYSTEM_NO_CONFIGURED_LICENSE="keySystemNoConfiguredLicense",n.KEY_SYSTEM_LICENSE_REQUEST_FAILED="keySystemLicenseRequestFailed",n.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED="keySystemServerCertificateRequestFailed",n.KEY_SYSTEM_SERVER_CERTIFICATE_UPDATE_FAILED="keySystemServerCertificateUpdateFailed",n.KEY_SYSTEM_SESSION_UPDATE_FAILED="keySystemSessionUpdateFailed",n.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED="keySystemStatusOutputRestricted",n.KEY_SYSTEM_STATUS_INTERNAL_ERROR="keySystemStatusInternalError",n.KEY_SYSTEM_DESTROY_MEDIA_KEYS_ERROR="keySystemDestroyMediaKeysError",n.KEY_SYSTEM_DESTROY_CLOSE_SESSION_ERROR="keySystemDestroyCloseSessionError",n.KEY_SYSTEM_DESTROY_REMOVE_SESSION_ERROR="keySystemDestroyRemoveSessionError",n.MANIFEST_LOAD_ERROR="manifestLoadError",n.MANIFEST_LOAD_TIMEOUT="manifestLoadTimeOut",n.MANIFEST_PARSING_ERROR="manifestParsingError",n.MANIFEST_INCOMPATIBLE_CODECS_ERROR="manifestIncompatibleCodecsError",n.LEVEL_EMPTY_ERROR="levelEmptyError",n.LEVEL_LOAD_ERROR="levelLoadError",n.LEVEL_LOAD_TIMEOUT="levelLoadTimeOut",n.LEVEL_PARSING_ERROR="levelParsingError",n.LEVEL_SWITCH_ERROR="levelSwitchError",n.AUDIO_TRACK_LOAD_ERROR="audioTrackLoadError",n.AUDIO_TRACK_LOAD_TIMEOUT="audioTrackLoadTimeOut",n.SUBTITLE_LOAD_ERROR="subtitleTrackLoadError",n.SUBTITLE_TRACK_LOAD_TIMEOUT="subtitleTrackLoadTimeOut",n.FRAG_LOAD_ERROR="fragLoadError",n.FRAG_LOAD_TIMEOUT="fragLoadTimeOut",n.FRAG_DECRYPT_ERROR="fragDecryptError",n.FRAG_PARSING_ERROR="fragParsingError",n.FRAG_GAP="fragGap",n.REMUX_ALLOC_ERROR="remuxAllocError",n.KEY_LOAD_ERROR="keyLoadError",n.KEY_LOAD_TIMEOUT="keyLoadTimeOut",n.BUFFER_ADD_CODEC_ERROR="bufferAddCodecError",n.BUFFER_INCOMPATIBLE_CODECS_ERROR="bufferIncompatibleCodecsError",n.BUFFER_APPEND_ERROR="bufferAppendError",n.BUFFER_APPENDING_ERROR="bufferAppendingError",n.BUFFER_STALLED_ERROR="bufferStalledError",n.BUFFER_FULL_ERROR="bufferFullError",n.BUFFER_SEEK_OVER_HOLE="bufferSeekOverHole",n.BUFFER_NUDGE_ON_STALL="bufferNudgeOnStall",n.ASSET_LIST_LOAD_ERROR="assetListLoadError",n.ASSET_LIST_LOAD_TIMEOUT="assetListLoadTimeout",n.ASSET_LIST_PARSING_ERROR="assetListParsingError",n.INTERSTITIAL_ASSET_ITEM_ERROR="interstitialAssetItemError",n.INTERNAL_EXCEPTION="internalException",n.INTERNAL_ABORTED="aborted",n.ATTACH_MEDIA_ERROR="attachMediaError",n.UNKNOWN="unknown",n}({}),S=function(n){return n.MEDIA_ATTACHING="hlsMediaAttaching",n.MEDIA_ATTACHED="hlsMediaAttached",n.MEDIA_DETACHING="hlsMediaDetaching",n.MEDIA_DETACHED="hlsMediaDetached",n.MEDIA_ENDED="hlsMediaEnded",n.STALL_RESOLVED="hlsStallResolved",n.BUFFER_RESET="hlsBufferReset",n.BUFFER_CODECS="hlsBufferCodecs",n.BUFFER_CREATED="hlsBufferCreated",n.BUFFER_APPENDING="hlsBufferAppending",n.BUFFER_APPENDED="hlsBufferAppended",n.BUFFER_EOS="hlsBufferEos",n.BUFFERED_TO_END="hlsBufferedToEnd",n.BUFFER_FLUSHING="hlsBufferFlushing",n.BUFFER_FLUSHED="hlsBufferFlushed",n.MANIFEST_LOADING="hlsManifestLoading",n.MANIFEST_LOADED="hlsManifestLoaded",n.MANIFEST_PARSED="hlsManifestParsed",n.LEVEL_SWITCHING="hlsLevelSwitching",n.LEVEL_SWITCHED="hlsLevelSwitched",n.LEVEL_LOADING="hlsLevelLoading",n.LEVEL_LOADED="hlsLevelLoaded",n.LEVEL_UPDATED="hlsLevelUpdated",n.LEVEL_PTS_UPDATED="hlsLevelPtsUpdated",n.LEVELS_UPDATED="hlsLevelsUpdated",n.AUDIO_TRACKS_UPDATED="hlsAudioTracksUpdated",n.AUDIO_TRACK_SWITCHING="hlsAudioTrackSwitching",n.AUDIO_TRACK_SWITCHED="hlsAudioTrackSwitched",n.AUDIO_TRACK_LOADING="hlsAudioTrackLoading",n.AUDIO_TRACK_LOADED="hlsAudioTrackLoaded",n.AUDIO_TRACK_UPDATED="hlsAudioTrackUpdated",n.SUBTITLE_TRACKS_UPDATED="hlsSubtitleTracksUpdated",n.SUBTITLE_TRACKS_CLEARED="hlsSubtitleTracksCleared",n.SUBTITLE_TRACK_SWITCH="hlsSubtitleTrackSwitch",n.SUBTITLE_TRACK_LOADING="hlsSubtitleTrackLoading",n.SUBTITLE_TRACK_LOADED="hlsSubtitleTrackLoaded",n.SUBTITLE_TRACK_UPDATED="hlsSubtitleTrackUpdated",n.SUBTITLE_FRAG_PROCESSED="hlsSubtitleFragProcessed",n.CUES_PARSED="hlsCuesParsed",n.NON_NATIVE_TEXT_TRACKS_FOUND="hlsNonNativeTextTracksFound",n.INIT_PTS_FOUND="hlsInitPtsFound",n.FRAG_LOADING="hlsFragLoading",n.FRAG_LOAD_EMERGENCY_ABORTED="hlsFragLoadEmergencyAborted",n.FRAG_LOADED="hlsFragLoaded",n.FRAG_DECRYPTED="hlsFragDecrypted",n.FRAG_PARSING_INIT_SEGMENT="hlsFragParsingInitSegment",n.FRAG_PARSING_USERDATA="hlsFragParsingUserdata",n.FRAG_PARSING_METADATA="hlsFragParsingMetadata",n.FRAG_PARSED="hlsFragParsed",n.FRAG_BUFFERED="hlsFragBuffered",n.FRAG_CHANGED="hlsFragChanged",n.FPS_DROP="hlsFpsDrop",n.FPS_DROP_LEVEL_CAPPING="hlsFpsDropLevelCapping",n.MAX_AUTO_LEVEL_UPDATED="hlsMaxAutoLevelUpdated",n.ERROR="hlsError",n.DESTROYING="hlsDestroying",n.KEY_LOADING="hlsKeyLoading",n.KEY_LOADED="hlsKeyLoaded",n.LIVE_BACK_BUFFER_REACHED="hlsLiveBackBufferReached",n.BACK_BUFFER_REACHED="hlsBackBufferReached",n.STEERING_MANIFEST_LOADED="hlsSteeringManifestLoaded",n.ASSET_LIST_LOADING="hlsAssetListLoading",n.ASSET_LIST_LOADED="hlsAssetListLoaded",n.INTERSTITIALS_UPDATED="hlsInterstitialsUpdated",n.INTERSTITIALS_BUFFERED_TO_BOUNDARY="hlsInterstitialsBufferedToBoundary",n.INTERSTITIAL_ASSET_PLAYER_CREATED="hlsInterstitialAssetPlayerCreated",n.INTERSTITIAL_STARTED="hlsInterstitialStarted",n.INTERSTITIAL_ASSET_STARTED="hlsInterstitialAssetStarted",n.INTERSTITIAL_ASSET_ENDED="hlsInterstitialAssetEnded",n.INTERSTITIAL_ASSET_ERROR="hlsInterstitialAssetError",n.INTERSTITIAL_ENDED="hlsInterstitialEnded",n.INTERSTITIALS_PRIMARY_RESUMED="hlsInterstitialsPrimaryResumed",n.PLAYOUT_LIMIT_REACHED="hlsPlayoutLimitReached",n.EVENT_CUE_ENTER="hlsEventCueEnter",n}({});var Se={MANIFEST:"manifest",LEVEL:"level",AUDIO_TRACK:"audioTrack",SUBTITLE_TRACK:"subtitleTrack"},ne={MAIN:"main",AUDIO:"audio",SUBTITLE:"subtitle"};class gs{constructor(e,t=0,r=0){this.halfLife=void 0,this.alpha_=void 0,this.estimate_=void 0,this.totalWeight_=void 0,this.halfLife=e,this.alpha_=e?Math.exp(Math.log(.5)/e):0,this.estimate_=t,this.totalWeight_=r}sample(e,t){const r=Math.pow(this.alpha_,e);this.estimate_=t*(1-r)+r*this.estimate_,this.totalWeight_+=e}getTotalWeight(){return this.totalWeight_}getEstimate(){if(this.alpha_){const e=1-Math.pow(this.alpha_,this.totalWeight_);if(e)return this.estimate_/e}return this.estimate_}}class ww{constructor(e,t,r,i=100){this.defaultEstimate_=void 0,this.minWeight_=void 0,this.minDelayMs_=void 0,this.slow_=void 0,this.fast_=void 0,this.defaultTTFB_=void 0,this.ttfb_=void 0,this.defaultEstimate_=r,this.minWeight_=.001,this.minDelayMs_=50,this.slow_=new gs(e),this.fast_=new gs(t),this.defaultTTFB_=i,this.ttfb_=new gs(e)}update(e,t){const{slow_:r,fast_:i,ttfb_:s}=this;r.halfLife!==e&&(this.slow_=new gs(e,r.getEstimate(),r.getTotalWeight())),i.halfLife!==t&&(this.fast_=new gs(t,i.getEstimate(),i.getTotalWeight())),s.halfLife!==e&&(this.ttfb_=new gs(e,s.getEstimate(),s.getTotalWeight()))}sample(e,t){e=Math.max(e,this.minDelayMs_);const r=8*t,i=e/1e3,s=r/i;this.fast_.sample(i,s),this.slow_.sample(i,s)}sampleTTFB(e){const t=e/1e3,r=Math.sqrt(2)*Math.exp(-Math.pow(t,2)/2);this.ttfb_.sample(r,Math.max(e,5))}canEstimate(){return this.fast_.getTotalWeight()>=this.minWeight_}getEstimate(){return this.canEstimate()?Math.min(this.fast_.getEstimate(),this.slow_.getEstimate()):this.defaultEstimate_}getEstimateTTFB(){return this.ttfb_.getTotalWeight()>=this.minWeight_?this.ttfb_.getEstimate():this.defaultTTFB_}get defaultEstimate(){return this.defaultEstimate_}destroy(){}}function bw(n,e,t){return(e=Pw(e))in n?Object.defineProperty(n,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):n[e]=t,n}function Oe(){return Oe=Object.assign?Object.assign.bind():function(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var r in t)({}).hasOwnProperty.call(t,r)&&(n[r]=t[r])}return n},Oe.apply(null,arguments)}function t0(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(n);e&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(n,i).enumerable})),t.push.apply(t,r)}return t}function Ce(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?t0(Object(t),!0).forEach(function(r){bw(n,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):t0(Object(t)).forEach(function(r){Object.defineProperty(n,r,Object.getOwnPropertyDescriptor(t,r))})}return n}function kw(n,e){if(typeof n!="object"||!n)return n;var t=n[Symbol.toPrimitive];if(t!==void 0){var r=t.call(n,e);if(typeof r!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(n)}function Pw(n){var e=kw(n,"string");return typeof e=="symbol"?e:e+""}class kr{constructor(e,t){this.trace=void 0,this.debug=void 0,this.log=void 0,this.warn=void 0,this.info=void 0,this.error=void 0;const r=`[${e}]:`;this.trace=Kr,this.debug=t.debug.bind(null,r),this.log=t.log.bind(null,r),this.warn=t.warn.bind(null,r),this.info=t.info.bind(null,r),this.error=t.error.bind(null,r)}}const Kr=function(){},Ow={trace:Kr,debug:Kr,log:Kr,warn:Kr,info:Kr,error:Kr};function zh(){return Oe({},Ow)}function Fw(n,e){const t=self.console[n];return t?t.bind(self.console,`${e?"["+e+"] ":""}[${n}] >`):Kr}function n0(n,e,t){return e[n]?e[n].bind(e):Fw(n,t)}const Wh=zh();function Mw(n,e,t){const r=zh();if(typeof console=="object"&&n===!0||typeof n=="object"){const i=["debug","log","info","warn","error"];i.forEach(s=>{r[s]=n0(s,n,t)});try{r.log(`Debug logs enabled for "${e}" in hls.js version 1.6.5`)}catch{return zh()}i.forEach(s=>{Wh[s]=n0(s,n)})}else Oe(Wh,r);return r}const Ie=Wh;function vi(n=!0){return typeof self>"u"?void 0:(n||!self.MediaSource)&&self.ManagedMediaSource||self.MediaSource||self.WebKitMediaSource}function Nw(n){return typeof self<"u"&&n===self.ManagedMediaSource}function US(n,e){const t=Object.keys(n),r=Object.keys(e),i=t.length,s=r.length;return!i||!s||i===s&&!t.some(a=>r.indexOf(a)===-1)}function sn(n,e=!1){if(typeof TextDecoder<"u"){const u=new TextDecoder("utf-8").decode(n);if(e){const c=u.indexOf("\0");return c!==-1?u.substring(0,c):u}return u.replace(/\0/g,"")}const t=n.length;let r,i,s,a="",o=0;for(;o<t;){if(r=n[o++],r===0&&e)return a;if(r===0||r===3)continue;switch(r>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:a+=String.fromCharCode(r);break;case 12:case 13:i=n[o++],a+=String.fromCharCode((r&31)<<6|i&63);break;case 14:i=n[o++],s=n[o++],a+=String.fromCharCode((r&15)<<12|(i&63)<<6|(s&63)<<0);break}}return a}const Kn={hexDump:function(n){let e="";for(let t=0;t<n.length;t++){let r=n[t].toString(16);r.length<2&&(r="0"+r),e+=r}return e}};function Uw(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var gd={exports:{}},r0;function Bw(){return r0||(r0=1,function(n,e){(function(t){var r=/^(?=((?:[a-zA-Z0-9+\-.]+:)?))\1(?=((?:\/\/[^\/?#]*)?))\2(?=((?:(?:[^?#\/]*\/)*[^;?#\/]*)?))\3((?:;[^?#]*)?)(\?[^#]*)?(#[^]*)?$/,i=/^(?=([^\/?#]*))\1([^]*)$/,s=/(?:\/|^)\.(?=\/)/g,a=/(?:\/|^)\.\.\/(?!\.\.\/)[^\/]*(?=\/)/g,o={buildAbsoluteURL:function(l,u,c){if(c=c||{},l=l.trim(),u=u.trim(),!u){if(!c.alwaysNormalize)return l;var d=o.parseURL(l);if(!d)throw new Error("Error trying to parse base URL.");return d.path=o.normalizePath(d.path),o.buildURLFromParts(d)}var h=o.parseURL(u);if(!h)throw new Error("Error trying to parse relative URL.");if(h.scheme)return c.alwaysNormalize?(h.path=o.normalizePath(h.path),o.buildURLFromParts(h)):u;var f=o.parseURL(l);if(!f)throw new Error("Error trying to parse base URL.");if(!f.netLoc&&f.path&&f.path[0]!=="/"){var g=i.exec(f.path);f.netLoc=g[1],f.path=g[2]}f.netLoc&&!f.path&&(f.path="/");var m={scheme:f.scheme,netLoc:h.netLoc,path:null,params:h.params,query:h.query,fragment:h.fragment};if(!h.netLoc&&(m.netLoc=f.netLoc,h.path[0]!=="/"))if(!h.path)m.path=f.path,h.params||(m.params=f.params,h.query||(m.query=f.query));else{var y=f.path,p=y.substring(0,y.lastIndexOf("/")+1)+h.path;m.path=o.normalizePath(p)}return m.path===null&&(m.path=c.alwaysNormalize?o.normalizePath(h.path):h.path),o.buildURLFromParts(m)},parseURL:function(l){var u=r.exec(l);return u?{scheme:u[1]||"",netLoc:u[2]||"",path:u[3]||"",params:u[4]||"",query:u[5]||"",fragment:u[6]||""}:null},normalizePath:function(l){for(l=l.split("").reverse().join("").replace(s,"");l.length!==(l=l.replace(a,"")).length;);return l.split("").reverse().join("")},buildURLFromParts:function(l){return l.scheme+l.netLoc+l.path+l.params+l.query+l.fragment}};n.exports=o})()}(gd)),gd.exports}var Sg=Bw();class xg{constructor(){this.aborted=!1,this.loaded=0,this.retry=0,this.total=0,this.chunkCount=0,this.bwEstimate=0,this.loading={start:0,first:0,end:0},this.parsing={start:0,end:0},this.buffering={start:0,first:0,end:0}}}var Ne={AUDIO:"audio",VIDEO:"video",AUDIOVIDEO:"audiovideo"};class BS{constructor(e){this._byteRange=null,this._url=null,this._stats=null,this._streams=null,this.base=void 0,this.relurl=void 0,typeof e=="string"&&(e={url:e}),this.base=e,jw(this,"stats")}setByteRange(e,t){const r=e.split("@",2);let i;r.length===1?i=(t==null?void 0:t.byteRangeEndOffset)||0:i=parseInt(r[1]),this._byteRange=[i,parseInt(r[0])+i]}get baseurl(){return this.base.url}get byteRange(){return this._byteRange===null?[]:this._byteRange}get byteRangeStartOffset(){return this.byteRange[0]}get byteRangeEndOffset(){return this.byteRange[1]}get elementaryStreams(){return this._streams===null&&(this._streams={[Ne.AUDIO]:null,[Ne.VIDEO]:null,[Ne.AUDIOVIDEO]:null}),this._streams}set elementaryStreams(e){this._streams=e}get hasStats(){return this._stats!==null}get hasStreams(){return this._streams!==null}get stats(){return this._stats===null&&(this._stats=new xg),this._stats}set stats(e){this._stats=e}get url(){return!this._url&&this.baseurl&&this.relurl&&(this._url=Sg.buildAbsoluteURL(this.baseurl,this.relurl,{alwaysNormalize:!0})),this._url||""}set url(e){this._url=e}clearElementaryStreamInfo(){const{elementaryStreams:e}=this;e[Ne.AUDIO]=null,e[Ne.VIDEO]=null,e[Ne.AUDIOVIDEO]=null}}function vt(n){return n.sn!=="initSegment"}class md extends BS{constructor(e,t){super(t),this._decryptdata=null,this._programDateTime=null,this._ref=null,this._bitrate=void 0,this.rawProgramDateTime=null,this.tagList=[],this.duration=0,this.sn=0,this.levelkeys=void 0,this.type=void 0,this.loader=null,this.keyLoader=null,this.level=-1,this.cc=0,this.startPTS=void 0,this.endPTS=void 0,this.startDTS=void 0,this.endDTS=void 0,this.start=0,this.playlistOffset=0,this.deltaPTS=void 0,this.maxStartPTS=void 0,this.minEndPTS=void 0,this.data=void 0,this.bitrateTest=!1,this.title=null,this.initSegment=null,this.endList=void 0,this.gap=void 0,this.urlId=0,this.type=e}get byteLength(){if(this.hasStats){const e=this.stats.total;if(e)return e}if(this.byteRange){const e=this.byteRange[0],t=this.byteRange[1];if(Z(e)&&Z(t))return t-e}return null}get bitrate(){return this.byteLength?this.byteLength*8/this.duration:this._bitrate?this._bitrate:null}set bitrate(e){this._bitrate=e}get decryptdata(){const{levelkeys:e}=this;if(!e&&!this._decryptdata)return null;if(!this._decryptdata&&this.levelkeys&&!this.levelkeys.NONE){const t=this.levelkeys.identity;if(t)this._decryptdata=t.getDecryptData(this.sn);else{const r=Object.keys(this.levelkeys);if(r.length===1)return this._decryptdata=this.levelkeys[r[0]].getDecryptData(this.sn)}}return this._decryptdata}get end(){return this.start+this.duration}get endProgramDateTime(){if(this.programDateTime===null)return null;const e=Z(this.duration)?this.duration:0;return this.programDateTime+e*1e3}get encrypted(){var e;if((e=this._decryptdata)!=null&&e.encrypted)return!0;if(this.levelkeys){const t=Object.keys(this.levelkeys),r=t.length;if(r>1||r===1&&this.levelkeys[t[0]].encrypted)return!0}return!1}get programDateTime(){return this._programDateTime===null&&this.rawProgramDateTime&&(this.programDateTime=Date.parse(this.rawProgramDateTime)),this._programDateTime}set programDateTime(e){if(!Z(e)){this._programDateTime=this.rawProgramDateTime=null;return}this._programDateTime=e}get ref(){return vt(this)?(this._ref||(this._ref={base:this.base,start:this.start,duration:this.duration,sn:this.sn,programDateTime:this.programDateTime}),this._ref):null}addStart(e){this.setStart(this.start+e)}setStart(e){this.start=e,this._ref&&(this._ref.start=e)}setDuration(e){this.duration=e,this._ref&&(this._ref.duration=e)}setKeyFormat(e){if(this.levelkeys){const t=this.levelkeys[e];t&&!this._decryptdata&&(this._decryptdata=t.getDecryptData(this.sn))}}abortRequests(){var e,t;(e=this.loader)==null||e.abort(),(t=this.keyLoader)==null||t.abort()}setElementaryStreamInfo(e,t,r,i,s,a=!1){const{elementaryStreams:o}=this,l=o[e];if(!l){o[e]={startPTS:t,endPTS:r,startDTS:i,endDTS:s,partial:a};return}l.startPTS=Math.min(l.startPTS,t),l.endPTS=Math.max(l.endPTS,r),l.startDTS=Math.min(l.startDTS,i),l.endDTS=Math.max(l.endDTS,s)}}class $w extends BS{constructor(e,t,r,i,s){super(r),this.fragOffset=0,this.duration=0,this.gap=!1,this.independent=!1,this.relurl=void 0,this.fragment=void 0,this.index=void 0,this.duration=e.decimalFloatingPoint("DURATION"),this.gap=e.bool("GAP"),this.independent=e.bool("INDEPENDENT"),this.relurl=e.enumeratedString("URI"),this.fragment=t,this.index=i;const a=e.enumeratedString("BYTERANGE");a&&this.setByteRange(a,s),s&&(this.fragOffset=s.fragOffset+s.duration)}get start(){return this.fragment.start+this.fragOffset}get end(){return this.start+this.duration}get loaded(){const{elementaryStreams:e}=this;return!!(e.audio||e.video||e.audiovideo)}}function $S(n,e){const t=Object.getPrototypeOf(n);if(t){const r=Object.getOwnPropertyDescriptor(t,e);return r||$S(t,e)}}function jw(n,e){const t=$S(n,e);t&&(t.enumerable=!0,Object.defineProperty(n,e,t))}const Gu=Math.pow(2,32)-1,Gw=[].push,jS={video:1,audio:2,id3:3,text:4};function lt(n){return String.fromCharCode.apply(null,n)}function GS(n,e){const t=n[e]<<8|n[e+1];return t<0?65536+t:t}function ce(n,e){const t=KS(n,e);return t<0?4294967296+t:t}function i0(n,e){let t=ce(n,e);return t*=Math.pow(2,32),t+=ce(n,e+4),t}function KS(n,e){return n[e]<<24|n[e+1]<<16|n[e+2]<<8|n[e+3]}function pd(n,e,t){n[e]=t>>24,n[e+1]=t>>16&255,n[e+2]=t>>8&255,n[e+3]=t&255}function Kw(n){const e=n.byteLength;for(let t=0;t<e;){const r=ce(n,t);if(r>8&&n[t+4]===109&&n[t+5]===111&&n[t+6]===111&&n[t+7]===102)return!0;t=r>1?t+r:e}return!1}function me(n,e){const t=[];if(!e.length)return t;const r=n.byteLength;for(let i=0;i<r;){const s=ce(n,i),a=lt(n.subarray(i+4,i+8)),o=s>1?i+s:r;if(a===e[0])if(e.length===1)t.push(n.subarray(i+8,o));else{const l=me(n.subarray(i+8,o),e.slice(1));l.length&&Gw.apply(t,l)}i=o}return t}function Vw(n){const e=[],t=n[0];let r=8;const i=ce(n,r);r+=4;let s=0,a=0;t===0?(s=ce(n,r),a=ce(n,r+4),r+=8):(s=i0(n,r),a=i0(n,r+8),r+=16),r+=2;let o=n.length+a;const l=GS(n,r);r+=2;for(let u=0;u<l;u++){let c=r;const d=ce(n,c);c+=4;const h=d&2147483647;if((d&2147483648)>>>31===1)return Ie.warn("SIDX has hierarchical references (not supported)"),null;const g=ce(n,c);c+=4,e.push({referenceSize:h,subsegmentDuration:g,info:{duration:g/i,start:o,end:o+h-1}}),o+=h,c+=4,r=c}return{earliestPresentationTime:s,timescale:i,version:t,referencesCount:l,references:e}}function VS(n){const e=[],t=me(n,["moov","trak"]);for(let i=0;i<t.length;i++){const s=t[i],a=me(s,["tkhd"])[0];if(a){let o=a[0];const l=ce(a,o===0?12:20),u=me(s,["mdia","mdhd"])[0];if(u){o=u[0];const c=ce(u,o===0?12:20),d=me(s,["mdia","hdlr"])[0];if(d){const h=lt(d.subarray(8,12)),f={soun:Ne.AUDIO,vide:Ne.VIDEO}[h],g=me(s,["mdia","minf","stbl","stsd"])[0],m=Hw(g);f?(e[l]={timescale:c,type:f,stsd:m},e[f]=Ce({timescale:c,id:l},m)):e[l]={timescale:c,type:h,stsd:m}}}}}return me(n,["moov","mvex","trex"]).forEach(i=>{const s=ce(i,4),a=e[s];a&&(a.default={duration:ce(i,12),flags:ce(i,20)})}),e}function Hw(n){const e=n.subarray(8),t=e.subarray(86),r=lt(e.subarray(4,8));let i=r,s;const a=r==="enca"||r==="encv";if(a){const u=me(e,[r])[0].subarray(r==="enca"?28:78);me(u,["sinf"]).forEach(d=>{const h=me(d,["schm"])[0];if(h){const f=lt(h.subarray(4,8));if(f==="cbcs"||f==="cenc"){const g=me(d,["frma"])[0];g&&(i=lt(g))}}})}const o=i;switch(i){case"avc1":case"avc2":case"avc3":case"avc4":{const l=me(t,["avcC"])[0];l&&l.length>3&&(i+="."+wl(l[1])+wl(l[2])+wl(l[3]),s=Cl(o==="avc1"?"dva1":"dvav",t));break}case"mp4a":{const l=me(e,[r])[0],u=me(l.subarray(28),["esds"])[0];if(u&&u.length>7){let c=4;if(u[c++]!==3)break;c=yd(u,c),c+=2;const d=u[c++];if(d&128&&(c+=2),d&64&&(c+=u[c++]),u[c++]!==4)break;c=yd(u,c);const h=u[c++];if(h===64)i+="."+wl(h);else break;if(c+=12,u[c++]!==5)break;c=yd(u,c);const f=u[c++];let g=(f&248)>>3;g===31&&(g+=1+((f&7)<<3)+((u[c]&224)>>5)),i+="."+g}break}case"hvc1":case"hev1":{const l=me(t,["hvcC"])[0];if(l&&l.length>12){const u=l[1],c=["","A","B","C"][u>>6],d=u&31,h=ce(l,2),f=(u&32)>>5?"H":"L",g=l[12],m=l.subarray(6,12);i+="."+c+d,i+="."+zw(h).toString(16).toUpperCase(),i+="."+f+g;let y="";for(let p=m.length;p--;){const v=m[p];(v||y)&&(y="."+v.toString(16).toUpperCase()+y)}i+=y}s=Cl(o=="hev1"?"dvhe":"dvh1",t);break}case"dvh1":case"dvhe":case"dvav":case"dva1":case"dav1":{i=Cl(i,t)||i;break}case"vp09":{const l=me(t,["vpcC"])[0];if(l&&l.length>6){const u=l[4],c=l[5],d=l[6]>>4&15;i+="."+Gn(u)+"."+Gn(c)+"."+Gn(d)}break}case"av01":{const l=me(t,["av1C"])[0];if(l&&l.length>2){const u=l[1]>>>5,c=l[1]&31,d=l[2]>>>7?"H":"M",h=(l[2]&64)>>6,f=(l[2]&32)>>5,g=u===2&&h?f?12:10:h?10:8,m=(l[2]&16)>>4,y=(l[2]&8)>>3,p=(l[2]&4)>>2,v=l[2]&3;i+="."+u+"."+Gn(c)+d+"."+Gn(g)+"."+m+"."+y+p+v+"."+Gn(1)+"."+Gn(1)+"."+Gn(1)+"."+0,s=Cl("dav1",t)}break}}return{codec:i,encrypted:a,supplemental:s}}function Cl(n,e){const t=me(e,["dvvC"]),r=t.length?t[0]:me(e,["dvcC"])[0];if(r){const i=r[2]>>1&127,s=r[2]<<5&32|r[3]>>3&31;return n+"."+Gn(i)+"."+Gn(s)}}function zw(n){let e=0;for(let t=0;t<32;t++)e|=(n>>t&1)<<31-t;return e>>>0}function yd(n,e){const t=e+5;for(;n[e++]&128&&e<t;);return e}function wl(n){return("0"+n.toString(16).toUpperCase()).slice(-2)}function Gn(n){return(n<10?"0":"")+n}function Ww(n,e){if(!n||!e)return n;const t=e.keyId;return t&&e.isCommonEncryption&&me(n,["moov","trak"]).forEach(i=>{const a=me(i,["mdia","minf","stbl","stsd"])[0].subarray(8);let o=me(a,["enca"]);const l=o.length>0;l||(o=me(a,["encv"])),o.forEach(u=>{const c=l?u.subarray(28):u.subarray(78);me(c,["sinf"]).forEach(h=>{const f=HS(h);if(f){const g=f.subarray(8,24);g.some(m=>m!==0)||(Ie.log(`[eme] Patching keyId in 'enc${l?"a":"v"}>sinf>>tenc' box: ${Kn.hexDump(g)} -> ${Kn.hexDump(t)}`),f.set(t,8))}})})}),n}function HS(n){const e=me(n,["schm"])[0];if(e){const t=lt(e.subarray(4,8));if(t==="cbcs"||t==="cenc")return me(n,["schi","tenc"])[0]}return null}function Yw(n,e,t){const r={},i=me(n,["moof","traf"]);for(let s=0;s<i.length;s++){const a=i[s],o=me(a,["tfhd"])[0],l=ce(o,4),u=e[l];if(!u)continue;const c=r[l]||(r[l]={start:NaN,duration:0,sampleCount:0,timescale:u.timescale,type:u.type}),d=me(a,["tfdt"])[0];if(d){const E=d[0];let T=ce(d,4);E===1&&(T===Gu?t.warn("[mp4-demuxer]: Ignoring assumed invalid signed 64-bit track fragment decode time"):(T*=Gu+1,T+=ce(d,8))),Z(T)&&(!Z(c.start)||T<c.start)&&(c.start=T)}const h=u.default,f=ce(o,0)|(h==null?void 0:h.flags);let g=(h==null?void 0:h.duration)||0;f&8&&(f&2?g=ce(o,12):g=ce(o,8));const m=me(a,["trun"]);let y=c.start||0,p=0,v=g;for(let E=0;E<m.length;E++){const T=m[E],A=ce(T,4),I=c.sampleCount;c.sampleCount+=A;const R=T[3]&1,x=T[3]&4,D=T[2]&1,_=T[2]&2,M=T[2]&4,j=T[2]&8;let z=8,H=A;for(R&&(z+=4),x&&A&&(!(T[z+1]&1)&&c.keyFrameIndex===void 0&&(c.keyFrameIndex=I),z+=4,D?(v=ce(T,z),z+=4):v=g,_&&(z+=4),j&&(z+=4),y+=v,p+=v,H--);H--;)D?(v=ce(T,z),z+=4):v=g,_&&(z+=4),M&&(T[z+1]&1||c.keyFrameIndex===void 0&&(c.keyFrameIndex=c.sampleCount-(H+1),c.keyFrameStart=y),z+=4),j&&(z+=4),y+=v,p+=v;!p&&g&&(p+=g*A)}c.duration+=p}if(!Object.keys(r).some(s=>r[s].duration)){let s=1/0,a=0;const o=me(n,["sidx"]);for(let l=0;l<o.length;l++){const u=Vw(o[l]);if(u!=null&&u.references){s=Math.min(s,u.earliestPresentationTime/u.timescale);const c=u.references.reduce((d,h)=>d+h.info.duration||0,0);a=Math.max(a,c+u.earliestPresentationTime/u.timescale)}}a&&Z(a)&&Object.keys(r).forEach(l=>{r[l].duration||(r[l].duration=a*r[l].timescale-r[l].start)})}return r}function qw(n,e,t){me(e,["moof","traf"]).forEach(r=>{me(r,["tfhd"]).forEach(i=>{const s=ce(i,4),a=n[s];if(!a)return;const o=a.timescale||9e4;me(r,["tfdt"]).forEach(l=>{const u=l[0],c=t*o;if(c){let d=ce(l,4);if(u===0)d-=c,d=Math.max(d,0),pd(l,4,d);else{d*=Math.pow(2,32),d+=ce(l,8),d-=c,d=Math.max(d,0);const h=Math.floor(d/(Gu+1)),f=Math.floor(d%(Gu+1));pd(l,4,h),pd(l,8,f)}}})})})}function Qw(n){const e={valid:null,remainder:null},t=me(n,["moof"]);if(t.length<2)return e.remainder=n,e;const r=t[t.length-1];return e.valid=n.slice(0,r.byteOffset-8),e.remainder=n.slice(r.byteOffset-8),e}function Tn(n,e){const t=new Uint8Array(n.length+e.length);return t.set(n),t.set(e,n.length),t}function s0(n,e){const t=[],r=e.samples,i=e.timescale,s=e.id;let a=!1;return me(r,["moof"]).map(l=>{const u=l.byteOffset-8;me(l,["traf"]).map(d=>{const h=me(d,["tfdt"]).map(f=>{const g=f[0];let m=ce(f,4);return g===1&&(m*=Math.pow(2,32),m+=ce(f,8)),m/i})[0];return h!==void 0&&(n=h),me(d,["tfhd"]).map(f=>{const g=ce(f,4),m=ce(f,0)&16777215,y=(m&1)!==0,p=(m&2)!==0,v=(m&8)!==0;let E=0;const T=(m&16)!==0;let A=0;const I=(m&32)!==0;let R=8;g===s&&(y&&(R+=8),p&&(R+=4),v&&(E=ce(f,R),R+=4),T&&(A=ce(f,R),R+=4),I&&(R+=4),e.type==="video"&&(a=Tc(e.codec)),me(d,["trun"]).map(x=>{const D=x[0],_=ce(x,0)&16777215,M=(_&1)!==0;let j=0;const z=(_&4)!==0,H=(_&256)!==0;let W=0;const V=(_&512)!==0;let X=0;const B=(_&1024)!==0,F=(_&2048)!==0;let U=0;const Q=ce(x,4);let q=8;M&&(j=ce(x,q),q+=4),z&&(q+=4);let oe=j+u;for(let de=0;de<Q;de++){if(H?(W=ce(x,q),q+=4):W=E,V?(X=ce(x,q),q+=4):X=A,B&&(q+=4),F&&(D===0?U=ce(x,q):U=KS(x,q),q+=4),e.type===Ne.VIDEO){let pe=0;for(;pe<X;){const he=ce(r,oe);if(oe+=4,Xw(a,r[oe])){const Fe=r.subarray(oe,oe+he);Tg(Fe,a?2:1,n+U/i,t)}oe+=he,pe+=he+4}}n+=W/i}}))})})}),t}function Tc(n){if(!n)return!1;const e=n.substring(0,4);return e==="hvc1"||e==="hev1"||e==="dvh1"||e==="dvhe"}function Xw(n,e){if(n){const t=e>>1&63;return t===39||t===40}else return(e&31)===6}function Tg(n,e,t,r){const i=zS(n);let s=0;s+=e;let a=0,o=0,l=0;for(;s<i.length;){a=0;do{if(s>=i.length)break;l=i[s++],a+=l}while(l===255);o=0;do{if(s>=i.length)break;l=i[s++],o+=l}while(l===255);const u=i.length-s;let c=s;if(o<u)s+=o;else if(o>u){Ie.error(`Malformed SEI payload. ${o} is too small, only ${u} bytes left to parse.`);break}if(a===4){if(i[c++]===181){const h=GS(i,c);if(c+=2,h===49){const f=ce(i,c);if(c+=4,f===1195456820){const g=i[c++];if(g===3){const m=i[c++],y=31&m,p=64&m,v=p?2+y*3:0,E=new Uint8Array(v);if(p){E[0]=m;for(let T=1;T<v;T++)E[T]=i[c++]}r.push({type:g,payloadType:a,pts:t,bytes:E})}}}}}else if(a===5&&o>16){const d=[];for(let g=0;g<16;g++){const m=i[c++].toString(16);d.push(m.length==1?"0"+m:m),(g===3||g===5||g===7||g===9)&&d.push("-")}const h=o-16,f=new Uint8Array(h);for(let g=0;g<h;g++)f[g]=i[c++];r.push({payloadType:a,pts:t,uuid:d.join(""),userData:sn(f),userDataBytes:f})}}}function zS(n){const e=n.byteLength,t=[];let r=1;for(;r<e-2;)n[r]===0&&n[r+1]===0&&n[r+2]===3?(t.push(r+2),r+=2):r++;if(t.length===0)return n;const i=e-t.length,s=new Uint8Array(i);let a=0;for(r=0;r<i;a++,r++)a===t[0]&&(a++,t.shift()),s[r]=n[a];return s}function Zw(n){const e=n[0];let t="",r="",i=0,s=0,a=0,o=0,l=0,u=0;if(e===0){for(;lt(n.subarray(u,u+1))!=="\0";)t+=lt(n.subarray(u,u+1)),u+=1;for(t+=lt(n.subarray(u,u+1)),u+=1;lt(n.subarray(u,u+1))!=="\0";)r+=lt(n.subarray(u,u+1)),u+=1;r+=lt(n.subarray(u,u+1)),u+=1,i=ce(n,12),s=ce(n,16),o=ce(n,20),l=ce(n,24),u=28}else if(e===1){u+=4,i=ce(n,u),u+=4;const d=ce(n,u);u+=4;const h=ce(n,u);for(u+=4,a=2**32*d+h,Dw(a)||(a=Number.MAX_SAFE_INTEGER,Ie.warn("Presentation time exceeds safe integer limit and wrapped to max safe integer in parsing emsg box")),o=ce(n,u),u+=4,l=ce(n,u),u+=4;lt(n.subarray(u,u+1))!=="\0";)t+=lt(n.subarray(u,u+1)),u+=1;for(t+=lt(n.subarray(u,u+1)),u+=1;lt(n.subarray(u,u+1))!=="\0";)r+=lt(n.subarray(u,u+1)),u+=1;r+=lt(n.subarray(u,u+1)),u+=1}const c=n.subarray(u,n.byteLength);return{schemeIdUri:t,value:r,timeScale:i,presentationTime:a,presentationTimeDelta:s,eventDuration:o,id:l,payload:c}}function Jw(n,...e){const t=e.length;let r=8,i=t;for(;i--;)r+=e[i].byteLength;const s=new Uint8Array(r);for(s[0]=r>>24&255,s[1]=r>>16&255,s[2]=r>>8&255,s[3]=r&255,s.set(n,4),i=0,r=8;i<t;i++)s.set(e[i],r),r+=e[i].byteLength;return s}function eb(n,e,t){if(n.byteLength!==16)throw new RangeError("Invalid system id");let r,i;r=0,i=new Uint8Array;let s;r>0?(s=new Uint8Array(4),e.length>0&&new DataView(s.buffer).setUint32(0,e.length,!1)):s=new Uint8Array;const a=new Uint8Array(4);return t&&t.byteLength>0&&new DataView(a.buffer).setUint32(0,t.byteLength,!1),Jw([112,115,115,104],new Uint8Array([r,0,0,0]),n,s,i,a,t||new Uint8Array)}function tb(n){const e=[];if(n instanceof ArrayBuffer){const t=n.byteLength;let r=0;for(;r+32<t;){const i=new DataView(n,r),s=nb(i);e.push(s),r+=s.size}}return e}function nb(n){const e=n.getUint32(0),t=n.byteOffset,r=n.byteLength;if(r<e)return{offset:t,size:r};if(n.getUint32(4)!==1886614376)return{offset:t,size:e};const s=n.getUint32(8)>>>24;if(s!==0&&s!==1)return{offset:t,size:e};const a=n.buffer,o=Kn.hexDump(new Uint8Array(a,t+12,16)),l=n.getUint32(28);let u=null,c=null;if(s===0){if(e-32<l||l<22)return{offset:t,size:e};c=new Uint8Array(a,t+32,l)}else if(s===1){if(!l||r<t+32+l*16+16)return{offset:t,size:e};u=[];for(let d=0;d<l;d++)u.push(new Uint8Array(a,t+32+d*16,16))}return{version:s,systemId:o,kids:u,data:c,offset:t,size:e}}const WS=()=>/\(Windows.+Firefox\//i.test(navigator.userAgent),ha={audio:{a3ds:1,"ac-3":.95,"ac-4":1,alac:.9,alaw:1,dra1:1,"dts+":1,"dts-":1,dtsc:1,dtse:1,dtsh:1,"ec-3":.9,enca:1,fLaC:.9,flac:.9,FLAC:.9,g719:1,g726:1,m4ae:1,mha1:1,mha2:1,mhm1:1,mhm2:1,mlpa:1,mp4a:1,"raw ":1,Opus:1,opus:1,samr:1,sawb:1,sawp:1,sevc:1,sqcp:1,ssmv:1,twos:1,ulaw:1},video:{avc1:1,avc2:1,avc3:1,avc4:1,avcp:1,av01:.8,dav1:.8,drac:1,dva1:1,dvav:1,dvh1:.7,dvhe:.7,encv:1,hev1:.75,hvc1:.75,mjp2:1,mp4v:1,mvc1:1,mvc2:1,mvc3:1,mvc4:1,resv:1,rv60:1,s263:1,svc1:1,svc2:1,"vc-1":1,vp08:1,vp09:.9},text:{stpp:1,wvtt:1}};function YS(n,e){const t=ha[e];return!!t&&!!t[n.slice(0,4)]}function Yh(n,e,t=!0){return!n.split(",").some(r=>!qS(r,e,t))}function qS(n,e,t=!0){var r;const i=vi(t);return(r=i==null?void 0:i.isTypeSupported(_o(n,e)))!=null?r:!1}function _o(n,e){return`${e}/mp4;codecs=${n}`}function a0(n){if(n){const e=n.substring(0,4);return ha.video[e]}return 2}function Ku(n){const e=WS();return n.split(",").reduce((t,r)=>{const s=e&&Tc(r)?9:ha.video[r];return s?(s*2+t)/(t?3:2):(ha.audio[r]+t)/(t?2:1)},0)}const vd={};function rb(n,e=!0){if(vd[n])return vd[n];const t={flac:["flac","fLaC","FLAC"],opus:["opus","Opus"],"mp4a.40.34":["mp3"]}[n];for(let i=0;i<t.length;i++){var r;if(qS(t[i],"audio",e))return vd[n]=t[i],t[i];if(t[i]==="mp3"&&(r=vi(e))!=null&&r.isTypeSupported("audio/mpeg"))return""}return n}const ib=/flac|opus|mp4a\.40\.34/i;function Vu(n,e=!0){return n.replace(ib,t=>rb(t.toLowerCase(),e))}function sb(n,e){const t=[];if(n){const r=n.split(",");for(let i=0;i<r.length;i++)YS(r[i],"video")||t.push(r[i])}return e&&t.push(e),t.join(",")}function au(n,e){if(n&&(n.length>4||["ac-3","ec-3","alac","fLaC","Opus"].indexOf(n)!==-1))return n;if(e){const t=e.split(",");if(t.length>1){if(n){for(let r=t.length;r--;)if(t[r].substring(0,4)===n.substring(0,4))return t[r]}return t[0]}}return e||n}function ab(n){const e=n.split(",");for(let t=0;t<e.length;t++){const r=e[t].split(".");r.length>2&&r[0]==="avc1"&&(e[t]=`avc1.${parseInt(r[1]).toString(16)}${("000"+parseInt(r[2]).toString(16)).slice(-4)}`)}return e.join(",")}function ob(n){if(n.startsWith("av01.")){const e=n.split("."),t=["0","111","01","01","01","0"];for(let r=e.length;r>4&&r<10;r++)e[r]=t[r-4];return e.join(".")}return n}function o0(n){const e=vi(n)||{isTypeSupported:()=>!1};return{mpeg:e.isTypeSupported("audio/mpeg"),mp3:e.isTypeSupported('audio/mp4; codecs="mp3"'),ac3:e.isTypeSupported('audio/mp4; codecs="ac-3"')}}function QS(n){return n.replace(/^.+codecs=["']?([^"']+).*$/,"$1")}const XS={supported:!0,configurations:[],decodingInfoResults:[{supported:!0,powerEfficient:!0,smooth:!0}]};function ZS(n,e){return{supported:!1,configurations:e,decodingInfoResults:[{supported:!1,smooth:!1,powerEfficient:!1}],error:n}}const l0={};function lb(n,e,t,r,i,s){const a=n.audioCodec?n.audioGroups:null,o=s==null?void 0:s.audioCodec,l=s==null?void 0:s.channels,u=l?parseInt(l):o?1/0:2;let c=null;if(a!=null&&a.length)try{a.length===1&&a[0]?c=e.groups[a[0]].channels:c=a.reduce((d,h)=>{if(h){const f=e.groups[h];if(!f)throw new Error(`Audio track group ${h} not found`);Object.keys(f.channels).forEach(g=>{d[g]=(d[g]||0)+f.channels[g]})}return d},{2:0})}catch{return!0}return n.videoCodec!==void 0&&(n.width>1920&&n.height>1088||n.height>1920&&n.width>1088||n.frameRate>Math.max(r,30)||n.videoRange!=="SDR"&&n.videoRange!==t||n.bitrate>Math.max(i,8e6))||!!c&&Z(u)&&Object.keys(c).some(d=>parseInt(d)>u)}function JS(n,e,t){const r=n.videoCodec,i=n.audioCodec;if(!r&&!i||!t)return Promise.resolve(XS);const s=[];if(r){const a={width:n.width,height:n.height,bitrate:Math.ceil(Math.max(n.bitrate*.9,n.averageBitrate)),framerate:n.frameRate||30},o=n.videoRange;o!=="SDR"&&(a.transferFunction=o.toLowerCase());const l=r.split(","),u=navigator.userAgent;if(l.some(c=>Tc(c))&&WS())return Promise.resolve(ZS(new Error(`Overriding Windows Firefox HEVC MediaCapabilities result based on user-agent sting: (${u})`),s));s.push.apply(s,l.map(c=>({type:"media-source",video:Ce(Ce({},a),{},{contentType:_o(ob(c),"video")})})))}return i&&n.audioGroups&&n.audioGroups.forEach(a=>{var o;a&&((o=e.groups[a])==null||o.tracks.forEach(l=>{if(l.groupId===a){const u=l.channels||"",c=parseFloat(u);Z(c)&&c>2&&s.push.apply(s,i.split(",").map(d=>({type:"media-source",audio:{contentType:_o(d,"audio"),channels:""+c}})))}}))}),Promise.all(s.map(a=>{const o=ub(a);return l0[o]||(l0[o]=t.decodingInfo(a))})).then(a=>({supported:!a.some(o=>!o.supported),configurations:s,decodingInfoResults:a})).catch(a=>({supported:!1,configurations:s,decodingInfoResults:[],error:a}))}function ub(n){const{audio:e,video:t}=n,r=t||e;if(r){const i=QS(r.contentType);if(t)return`r${t.height}x${t.width}f${Math.ceil(t.framerate)}${t.transferFunction||"sd"}_${i}_${Math.ceil(t.bitrate/1e5)}`;if(e)return`c${e.channels}${e.spatialRendering?"s":"n"}_${i}`}return""}const qh=["NONE","TYPE-0","TYPE-1",null];function cb(n){return qh.indexOf(n)>-1}const Hu=["SDR","PQ","HLG"];function db(n){return!!n&&Hu.indexOf(n)>-1}var ou={No:"",Yes:"YES",v2:"v2"};function u0(n){const{canSkipUntil:e,canSkipDateRanges:t,age:r}=n,i=r<e/2;return e&&i?t?ou.v2:ou.Yes:ou.No}class c0{constructor(e,t,r){this.msn=void 0,this.part=void 0,this.skip=void 0,this.msn=e,this.part=t,this.skip=r}addDirectives(e){const t=new self.URL(e);return this.msn!==void 0&&t.searchParams.set("_HLS_msn",this.msn.toString()),this.part!==void 0&&t.searchParams.set("_HLS_part",this.part.toString()),this.skip&&t.searchParams.set("_HLS_skip",this.skip),t.href}}class Io{constructor(e){if(this._attrs=void 0,this.audioCodec=void 0,this.bitrate=void 0,this.codecSet=void 0,this.url=void 0,this.frameRate=void 0,this.height=void 0,this.id=void 0,this.name=void 0,this.supplemental=void 0,this.videoCodec=void 0,this.width=void 0,this.details=void 0,this.fragmentError=0,this.loadError=0,this.loaded=void 0,this.realBitrate=0,this.supportedPromise=void 0,this.supportedResult=void 0,this._avgBitrate=0,this._audioGroups=void 0,this._subtitleGroups=void 0,this._urlId=0,this.url=[e.url],this._attrs=[e.attrs],this.bitrate=e.bitrate,e.details&&(this.details=e.details),this.id=e.id||0,this.name=e.name,this.width=e.width||0,this.height=e.height||0,this.frameRate=e.attrs.optionalFloat("FRAME-RATE",0),this._avgBitrate=e.attrs.decimalInteger("AVERAGE-BANDWIDTH"),this.audioCodec=e.audioCodec,this.videoCodec=e.videoCodec,this.codecSet=[e.videoCodec,e.audioCodec].filter(r=>!!r).map(r=>r.substring(0,4)).join(","),"supplemental"in e){var t;this.supplemental=e.supplemental;const r=(t=e.supplemental)==null?void 0:t.videoCodec;r&&r!==e.videoCodec&&(this.codecSet+=`,${r.substring(0,4)}`)}this.addGroupId("audio",e.attrs.AUDIO),this.addGroupId("text",e.attrs.SUBTITLES)}get maxBitrate(){return Math.max(this.realBitrate,this.bitrate)}get averageBitrate(){return this._avgBitrate||this.realBitrate||this.bitrate}get attrs(){return this._attrs[0]}get codecs(){return this.attrs.CODECS||""}get pathwayId(){return this.attrs["PATHWAY-ID"]||"."}get videoRange(){return this.attrs["VIDEO-RANGE"]||"SDR"}get score(){return this.attrs.optionalFloat("SCORE",0)}get uri(){return this.url[0]||""}hasAudioGroup(e){return d0(this._audioGroups,e)}hasSubtitleGroup(e){return d0(this._subtitleGroups,e)}get audioGroups(){return this._audioGroups}get subtitleGroups(){return this._subtitleGroups}addGroupId(e,t){if(t){if(e==="audio"){let r=this._audioGroups;r||(r=this._audioGroups=[]),r.indexOf(t)===-1&&r.push(t)}else if(e==="text"){let r=this._subtitleGroups;r||(r=this._subtitleGroups=[]),r.indexOf(t)===-1&&r.push(t)}}}get urlId(){return 0}set urlId(e){}get audioGroupIds(){return this.audioGroups?[this.audioGroupId]:void 0}get textGroupIds(){return this.subtitleGroups?[this.textGroupId]:void 0}get audioGroupId(){var e;return(e=this.audioGroups)==null?void 0:e[0]}get textGroupId(){var e;return(e=this.subtitleGroups)==null?void 0:e[0]}addFallback(){}}function d0(n,e){return!e||!n?!1:n.indexOf(e)!==-1}function hb(){if(typeof matchMedia=="function"){const n=matchMedia("(dynamic-range: high)"),e=matchMedia("bad query");if(n.media!==e.media)return n.matches===!0}return!1}function fb(n,e){let t=!1,r=[];if(n&&(t=n!=="SDR",r=[n]),e){r=e.allowedVideoRanges||Hu.slice(0);const i=r.join("")!=="SDR"&&!e.videoCodec;t=e.preferHDR!==void 0?e.preferHDR:i&&hb(),t||(r=["SDR"])}return{preferHDR:t,allowedVideoRanges:r}}const gb=n=>{const e=new WeakSet;return(t,r)=>{if(n&&(r=n(t,r)),typeof r=="object"&&r!==null){if(e.has(r))return;e.add(r)}return r}},Ve=(n,e)=>JSON.stringify(n,gb(e));function mb(n,e,t,r,i){const s=Object.keys(n),a=r==null?void 0:r.channels,o=r==null?void 0:r.audioCodec,l=i==null?void 0:i.videoCodec,u=a&&parseInt(a)===2;let c=!1,d=!1,h=1/0,f=1/0,g=1/0,m=1/0,y=0,p=[];const{preferHDR:v,allowedVideoRanges:E}=fb(e,i);for(let x=s.length;x--;){const D=n[s[x]];c||(c=D.channels[2]>0),h=Math.min(h,D.minHeight),f=Math.min(f,D.minFramerate),g=Math.min(g,D.minBitrate),E.filter(M=>D.videoRanges[M]>0).length>0&&(d=!0)}h=Z(h)?h:0,f=Z(f)?f:0;const T=Math.max(1080,h),A=Math.max(30,f);g=Z(g)?g:t,t=Math.max(g,t),d||(e=void 0);const I=s.length>1;return{codecSet:s.reduce((x,D)=>{const _=n[D];if(D===x)return x;if(p=d?E.filter(M=>_.videoRanges[M]>0):[],I){if(_.minBitrate>t)return $n(D,`min bitrate of ${_.minBitrate} > current estimate of ${t}`),x;if(!_.hasDefaultAudio)return $n(D,"no renditions with default or auto-select sound found"),x;if(o&&D.indexOf(o.substring(0,4))%5!==0)return $n(D,`audio codec preference "${o}" not found`),x;if(a&&!u){if(!_.channels[a])return $n(D,`no renditions with ${a} channel sound found (channels options: ${Object.keys(_.channels)})`),x}else if((!o||u)&&c&&_.channels[2]===0)return $n(D,"no renditions with stereo sound found"),x;if(_.minHeight>T)return $n(D,`min resolution of ${_.minHeight} > maximum of ${T}`),x;if(_.minFramerate>A)return $n(D,`min framerate of ${_.minFramerate} > maximum of ${A}`),x;if(!p.some(M=>_.videoRanges[M]>0))return $n(D,`no variants with VIDEO-RANGE of ${Ve(p)} found`),x;if(l&&D.indexOf(l.substring(0,4))%5!==0)return $n(D,`video codec preference "${l}" not found`),x;if(_.maxScore<y)return $n(D,`max score of ${_.maxScore} < selected max of ${y}`),x}return x&&(Ku(D)>=Ku(x)||_.fragmentError>n[x].fragmentError)?x:(m=_.minIndex,y=_.maxScore,D)},void 0),videoRanges:p,preferHDR:v,minFramerate:f,minBitrate:g,minIndex:m}}function $n(n,e){Ie.log(`[abr] start candidates with "${n}" ignored because ${e}`)}function ex(n){return n.reduce((e,t)=>{let r=e.groups[t.groupId];r||(r=e.groups[t.groupId]={tracks:[],channels:{2:0},hasDefault:!1,hasAutoSelect:!1}),r.tracks.push(t);const i=t.channels||"2";return r.channels[i]=(r.channels[i]||0)+1,r.hasDefault=r.hasDefault||t.default,r.hasAutoSelect=r.hasAutoSelect||t.autoselect,r.hasDefault&&(e.hasDefaultAudio=!0),r.hasAutoSelect&&(e.hasAutoSelectAudio=!0),e},{hasDefaultAudio:!1,hasAutoSelectAudio:!1,groups:{}})}function pb(n,e,t,r){return n.slice(t,r+1).reduce((i,s,a)=>{if(!s.codecSet)return i;const o=s.audioGroups;let l=i[s.codecSet];l||(i[s.codecSet]=l={minBitrate:1/0,minHeight:1/0,minFramerate:1/0,minIndex:a,maxScore:0,videoRanges:{SDR:0},channels:{2:0},hasDefaultAudio:!o,fragmentError:0}),l.minBitrate=Math.min(l.minBitrate,s.bitrate);const u=Math.min(s.height,s.width);return l.minHeight=Math.min(l.minHeight,u),l.minFramerate=Math.min(l.minFramerate,s.frameRate),l.minIndex=Math.min(l.minIndex,a),l.maxScore=Math.max(l.maxScore,s.score),l.fragmentError+=s.fragmentError,l.videoRanges[s.videoRange]=(l.videoRanges[s.videoRange]||0)+1,o&&o.forEach(c=>{if(!c)return;const d=e.groups[c];d&&(l.hasDefaultAudio=l.hasDefaultAudio||e.hasDefaultAudio?d.hasDefault:d.hasAutoSelect||!e.hasDefaultAudio&&!e.hasAutoSelectAudio,Object.keys(d.channels).forEach(h=>{l.channels[h]=(l.channels[h]||0)+d.channels[h]}))}),i},{})}function h0(n){if(!n)return n;const{lang:e,assocLang:t,characteristics:r,channels:i,audioCodec:s}=n;return{lang:e,assocLang:t,characteristics:r,channels:i,audioCodec:s}}function Zn(n,e,t){if("attrs"in n){const r=e.indexOf(n);if(r!==-1)return r}for(let r=0;r<e.length;r++){const i=e[r];if(Wi(n,i,t))return r}return-1}function Wi(n,e,t){const{groupId:r,name:i,lang:s,assocLang:a,default:o}=n,l=n.forced;return(r===void 0||e.groupId===r)&&(i===void 0||e.name===i)&&(s===void 0||yb(s,e.lang))&&(s===void 0||e.assocLang===a)&&(o===void 0||e.default===o)&&(l===void 0||e.forced===l)&&(!("characteristics"in n)||vb(n.characteristics||"",e.characteristics))&&(t===void 0||t(n,e))}function yb(n,e="--"){return n.length===e.length?n===e:n.startsWith(e)||e.startsWith(n)}function vb(n,e=""){const t=n.split(","),r=e.split(",");return t.length===r.length&&!t.some(i=>r.indexOf(i)===-1)}function ki(n,e){const{audioCodec:t,channels:r}=n;return(t===void 0||(e.audioCodec||"").substring(0,4)===t.substring(0,4))&&(r===void 0||r===(e.channels||"2"))}function Eb(n,e,t,r,i){const s=e[r],o=e.reduce((h,f,g)=>{const m=f.uri;return(h[m]||(h[m]=[])).push(g),h},{})[s.uri];o.length>1&&(r=Math.max.apply(Math,o));const l=s.videoRange,u=s.frameRate,c=s.codecSet.substring(0,4),d=f0(e,r,h=>{if(h.videoRange!==l||h.frameRate!==u||h.codecSet.substring(0,4)!==c)return!1;const f=h.audioGroups,g=t.filter(m=>!f||f.indexOf(m.groupId)!==-1);return Zn(n,g,i)>-1});return d>-1?d:f0(e,r,h=>{const f=h.audioGroups,g=t.filter(m=>!f||f.indexOf(m.groupId)!==-1);return Zn(n,g,i)>-1})}function f0(n,e,t){for(let r=e;r>-1;r--)if(t(n[r]))return r;for(let r=e+1;r<n.length;r++)if(t(n[r]))return r;return-1}function zu(n,e){var t;return!!n&&n!==((t=e.loadLevelObj)==null?void 0:t.uri)}class Sb extends kr{constructor(e){super("abr",e.logger),this.hls=void 0,this.lastLevelLoadSec=0,this.lastLoadedFragLevel=-1,this.firstSelection=-1,this._nextAutoLevel=-1,this.nextAutoLevelKey="",this.audioTracksByGroup=null,this.codecTiers=null,this.timer=-1,this.fragCurrent=null,this.partCurrent=null,this.bitrateTestDelay=0,this.rebufferNotice=-1,this.bwEstimator=void 0,this._abandonRulesCheck=t=>{var r;const{fragCurrent:i,partCurrent:s,hls:a}=this,{autoLevelEnabled:o,media:l}=a;if(!i||!l)return;const u=performance.now(),c=s?s.stats:i.stats,d=s?s.duration:i.duration,h=u-c.loading.start,f=a.minAutoLevel,g=i.level,m=this._nextAutoLevel;if(c.aborted||c.loaded&&c.loaded===c.total||g<=f){this.clearTimer(),this._nextAutoLevel=-1;return}if(!o)return;const y=m>-1&&m!==g,p=!!t||y;if(!p&&(l.paused||!l.playbackRate||!l.readyState))return;const v=a.mainForwardBufferInfo;if(!p&&v===null)return;const E=this.bwEstimator.getEstimateTTFB(),T=Math.abs(l.playbackRate);if(h<=Math.max(E,1e3*(d/(T*2))))return;const A=v?v.len/T:0,I=c.loading.first?c.loading.first-c.loading.start:-1,R=c.loaded&&I>-1,x=this.getBwEstimate(),D=a.levels,_=D[g],M=Math.max(c.loaded,Math.round(d*(i.bitrate||_.averageBitrate)/8));let j=R?h-I:h;j<1&&R&&(j=Math.min(h,c.loaded*8/x));const z=R?c.loaded*1e3/j:0,H=E/1e3,W=z?(M-c.loaded)/z:M*8/x+H;if(W<=A)return;const V=z?z*8:x,X=((r=(t==null?void 0:t.details)||this.hls.latestLevelDetails)==null?void 0:r.live)===!0,B=this.hls.config.abrBandWidthUpFactor;let F=Number.POSITIVE_INFINITY,U;for(U=g-1;U>f;U--){const de=D[U].maxBitrate,pe=!D[U].details||X;if(F=this.getTimeToLoadFrag(H,V,d*de,pe),F<Math.min(A,d+H))break}if(F>=W||F>d*10)return;R?this.bwEstimator.sample(h-Math.min(E,I),c.loaded):this.bwEstimator.sampleTTFB(h);const Q=D[U].maxBitrate;this.getBwEstimate()*B>Q&&this.resetEstimator(Q);const q=this.findBestLevel(Q,f,U,0,A,1,1);q>-1&&(U=q),this.warn(`Fragment ${i.sn}${s?" part "+s.index:""} of level ${g} is loading too slowly;
      Fragment duration: ${i.duration.toFixed(3)}
      Time to underbuffer: ${A.toFixed(3)} s
      Estimated load time for current fragment: ${W.toFixed(3)} s
      Estimated load time for down switch fragment: ${F.toFixed(3)} s
      TTFB estimate: ${I|0} ms
      Current BW estimate: ${Z(x)?x|0:"Unknown"} bps
      New BW estimate: ${this.getBwEstimate()|0} bps
      Switching to level ${U} @ ${Q|0} bps`),a.nextLoadLevel=a.nextAutoLevel=U,this.clearTimer();const oe=()=>{if(this.clearTimer(),this.fragCurrent===i&&this.hls.loadLevel===U&&U>0){const de=this.getStarvationDelay();if(this.warn(`Aborting inflight request ${U>0?"and switching down":""}
      Fragment duration: ${i.duration.toFixed(3)} s
      Time to underbuffer: ${de.toFixed(3)} s`),i.abortRequests(),this.fragCurrent=this.partCurrent=null,U>f){let pe=this.findBestLevel(this.hls.levels[f].bitrate,f,U,0,de,1,1);pe===-1&&(pe=f),this.hls.nextLoadLevel=this.hls.nextAutoLevel=pe,this.resetEstimator(this.hls.levels[pe].bitrate)}}};y||W>F*2?oe():this.timer=self.setInterval(oe,F*1e3),a.trigger(S.FRAG_LOAD_EMERGENCY_ABORTED,{frag:i,part:s,stats:c})},this.hls=e,this.bwEstimator=this.initEstimator(),this.registerListeners()}resetEstimator(e){e&&(this.log(`setting initial bwe to ${e}`),this.hls.config.abrEwmaDefaultEstimate=e),this.firstSelection=-1,this.bwEstimator=this.initEstimator()}initEstimator(){const e=this.hls.config;return new ww(e.abrEwmaSlowVoD,e.abrEwmaFastVoD,e.abrEwmaDefaultEstimate)}registerListeners(){const{hls:e}=this;e.on(S.MANIFEST_LOADING,this.onManifestLoading,this),e.on(S.FRAG_LOADING,this.onFragLoading,this),e.on(S.FRAG_LOADED,this.onFragLoaded,this),e.on(S.FRAG_BUFFERED,this.onFragBuffered,this),e.on(S.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(S.LEVEL_LOADED,this.onLevelLoaded,this),e.on(S.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(S.MAX_AUTO_LEVEL_UPDATED,this.onMaxAutoLevelUpdated,this),e.on(S.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e&&(e.off(S.MANIFEST_LOADING,this.onManifestLoading,this),e.off(S.FRAG_LOADING,this.onFragLoading,this),e.off(S.FRAG_LOADED,this.onFragLoaded,this),e.off(S.FRAG_BUFFERED,this.onFragBuffered,this),e.off(S.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(S.LEVEL_LOADED,this.onLevelLoaded,this),e.off(S.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(S.MAX_AUTO_LEVEL_UPDATED,this.onMaxAutoLevelUpdated,this),e.off(S.ERROR,this.onError,this))}destroy(){this.unregisterListeners(),this.clearTimer(),this.hls=this._abandonRulesCheck=null,this.fragCurrent=this.partCurrent=null}onManifestLoading(e,t){this.lastLoadedFragLevel=-1,this.firstSelection=-1,this.lastLevelLoadSec=0,this.fragCurrent=this.partCurrent=null,this.onLevelsUpdated(),this.clearTimer()}onLevelsUpdated(){this.lastLoadedFragLevel>-1&&this.fragCurrent&&(this.lastLoadedFragLevel=this.fragCurrent.level),this._nextAutoLevel=-1,this.onMaxAutoLevelUpdated(),this.codecTiers=null,this.audioTracksByGroup=null}onMaxAutoLevelUpdated(){this.firstSelection=-1,this.nextAutoLevelKey=""}onFragLoading(e,t){const r=t.frag;if(!this.ignoreFragment(r)){if(!r.bitrateTest){var i;this.fragCurrent=r,this.partCurrent=(i=t.part)!=null?i:null}this.clearTimer(),this.timer=self.setInterval(this._abandonRulesCheck,100)}}onLevelSwitching(e,t){this.clearTimer()}onError(e,t){if(!t.fatal)switch(t.details){case O.BUFFER_ADD_CODEC_ERROR:case O.BUFFER_APPEND_ERROR:this.lastLoadedFragLevel=-1,this.firstSelection=-1;break;case O.FRAG_LOAD_TIMEOUT:{const r=t.frag,{fragCurrent:i,partCurrent:s}=this;if(r&&i&&r.sn===i.sn&&r.level===i.level){const a=performance.now(),o=s?s.stats:r.stats,l=a-o.loading.start,u=o.loading.first?o.loading.first-o.loading.start:-1;if(o.loaded&&u>-1){const d=this.bwEstimator.getEstimateTTFB();this.bwEstimator.sample(l-Math.min(d,u),o.loaded)}else this.bwEstimator.sampleTTFB(l)}break}}}getTimeToLoadFrag(e,t,r,i){const s=e+r/t,a=i?e+this.lastLevelLoadSec:0;return s+a}onLevelLoaded(e,t){const r=this.hls.config,{loading:i}=t.stats,s=i.end-i.first;Z(s)&&(this.lastLevelLoadSec=s/1e3),t.details.live?this.bwEstimator.update(r.abrEwmaSlowLive,r.abrEwmaFastLive):this.bwEstimator.update(r.abrEwmaSlowVoD,r.abrEwmaFastVoD),this.timer>-1&&this._abandonRulesCheck(t.levelInfo)}onFragLoaded(e,{frag:t,part:r}){const i=r?r.stats:t.stats;if(t.type===ne.MAIN&&this.bwEstimator.sampleTTFB(i.loading.first-i.loading.start),!this.ignoreFragment(t)){if(this.clearTimer(),t.level===this._nextAutoLevel&&(this._nextAutoLevel=-1),this.firstSelection=-1,this.hls.config.abrMaxWithRealBitrate){const s=r?r.duration:t.duration,a=this.hls.levels[t.level],o=(a.loaded?a.loaded.bytes:0)+i.loaded,l=(a.loaded?a.loaded.duration:0)+s;a.loaded={bytes:o,duration:l},a.realBitrate=Math.round(8*o/l)}if(t.bitrateTest){const s={stats:i,frag:t,part:r,id:t.type};this.onFragBuffered(S.FRAG_BUFFERED,s),t.bitrateTest=!1}else this.lastLoadedFragLevel=t.level}}onFragBuffered(e,t){const{frag:r,part:i}=t,s=i!=null&&i.stats.loaded?i.stats:r.stats;if(s.aborted||this.ignoreFragment(r))return;const a=s.parsing.end-s.loading.start-Math.min(s.loading.first-s.loading.start,this.bwEstimator.getEstimateTTFB());this.bwEstimator.sample(a,s.loaded),s.bwEstimate=this.getBwEstimate(),r.bitrateTest?this.bitrateTestDelay=a/1e3:this.bitrateTestDelay=0}ignoreFragment(e){return e.type!==ne.MAIN||e.sn==="initSegment"}clearTimer(){this.timer>-1&&(self.clearInterval(this.timer),this.timer=-1)}get firstAutoLevel(){const{maxAutoLevel:e,minAutoLevel:t}=this.hls,r=this.getBwEstimate(),i=this.hls.config.maxStarvationDelay,s=this.findBestLevel(r,t,e,0,i,1,1);if(s>-1)return s;const a=this.hls.firstLevel,o=Math.min(Math.max(a,t),e);return this.warn(`Could not find best starting auto level. Defaulting to first in playlist ${a} clamped to ${o}`),o}get forcedAutoLevel(){return this.nextAutoLevelKey?-1:this._nextAutoLevel}get nextAutoLevel(){const e=this.forcedAutoLevel,r=this.bwEstimator.canEstimate(),i=this.lastLoadedFragLevel>-1;if(e!==-1&&(!r||!i||this.nextAutoLevelKey===this.getAutoLevelKey()))return e;const s=r&&i?this.getNextABRAutoLevel():this.firstAutoLevel;if(e!==-1){const a=this.hls.levels;if(a.length>Math.max(e,s)&&a[e].loadError<=a[s].loadError)return e}return this._nextAutoLevel=s,this.nextAutoLevelKey=this.getAutoLevelKey(),s}getAutoLevelKey(){return`${this.getBwEstimate()}_${this.getStarvationDelay().toFixed(2)}`}getNextABRAutoLevel(){const{fragCurrent:e,partCurrent:t,hls:r}=this;if(r.levels.length<=1)return r.loadLevel;const{maxAutoLevel:i,config:s,minAutoLevel:a}=r,o=t?t.duration:e?e.duration:0,l=this.getBwEstimate(),u=this.getStarvationDelay();let c=s.abrBandWidthFactor,d=s.abrBandWidthUpFactor;if(u){const y=this.findBestLevel(l,a,i,u,0,c,d);if(y>=0)return this.rebufferNotice=-1,y}let h=o?Math.min(o,s.maxStarvationDelay):s.maxStarvationDelay;if(!u){const y=this.bitrateTestDelay;y&&(h=(o?Math.min(o,s.maxLoadingDelay):s.maxLoadingDelay)-y,this.info(`bitrate test took ${Math.round(1e3*y)}ms, set first fragment max fetchDuration to ${Math.round(1e3*h)} ms`),c=d=1)}const f=this.findBestLevel(l,a,i,u,h,c,d);if(this.rebufferNotice!==f&&(this.rebufferNotice=f,this.info(`${u?"rebuffering expected":"buffer is empty"}, optimal quality level ${f}`)),f>-1)return f;const g=r.levels[a],m=r.loadLevelObj;return m&&(g==null?void 0:g.bitrate)<m.bitrate?a:r.loadLevel}getStarvationDelay(){const e=this.hls,t=e.media;if(!t)return 1/0;const r=t&&t.playbackRate!==0?Math.abs(t.playbackRate):1,i=e.mainForwardBufferInfo;return(i?i.len:0)/r}getBwEstimate(){return this.bwEstimator.canEstimate()?this.bwEstimator.getEstimate():this.hls.config.abrEwmaDefaultEstimate}findBestLevel(e,t,r,i,s,a,o){var l;const u=i+s,c=this.lastLoadedFragLevel,d=c===-1?this.hls.firstLevel:c,{fragCurrent:h,partCurrent:f}=this,{levels:g,allAudioTracks:m,loadLevel:y,config:p}=this.hls;if(g.length===1)return 0;const v=g[d],E=!!((l=this.hls.latestLevelDetails)!=null&&l.live),T=y===-1||c===-1;let A,I="SDR",R=(v==null?void 0:v.frameRate)||0;const{audioPreference:x,videoPreference:D}=p,_=this.audioTracksByGroup||(this.audioTracksByGroup=ex(m));let M=-1;if(T){if(this.firstSelection!==-1)return this.firstSelection;const V=this.codecTiers||(this.codecTiers=pb(g,_,t,r)),X=mb(V,I,e,x,D),{codecSet:B,videoRanges:F,minFramerate:U,minBitrate:Q,minIndex:q,preferHDR:oe}=X;M=q,A=B,I=oe?F[F.length-1]:F[0],R=U,e=Math.max(e,Q),this.log(`picked start tier ${Ve(X)}`)}else A=v==null?void 0:v.codecSet,I=v==null?void 0:v.videoRange;const j=f?f.duration:h?h.duration:0,z=this.bwEstimator.getEstimateTTFB()/1e3,H=[];for(let V=r;V>=t;V--){var W;const X=g[V],B=V>d;if(!X)continue;if(p.useMediaCapabilities&&!X.supportedResult&&!X.supportedPromise){const pe=navigator.mediaCapabilities;typeof(pe==null?void 0:pe.decodingInfo)=="function"&&(lb(X,_,I,R,e,x)||Tc(X.videoCodec))?(X.supportedPromise=JS(X,_,pe),X.supportedPromise.then(he=>{if(!this.hls)return;X.supportedResult=he;const Fe=this.hls.levels,Xe=Fe.indexOf(X);he.error?this.warn(`MediaCapabilities decodingInfo error: "${he.error}" for level ${Xe} ${Ve(he)}`):he.supported||(this.warn(`Unsupported MediaCapabilities decodingInfo result for level ${Xe} ${Ve(he)}`),Xe>-1&&Fe.length>1&&(this.log(`Removing unsupported level ${Xe}`),this.hls.removeLevel(Xe),this.hls.loadLevel===-1&&(this.hls.nextLoadLevel=0)))})):X.supportedResult=XS}if((A&&X.codecSet!==A||I&&X.videoRange!==I||B&&R>X.frameRate||!B&&R>0&&R<X.frameRate||X.supportedResult&&!((W=X.supportedResult.decodingInfoResults)!=null&&W[0].smooth))&&(!T||V!==M)){H.push(V);continue}const F=X.details,U=(f?F==null?void 0:F.partTarget:F==null?void 0:F.averagetargetduration)||j;let Q;B?Q=o*e:Q=a*e;const q=j&&i>=j*2&&s===0?X.averageBitrate:X.maxBitrate,oe=this.getTimeToLoadFrag(z,Q,q*U,F===void 0);if(Q>=q&&(V===c||X.loadError===0&&X.fragmentError===0)&&(oe<=z||!Z(oe)||E&&!this.bitrateTestDelay||oe<u)){const pe=this.forcedAutoLevel;return V!==y&&(pe===-1||pe!==y)&&(H.length&&this.trace(`Skipped level(s) ${H.join(",")} of ${r} max with CODECS and VIDEO-RANGE:"${g[H[0]].codecs}" ${g[H[0]].videoRange}; not compatible with "${A}" ${I}`),this.info(`switch candidate:${d}->${V} adjustedbw(${Math.round(Q)})-bitrate=${Math.round(Q-q)} ttfb:${z.toFixed(1)} avgDuration:${U.toFixed(1)} maxFetchDuration:${u.toFixed(1)} fetchDuration:${oe.toFixed(1)} firstSelection:${T} codecSet:${X.codecSet} videoRange:${X.videoRange} hls.loadLevel:${y}`)),T&&(this.firstSelection=V),V}}return-1}set nextAutoLevel(e){const t=this.deriveNextAutoLevel(e);this._nextAutoLevel!==t&&(this.nextAutoLevelKey="",this._nextAutoLevel=t)}deriveNextAutoLevel(e){const{maxAutoLevel:t,minAutoLevel:r}=this.hls;return Math.min(Math.max(e,r),t)}}const tx={search:function(n,e){let t=0,r=n.length-1,i=null,s=null;for(;t<=r;){i=(t+r)/2|0,s=n[i];const a=e(s);if(a>0)t=i+1;else if(a<0)r=i-1;else return s}return null}};function xb(n,e,t){if(e===null||!Array.isArray(n)||!n.length||!Z(e))return null;const r=n[0].programDateTime;if(e<(r||0))return null;const i=n[n.length-1].endProgramDateTime;if(e>=(i||0))return null;for(let s=0;s<n.length;++s){const a=n[s];if(Lb(e,t,a))return a}return null}function rs(n,e,t=0,r=0,i=.005){let s=null;if(n){s=e[1+n.sn-e[0].sn]||null;const o=n.endDTS-t;o>0&&o<15e-7&&(t+=15e-7),s&&n.level!==s.level&&s.end<=n.end&&(s=e[2+n.sn-e[0].sn]||null)}else t===0&&e[0].start===0&&(s=e[0]);if(s&&((!n||n.level===s.level)&&g0(t,r,s)===0||Tb(s,n,Math.min(i,r))))return s;const a=tx.search(e,g0.bind(null,t,r));return a&&(a!==n||!s)?a:s}function Tb(n,e,t){if(e&&e.start===0&&e.level<n.level&&(e.endPTS||0)>0){const r=e.tagList.reduce((i,s)=>(s[0]==="INF"&&(i+=parseFloat(s[1])),i),t);return n.start<=r}return!1}function g0(n=0,e=0,t){if(t.start<=n&&t.start+t.duration>n)return 0;const r=Math.min(e,t.duration+(t.deltaPTS?t.deltaPTS:0));return t.start+t.duration-r<=n?1:t.start-r>n&&t.start?-1:0}function Lb(n,e,t){const r=Math.min(e,t.duration+(t.deltaPTS?t.deltaPTS:0))*1e3;return(t.endProgramDateTime||0)-r>n}function nx(n,e,t){if(n&&n.startCC<=e&&n.endCC>=e){let r=n.fragments;const{fragmentHint:i}=n;i&&(r=r.concat(i));let s;return tx.search(r,a=>a.cc<e?1:a.cc>e?-1:(s=a,a.end<=t?1:a.start>t?-1:0)),s||null}return null}function Wu(n){switch(n.details){case O.FRAG_LOAD_TIMEOUT:case O.KEY_LOAD_TIMEOUT:case O.LEVEL_LOAD_TIMEOUT:case O.MANIFEST_LOAD_TIMEOUT:return!0}return!1}function m0(n,e){const t=Wu(e);return n.default[`${t?"timeout":"error"}Retry`]}function Lg(n,e){const t=n.backoff==="linear"?1:Math.pow(2,e);return Math.min(t*n.retryDelayMs,n.maxRetryDelayMs)}function p0(n){return Ce(Ce({},n),{errorRetry:null,timeoutRetry:null})}function Yu(n,e,t,r){if(!n)return!1;const i=r==null?void 0:r.code,s=e<n.maxNumRetry&&(Ab(i)||!!t);return n.shouldRetry?n.shouldRetry(n,e,t,r,s):s}function Ab(n){return n===0&&navigator.onLine===!1||!!n&&(n<400||n>499)}var It={DoNothing:0,SendEndCallback:1,SendAlternateToPenaltyBox:2,RemoveAlternatePermanently:3,InsertDiscontinuity:4,RetryRequest:5},In={None:0,MoveAllAlternatesMatchingHost:1,MoveAllAlternatesMatchingHDCP:2,SwitchToSDR:4};class Rb extends kr{constructor(e){super("error-controller",e.logger),this.hls=void 0,this.playlistError=0,this.penalizedRenditions={},this.hls=e,this.registerListeners()}registerListeners(){const e=this.hls;e.on(S.ERROR,this.onError,this),e.on(S.MANIFEST_LOADING,this.onManifestLoading,this),e.on(S.LEVEL_UPDATED,this.onLevelUpdated,this)}unregisterListeners(){const e=this.hls;e&&(e.off(S.ERROR,this.onError,this),e.off(S.ERROR,this.onErrorOut,this),e.off(S.MANIFEST_LOADING,this.onManifestLoading,this),e.off(S.LEVEL_UPDATED,this.onLevelUpdated,this))}destroy(){this.unregisterListeners(),this.hls=null,this.penalizedRenditions={}}startLoad(e){}stopLoad(){this.playlistError=0}getVariantLevelIndex(e){return(e==null?void 0:e.type)===ne.MAIN?e.level:this.hls.loadLevel}onManifestLoading(){this.playlistError=0,this.penalizedRenditions={}}onLevelUpdated(){this.playlistError=0}onError(e,t){var r;if(t.fatal)return;const i=this.hls,s=t.context;switch(t.details){case O.FRAG_LOAD_ERROR:case O.FRAG_LOAD_TIMEOUT:case O.KEY_LOAD_ERROR:case O.KEY_LOAD_TIMEOUT:t.errorAction=this.getFragRetryOrSwitchAction(t);return;case O.FRAG_PARSING_ERROR:if((r=t.frag)!=null&&r.gap){t.errorAction=Do();return}case O.FRAG_GAP:case O.FRAG_DECRYPT_ERROR:{t.errorAction=this.getFragRetryOrSwitchAction(t),t.errorAction.action=It.SendAlternateToPenaltyBox;return}case O.LEVEL_EMPTY_ERROR:case O.LEVEL_PARSING_ERROR:{var a,o;const u=t.parent===ne.MAIN?t.level:i.loadLevel;t.details===O.LEVEL_EMPTY_ERROR&&((a=t.context)!=null&&(o=a.levelDetails)!=null&&o.live)?t.errorAction=this.getPlaylistRetryOrSwitchAction(t,u):(t.levelRetry=!1,t.errorAction=this.getLevelSwitchAction(t,u))}return;case O.LEVEL_LOAD_ERROR:case O.LEVEL_LOAD_TIMEOUT:typeof(s==null?void 0:s.level)=="number"&&(t.errorAction=this.getPlaylistRetryOrSwitchAction(t,s.level));return;case O.AUDIO_TRACK_LOAD_ERROR:case O.AUDIO_TRACK_LOAD_TIMEOUT:case O.SUBTITLE_LOAD_ERROR:case O.SUBTITLE_TRACK_LOAD_TIMEOUT:if(s){const u=i.loadLevelObj;if(u&&(s.type===Se.AUDIO_TRACK&&u.hasAudioGroup(s.groupId)||s.type===Se.SUBTITLE_TRACK&&u.hasSubtitleGroup(s.groupId))){t.errorAction=this.getPlaylistRetryOrSwitchAction(t,i.loadLevel),t.errorAction.action=It.SendAlternateToPenaltyBox,t.errorAction.flags=In.MoveAllAlternatesMatchingHost;return}}return;case O.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED:{const u=i.loadLevelObj,c=u==null?void 0:u.attrs["HDCP-LEVEL"];c?t.errorAction={action:It.SendAlternateToPenaltyBox,flags:In.MoveAllAlternatesMatchingHDCP,hdcpLevel:c}:this.keySystemError(t)}return;case O.BUFFER_ADD_CODEC_ERROR:case O.REMUX_ALLOC_ERROR:case O.BUFFER_APPEND_ERROR:if(!t.errorAction){var l;t.errorAction=this.getLevelSwitchAction(t,(l=t.level)!=null?l:i.loadLevel)}return;case O.INTERNAL_EXCEPTION:case O.BUFFER_APPENDING_ERROR:case O.BUFFER_FULL_ERROR:case O.LEVEL_SWITCH_ERROR:case O.BUFFER_STALLED_ERROR:case O.BUFFER_SEEK_OVER_HOLE:case O.BUFFER_NUDGE_ON_STALL:t.errorAction=Do();return}t.type===re.KEY_SYSTEM_ERROR&&this.keySystemError(t)}keySystemError(e){const t=this.getVariantLevelIndex(e.frag);e.levelRetry=!1,e.errorAction=this.getLevelSwitchAction(e,t)}getPlaylistRetryOrSwitchAction(e,t){const r=this.hls,i=m0(r.config.playlistLoadPolicy,e),s=this.playlistError++;if(Yu(i,s,Wu(e),e.response))return{action:It.RetryRequest,flags:In.None,retryConfig:i,retryCount:s};const o=this.getLevelSwitchAction(e,t);return i&&(o.retryConfig=i,o.retryCount=s),o}getFragRetryOrSwitchAction(e){const t=this.hls,r=this.getVariantLevelIndex(e.frag),i=t.levels[r],{fragLoadPolicy:s,keyLoadPolicy:a}=t.config,o=m0(e.details.startsWith("key")?a:s,e),l=t.levels.reduce((c,d)=>c+d.fragmentError,0);if(i&&(e.details!==O.FRAG_GAP&&i.fragmentError++,Yu(o,l,Wu(e),e.response)))return{action:It.RetryRequest,flags:In.None,retryConfig:o,retryCount:l};const u=this.getLevelSwitchAction(e,r);return o&&(u.retryConfig=o,u.retryCount=l),u}getLevelSwitchAction(e,t){const r=this.hls;t==null&&(t=r.loadLevel);const i=this.hls.levels[t];if(i){var s,a;const u=e.details;i.loadError++,u===O.BUFFER_APPEND_ERROR&&i.fragmentError++;let c=-1;const{levels:d,loadLevel:h,minAutoLevel:f,maxAutoLevel:g}=r;!r.autoLevelEnabled&&!r.config.preserveManualLevelOnError&&(r.loadLevel=-1);const m=(s=e.frag)==null?void 0:s.type,p=(m===ne.AUDIO&&u===O.FRAG_PARSING_ERROR||e.sourceBufferName==="audio"&&(u===O.BUFFER_ADD_CODEC_ERROR||u===O.BUFFER_APPEND_ERROR))&&d.some(({audioCodec:I})=>i.audioCodec!==I),E=e.sourceBufferName==="video"&&(u===O.BUFFER_ADD_CODEC_ERROR||u===O.BUFFER_APPEND_ERROR)&&d.some(({codecSet:I,audioCodec:R})=>i.codecSet!==I&&i.audioCodec===R),{type:T,groupId:A}=(a=e.context)!=null?a:{};for(let I=d.length;I--;){const R=(I+h)%d.length;if(R!==h&&R>=f&&R<=g&&d[R].loadError===0){var o,l;const x=d[R];if(u===O.FRAG_GAP&&m===ne.MAIN&&e.frag){const D=d[R].details;if(D){const _=rs(e.frag,D.fragments,e.frag.start);if(_!=null&&_.gap)continue}}else{if(T===Se.AUDIO_TRACK&&x.hasAudioGroup(A)||T===Se.SUBTITLE_TRACK&&x.hasSubtitleGroup(A))continue;if(m===ne.AUDIO&&(o=i.audioGroups)!=null&&o.some(D=>x.hasAudioGroup(D))||m===ne.SUBTITLE&&(l=i.subtitleGroups)!=null&&l.some(D=>x.hasSubtitleGroup(D))||p&&i.audioCodec===x.audioCodec||!p&&i.audioCodec!==x.audioCodec||E&&i.codecSet===x.codecSet)continue}c=R;break}}if(c>-1&&r.loadLevel!==c)return e.levelRetry=!0,this.playlistError=0,{action:It.SendAlternateToPenaltyBox,flags:In.None,nextAutoLevel:c}}return{action:It.SendAlternateToPenaltyBox,flags:In.MoveAllAlternatesMatchingHost}}onErrorOut(e,t){var r;switch((r=t.errorAction)==null?void 0:r.action){case It.DoNothing:break;case It.SendAlternateToPenaltyBox:this.sendAlternateToPenaltyBox(t),!t.errorAction.resolved&&t.details!==O.FRAG_GAP?t.fatal=!0:/MediaSource readyState: ended/.test(t.error.message)&&(this.warn(`MediaSource ended after "${t.sourceBufferName}" sourceBuffer append error. Attempting to recover from media error.`),this.hls.recoverMediaError());break}if(t.fatal){this.hls.stopLoad();return}}sendAlternateToPenaltyBox(e){const t=this.hls,r=e.errorAction;if(!r)return;const{flags:i,hdcpLevel:s,nextAutoLevel:a}=r;switch(i){case In.None:this.switchLevel(e,a);break;case In.MoveAllAlternatesMatchingHDCP:s&&(t.maxHdcpLevel=qh[qh.indexOf(s)-1],r.resolved=!0),this.warn(`Restricting playback to HDCP-LEVEL of "${t.maxHdcpLevel}" or lower`);break}r.resolved||this.switchLevel(e,a)}switchLevel(e,t){if(t!==void 0&&e.errorAction&&(this.warn(`switching to level ${t} after ${e.details}`),this.hls.nextAutoLevel=t,e.errorAction.resolved=!0,this.hls.nextLoadLevel=this.hls.nextAutoLevel,e.details===O.BUFFER_ADD_CODEC_ERROR&&e.mimeType&&e.sourceBufferName!=="audiovideo")){const r=QS(e.mimeType),i=this.hls.levels;for(let s=i.length;s--;)i[s][`${e.sourceBufferName}Codec`]===r&&this.hls.removeLevel(s)}}}function Do(n){const e={action:It.DoNothing,flags:In.None};return n&&(e.resolved=!0),e}var ct={NOT_LOADED:"NOT_LOADED",APPENDING:"APPENDING",PARTIAL:"PARTIAL",OK:"OK"};class _b{constructor(e){this.activePartLists=Object.create(null),this.endListFragments=Object.create(null),this.fragments=Object.create(null),this.timeRanges=Object.create(null),this.bufferPadding=.2,this.hls=void 0,this.hasGaps=!1,this.hls=e,this._registerListeners()}_registerListeners(){const{hls:e}=this;e.on(S.MANIFEST_LOADING,this.onManifestLoading,this),e.on(S.BUFFER_APPENDED,this.onBufferAppended,this),e.on(S.FRAG_BUFFERED,this.onFragBuffered,this),e.on(S.FRAG_LOADED,this.onFragLoaded,this)}_unregisterListeners(){const{hls:e}=this;e.off(S.MANIFEST_LOADING,this.onManifestLoading,this),e.off(S.BUFFER_APPENDED,this.onBufferAppended,this),e.off(S.FRAG_BUFFERED,this.onFragBuffered,this),e.off(S.FRAG_LOADED,this.onFragLoaded,this)}destroy(){this._unregisterListeners(),this.fragments=this.activePartLists=this.endListFragments=this.timeRanges=null}getAppendedFrag(e,t){const r=this.activePartLists[t];if(r)for(let i=r.length;i--;){const s=r[i];if(!s)break;const a=s.end;if(s.start<=e&&a!==null&&e<=a)return s}return this.getBufferedFrag(e,t)}getBufferedFrag(e,t){return this.getFragAtPos(e,t,!0)}getFragAtPos(e,t,r){const{fragments:i}=this,s=Object.keys(i);for(let a=s.length;a--;){const o=i[s[a]];if((o==null?void 0:o.body.type)===t&&(!r||o.buffered)){const l=o.body;if(l.start<=e&&e<=l.end)return l}}return null}detectEvictedFragments(e,t,r,i,s){this.timeRanges&&(this.timeRanges[e]=t);const a=(i==null?void 0:i.fragment.sn)||-1;Object.keys(this.fragments).forEach(o=>{const l=this.fragments[o];if(!l||a>=l.body.sn)return;if(!l.buffered&&(!l.loaded||s)){l.body.type===r&&this.removeFragment(l.body);return}const u=l.range[e];if(u){if(u.time.length===0){this.removeFragment(l.body);return}u.time.some(c=>{const d=!this.isTimeBuffered(c.startPTS,c.endPTS,t);return d&&this.removeFragment(l.body),d})}})}detectPartialFragments(e){const t=this.timeRanges;if(!t||e.frag.sn==="initSegment")return;const r=e.frag,i=ms(r),s=this.fragments[i];if(!s||s.buffered&&r.gap)return;const a=!r.relurl;Object.keys(t).forEach(o=>{const l=r.elementaryStreams[o];if(!l)return;const u=t[o],c=a||l.partial===!0;s.range[o]=this.getBufferedTimes(r,e.part,c,u)}),s.loaded=null,Object.keys(s.range).length?(s.buffered=!0,(s.body.endList=r.endList||s.body.endList)&&(this.endListFragments[s.body.type]=s),bl(s)||this.removeParts(r.sn-1,r.type)):this.removeFragment(s.body)}removeParts(e,t){const r=this.activePartLists[t];r&&(this.activePartLists[t]=y0(r,i=>i.fragment.sn>=e))}fragBuffered(e,t){const r=ms(e);let i=this.fragments[r];!i&&t&&(i=this.fragments[r]={body:e,appendedPTS:null,loaded:null,buffered:!1,range:Object.create(null)},e.gap&&(this.hasGaps=!0)),i&&(i.loaded=null,i.buffered=!0)}getBufferedTimes(e,t,r,i){const s={time:[],partial:r},a=e.start,o=e.end,l=e.minEndPTS||o,u=e.maxStartPTS||a;for(let c=0;c<i.length;c++){const d=i.start(c)-this.bufferPadding,h=i.end(c)+this.bufferPadding;if(u>=d&&l<=h){s.time.push({startPTS:Math.max(a,i.start(c)),endPTS:Math.min(o,i.end(c))});break}else if(a<h&&o>d){const f=Math.max(a,i.start(c)),g=Math.min(o,i.end(c));g>f&&(s.partial=!0,s.time.push({startPTS:f,endPTS:g}))}else if(o<=d)break}return s}getPartialFragment(e){let t=null,r,i,s,a=0;const{bufferPadding:o,fragments:l}=this;return Object.keys(l).forEach(u=>{const c=l[u];c&&bl(c)&&(i=c.body.start-o,s=c.body.end+o,e>=i&&e<=s&&(r=Math.min(e-i,s-e),a<=r&&(t=c.body,a=r)))}),t}isEndListAppended(e){const t=this.endListFragments[e];return t!==void 0&&(t.buffered||bl(t))}getState(e){const t=ms(e),r=this.fragments[t];return r?r.buffered?bl(r)?ct.PARTIAL:ct.OK:ct.APPENDING:ct.NOT_LOADED}isTimeBuffered(e,t,r){let i,s;for(let a=0;a<r.length;a++){if(i=r.start(a)-this.bufferPadding,s=r.end(a)+this.bufferPadding,e>=i&&t<=s)return!0;if(t<=i)return!1}return!1}onManifestLoading(){this.removeAllFragments()}onFragLoaded(e,t){if(t.frag.sn==="initSegment"||t.frag.bitrateTest)return;const r=t.frag,i=t.part?null:t,s=ms(r);this.fragments[s]={body:r,appendedPTS:null,loaded:i,buffered:!1,range:Object.create(null)}}onBufferAppended(e,t){const{frag:r,part:i,timeRanges:s,type:a}=t;if(r.sn==="initSegment")return;const o=r.type;if(i){let u=this.activePartLists[o];u||(this.activePartLists[o]=u=[]),u.push(i)}this.timeRanges=s;const l=s[a];this.detectEvictedFragments(a,l,o,i)}onFragBuffered(e,t){this.detectPartialFragments(t)}hasFragment(e){const t=ms(e);return!!this.fragments[t]}hasFragments(e){const{fragments:t}=this,r=Object.keys(t);if(!e)return r.length>0;for(let i=r.length;i--;){const s=t[r[i]];if((s==null?void 0:s.body.type)===e)return!0}return!1}hasParts(e){var t;return!!((t=this.activePartLists[e])!=null&&t.length)}removeFragmentsInRange(e,t,r,i,s){i&&!this.hasGaps||Object.keys(this.fragments).forEach(a=>{const o=this.fragments[a];if(!o)return;const l=o.body;l.type!==r||i&&!l.gap||l.start<t&&l.end>e&&(o.buffered||s)&&this.removeFragment(l)})}removeFragment(e){const t=ms(e);e.clearElementaryStreamInfo();const r=this.activePartLists[e.type];if(r){const i=e.sn;this.activePartLists[e.type]=y0(r,s=>s.fragment.sn!==i)}delete this.fragments[t],e.endList&&delete this.endListFragments[e.type]}removeAllFragments(){var e,t;this.fragments=Object.create(null),this.endListFragments=Object.create(null),this.activePartLists=Object.create(null),this.hasGaps=!1;const r=(e=this.hls)==null||(t=e.latestLevelDetails)==null?void 0:t.partList;r&&r.forEach(i=>i.clearElementaryStreamInfo())}}function bl(n){var e,t,r;return n.buffered&&(n.body.gap||((e=n.range.video)==null?void 0:e.partial)||((t=n.range.audio)==null?void 0:t.partial)||((r=n.range.audiovideo)==null?void 0:r.partial))}function ms(n){return`${n.type}_${n.level}_${n.sn}`}function y0(n,e){return n.filter(t=>{const r=e(t);return r||t.clearElementaryStreamInfo(),r})}var Ei={cbc:0,ctr:1};class Ib{constructor(e,t,r){this.subtle=void 0,this.aesIV=void 0,this.aesMode=void 0,this.subtle=e,this.aesIV=t,this.aesMode=r}decrypt(e,t){switch(this.aesMode){case Ei.cbc:return this.subtle.decrypt({name:"AES-CBC",iv:this.aesIV},t,e);case Ei.ctr:return this.subtle.decrypt({name:"AES-CTR",counter:this.aesIV,length:64},t,e);default:throw new Error(`[AESCrypto] invalid aes mode ${this.aesMode}`)}}}function Db(n){const e=n.byteLength,t=e&&new DataView(n.buffer).getUint8(e-1);return t?n.slice(0,e-t):n}class Cb{constructor(){this.rcon=[0,1,2,4,8,16,32,64,128,27,54],this.subMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.invSubMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.sBox=new Uint32Array(256),this.invSBox=new Uint32Array(256),this.key=new Uint32Array(0),this.ksRows=0,this.keySize=0,this.keySchedule=void 0,this.invKeySchedule=void 0,this.initTable()}uint8ArrayToUint32Array_(e){const t=new DataView(e),r=new Uint32Array(4);for(let i=0;i<4;i++)r[i]=t.getUint32(i*4);return r}initTable(){const e=this.sBox,t=this.invSBox,r=this.subMix,i=r[0],s=r[1],a=r[2],o=r[3],l=this.invSubMix,u=l[0],c=l[1],d=l[2],h=l[3],f=new Uint32Array(256);let g=0,m=0,y=0;for(y=0;y<256;y++)y<128?f[y]=y<<1:f[y]=y<<1^283;for(y=0;y<256;y++){let p=m^m<<1^m<<2^m<<3^m<<4;p=p>>>8^p&255^99,e[g]=p,t[p]=g;const v=f[g],E=f[v],T=f[E];let A=f[p]*257^p*16843008;i[g]=A<<24|A>>>8,s[g]=A<<16|A>>>16,a[g]=A<<8|A>>>24,o[g]=A,A=T*16843009^E*65537^v*257^g*16843008,u[p]=A<<24|A>>>8,c[p]=A<<16|A>>>16,d[p]=A<<8|A>>>24,h[p]=A,g?(g=v^f[f[f[T^v]]],m^=f[f[m]]):g=m=1}}expandKey(e){const t=this.uint8ArrayToUint32Array_(e);let r=!0,i=0;for(;i<t.length&&r;)r=t[i]===this.key[i],i++;if(r)return;this.key=t;const s=this.keySize=t.length;if(s!==4&&s!==6&&s!==8)throw new Error("Invalid aes key size="+s);const a=this.ksRows=(s+6+1)*4;let o,l;const u=this.keySchedule=new Uint32Array(a),c=this.invKeySchedule=new Uint32Array(a),d=this.sBox,h=this.rcon,f=this.invSubMix,g=f[0],m=f[1],y=f[2],p=f[3];let v,E;for(o=0;o<a;o++){if(o<s){v=u[o]=t[o];continue}E=v,o%s===0?(E=E<<8|E>>>24,E=d[E>>>24]<<24|d[E>>>16&255]<<16|d[E>>>8&255]<<8|d[E&255],E^=h[o/s|0]<<24):s>6&&o%s===4&&(E=d[E>>>24]<<24|d[E>>>16&255]<<16|d[E>>>8&255]<<8|d[E&255]),u[o]=v=(u[o-s]^E)>>>0}for(l=0;l<a;l++)o=a-l,l&3?E=u[o]:E=u[o-4],l<4||o<=4?c[l]=E:c[l]=g[d[E>>>24]]^m[d[E>>>16&255]]^y[d[E>>>8&255]]^p[d[E&255]],c[l]=c[l]>>>0}networkToHostOrderSwap(e){return e<<24|(e&65280)<<8|(e&16711680)>>8|e>>>24}decrypt(e,t,r){const i=this.keySize+6,s=this.invKeySchedule,a=this.invSBox,o=this.invSubMix,l=o[0],u=o[1],c=o[2],d=o[3],h=this.uint8ArrayToUint32Array_(r);let f=h[0],g=h[1],m=h[2],y=h[3];const p=new Int32Array(e),v=new Int32Array(p.length);let E,T,A,I,R,x,D,_,M,j,z,H,W,V;const X=this.networkToHostOrderSwap;for(;t<p.length;){for(M=X(p[t]),j=X(p[t+1]),z=X(p[t+2]),H=X(p[t+3]),R=M^s[0],x=H^s[1],D=z^s[2],_=j^s[3],W=4,V=1;V<i;V++)E=l[R>>>24]^u[x>>16&255]^c[D>>8&255]^d[_&255]^s[W],T=l[x>>>24]^u[D>>16&255]^c[_>>8&255]^d[R&255]^s[W+1],A=l[D>>>24]^u[_>>16&255]^c[R>>8&255]^d[x&255]^s[W+2],I=l[_>>>24]^u[R>>16&255]^c[x>>8&255]^d[D&255]^s[W+3],R=E,x=T,D=A,_=I,W=W+4;E=a[R>>>24]<<24^a[x>>16&255]<<16^a[D>>8&255]<<8^a[_&255]^s[W],T=a[x>>>24]<<24^a[D>>16&255]<<16^a[_>>8&255]<<8^a[R&255]^s[W+1],A=a[D>>>24]<<24^a[_>>16&255]<<16^a[R>>8&255]<<8^a[x&255]^s[W+2],I=a[_>>>24]<<24^a[R>>16&255]<<16^a[x>>8&255]<<8^a[D&255]^s[W+3],v[t]=X(E^f),v[t+1]=X(I^g),v[t+2]=X(A^m),v[t+3]=X(T^y),f=M,g=j,m=z,y=H,t=t+4}return v.buffer}}class wb{constructor(e,t,r){this.subtle=void 0,this.key=void 0,this.aesMode=void 0,this.subtle=e,this.key=t,this.aesMode=r}expandKey(){const e=bb(this.aesMode);return this.subtle.importKey("raw",this.key,{name:e},!1,["encrypt","decrypt"])}}function bb(n){switch(n){case Ei.cbc:return"AES-CBC";case Ei.ctr:return"AES-CTR";default:throw new Error(`[FastAESKey] invalid aes mode ${n}`)}}const kb=16;class Ag{constructor(e,{removePKCS7Padding:t=!0}={}){if(this.logEnabled=!0,this.removePKCS7Padding=void 0,this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null,this.useSoftware=void 0,this.enableSoftwareAES=void 0,this.enableSoftwareAES=e.enableSoftwareAES,this.removePKCS7Padding=t,t)try{const r=self.crypto;r&&(this.subtle=r.subtle||r.webkitSubtle)}catch{}this.useSoftware=!this.subtle}destroy(){this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null}isSync(){return this.useSoftware}flush(){const{currentResult:e,remainderData:t}=this;if(!e||t)return this.reset(),null;const r=new Uint8Array(e);return this.reset(),this.removePKCS7Padding?Db(r):r}reset(){this.currentResult=null,this.currentIV=null,this.remainderData=null,this.softwareDecrypter&&(this.softwareDecrypter=null)}decrypt(e,t,r,i){return this.useSoftware?new Promise((s,a)=>{const o=ArrayBuffer.isView(e)?e:new Uint8Array(e);this.softwareDecrypt(o,t,r,i);const l=this.flush();l?s(l.buffer):a(new Error("[softwareDecrypt] Failed to decrypt data"))}):this.webCryptoDecrypt(new Uint8Array(e),t,r,i)}softwareDecrypt(e,t,r,i){const{currentIV:s,currentResult:a,remainderData:o}=this;if(i!==Ei.cbc||t.byteLength!==16)return Ie.warn("SoftwareDecrypt: can only handle AES-128-CBC"),null;this.logOnce("JS AES decrypt"),o&&(e=Tn(o,e),this.remainderData=null);const l=this.getValidChunk(e);if(!l.length)return null;s&&(r=s);let u=this.softwareDecrypter;u||(u=this.softwareDecrypter=new Cb),u.expandKey(t);const c=a;return this.currentResult=u.decrypt(l.buffer,0,r),this.currentIV=l.slice(-16).buffer,c||null}webCryptoDecrypt(e,t,r,i){if(this.key!==t||!this.fastAesKey){if(!this.subtle)return Promise.resolve(this.onWebCryptoError(e,t,r,i));this.key=t,this.fastAesKey=new wb(this.subtle,t,i)}return this.fastAesKey.expandKey().then(s=>this.subtle?(this.logOnce("WebCrypto AES decrypt"),new Ib(this.subtle,new Uint8Array(r),i).decrypt(e.buffer,s)):Promise.reject(new Error("web crypto not initialized"))).catch(s=>(Ie.warn(`[decrypter]: WebCrypto Error, disable WebCrypto API, ${s.name}: ${s.message}`),this.onWebCryptoError(e,t,r,i)))}onWebCryptoError(e,t,r,i){const s=this.enableSoftwareAES;if(s){this.useSoftware=!0,this.logEnabled=!0,this.softwareDecrypt(e,t,r,i);const a=this.flush();if(a)return a.buffer}throw new Error("WebCrypto"+(s?" and softwareDecrypt":"")+": failed to decrypt data")}getValidChunk(e){let t=e;const r=e.length-e.length%kb;return r!==e.length&&(t=e.slice(0,r),this.remainderData=e.slice(r)),t}logOnce(e){this.logEnabled&&(Ie.log(`[decrypter]: ${e}`),this.logEnabled=!1)}}const v0=Math.pow(2,17);class Pb{constructor(e){this.config=void 0,this.loader=null,this.partLoadTimeout=-1,this.config=e}destroy(){this.loader&&(this.loader.destroy(),this.loader=null)}abort(){this.loader&&this.loader.abort()}load(e,t){const r=e.url;if(!r)return Promise.reject(new pr({type:re.NETWORK_ERROR,details:O.FRAG_LOAD_ERROR,fatal:!1,frag:e,error:new Error(`Fragment does not have a ${r?"part list":"url"}`),networkDetails:null}));this.abort();const i=this.config,s=i.fLoader,a=i.loader;return new Promise((o,l)=>{if(this.loader&&this.loader.destroy(),e.gap)if(e.tagList.some(g=>g[0]==="GAP")){l(S0(e));return}else e.gap=!1;const u=this.loader=s?new s(i):new a(i),c=E0(e);e.loader=u;const d=p0(i.fragLoadPolicy.default),h={loadPolicy:d,timeout:d.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0,highWaterMark:e.sn==="initSegment"?1/0:v0};e.stats=u.stats;const f={onSuccess:(g,m,y,p)=>{this.resetLoader(e,u);let v=g.data;y.resetIV&&e.decryptdata&&(e.decryptdata.iv=new Uint8Array(v.slice(0,16)),v=v.slice(16)),o({frag:e,part:null,payload:v,networkDetails:p})},onError:(g,m,y,p)=>{this.resetLoader(e,u),l(new pr({type:re.NETWORK_ERROR,details:O.FRAG_LOAD_ERROR,fatal:!1,frag:e,response:Ce({url:r,data:void 0},g),error:new Error(`HTTP Error ${g.code} ${g.text}`),networkDetails:y,stats:p}))},onAbort:(g,m,y)=>{this.resetLoader(e,u),l(new pr({type:re.NETWORK_ERROR,details:O.INTERNAL_ABORTED,fatal:!1,frag:e,error:new Error("Aborted"),networkDetails:y,stats:g}))},onTimeout:(g,m,y)=>{this.resetLoader(e,u),l(new pr({type:re.NETWORK_ERROR,details:O.FRAG_LOAD_TIMEOUT,fatal:!1,frag:e,error:new Error(`Timeout after ${h.timeout}ms`),networkDetails:y,stats:g}))}};t&&(f.onProgress=(g,m,y,p)=>t({frag:e,part:null,payload:y,networkDetails:p})),u.load(c,h,f)})}loadPart(e,t,r){this.abort();const i=this.config,s=i.fLoader,a=i.loader;return new Promise((o,l)=>{if(this.loader&&this.loader.destroy(),e.gap||t.gap){l(S0(e,t));return}const u=this.loader=s?new s(i):new a(i),c=E0(e,t);e.loader=u;const d=p0(i.fragLoadPolicy.default),h={loadPolicy:d,timeout:d.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0,highWaterMark:v0};t.stats=u.stats,u.load(c,h,{onSuccess:(f,g,m,y)=>{this.resetLoader(e,u),this.updateStatsFromPart(e,t);const p={frag:e,part:t,payload:f.data,networkDetails:y};r(p),o(p)},onError:(f,g,m,y)=>{this.resetLoader(e,u),l(new pr({type:re.NETWORK_ERROR,details:O.FRAG_LOAD_ERROR,fatal:!1,frag:e,part:t,response:Ce({url:c.url,data:void 0},f),error:new Error(`HTTP Error ${f.code} ${f.text}`),networkDetails:m,stats:y}))},onAbort:(f,g,m)=>{e.stats.aborted=t.stats.aborted,this.resetLoader(e,u),l(new pr({type:re.NETWORK_ERROR,details:O.INTERNAL_ABORTED,fatal:!1,frag:e,part:t,error:new Error("Aborted"),networkDetails:m,stats:f}))},onTimeout:(f,g,m)=>{this.resetLoader(e,u),l(new pr({type:re.NETWORK_ERROR,details:O.FRAG_LOAD_TIMEOUT,fatal:!1,frag:e,part:t,error:new Error(`Timeout after ${h.timeout}ms`),networkDetails:m,stats:f}))}})})}updateStatsFromPart(e,t){const r=e.stats,i=t.stats,s=i.total;if(r.loaded+=i.loaded,s){const l=Math.round(e.duration/t.duration),u=Math.min(Math.round(r.loaded/s),l),d=(l-u)*Math.round(r.loaded/u);r.total=r.loaded+d}else r.total=Math.max(r.loaded,r.total);const a=r.loading,o=i.loading;a.start?a.first+=o.first-o.start:(a.start=o.start,a.first=o.first),a.end=o.end}resetLoader(e,t){e.loader=null,this.loader===t&&(self.clearTimeout(this.partLoadTimeout),this.loader=null),t.destroy()}}function E0(n,e=null){const t=e||n,r={frag:n,part:e,responseType:"arraybuffer",url:t.url,headers:{},rangeStart:0,rangeEnd:0},i=t.byteRangeStartOffset,s=t.byteRangeEndOffset;if(Z(i)&&Z(s)){var a;let o=i,l=s;if(n.sn==="initSegment"&&Ob((a=n.decryptdata)==null?void 0:a.method)){const u=s-i;u%16&&(l=s+(16-u%16)),i!==0&&(r.resetIV=!0,o=i-16)}r.rangeStart=o,r.rangeEnd=l}return r}function S0(n,e){const t=new Error(`GAP ${n.gap?"tag":"attribute"} found`),r={type:re.MEDIA_ERROR,details:O.FRAG_GAP,fatal:!1,frag:n,error:t,networkDetails:null};return e&&(r.part=e),(e||n).stats.aborted=!0,new pr(r)}function Ob(n){return n==="AES-128"||n==="AES-256"}class pr extends Error{constructor(e){super(e.error.message),this.data=void 0,this.data=e}}class rx extends kr{constructor(e,t){super(e,t),this._boundTick=void 0,this._tickTimer=null,this._tickInterval=null,this._tickCallCount=0,this._boundTick=this.tick.bind(this)}destroy(){this.onHandlerDestroying(),this.onHandlerDestroyed()}onHandlerDestroying(){this.clearNextTick(),this.clearInterval()}onHandlerDestroyed(){}hasInterval(){return!!this._tickInterval}hasNextTick(){return!!this._tickTimer}setInterval(e){return this._tickInterval?!1:(this._tickCallCount=0,this._tickInterval=self.setInterval(this._boundTick,e),!0)}clearInterval(){return this._tickInterval?(self.clearInterval(this._tickInterval),this._tickInterval=null,!0):!1}clearNextTick(){return this._tickTimer?(self.clearTimeout(this._tickTimer),this._tickTimer=null,!0):!1}tick(){this._tickCallCount++,this._tickCallCount===1&&(this.doTick(),this._tickCallCount>1&&this.tickImmediate(),this._tickCallCount=0)}tickImmediate(){this.clearNextTick(),this._tickTimer=self.setTimeout(this._boundTick,0)}doTick(){}}class Rg{constructor(e,t,r,i=0,s=-1,a=!1){this.level=void 0,this.sn=void 0,this.part=void 0,this.id=void 0,this.size=void 0,this.partial=void 0,this.transmuxing=kl(),this.buffering={audio:kl(),video:kl(),audiovideo:kl()},this.level=e,this.sn=t,this.id=r,this.size=i,this.part=s,this.partial=a}}function kl(){return{start:0,executeStart:0,executeEnd:0,end:0}}const x0={length:0,start:()=>0,end:()=>0};class ge{static isBuffered(e,t){if(e){const r=ge.getBuffered(e);for(let i=r.length;i--;)if(t>=r.start(i)&&t<=r.end(i))return!0}return!1}static bufferedRanges(e){if(e){const t=ge.getBuffered(e);return ge.timeRangesToArray(t)}return[]}static timeRangesToArray(e){const t=[];for(let r=0;r<e.length;r++)t.push({start:e.start(r),end:e.end(r)});return t}static bufferInfo(e,t,r){if(e){const i=ge.bufferedRanges(e);if(i.length)return ge.bufferedInfo(i,t,r)}return{len:0,start:t,end:t,bufferedIndex:-1}}static bufferedInfo(e,t,r){t=Math.max(0,t),e.length>1&&e.sort((c,d)=>c.start-d.start||d.end-c.end);let i=-1,s=[];if(r)for(let c=0;c<e.length;c++){t>=e[c].start&&t<=e[c].end&&(i=c);const d=s.length;if(d){const h=s[d-1].end;e[c].start-h<r?e[c].end>h&&(s[d-1].end=e[c].end):s.push(e[c])}else s.push(e[c])}else s=e;let a=0,o,l=t,u=t;for(let c=0;c<s.length;c++){const d=s[c].start,h=s[c].end;if(i===-1&&t>=d&&t<=h&&(i=c),t+r>=d&&t<h)l=d,u=h,a=u-t;else if(t+r<d){o=d;break}}return{len:a,start:l||0,end:u||0,nextStart:o,buffered:e,bufferedIndex:i}}static getBuffered(e){try{return e.buffered||x0}catch(t){return Ie.log("failed to get media.buffered",t),x0}}}const ix=/\{\$([a-zA-Z0-9-_]+)\}/g;function T0(n){return ix.test(n)}function Qh(n,e){if(n.variableList!==null||n.hasVariableRefs){const t=n.variableList;return e.replace(ix,r=>{const i=r.substring(2,r.length-1),s=t==null?void 0:t[i];return s===void 0?(n.playlistParsingError||(n.playlistParsingError=new Error(`Missing preceding EXT-X-DEFINE tag for Variable Reference: "${i}"`)),r):s})}return e}function L0(n,e,t){let r=n.variableList;r||(n.variableList=r={});let i,s;if("QUERYPARAM"in e){i=e.QUERYPARAM;try{const a=new self.URL(t).searchParams;if(a.has(i))s=a.get(i);else throw new Error(`"${i}" does not match any query parameter in URI: "${t}"`)}catch(a){n.playlistParsingError||(n.playlistParsingError=new Error(`EXT-X-DEFINE QUERYPARAM: ${a.message}`))}}else i=e.NAME,s=e.VALUE;i in r?n.playlistParsingError||(n.playlistParsingError=new Error(`EXT-X-DEFINE duplicate Variable Name declarations: "${i}"`)):r[i]=s||""}function Fb(n,e,t){const r=e.IMPORT;if(t&&r in t){let i=n.variableList;i||(n.variableList=i={}),i[r]=t[r]}else n.playlistParsingError||(n.playlistParsingError=new Error(`EXT-X-DEFINE IMPORT attribute not found in Multivariant Playlist: "${r}"`))}const Mb=/^(\d+)x(\d+)$/,A0=/(.+?)=(".*?"|.*?)(?:,|$)/g;class He{constructor(e,t){typeof e=="string"&&(e=He.parseAttrList(e,t)),Oe(this,e)}get clientAttrs(){return Object.keys(this).filter(e=>e.substring(0,2)==="X-")}decimalInteger(e){const t=parseInt(this[e],10);return t>Number.MAX_SAFE_INTEGER?1/0:t}hexadecimalInteger(e){if(this[e]){let t=(this[e]||"0x").slice(2);t=(t.length&1?"0":"")+t;const r=new Uint8Array(t.length/2);for(let i=0;i<t.length/2;i++)r[i]=parseInt(t.slice(i*2,i*2+2),16);return r}return null}hexadecimalIntegerAsNumber(e){const t=parseInt(this[e],16);return t>Number.MAX_SAFE_INTEGER?1/0:t}decimalFloatingPoint(e){return parseFloat(this[e])}optionalFloat(e,t){const r=this[e];return r?parseFloat(r):t}enumeratedString(e){return this[e]}enumeratedStringList(e,t){const r=this[e];return(r?r.split(/[ ,]+/):[]).reduce((i,s)=>(i[s.toLowerCase()]=!0,i),t)}bool(e){return this[e]==="YES"}decimalResolution(e){const t=Mb.exec(this[e]);if(t!==null)return{width:parseInt(t[1],10),height:parseInt(t[2],10)}}static parseAttrList(e,t){let r;const i={},s='"';for(A0.lastIndex=0;(r=A0.exec(e))!==null;){const a=r[1].trim();let o=r[2];const l=o.indexOf(s)===0&&o.lastIndexOf(s)===o.length-1;let u=!1;if(l)o=o.slice(1,-1);else switch(a){case"IV":case"SCTE35-CMD":case"SCTE35-IN":case"SCTE35-OUT":u=!0}if(t&&(l||u))o=Qh(t,o);else if(!u&&!l)switch(a){case"CLOSED-CAPTIONS":if(o==="NONE")break;case"ALLOWED-CPC":case"CLASS":case"ASSOC-LANGUAGE":case"AUDIO":case"BYTERANGE":case"CHANNELS":case"CHARACTERISTICS":case"CODECS":case"DATA-ID":case"END-DATE":case"GROUP-ID":case"ID":case"IMPORT":case"INSTREAM-ID":case"KEYFORMAT":case"KEYFORMATVERSIONS":case"LANGUAGE":case"NAME":case"PATHWAY-ID":case"QUERYPARAM":case"RECENTLY-REMOVED-DATERANGES":case"SERVER-URI":case"STABLE-RENDITION-ID":case"STABLE-VARIANT-ID":case"START-DATE":case"SUBTITLES":case"SUPPLEMENTAL-CODECS":case"URI":case"VALUE":case"VIDEO":case"X-ASSET-LIST":case"X-ASSET-URI":Ie.warn(`${e}: attribute ${a} is missing quotes`)}i[a]=o}return i}}const Nb="com.apple.hls.interstitial";function Ub(n){return n!=="ID"&&n!=="CLASS"&&n!=="CUE"&&n!=="START-DATE"&&n!=="DURATION"&&n!=="END-DATE"&&n!=="END-ON-NEXT"}function Bb(n){return n==="SCTE35-OUT"||n==="SCTE35-IN"||n==="SCTE35-CMD"}class sx{constructor(e,t,r=0){var i;if(this.attr=void 0,this.tagAnchor=void 0,this.tagOrder=void 0,this._startDate=void 0,this._endDate=void 0,this._dateAtEnd=void 0,this._cue=void 0,this._badValueForSameId=void 0,this.tagAnchor=(t==null?void 0:t.tagAnchor)||null,this.tagOrder=(i=t==null?void 0:t.tagOrder)!=null?i:r,t){const s=t.attr;for(const a in s)if(Object.prototype.hasOwnProperty.call(e,a)&&e[a]!==s[a]){Ie.warn(`DATERANGE tag attribute: "${a}" does not match for tags with ID: "${e.ID}"`),this._badValueForSameId=a;break}e=Oe(new He({}),s,e)}if(this.attr=e,t?(this._startDate=t._startDate,this._cue=t._cue,this._endDate=t._endDate,this._dateAtEnd=t._dateAtEnd):this._startDate=new Date(e["START-DATE"]),"END-DATE"in this.attr){const s=(t==null?void 0:t.endDate)||new Date(this.attr["END-DATE"]);Z(s.getTime())&&(this._endDate=s)}}get id(){return this.attr.ID}get class(){return this.attr.CLASS}get cue(){const e=this._cue;return e===void 0?this._cue=this.attr.enumeratedStringList(this.attr.CUE?"CUE":"X-CUE",{pre:!1,post:!1,once:!1}):e}get startTime(){const{tagAnchor:e}=this;return e===null||e.programDateTime===null?(Ie.warn(`Expected tagAnchor Fragment with PDT set for DateRange "${this.id}": ${e}`),NaN):e.start+(this.startDate.getTime()-e.programDateTime)/1e3}get startDate(){return this._startDate}get endDate(){const e=this._endDate||this._dateAtEnd;if(e)return e;const t=this.duration;return t!==null?this._dateAtEnd=new Date(this._startDate.getTime()+t*1e3):null}get duration(){if("DURATION"in this.attr){const e=this.attr.decimalFloatingPoint("DURATION");if(Z(e))return e}else if(this._endDate)return(this._endDate.getTime()-this._startDate.getTime())/1e3;return null}get plannedDuration(){return"PLANNED-DURATION"in this.attr?this.attr.decimalFloatingPoint("PLANNED-DURATION"):null}get endOnNext(){return this.attr.bool("END-ON-NEXT")}get isInterstitial(){return this.class===Nb}get isValid(){return!!this.id&&!this._badValueForSameId&&Z(this.startDate.getTime())&&(this.duration===null||this.duration>=0)&&(!this.endOnNext||!!this.class)&&(!this.attr.CUE||!this.cue.pre&&!this.cue.post||this.cue.pre!==this.cue.post)&&(!this.isInterstitial||"X-ASSET-URI"in this.attr||"X-ASSET-LIST"in this.attr)}}const $b=10;class jb{constructor(e){this.PTSKnown=!1,this.alignedSliding=!1,this.averagetargetduration=void 0,this.endCC=0,this.endSN=0,this.fragments=void 0,this.fragmentHint=void 0,this.partList=null,this.dateRanges=void 0,this.dateRangeTagCount=0,this.live=!0,this.requestScheduled=-1,this.ageHeader=0,this.advancedDateTime=void 0,this.updated=!0,this.advanced=!0,this.misses=0,this.startCC=0,this.startSN=0,this.startTimeOffset=null,this.targetduration=0,this.totalduration=0,this.type=null,this.url=void 0,this.m3u8="",this.version=null,this.canBlockReload=!1,this.canSkipUntil=0,this.canSkipDateRanges=!1,this.skippedSegments=0,this.recentlyRemovedDateranges=void 0,this.partHoldBack=0,this.holdBack=0,this.partTarget=0,this.preloadHint=void 0,this.renditionReports=void 0,this.tuneInGoal=0,this.deltaUpdateFailed=void 0,this.driftStartTime=0,this.driftEndTime=0,this.driftStart=0,this.driftEnd=0,this.encryptedFragments=void 0,this.playlistParsingError=null,this.variableList=null,this.hasVariableRefs=!1,this.appliedTimelineOffset=void 0,this.fragments=[],this.encryptedFragments=[],this.dateRanges={},this.url=e}reloaded(e){if(!e){this.advanced=!0,this.updated=!0;return}const t=this.lastPartSn-e.lastPartSn,r=this.lastPartIndex-e.lastPartIndex;this.updated=this.endSN!==e.endSN||!!r||!!t||!this.live,this.advanced=this.endSN>e.endSN||t>0||t===0&&r>0,this.updated||this.advanced?this.misses=Math.floor(e.misses*.6):this.misses=e.misses+1}get hasProgramDateTime(){return this.fragments.length?Z(this.fragments[this.fragments.length-1].programDateTime):!1}get levelTargetDuration(){return this.averagetargetduration||this.targetduration||$b}get drift(){const e=this.driftEndTime-this.driftStartTime;return e>0?(this.driftEnd-this.driftStart)*1e3/e:1}get edge(){return this.partEnd||this.fragmentEnd}get partEnd(){var e;return(e=this.partList)!=null&&e.length?this.partList[this.partList.length-1].end:this.fragmentEnd}get fragmentEnd(){var e;return(e=this.fragments)!=null&&e.length?this.fragments[this.fragments.length-1].end:0}get fragmentStart(){var e;return(e=this.fragments)!=null&&e.length?this.fragments[0].start:0}get age(){return this.advancedDateTime?Math.max(Date.now()-this.advancedDateTime,0)/1e3:0}get lastPartIndex(){var e;return(e=this.partList)!=null&&e.length?this.partList[this.partList.length-1].index:-1}get maxPartIndex(){const e=this.partList;if(e){const t=this.lastPartIndex;if(t!==-1){for(let r=e.length;r--;)if(e[r].index>t)return e[r].index;return t}}return 0}get lastPartSn(){var e;return(e=this.partList)!=null&&e.length?this.partList[this.partList.length-1].fragment.sn:this.endSN}get expired(){if(this.live&&this.age&&this.misses<3){const e=this.partEnd-this.fragmentStart;return this.age>Math.max(e,this.totalduration)+this.levelTargetDuration}return!1}}function Gs(n){return n==="AES-128"||n==="AES-256"||n==="AES-256-CTR"}function _g(n){switch(n){case"AES-128":case"AES-256":return Ei.cbc;case"AES-256-CTR":return Ei.ctr;default:throw new Error(`invalid full segment method ${n}`)}}function Ig(n){return Uint8Array.from(atob(n),e=>e.charCodeAt(0))}function Xh(n){return Uint8Array.from(unescape(encodeURIComponent(n)),e=>e.charCodeAt(0))}function Gb(n){const e=Xh(n).subarray(0,16),t=new Uint8Array(16);return t.set(e,16-e.length),t}function Kb(n){const e=function(r,i,s){const a=r[i];r[i]=r[s],r[s]=a};e(n,0,3),e(n,1,2),e(n,4,5),e(n,6,7)}function Vb(n){const e=n.split(":");let t=null;if(e[0]==="data"&&e.length===2){const r=e[1].split(";"),i=r[r.length-1].split(",");if(i.length===2){const s=i[0]==="base64",a=i[1];s?(r.splice(-1,1),t=Ig(a)):t=Gb(a)}}return t}const qu=typeof self<"u"?self:void 0;var we={CLEARKEY:"org.w3.clearkey",FAIRPLAY:"com.apple.fps",PLAYREADY:"com.microsoft.playready",WIDEVINE:"com.widevine.alpha"},Gt={CLEARKEY:"org.w3.clearkey",FAIRPLAY:"com.apple.streamingkeydelivery",PLAYREADY:"com.microsoft.playready",WIDEVINE:"urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed"};function lu(n){switch(n){case Gt.FAIRPLAY:return we.FAIRPLAY;case Gt.PLAYREADY:return we.PLAYREADY;case Gt.WIDEVINE:return we.WIDEVINE;case Gt.CLEARKEY:return we.CLEARKEY}}var Pl={CENC:"1077efecc0b24d02ace33c1e52e2fb4b",CLEARKEY:"e2719d58a985b3c9781ab030af78d30e",PLAYREADY:"9a04f07998404286ab92e65be0885f95",WIDEVINE:"edef8ba979d64acea3c827dcd51d21ed"};function Ed(n){if(n===Pl.WIDEVINE)return we.WIDEVINE;if(n===Pl.PLAYREADY)return we.PLAYREADY;if(n===Pl.CENC||n===Pl.CLEARKEY)return we.CLEARKEY}function Ol(n){switch(n){case we.FAIRPLAY:return Gt.FAIRPLAY;case we.PLAYREADY:return Gt.PLAYREADY;case we.WIDEVINE:return Gt.WIDEVINE;case we.CLEARKEY:return Gt.CLEARKEY}}function Va(n){const{drmSystems:e,widevineLicenseUrl:t}=n,r=e?[we.FAIRPLAY,we.WIDEVINE,we.PLAYREADY,we.CLEARKEY].filter(i=>!!e[i]):[];return!r[we.WIDEVINE]&&t&&r.push(we.WIDEVINE),r}const ax=function(n){return qu!=null&&(n=qu.navigator)!=null&&n.requestMediaKeySystemAccess?self.navigator.requestMediaKeySystemAccess.bind(self.navigator):null}();function Hb(n,e,t,r){let i;switch(n){case we.FAIRPLAY:i=["cenc","sinf"];break;case we.WIDEVINE:case we.PLAYREADY:i=["cenc"];break;case we.CLEARKEY:i=["cenc","keyids"];break;default:throw new Error(`Unknown key-system: ${n}`)}return zb(i,e,t,r)}function zb(n,e,t,r){return[{initDataTypes:n,persistentState:r.persistentState||"optional",distinctiveIdentifier:r.distinctiveIdentifier||"optional",sessionTypes:r.sessionTypes||[r.sessionType||"temporary"],audioCapabilities:e.map(s=>({contentType:`audio/mp4; codecs=${s}`,robustness:r.audioRobustness||"",encryptionScheme:r.audioEncryptionScheme||null})),videoCapabilities:t.map(s=>({contentType:`video/mp4; codecs=${s}`,robustness:r.videoRobustness||"",encryptionScheme:r.videoEncryptionScheme||null}))}]}function Wb(n){var e;return n.sessionType==="persistent-license"||!!((e=n.sessionTypes)!=null&&e.some(t=>t==="persistent-license"))}function ox(n){const e=new Uint16Array(n.buffer,n.byteOffset,n.byteLength/2),t=String.fromCharCode.apply(null,Array.from(e)),r=t.substring(t.indexOf("<"),t.length),a=new DOMParser().parseFromString(r,"text/xml").getElementsByTagName("KID")[0];if(a){const o=a.childNodes[0]?a.childNodes[0].nodeValue:a.getAttribute("VALUE");if(o){const l=Ig(o).subarray(0,16);return Kb(l),l}}return null}let Fl={};class Co{static clearKeyUriToKeyIdMap(){Fl={}}constructor(e,t,r,i=[1],s=null){this.uri=void 0,this.method=void 0,this.keyFormat=void 0,this.keyFormatVersions=void 0,this.encrypted=void 0,this.isCommonEncryption=void 0,this.iv=null,this.key=null,this.keyId=null,this.pssh=null,this.method=e,this.uri=t,this.keyFormat=r,this.keyFormatVersions=i,this.iv=s,this.encrypted=e?e!=="NONE":!1,this.isCommonEncryption=this.encrypted&&!Gs(e)}isSupported(){if(this.method){if(Gs(this.method)||this.method==="NONE")return!0;if(this.keyFormat==="identity")return this.method==="SAMPLE-AES";switch(this.keyFormat){case Gt.FAIRPLAY:case Gt.WIDEVINE:case Gt.PLAYREADY:case Gt.CLEARKEY:return["ISO-23001-7","SAMPLE-AES","SAMPLE-AES-CENC","SAMPLE-AES-CTR"].indexOf(this.method)!==-1}}return!1}getDecryptData(e){if(!this.encrypted||!this.uri)return null;if(Gs(this.method)&&this.uri&&!this.iv){typeof e!="number"&&(Ie.warn(`missing IV for initialization segment with method="${this.method}" - compliance issue`),e=0);const r=Yb(e);return new Co(this.method,this.uri,"identity",this.keyFormatVersions,r)}const t=Vb(this.uri);if(t)switch(this.keyFormat){case Gt.WIDEVINE:this.pssh=t,t.length>=22&&(this.keyId=t.subarray(t.length-22,t.length-6));break;case Gt.PLAYREADY:{const r=new Uint8Array([154,4,240,121,152,64,66,134,171,146,230,91,224,136,95,149]);this.pssh=eb(r,null,t),this.keyId=ox(t);break}default:{let r=t.subarray(0,16);if(r.length!==16){const i=new Uint8Array(16);i.set(r,16-r.length),r=i}this.keyId=r;break}}if(!this.keyId||this.keyId.byteLength!==16){let r=Fl[this.uri];if(!r){const i=Object.keys(Fl).length%Number.MAX_SAFE_INTEGER;r=new Uint8Array(16),new DataView(r.buffer,12,4).setUint32(0,i),Fl[this.uri]=r}this.keyId=r}return this}}function Yb(n){const e=new Uint8Array(16);for(let t=12;t<16;t++)e[t]=n>>8*(15-t)&255;return e}const R0=/#EXT-X-STREAM-INF:([^\r\n]*)(?:[\r\n](?:#[^\r\n]*)?)*([^\r\n]+)|#EXT-X-(SESSION-DATA|SESSION-KEY|DEFINE|CONTENT-STEERING|START):([^\r\n]*)[\r\n]+/g,_0=/#EXT-X-MEDIA:(.*)/g,qb=/^#EXT(?:INF|-X-TARGETDURATION):/m,Sd=new RegExp([/#EXTINF:\s*(\d*(?:\.\d+)?)(?:,(.*)\s+)?/.source,/(?!#) *(\S[^\r\n]*)/.source,/#.*/.source].join("|"),"g"),Qb=new RegExp([/#EXT-X-(PROGRAM-DATE-TIME|BYTERANGE|DATERANGE|DEFINE|KEY|MAP|PART|PART-INF|PLAYLIST-TYPE|PRELOAD-HINT|RENDITION-REPORT|SERVER-CONTROL|SKIP|START):(.+)/.source,/#EXT-X-(BITRATE|DISCONTINUITY-SEQUENCE|MEDIA-SEQUENCE|TARGETDURATION|VERSION): *(\d+)/.source,/#EXT-X-(DISCONTINUITY|ENDLIST|GAP|INDEPENDENT-SEGMENTS)/.source,/(#)([^:]*):(.*)/.source,/(#)(.*)(?:.*)\r?\n?/.source].join("|"));class Jn{static findGroup(e,t){for(let r=0;r<e.length;r++){const i=e[r];if(i.id===t)return i}}static resolve(e,t){return Sg.buildAbsoluteURL(t,e,{alwaysNormalize:!0})}static isMediaPlaylist(e){return qb.test(e)}static parseMasterPlaylist(e,t){const r=T0(e),i={contentSteering:null,levels:[],playlistParsingError:null,sessionData:null,sessionKeys:null,startTimeOffset:null,variableList:null,hasVariableRefs:r},s=[];R0.lastIndex=0;let a;for(;(a=R0.exec(e))!=null;)if(a[1]){var o;const u=new He(a[1],i),c=Qh(i,a[2]),d={attrs:u,bitrate:u.decimalInteger("BANDWIDTH")||u.decimalInteger("AVERAGE-BANDWIDTH"),name:u.NAME,url:Jn.resolve(c,t)},h=u.decimalResolution("RESOLUTION");h&&(d.width=h.width,d.height=h.height),C0(u.CODECS,d);const f=u["SUPPLEMENTAL-CODECS"];f&&(d.supplemental={},C0(f,d.supplemental)),(o=d.unknownCodecs)!=null&&o.length||s.push(d),i.levels.push(d)}else if(a[3]){const u=a[3],c=a[4];switch(u){case"SESSION-DATA":{const d=new He(c,i),h=d["DATA-ID"];h&&(i.sessionData===null&&(i.sessionData={}),i.sessionData[h]=d);break}case"SESSION-KEY":{const d=I0(c,t,i);d.encrypted&&d.isSupported()?(i.sessionKeys===null&&(i.sessionKeys=[]),i.sessionKeys.push(d)):Ie.warn(`[Keys] Ignoring invalid EXT-X-SESSION-KEY tag: "${c}"`);break}case"DEFINE":{{const d=new He(c,i);L0(i,d,t)}break}case"CONTENT-STEERING":{const d=new He(c,i);i.contentSteering={uri:Jn.resolve(d["SERVER-URI"],t),pathwayId:d["PATHWAY-ID"]||"."};break}case"START":{i.startTimeOffset=D0(c);break}}}const l=s.length>0&&s.length<i.levels.length;return i.levels=l?s:i.levels,i.levels.length===0&&(i.playlistParsingError=new Error("no levels found in manifest")),i}static parseMasterPlaylistMedia(e,t,r){let i;const s={},a=r.levels,o={AUDIO:a.map(u=>({id:u.attrs.AUDIO,audioCodec:u.audioCodec})),SUBTITLES:a.map(u=>({id:u.attrs.SUBTITLES,textCodec:u.textCodec})),"CLOSED-CAPTIONS":[]};let l=0;for(_0.lastIndex=0;(i=_0.exec(e))!==null;){const u=new He(i[1],r),c=u.TYPE;if(c){const d=o[c],h=s[c]||[];s[c]=h;const f=u.LANGUAGE,g=u["ASSOC-LANGUAGE"],m=u.CHANNELS,y=u.CHARACTERISTICS,p=u["INSTREAM-ID"],v={attrs:u,bitrate:0,id:l++,groupId:u["GROUP-ID"]||"",name:u.NAME||f||"",type:c,default:u.bool("DEFAULT"),autoselect:u.bool("AUTOSELECT"),forced:u.bool("FORCED"),lang:f,url:u.URI?Jn.resolve(u.URI,t):""};if(g&&(v.assocLang=g),m&&(v.channels=m),y&&(v.characteristics=y),p&&(v.instreamId=p),d!=null&&d.length){const E=Jn.findGroup(d,v.groupId)||d[0];w0(v,E,"audioCodec"),w0(v,E,"textCodec")}h.push(v)}}return s}static parseLevelPlaylist(e,t,r,i,s,a){var o;const l={url:t},u=new jb(t),c=u.fragments,d=[];let h=null,f=0,g=0,m=0,y=0,p=0,v=null,E=new md(i,l),T,A,I,R=-1,x=!1,D=null,_;if(Sd.lastIndex=0,u.m3u8=e,u.hasVariableRefs=T0(e),((o=Sd.exec(e))==null?void 0:o[0])!=="#EXTM3U")return u.playlistParsingError=new Error("Missing format identifier #EXTM3U"),u;for(;(T=Sd.exec(e))!==null;){x&&(x=!1,E=new md(i,l),E.playlistOffset=m,E.start=m,E.sn=f,E.cc=y,p&&(E.bitrate=p),E.level=r,h&&(E.initSegment=h,h.rawProgramDateTime&&(E.rawProgramDateTime=h.rawProgramDateTime,h.rawProgramDateTime=null),D&&(E.setByteRange(D),D=null)));const H=T[1];if(H){E.duration=parseFloat(H);const W=(" "+T[2]).slice(1);E.title=W||null,E.tagList.push(W?["INF",H,W]:["INF",H])}else if(T[3]){if(Z(E.duration)){E.playlistOffset=m,E.start=m,I&&k0(E,I,u),E.sn=f,E.level=r,E.cc=y,c.push(E);const W=(" "+T[3]).slice(1);E.relurl=Qh(u,W),Zh(E,v,d),v=E,m+=E.duration,f++,g=0,x=!0}}else{if(T=T[0].match(Qb),!T){Ie.warn("No matches on slow regex match for level playlist!");continue}for(A=1;A<T.length&&T[A]===void 0;A++);const W=(" "+T[A]).slice(1),V=(" "+T[A+1]).slice(1),X=T[A+2]?(" "+T[A+2]).slice(1):null;switch(W){case"BYTERANGE":v?E.setByteRange(V,v):E.setByteRange(V);break;case"PROGRAM-DATE-TIME":E.rawProgramDateTime=V,E.tagList.push(["PROGRAM-DATE-TIME",V]),R===-1&&(R=c.length);break;case"PLAYLIST-TYPE":u.type&&hr(u,W,T),u.type=V.toUpperCase();break;case"MEDIA-SEQUENCE":u.startSN!==0?hr(u,W,T):c.length>0&&P0(u,W,T),f=u.startSN=parseInt(V);break;case"SKIP":{u.skippedSegments&&hr(u,W,T);const B=new He(V,u),F=B.decimalInteger("SKIPPED-SEGMENTS");if(Z(F)){u.skippedSegments+=F;for(let Q=F;Q--;)c.push(null);f+=F}const U=B.enumeratedString("RECENTLY-REMOVED-DATERANGES");U&&(u.recentlyRemovedDateranges=(u.recentlyRemovedDateranges||[]).concat(U.split("	")));break}case"TARGETDURATION":u.targetduration!==0&&hr(u,W,T),u.targetduration=Math.max(parseInt(V),1);break;case"VERSION":u.version!==null&&hr(u,W,T),u.version=parseInt(V);break;case"INDEPENDENT-SEGMENTS":break;case"ENDLIST":u.live||hr(u,W,T),u.live=!1;break;case"#":(V||X)&&E.tagList.push(X?[V,X]:[V]);break;case"DISCONTINUITY":y++,E.tagList.push(["DIS"]);break;case"GAP":E.gap=!0,E.tagList.push([W]);break;case"BITRATE":E.tagList.push([W,V]),p=parseInt(V)*1e3,Z(p)?E.bitrate=p:p=0;break;case"DATERANGE":{const B=new He(V,u),F=new sx(B,u.dateRanges[B.ID],u.dateRangeTagCount);u.dateRangeTagCount++,F.isValid||u.skippedSegments?u.dateRanges[F.id]=F:Ie.warn(`Ignoring invalid DATERANGE tag: "${V}"`),E.tagList.push(["EXT-X-DATERANGE",V]);break}case"DEFINE":{{const B=new He(V,u);"IMPORT"in B?Fb(u,B,a):L0(u,B,t)}break}case"DISCONTINUITY-SEQUENCE":u.startCC!==0?hr(u,W,T):c.length>0&&P0(u,W,T),u.startCC=y=parseInt(V);break;case"KEY":{const B=I0(V,t,u);if(B.isSupported()){if(B.method==="NONE"){I=void 0;break}I||(I={}),I[B.keyFormat]&&(I=Oe({},I)),I[B.keyFormat]=B}else Ie.warn(`[Keys] Ignoring invalid EXT-X-KEY tag: "${V}"`);break}case"START":u.startTimeOffset=D0(V);break;case"MAP":{const B=new He(V,u);if(E.duration){const F=new md(i,l);b0(F,B,r,I),h=F,E.initSegment=h,h.rawProgramDateTime&&!E.rawProgramDateTime&&(E.rawProgramDateTime=h.rawProgramDateTime)}else{const F=E.byteRangeEndOffset;if(F){const U=E.byteRangeStartOffset;D=`${F-U}@${U}`}else D=null;b0(E,B,r,I),h=E,x=!0}h.cc=y;break}case"SERVER-CONTROL":{_&&hr(u,W,T),_=new He(V),u.canBlockReload=_.bool("CAN-BLOCK-RELOAD"),u.canSkipUntil=_.optionalFloat("CAN-SKIP-UNTIL",0),u.canSkipDateRanges=u.canSkipUntil>0&&_.bool("CAN-SKIP-DATERANGES"),u.partHoldBack=_.optionalFloat("PART-HOLD-BACK",0),u.holdBack=_.optionalFloat("HOLD-BACK",0);break}case"PART-INF":{u.partTarget&&hr(u,W,T);const B=new He(V);u.partTarget=B.decimalFloatingPoint("PART-TARGET");break}case"PART":{let B=u.partList;B||(B=u.partList=[]);const F=g>0?B[B.length-1]:void 0,U=g++,Q=new He(V,u),q=new $w(Q,E,l,U,F);B.push(q),E.duration+=q.duration;break}case"PRELOAD-HINT":{const B=new He(V,u);u.preloadHint=B;break}case"RENDITION-REPORT":{const B=new He(V,u);u.renditionReports=u.renditionReports||[],u.renditionReports.push(B);break}default:Ie.warn(`line parsed but not handled: ${T}`);break}}}v&&!v.relurl?(c.pop(),m-=v.duration,u.partList&&(u.fragmentHint=v)):u.partList&&(Zh(E,v,d),E.cc=y,u.fragmentHint=E,I&&k0(E,I,u)),u.targetduration||(u.playlistParsingError=new Error("#EXT-X-TARGETDURATION is required"));const M=c.length,j=c[0],z=c[M-1];if(m+=u.skippedSegments*u.targetduration,m>0&&M&&z){u.averagetargetduration=m/M;const H=z.sn;u.endSN=H!=="initSegment"?H:0,u.live||(z.endList=!0),j&&u.startCC===void 0&&(u.startCC=j.cc),R>0&&(Zb(c,R),j&&d.unshift(j))}else u.endSN=0,u.startCC=0;return u.fragmentHint&&(m+=u.fragmentHint.duration),u.totalduration=m,d.length&&u.dateRangeTagCount&&j&&lx(d,u),u.endCC=y,u}}function lx(n,e){const t=n.length;if(!t)return;const r=n[t-1],i=e.live?1/0:e.totalduration,s=Object.keys(e.dateRanges);for(let a=s.length;a--;){const o=e.dateRanges[s[a]],l=o.startDate.getTime();o.tagAnchor=r.ref;for(let u=t;u--;){const c=Xb(e,l,n,u,i);if(c!==-1){o.tagAnchor=e.fragments[c].ref;break}}}}function Xb(n,e,t,r,i){const s=t[r];if(s){const o=s.programDateTime;if(e>=o||r===0){var a;const l=(((a=t[r+1])==null?void 0:a.start)||i)-s.start;if(e<=o+l*1e3){const u=t[r].sn-n.startSN,c=n.fragments;if(c.length>t.length){const h=(t[r+1]||c[c.length-1]).sn-n.startSN;for(let f=h;f>u;f--){const g=c[f].programDateTime;if(e>=g&&e<g+c[f].duration*1e3)return f}}return u}}}return-1}function I0(n,e,t){var r,i;const s=new He(n,t),a=(r=s.METHOD)!=null?r:"",o=s.URI,l=s.hexadecimalInteger("IV"),u=s.KEYFORMATVERSIONS,c=(i=s.KEYFORMAT)!=null?i:"identity";o&&s.IV&&!l&&Ie.error(`Invalid IV: ${s.IV}`);const d=o?Jn.resolve(o,e):"",h=(u||"1").split("/").map(Number).filter(Number.isFinite);return new Co(a,d,c,h,l)}function D0(n){const t=new He(n).decimalFloatingPoint("TIME-OFFSET");return Z(t)?t:null}function C0(n,e){let t=(n||"").split(/[ ,]+/).filter(r=>r);["video","audio","text"].forEach(r=>{const i=t.filter(s=>YS(s,r));i.length&&(e[`${r}Codec`]=i.map(s=>s.split("/")[0]).join(","),t=t.filter(s=>i.indexOf(s)===-1))}),e.unknownCodecs=t}function w0(n,e,t){const r=e[t];r&&(n[t]=r)}function Zb(n,e){let t=n[e];for(let r=e;r--;){const i=n[r];if(!i)return;i.programDateTime=t.programDateTime-i.duration*1e3,t=i}}function Zh(n,e,t){n.rawProgramDateTime?t.push(n):e!=null&&e.programDateTime&&(n.programDateTime=e.endProgramDateTime)}function b0(n,e,t,r){n.relurl=e.URI,e.BYTERANGE&&n.setByteRange(e.BYTERANGE),n.level=t,n.sn="initSegment",r&&(n.levelkeys=r),n.initSegment=null}function k0(n,e,t){n.levelkeys=e;const{encryptedFragments:r}=t;(!r.length||r[r.length-1].levelkeys!==e)&&Object.keys(e).some(i=>e[i].isCommonEncryption)&&r.push(n)}function hr(n,e,t){n.playlistParsingError=new Error(`#EXT-X-${e} must not appear more than once (${t[0]})`)}function P0(n,e,t){n.playlistParsingError=new Error(`#EXT-X-${e} must appear before the first Media Segment (${t[0]})`)}function xd(n,e){const t=e.startPTS;if(Z(t)){let r=0,i;e.sn>n.sn?(r=t-n.start,i=n):(r=n.start-t,i=e),i.duration!==r&&i.setDuration(r)}else e.sn>n.sn?n.cc===e.cc&&n.minEndPTS?e.setStart(n.start+(n.minEndPTS-n.start)):e.setStart(n.start+n.duration):e.setStart(Math.max(n.start-e.duration,0))}function ux(n,e,t,r,i,s){r-t<=0&&(Ie.warn("Fragment should have a positive duration",e),r=t+e.duration,s=i+e.duration);let o=t,l=r;const u=e.startPTS,c=e.endPTS;if(Z(u)){const y=Math.abs(u-t);Z(e.deltaPTS)?e.deltaPTS=Math.max(y,e.deltaPTS):e.deltaPTS=y,o=Math.max(t,u),t=Math.min(t,u),i=Math.min(i,e.startDTS),l=Math.min(r,c),r=Math.max(r,c),s=Math.max(s,e.endDTS)}const d=t-e.start;e.start!==0&&e.setStart(t),e.setDuration(r-e.start),e.startPTS=t,e.maxStartPTS=o,e.startDTS=i,e.endPTS=r,e.minEndPTS=l,e.endDTS=s;const h=e.sn;if(!n||h<n.startSN||h>n.endSN)return 0;let f;const g=h-n.startSN,m=n.fragments;for(m[g]=e,f=g;f>0;f--)xd(m[f],m[f-1]);for(f=g;f<m.length-1;f++)xd(m[f],m[f+1]);return n.fragmentHint&&xd(m[m.length-1],n.fragmentHint),n.PTSKnown=n.alignedSliding=!0,d}function Jb(n,e){if(n===e)return;let t=null;const r=n.fragments;for(let u=r.length-1;u>=0;u--){const c=r[u].initSegment;if(c){t=c;break}}n.fragmentHint&&delete n.fragmentHint.endPTS;let i;nk(n,e,(u,c,d,h)=>{if((!e.startCC||e.skippedSegments)&&c.cc!==u.cc){const f=u.cc-c.cc;for(let g=d;g<h.length;g++)h[g].cc+=f;e.endCC=h[h.length-1].cc}Z(u.startPTS)&&Z(u.endPTS)&&(c.setStart(c.startPTS=u.startPTS),c.startDTS=u.startDTS,c.maxStartPTS=u.maxStartPTS,c.endPTS=u.endPTS,c.endDTS=u.endDTS,c.minEndPTS=u.minEndPTS,c.setDuration(u.endPTS-u.startPTS),c.duration&&(i=c),e.PTSKnown=e.alignedSliding=!0),u.hasStreams&&(c.elementaryStreams=u.elementaryStreams),c.loader=u.loader,u.hasStats&&(c.stats=u.stats),u.initSegment&&(c.initSegment=u.initSegment,t=u.initSegment)});const s=e.fragments,a=e.fragmentHint?s.concat(e.fragmentHint):s;if(t&&a.forEach(u=>{var c;u&&(!u.initSegment||u.initSegment.relurl===((c=t)==null?void 0:c.relurl))&&(u.initSegment=t)}),e.skippedSegments){if(e.deltaUpdateFailed=s.some(u=>!u),e.deltaUpdateFailed){Ie.warn("[level-helper] Previous playlist missing segments skipped in delta playlist");for(let u=e.skippedSegments;u--;)s.shift();e.startSN=s[0].sn}else{e.canSkipDateRanges&&(e.dateRanges=ek(n.dateRanges,e));const u=n.fragments.filter(c=>c.rawProgramDateTime);if(n.hasProgramDateTime&&!e.hasProgramDateTime)for(let c=1;c<a.length;c++)a[c].programDateTime===null&&Zh(a[c],a[c-1],u);lx(u,e)}e.endCC=s[s.length-1].cc}if(!e.startCC){var o;const u=hx(n,e.startSN-1);e.startCC=(o=u==null?void 0:u.cc)!=null?o:s[0].cc}tk(n.partList,e.partList,(u,c)=>{c.elementaryStreams=u.elementaryStreams,c.stats=u.stats}),i?ux(e,i,i.startPTS,i.endPTS,i.startDTS,i.endDTS):cx(n,e),s.length&&(e.totalduration=e.edge-s[0].start),e.driftStartTime=n.driftStartTime,e.driftStart=n.driftStart;const l=e.advancedDateTime;if(e.advanced&&l){const u=e.edge;e.driftStart||(e.driftStartTime=l,e.driftStart=u),e.driftEndTime=l,e.driftEnd=u}else e.driftEndTime=n.driftEndTime,e.driftEnd=n.driftEnd,e.advancedDateTime=n.advancedDateTime;e.requestScheduled===-1&&(e.requestScheduled=n.requestScheduled)}function ek(n,e){const{dateRanges:t,recentlyRemovedDateranges:r}=e,i=Oe({},n);r&&r.forEach(o=>{delete i[o]});const a=Object.keys(i).length;return a&&Object.keys(t).forEach(o=>{const l=i[o],u=new sx(t[o].attr,l);u.isValid?(i[o]=u,l||(u.tagOrder+=a)):Ie.warn(`Ignoring invalid Playlist Delta Update DATERANGE tag: "${Ve(t[o].attr)}"`)}),i}function tk(n,e,t){if(n&&e){let r=0;for(let i=0,s=n.length;i<=s;i++){const a=n[i],o=e[i+r];a&&o&&a.index===o.index&&a.fragment.sn===o.fragment.sn?t(a,o):r--}}}function nk(n,e,t){const r=e.skippedSegments,i=Math.max(n.startSN,e.startSN)-e.startSN,s=(n.fragmentHint?1:0)+(r?e.endSN:Math.min(n.endSN,e.endSN))-e.startSN,a=e.startSN-n.startSN,o=e.fragmentHint?e.fragments.concat(e.fragmentHint):e.fragments,l=n.fragmentHint?n.fragments.concat(n.fragmentHint):n.fragments;for(let u=i;u<=s;u++){const c=l[a+u];let d=o[u];if(r&&!d&&c&&(d=e.fragments[u]=c),c&&d){if(t(c,d,u,o),c.url&&c.url!==d.url){e.playlistParsingError=O0(`media sequence mismatch ${d.sn}:`,n,e,c,d);return}else if(c.cc!==d.cc){e.playlistParsingError=O0(`discontinuity sequence mismatch (${c.cc}!=${d.cc})`,n,e,c,d);return}}}}function O0(n,e,t,r,i){return new Error(`${n} ${i.url}
Playlist starting @${e.startSN}
${e.m3u8}

Playlist starting @${t.startSN}
${t.m3u8}`)}function cx(n,e,t=!0){const r=e.startSN+e.skippedSegments-n.startSN,i=n.fragments,s=r>=0;let a=0;if(s&&r<i.length)a=i[r].start;else if(s&&e.startSN===n.endSN+1)a=n.fragmentEnd;else if(s&&t)a=n.fragmentStart+r*e.levelTargetDuration;else if(!e.skippedSegments&&e.fragmentStart===0)a=n.fragmentStart;else return;Jh(e,a)}function Jh(n,e){if(e){const t=n.fragments;for(let r=n.skippedSegments;r<t.length;r++)t[r].addStart(e);n.fragmentHint&&n.fragmentHint.addStart(e)}}function dx(n,e=1/0){let t=1e3*n.targetduration;if(n.updated){const r=n.fragments;if(r.length&&t*4>e){const s=r[r.length-1].duration*1e3;s<t&&(t=s)}}else t/=2;return Math.round(t)}function hx(n,e,t){if(!n)return null;let r=n.fragments[e-n.startSN];return r||(r=n.fragmentHint,r&&r.sn===e)?r:e<n.startSN&&t&&t.sn===e?t:null}function F0(n,e,t){return n?fx(n.partList,e,t):null}function fx(n,e,t){if(n)for(let r=n.length;r--;){const i=n[r];if(i.index===t&&i.fragment.sn===e)return i}return null}function gx(n){n.forEach((e,t)=>{var r;(r=e.details)==null||r.fragments.forEach(i=>{i.level=t,i.initSegment&&(i.initSegment.level=t)})})}function no(n,e){for(let r=0,i=n.length;r<i;r++){var t;if(((t=n[r])==null?void 0:t.cc)===e)return n[r]}return null}function rk(n,e){return!!(n&&e.startCC<n.endCC&&e.endCC>n.startCC)}function M0(n,e){if(n){const t=n.start+e;n.start=n.startPTS=t,n.endPTS=t+n.duration}}function mx(n,e){const t=e.fragments;for(let r=0,i=t.length;r<i;r++)M0(t[r],n);e.fragmentHint&&M0(e.fragmentHint,n),e.alignedSliding=!0}function ik(n,e){n&&(px(e,n),!e.alignedSliding&&n&&Qu(e,n),!e.alignedSliding&&n&&!e.skippedSegments&&cx(n,e,!1))}function px(n,e){if(!rk(e,n))return;const t=Math.min(e.endCC,n.endCC),r=no(e.fragments,t),i=no(n.fragments,t);if(!r||!i)return;Ie.log(`Aligning playlist at start of dicontinuity sequence ${t}`);const s=r.start-i.start;mx(s,n)}function Qu(n,e){if(!n.hasProgramDateTime||!e.hasProgramDateTime)return;const t=n.fragments,r=e.fragments;if(!t.length||!r.length)return;let i,s;const a=Math.min(e.endCC,n.endCC);e.startCC<a&&n.startCC<a&&(i=no(r,a),s=no(t,a)),(!i||!s)&&(i=r[Math.floor(r.length/2)],s=no(t,i.cc)||t[Math.floor(t.length/2)]);const o=i.programDateTime,l=s.programDateTime;if(!o||!l)return;const u=(l-o)/1e3-(s.start-i.start);mx(u,n)}const sk={toString:function(n){let e="";const t=n.length;for(let r=0;r<t;r++)e+=`[${n.start(r).toFixed(3)}-${n.end(r).toFixed(3)}]`;return e}},$={STOPPED:"STOPPED",IDLE:"IDLE",KEY_LOADING:"KEY_LOADING",FRAG_LOADING:"FRAG_LOADING",FRAG_LOADING_WAITING_RETRY:"FRAG_LOADING_WAITING_RETRY",WAITING_TRACK:"WAITING_TRACK",PARSING:"PARSING",PARSED:"PARSED",ENDED:"ENDED",ERROR:"ERROR",WAITING_INIT_PTS:"WAITING_INIT_PTS",WAITING_LEVEL:"WAITING_LEVEL"};class Dg extends rx{constructor(e,t,r,i,s){super(i,e.logger),this.hls=void 0,this.fragPrevious=null,this.fragCurrent=null,this.fragmentTracker=void 0,this.transmuxer=null,this._state=$.STOPPED,this.playlistType=void 0,this.media=null,this.mediaBuffer=null,this.config=void 0,this.bitrateTest=!1,this.lastCurrentTime=0,this.nextLoadPosition=0,this.startPosition=0,this.startTimeOffset=null,this.retryDate=0,this.levels=null,this.fragmentLoader=void 0,this.keyLoader=void 0,this.levelLastLoaded=null,this.startFragRequested=!1,this.decrypter=void 0,this.initPTS=[],this.buffering=!0,this.loadingParts=!1,this.loopSn=void 0,this.onMediaSeeking=()=>{const{config:a,fragCurrent:o,media:l,mediaBuffer:u,state:c}=this,d=l?l.currentTime:0,h=ge.bufferInfo(u||l,d,a.maxBufferHole);if(this.log(`media seeking to ${Z(d)?d.toFixed(3):d}, state: ${c}`),this.state===$.ENDED)this.resetLoadingState();else if(o){const f=a.maxFragLookUpTolerance,g=o.start-f,m=o.start+o.duration+f;if(!h.len||m<h.start||g>h.end){const y=d>m;(d<g||y)&&(y&&o.loader&&(this.log("seeking outside of buffer while fragment load in progress, cancel fragment load"),o.abortRequests(),this.resetLoadingState()),this.fragPrevious=null)}}if(l){this.fragmentTracker.removeFragmentsInRange(d,1/0,this.playlistType,!0);const f=this.lastCurrentTime;if(d>f&&(this.lastCurrentTime=d),!this.loadingParts){const g=Math.max(h.end,d),m=this.shouldLoadParts(this.getLevelDetails(),g);m&&(this.log(`LL-Part loading ON after seeking to ${d.toFixed(2)} with buffer @${g.toFixed(2)}`),this.loadingParts=m)}}!this.hls.hasEnoughToStart&&!h.len&&(this.log(`setting startPosition to ${d} because of seek before start`),this.nextLoadPosition=this.startPosition=d),this.tickImmediate()},this.onMediaEnded=()=>{this.log("setting startPosition to 0 because media ended"),this.startPosition=this.lastCurrentTime=0},this.playlistType=s,this.hls=e,this.fragmentLoader=new Pb(e.config),this.keyLoader=r,this.fragmentTracker=t,this.config=e.config,this.decrypter=new Ag(e.config)}registerListeners(){const{hls:e}=this;e.on(S.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(S.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(S.MANIFEST_LOADING,this.onManifestLoading,this),e.on(S.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(S.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e.off(S.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(S.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(S.MANIFEST_LOADING,this.onManifestLoading,this),e.off(S.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(S.ERROR,this.onError,this)}doTick(){this.onTickEnd()}onTickEnd(){}startLoad(e){}stopLoad(){if(this.state===$.STOPPED)return;this.fragmentLoader.abort(),this.keyLoader.abort(this.playlistType);const e=this.fragCurrent;e!=null&&e.loader&&(e.abortRequests(),this.fragmentTracker.removeFragment(e)),this.resetTransmuxer(),this.fragCurrent=null,this.fragPrevious=null,this.clearInterval(),this.clearNextTick(),this.state=$.STOPPED}get startPositionValue(){const{nextLoadPosition:e,startPosition:t}=this;return t===-1&&e?e:t}get bufferingEnabled(){return this.buffering}pauseBuffering(){this.buffering=!1}resumeBuffering(){this.buffering=!0}get inFlightFrag(){return{frag:this.fragCurrent,state:this.state}}_streamEnded(e,t){if(t.live||!this.media)return!1;const r=e.end||0,i=this.config.timelineOffset||0;if(r<=i)return!1;const s=e.buffered;this.config.maxBufferHole&&s&&s.length>1&&(e=ge.bufferedInfo(s,e.start,0));const a=e.nextStart;if(a&&a>i&&a<t.edge||this.media.currentTime<e.start)return!1;const l=t.partList;if(l!=null&&l.length){const c=l[l.length-1];return ge.isBuffered(this.media,c.start+c.duration/2)}const u=t.fragments[t.fragments.length-1].type;return this.fragmentTracker.isEndListAppended(u)}getLevelDetails(){if(this.levels&&this.levelLastLoaded!==null){var e;return(e=this.levelLastLoaded)==null?void 0:e.details}}get timelineOffset(){const e=this.config.timelineOffset;if(e){var t;return((t=this.getLevelDetails())==null?void 0:t.appliedTimelineOffset)||e}return 0}onMediaAttached(e,t){const r=this.media=this.mediaBuffer=t.media;r.removeEventListener("seeking",this.onMediaSeeking),r.removeEventListener("ended",this.onMediaEnded),r.addEventListener("seeking",this.onMediaSeeking),r.addEventListener("ended",this.onMediaEnded);const i=this.config;this.levels&&i.autoStartLoad&&this.state===$.STOPPED&&this.startLoad(i.startPosition)}onMediaDetaching(e,t){const r=!!t.transferMedia,i=this.media;if(i!==null){if(i.ended&&(this.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0),i.removeEventListener("seeking",this.onMediaSeeking),i.removeEventListener("ended",this.onMediaEnded),this.keyLoader&&!r&&this.keyLoader.detach(),this.media=this.mediaBuffer=null,this.loopSn=void 0,r){this.resetLoadingState(),this.resetTransmuxer();return}this.loadingParts=!1,this.fragmentTracker.removeAllFragments(),this.stopLoad()}}onManifestLoading(){this.initPTS=[],this.levels=this.levelLastLoaded=this.fragCurrent=null,this.lastCurrentTime=this.startPosition=0,this.startFragRequested=!1}onError(e,t){}onManifestLoaded(e,t){this.startTimeOffset=t.startTimeOffset}onHandlerDestroying(){this.stopLoad(),this.transmuxer&&(this.transmuxer.destroy(),this.transmuxer=null),super.onHandlerDestroying(),this.hls=this.onMediaSeeking=this.onMediaEnded=null}onHandlerDestroyed(){this.state=$.STOPPED,this.fragmentLoader&&this.fragmentLoader.destroy(),this.keyLoader&&this.keyLoader.destroy(),this.decrypter&&this.decrypter.destroy(),this.hls=this.log=this.warn=this.decrypter=this.keyLoader=this.fragmentLoader=this.fragmentTracker=null,super.onHandlerDestroyed()}loadFragment(e,t,r){this.startFragRequested=!0,this._loadFragForPlayback(e,t,r)}_loadFragForPlayback(e,t,r){const i=s=>{const a=s.frag;if(this.fragContextChanged(a)){this.warn(`${a.type} sn: ${a.sn}${s.part?" part: "+s.part.index:""} of ${this.fragInfo(a,!1,s.part)}) was dropped during download.`),this.fragmentTracker.removeFragment(a);return}a.stats.chunkCount++,this._handleFragmentLoadProgress(s)};this._doFragLoad(e,t,r,i).then(s=>{if(!s)return;const a=this.state,o=s.frag;if(this.fragContextChanged(o)){(a===$.FRAG_LOADING||!this.fragCurrent&&a===$.PARSING)&&(this.fragmentTracker.removeFragment(o),this.state=$.IDLE);return}"payload"in s&&(this.log(`Loaded ${o.type} sn: ${o.sn} of ${this.playlistLabel()} ${o.level}`),this.hls.trigger(S.FRAG_LOADED,s)),this._handleFragmentLoadComplete(s)}).catch(s=>{this.state===$.STOPPED||this.state===$.ERROR||(this.warn(`Frag error: ${(s==null?void 0:s.message)||s}`),this.resetFragmentLoading(e))})}clearTrackerIfNeeded(e){var t;const{fragmentTracker:r}=this;if(r.getState(e)===ct.APPENDING){const s=e.type,a=this.getFwdBufferInfo(this.mediaBuffer,s),o=Math.max(e.duration,a?a.len:this.config.maxBufferLength),l=this.backtrackFragment;((l?e.sn-l.sn:0)===1||this.reduceMaxBufferLength(o,e.duration))&&r.removeFragment(e)}else((t=this.mediaBuffer)==null?void 0:t.buffered.length)===0?r.removeAllFragments():r.hasParts(e.type)&&(r.detectPartialFragments({frag:e,part:null,stats:e.stats,id:e.type}),r.getState(e)===ct.PARTIAL&&r.removeFragment(e))}checkLiveUpdate(e){if(e.updated&&!e.live){const t=e.fragments[e.fragments.length-1];this.fragmentTracker.detectPartialFragments({frag:t,part:null,stats:t.stats,id:t.type})}e.fragments[0]||(e.deltaUpdateFailed=!0)}waitForLive(e){const t=e.details;return(t==null?void 0:t.live)&&t.type!=="EVENT"&&(this.levelLastLoaded!==e||t.expired)}flushMainBuffer(e,t,r=null){if(!(e-t))return;const i={startOffset:e,endOffset:t,type:r};this.hls.trigger(S.BUFFER_FLUSHING,i)}_loadInitSegment(e,t){this._doFragLoad(e,t).then(r=>{const i=r==null?void 0:r.frag;if(!i||this.fragContextChanged(i)||!this.levels)throw new Error("init load aborted");return r}).then(r=>{const{hls:i}=this,{frag:s,payload:a}=r,o=s.decryptdata;if(a&&a.byteLength>0&&o!=null&&o.key&&o.iv&&Gs(o.method)){const l=self.performance.now();return this.decrypter.decrypt(new Uint8Array(a),o.key.buffer,o.iv.buffer,_g(o.method)).catch(u=>{throw i.trigger(S.ERROR,{type:re.MEDIA_ERROR,details:O.FRAG_DECRYPT_ERROR,fatal:!1,error:u,reason:u.message,frag:s}),u}).then(u=>{const c=self.performance.now();return i.trigger(S.FRAG_DECRYPTED,{frag:s,payload:u,stats:{tstart:l,tdecrypt:c}}),r.payload=u,this.completeInitSegmentLoad(r)})}return this.completeInitSegmentLoad(r)}).catch(r=>{this.state===$.STOPPED||this.state===$.ERROR||(this.warn(r),this.resetFragmentLoading(e))})}completeInitSegmentLoad(e){const{levels:t}=this;if(!t)throw new Error("init load aborted, missing levels");const r=e.frag.stats;this.state!==$.STOPPED&&(this.state=$.IDLE),e.frag.data=new Uint8Array(e.payload),r.parsing.start=r.buffering.start=self.performance.now(),r.parsing.end=r.buffering.end=self.performance.now(),this.tick()}fragContextChanged(e){const{fragCurrent:t}=this;return!e||!t||e.sn!==t.sn||e.level!==t.level}fragBufferedComplete(e,t){const r=this.mediaBuffer?this.mediaBuffer:this.media;if(this.log(`Buffered ${e.type} sn: ${e.sn}${t?" part: "+t.index:""} of ${this.fragInfo(e,!1,t)} > buffer:${r?sk.toString(ge.getBuffered(r)):"(detached)"})`),vt(e)){var i;if(e.type!==ne.SUBTITLE){const a=e.elementaryStreams;if(!Object.keys(a).some(o=>!!a[o])){this.state=$.IDLE;return}}const s=(i=this.levels)==null?void 0:i[e.level];s!=null&&s.fragmentError&&(this.log(`Resetting level fragment error count of ${s.fragmentError} on frag buffered`),s.fragmentError=0)}this.state=$.IDLE}_handleFragmentLoadComplete(e){const{transmuxer:t}=this;if(!t)return;const{frag:r,part:i,partsLoaded:s}=e,a=!s||s.length===0||s.some(l=>!l),o=new Rg(r.level,r.sn,r.stats.chunkCount+1,0,i?i.index:-1,!a);t.flush(o)}_handleFragmentLoadProgress(e){}_doFragLoad(e,t,r=null,i){var s;this.fragCurrent=e;const a=t==null?void 0:t.details;if(!this.levels||!a)throw new Error(`frag load aborted, missing level${a?"":" detail"}s`);let o=null;e.encrypted&&!((s=e.decryptdata)!=null&&s.key)?(this.log(`Loading key for ${e.sn} of [${a.startSN}-${a.endSN}], ${this.playlistLabel()} ${e.level}`),this.state=$.KEY_LOADING,this.fragCurrent=e,o=this.keyLoader.load(e).then(d=>{if(!this.fragContextChanged(d.frag))return this.hls.trigger(S.KEY_LOADED,d),this.state===$.KEY_LOADING&&(this.state=$.IDLE),d}),this.hls.trigger(S.KEY_LOADING,{frag:e}),this.fragCurrent===null&&(o=Promise.reject(new Error("frag load aborted, context changed in KEY_LOADING")))):e.encrypted||(o=this.keyLoader.loadClear(e,a.encryptedFragments),o&&this.log("[eme] blocking frag load until media-keys acquired"));const l=this.fragPrevious;if(vt(e)&&(!l||e.sn!==l.sn)){const d=this.shouldLoadParts(t.details,e.end);d!==this.loadingParts&&(this.log(`LL-Part loading ${d?"ON":"OFF"} loading sn ${l==null?void 0:l.sn}->${e.sn}`),this.loadingParts=d)}if(r=Math.max(e.start,r||0),this.loadingParts&&vt(e)){const d=a.partList;if(d&&i){r>e.end&&a.fragmentHint&&(e=a.fragmentHint);const h=this.getNextPart(d,e,r);if(h>-1){const f=d[h];e=this.fragCurrent=f.fragment,this.log(`Loading ${e.type} sn: ${e.sn} part: ${f.index} (${h}/${d.length-1}) of ${this.fragInfo(e,!1,f)}) cc: ${e.cc} [${a.startSN}-${a.endSN}], target: ${parseFloat(r.toFixed(3))}`),this.nextLoadPosition=f.start+f.duration,this.state=$.FRAG_LOADING;let g;return o?g=o.then(m=>!m||this.fragContextChanged(m.frag)?null:this.doFragPartsLoad(e,f,t,i)).catch(m=>this.handleFragLoadError(m)):g=this.doFragPartsLoad(e,f,t,i).catch(m=>this.handleFragLoadError(m)),this.hls.trigger(S.FRAG_LOADING,{frag:e,part:f,targetBufferTime:r}),this.fragCurrent===null?Promise.reject(new Error("frag load aborted, context changed in FRAG_LOADING parts")):g}else if(!e.url||this.loadedEndOfParts(d,r))return Promise.resolve(null)}}if(vt(e)&&this.loadingParts)this.log(`LL-Part loading OFF after next part miss @${r.toFixed(2)}`),this.loadingParts=!1;else if(!e.url)return Promise.resolve(null);this.log(`Loading ${e.type} sn: ${e.sn} of ${this.fragInfo(e,!1)}) cc: ${e.cc} ${a?"["+a.startSN+"-"+a.endSN+"]":""}, target: ${parseFloat(r.toFixed(3))}`),Z(e.sn)&&!this.bitrateTest&&(this.nextLoadPosition=e.start+e.duration),this.state=$.FRAG_LOADING;const u=this.config.progressive;let c;return u&&o?c=o.then(d=>!d||this.fragContextChanged(d==null?void 0:d.frag)?null:this.fragmentLoader.load(e,i)).catch(d=>this.handleFragLoadError(d)):c=Promise.all([this.fragmentLoader.load(e,u?i:void 0),o]).then(([d])=>(!u&&d&&i&&i(d),d)).catch(d=>this.handleFragLoadError(d)),this.hls.trigger(S.FRAG_LOADING,{frag:e,targetBufferTime:r}),this.fragCurrent===null?Promise.reject(new Error("frag load aborted, context changed in FRAG_LOADING")):c}doFragPartsLoad(e,t,r,i){return new Promise((s,a)=>{var o;const l=[],u=(o=r.details)==null?void 0:o.partList,c=d=>{this.fragmentLoader.loadPart(e,d,i).then(h=>{l[d.index]=h;const f=h.part;this.hls.trigger(S.FRAG_LOADED,h);const g=F0(r.details,e.sn,d.index+1)||fx(u,e.sn,d.index+1);if(g)c(g);else return s({frag:e,part:f,partsLoaded:l})}).catch(a)};c(t)})}handleFragLoadError(e){if("data"in e){const t=e.data;e.data&&t.details===O.INTERNAL_ABORTED?this.handleFragLoadAborted(t.frag,t.part):this.hls.trigger(S.ERROR,t)}else this.hls.trigger(S.ERROR,{type:re.OTHER_ERROR,details:O.INTERNAL_EXCEPTION,err:e,error:e,fatal:!0});return null}_handleTransmuxerFlush(e){const t=this.getCurrentContext(e);if(!t||this.state!==$.PARSING){!this.fragCurrent&&this.state!==$.STOPPED&&this.state!==$.ERROR&&(this.state=$.IDLE);return}const{frag:r,part:i,level:s}=t,a=self.performance.now();r.stats.parsing.end=a,i&&(i.stats.parsing.end=a);const o=this.getLevelDetails(),u=o&&r.sn>o.endSN||this.shouldLoadParts(o,r.end);u!==this.loadingParts&&(this.log(`LL-Part loading ${u?"ON":"OFF"} after parsing segment ending @${r.end.toFixed(2)}`),this.loadingParts=u),this.updateLevelTiming(r,i,s,e.partial)}shouldLoadParts(e,t){if(this.config.lowLatencyMode){if(!e)return this.loadingParts;if(e!=null&&e.partList){var r;const s=e.partList[0],a=s.end+(((r=e.fragmentHint)==null?void 0:r.duration)||0);if(t>=a){var i;if((this.hls.hasEnoughToStart?((i=this.media)==null?void 0:i.currentTime)||this.lastCurrentTime:this.getLoadPosition())>s.start-s.fragment.duration)return!0}}}return!1}getCurrentContext(e){const{levels:t,fragCurrent:r}=this,{level:i,sn:s,part:a}=e;if(!(t!=null&&t[i]))return this.warn(`Levels object was unset while buffering fragment ${s} of ${this.playlistLabel()} ${i}. The current chunk will not be buffered.`),null;const o=t[i],l=o.details,u=a>-1?F0(l,s,a):null,c=u?u.fragment:hx(l,s,r);return c?(r&&r!==c&&(c.stats=r.stats),{frag:c,part:u,level:o}):null}bufferFragmentData(e,t,r,i,s){var a;if(!e||this.state!==$.PARSING)return;const{data1:o,data2:l}=e;let u=o;if(o&&l&&(u=Tn(o,l)),!((a=u)!=null&&a.length))return;const c={type:e.type,frag:t,part:r,chunkMeta:i,parent:t.type,data:u};if(this.hls.trigger(S.BUFFER_APPENDING,c),e.dropped&&e.independent&&!r){if(s)return;this.flushBufferGap(t)}}flushBufferGap(e){const t=this.media;if(!t)return;if(!ge.isBuffered(t,t.currentTime)){this.flushMainBuffer(0,e.start);return}const r=t.currentTime,i=ge.bufferInfo(t,r,0),s=e.duration,a=Math.min(this.config.maxFragLookUpTolerance*2,s*.25),o=Math.max(Math.min(e.start-a,i.end-a),r+a);e.start-o>a&&this.flushMainBuffer(o,e.start)}getFwdBufferInfo(e,t){var r;const i=this.getLoadPosition();if(!Z(i))return null;const a=this.lastCurrentTime>i||(r=this.media)!=null&&r.paused?0:this.config.maxBufferHole;return this.getFwdBufferInfoAtPos(e,i,t,a)}getFwdBufferInfoAtPos(e,t,r,i){const s=ge.bufferInfo(e,t,i);if(s.len===0&&s.nextStart!==void 0){const a=this.fragmentTracker.getBufferedFrag(t,r);if(a&&(s.nextStart<=a.end||a.gap)){const o=Math.max(Math.min(s.nextStart,a.end)-t,i);return ge.bufferInfo(e,t,o)}}return s}getMaxBufferLength(e){const{config:t}=this;let r;return e?r=Math.max(8*t.maxBufferSize/e,t.maxBufferLength):r=t.maxBufferLength,Math.min(r,t.maxMaxBufferLength)}reduceMaxBufferLength(e,t){const r=this.config,i=Math.max(Math.min(e-t,r.maxBufferLength),t),s=Math.max(e-t*3,r.maxMaxBufferLength/2,i);return s>=i?(r.maxMaxBufferLength=s,this.warn(`Reduce max buffer length to ${s}s`),!0):!1}getAppendedFrag(e,t=ne.MAIN){var r;const i=(r=this.fragmentTracker)==null?void 0:r.getAppendedFrag(e,t);return i&&"fragment"in i?i.fragment:i}getNextFragment(e,t){const r=t.fragments,i=r.length;if(!i)return null;const{config:s}=this,a=r[0].start,o=s.lowLatencyMode&&!!t.partList;let l=null;if(t.live){const d=s.initialLiveManifestSize;if(i<d)return this.warn(`Not enough fragments to start playback (have: ${i}, need: ${d})`),null;if(!t.PTSKnown&&!this.startFragRequested&&this.startPosition===-1||e<a){var u;o&&!this.loadingParts&&(this.log("LL-Part loading ON for initial live fragment"),this.loadingParts=!0),l=this.getInitialLiveFragment(t);const h=this.hls.startPosition,f=this.hls.liveSyncPosition,g=l?(h!==-1&&h>=a?h:f)||l.start:e;this.log(`Setting startPosition to ${g} to match start frag at live edge. mainStart: ${h} liveSyncPosition: ${f} frag.start: ${(u=l)==null?void 0:u.start}`),this.startPosition=this.nextLoadPosition=g}}else e<=a&&(l=r[0]);if(!l){const d=this.loadingParts?t.partEnd:t.fragmentEnd;l=this.getFragmentAtPosition(e,d,t)}let c=this.filterReplacedPrimary(l,t);if(!c&&l){const d=l.sn-t.startSN;c=this.filterReplacedPrimary(r[d+1]||null,t)}return this.mapToInitFragWhenRequired(c)}isLoopLoading(e,t){const r=this.fragmentTracker.getState(e);return(r===ct.OK||r===ct.PARTIAL&&!!e.gap)&&this.nextLoadPosition>t}getNextFragmentLoopLoading(e,t,r,i,s){let a=null;if(e.gap&&(a=this.getNextFragment(this.nextLoadPosition,t),a&&!a.gap&&r.nextStart)){const o=this.getFwdBufferInfoAtPos(this.mediaBuffer?this.mediaBuffer:this.media,r.nextStart,i,0);if(o!==null&&r.len+o.len>=s){const l=a.sn;return this.loopSn!==l&&(this.log(`buffer full after gaps in "${i}" playlist starting at sn: ${l}`),this.loopSn=l),null}}return this.loopSn=void 0,a}get primaryPrefetch(){if(N0(this.hls.config)){var e,t;if((e=this.hls.interstitialsManager)==null||(t=e.playingItem)==null?void 0:t.event)return!0}return!1}filterReplacedPrimary(e,t){if(!e)return e;if(N0(this.hls.config)&&e.type!==ne.SUBTITLE){const r=this.hls.interstitialsManager,i=r==null?void 0:r.bufferingItem;if(i){const a=i.event;if(a){if(a.appendInPlace||Math.abs(e.start-i.start)>1||i.start===0)return null}else if(e.end<=i.start&&(t==null?void 0:t.live)===!1||e.start>i.end&&i.nextEvent&&(i.nextEvent.appendInPlace||e.start-i.end>1))return null}const s=r==null?void 0:r.playerQueue;if(s)for(let a=s.length;a--;){const o=s[a].interstitial;if(o.appendInPlace&&e.start>=o.startTime&&e.end<=o.resumeTime)return null}}return e}mapToInitFragWhenRequired(e){return e!=null&&e.initSegment&&!(e!=null&&e.initSegment.data)&&!this.bitrateTest?e.initSegment:e}getNextPart(e,t,r){let i=-1,s=!1,a=!0;for(let o=0,l=e.length;o<l;o++){const u=e[o];if(a=a&&!u.independent,i>-1&&r<u.start)break;const c=u.loaded;c?i=-1:(s||u.independent||a)&&u.fragment===t&&(i=o),s=c}return i}loadedEndOfParts(e,t){const r=e[e.length-1];return r&&t>r.start&&r.loaded}getInitialLiveFragment(e){const t=e.fragments,r=this.fragPrevious;let i=null;if(r){if(e.hasProgramDateTime&&(this.log(`Live playlist, switching playlist, load frag with same PDT: ${r.programDateTime}`),i=xb(t,r.endProgramDateTime,this.config.maxFragLookUpTolerance)),!i){const s=r.sn+1;if(s>=e.startSN&&s<=e.endSN){const a=t[s-e.startSN];r.cc===a.cc&&(i=a,this.log(`Live playlist, switching playlist, load frag with next SN: ${i.sn}`))}i||(i=nx(e,r.cc,r.end),i&&this.log(`Live playlist, switching playlist, load frag with same CC: ${i.sn}`))}}else{const s=this.hls.liveSyncPosition;s!==null&&(i=this.getFragmentAtPosition(s,this.bitrateTest?e.fragmentEnd:e.edge,e))}return i}getFragmentAtPosition(e,t,r){const{config:i}=this;let{fragPrevious:s}=this,{fragments:a,endSN:o}=r;const{fragmentHint:l}=r,{maxFragLookUpTolerance:u}=i,c=r.partList,d=!!(this.loadingParts&&c!=null&&c.length&&l);d&&l&&!this.bitrateTest&&c[c.length-1].fragment.sn===l.sn&&(a=a.concat(l),o=l.sn);let h;if(e<t){var f;const m=e<this.lastCurrentTime||e>t-u||(f=this.media)!=null&&f.paused||!this.startFragRequested?0:u;h=rs(s,a,e,m)}else h=a[a.length-1];if(h){const g=h.sn-r.startSN,m=this.fragmentTracker.getState(h);if((m===ct.OK||m===ct.PARTIAL&&h.gap)&&(s=h),s&&h.sn===s.sn&&(!d||c[0].fragment.sn>h.sn||!r.live&&!d)&&s&&h.level===s.level){const p=a[g+1];h.sn<o&&this.fragmentTracker.getState(p)!==ct.OK?h=p:h=null}}return h}alignPlaylists(e,t,r){const i=e.fragments.length;if(!i)return this.warn("No fragments in live playlist"),0;const s=e.fragmentStart,a=!t,o=e.alignedSliding&&Z(s);if(a||!o&&!s){ik(r,e);const l=e.fragmentStart;return this.log(`Live playlist sliding: ${l.toFixed(2)} start-sn: ${t?t.startSN:"na"}->${e.startSN} fragments: ${i}`),l}return s}waitForCdnTuneIn(e){return e.live&&e.canBlockReload&&e.partTarget&&e.tuneInGoal>Math.max(e.partHoldBack,e.partTarget*3)}setStartPosition(e,t){let r=this.startPosition;r<t&&(r=-1);const i=this.timelineOffset;if(r===-1){const s=this.startTimeOffset!==null,a=s?this.startTimeOffset:e.startTimeOffset;a!==null&&Z(a)?(r=t+a,a<0&&(r+=e.edge),r=Math.min(Math.max(t,r),t+e.totalduration),this.log(`Setting startPosition to ${r} for start time offset ${a} found in ${s?"multivariant":"media"} playlist`),this.startPosition=r):e.live?(r=this.hls.liveSyncPosition||t,this.log(`Setting startPosition to -1 to start at live edge ${r}`),this.startPosition=-1):(this.log("setting startPosition to 0 by default"),this.startPosition=r=0),this.lastCurrentTime=r+i}this.nextLoadPosition=r+i}getLoadPosition(){var e;const{media:t}=this;let r=0;return(e=this.hls)!=null&&e.hasEnoughToStart&&t?r=t.currentTime:this.nextLoadPosition>=0&&(r=this.nextLoadPosition),r}handleFragLoadAborted(e,t){this.transmuxer&&e.type===this.playlistType&&vt(e)&&e.stats.aborted&&(this.warn(`Fragment ${e.sn}${t?" part "+t.index:""} of ${this.playlistLabel()} ${e.level} was aborted`),this.resetFragmentLoading(e))}resetFragmentLoading(e){(!this.fragCurrent||!this.fragContextChanged(e)&&this.state!==$.FRAG_LOADING_WAITING_RETRY)&&(this.state=$.IDLE)}onFragmentOrKeyLoadError(e,t){if(t.chunkMeta&&!t.frag){const g=this.getCurrentContext(t.chunkMeta);g&&(t.frag=g.frag)}const r=t.frag;if(!r||r.type!==e||!this.levels)return;if(this.fragContextChanged(r)){var i;this.warn(`Frag load error must match current frag to retry ${r.url} > ${(i=this.fragCurrent)==null?void 0:i.url}`);return}const s=t.details===O.FRAG_GAP;s&&this.fragmentTracker.fragBuffered(r,!0);const a=t.errorAction,{action:o,flags:l,retryCount:u=0,retryConfig:c}=a||{},d=!!a&&!!c,h=d&&o===It.RetryRequest,f=d&&!a.resolved&&l===In.MoveAllAlternatesMatchingHost;if(!h&&f&&vt(r)&&!r.endList)this.resetFragmentErrors(e),this.treatAsGap(r),a.resolved=!0;else if((h||f)&&u<c.maxNumRetry){this.resetStartWhenNotLoaded(this.levelLastLoaded);const g=Lg(c,u);this.warn(`Fragment ${r.sn} of ${e} ${r.level} errored with ${t.details}, retrying loading ${u+1}/${c.maxNumRetry} in ${g}ms`),a.resolved=!0,this.retryDate=self.performance.now()+g,this.state=$.FRAG_LOADING_WAITING_RETRY}else if(c&&a)if(this.resetFragmentErrors(e),u<c.maxNumRetry)!s&&o!==It.RemoveAlternatePermanently&&(a.resolved=!0);else{this.warn(`${t.details} reached or exceeded max retry (${u})`);return}else o===It.SendAlternateToPenaltyBox?this.state=$.WAITING_LEVEL:this.state=$.ERROR;this.tickImmediate()}reduceLengthAndFlushBuffer(e){if(this.state===$.PARSING||this.state===$.PARSED){const t=e.frag,r=e.parent,i=this.getFwdBufferInfo(this.mediaBuffer,r),s=i&&i.len>.5;s&&this.reduceMaxBufferLength(i.len,(t==null?void 0:t.duration)||10);const a=!s;return a&&this.warn(`Buffer full error while media.currentTime is not buffered, flush ${r} buffer`),t&&(this.fragmentTracker.removeFragment(t),this.nextLoadPosition=t.start),this.resetLoadingState(),a}return!1}resetFragmentErrors(e){e===ne.AUDIO&&(this.fragCurrent=null),this.hls.hasEnoughToStart||(this.startFragRequested=!1),this.state!==$.STOPPED&&(this.state=$.IDLE)}afterBufferFlushed(e,t,r){if(!e)return;const i=ge.getBuffered(e);this.fragmentTracker.detectEvictedFragments(t,i,r),this.state===$.ENDED&&this.resetLoadingState()}resetLoadingState(){this.log("Reset loading state"),this.fragCurrent=null,this.fragPrevious=null,this.state!==$.STOPPED&&(this.state=$.IDLE)}resetStartWhenNotLoaded(e){if(!this.hls.hasEnoughToStart){this.startFragRequested=!1;const t=e?e.details:null;t!=null&&t.live?(this.log("resetting startPosition for live start"),this.startPosition=-1,this.setStartPosition(t,t.fragmentStart),this.resetLoadingState()):this.nextLoadPosition=this.startPosition}}resetWhenMissingContext(e){this.warn(`The loading context changed while buffering fragment ${e.sn} of ${this.playlistLabel()} ${e.level}. This chunk will not be buffered.`),this.removeUnbufferedFrags(),this.resetStartWhenNotLoaded(this.levelLastLoaded),this.resetLoadingState()}removeUnbufferedFrags(e=0){this.fragmentTracker.removeFragmentsInRange(e,1/0,this.playlistType,!1,!0)}updateLevelTiming(e,t,r,i){const s=r.details;if(!s){this.warn("level.details undefined");return}if(!Object.keys(e.elementaryStreams).reduce((l,u)=>{const c=e.elementaryStreams[u];if(c){const d=c.endPTS-c.startPTS;if(d<=0)return this.warn(`Could not parse fragment ${e.sn} ${u} duration reliably (${d})`),l||!1;const h=i?0:ux(s,e,c.startPTS,c.endPTS,c.startDTS,c.endDTS);return this.hls.trigger(S.LEVEL_PTS_UPDATED,{details:s,level:r,drift:h,type:u,frag:e,start:c.startPTS,end:c.endPTS}),!0}return l},!1)){var o;if(r.fragmentError===0&&this.treatAsGap(e,r),((o=this.transmuxer)==null?void 0:o.error)===null){const l=new Error(`Found no media in fragment ${e.sn} of ${this.playlistLabel()} ${e.level} resetting transmuxer to fallback to playlist timing`);if(this.warn(l.message),this.hls.trigger(S.ERROR,{type:re.MEDIA_ERROR,details:O.FRAG_PARSING_ERROR,fatal:!1,error:l,frag:e,reason:`Found no media in msn ${e.sn} of ${this.playlistLabel()} "${r.url}"`}),!this.hls)return;this.resetTransmuxer()}}this.state=$.PARSED,this.log(`Parsed ${e.type} sn: ${e.sn}${t?" part: "+t.index:""} of ${this.fragInfo(e,!1,t)})`),this.hls.trigger(S.FRAG_PARSED,{frag:e,part:t})}playlistLabel(){return this.playlistType===ne.MAIN?"level":"track"}fragInfo(e,t=!0,r){var i,s;return`${this.playlistLabel()} ${e.level} (${r?"part":"frag"}:[${((i=t&&!r?e.startPTS:(r||e).start)!=null?i:NaN).toFixed(3)}-${((s=t&&!r?e.endPTS:(r||e).end)!=null?s:NaN).toFixed(3)}]${r&&e.type==="main"?"INDEPENDENT="+(r.independent?"YES":"NO"):""}`}treatAsGap(e,t){t&&t.fragmentError++,e.gap=!0,this.fragmentTracker.removeFragment(e),this.fragmentTracker.fragBuffered(e,!0)}resetTransmuxer(){var e;(e=this.transmuxer)==null||e.reset()}recoverWorkerError(e){e.event==="demuxerWorker"&&(this.fragmentTracker.removeAllFragments(),this.transmuxer&&(this.transmuxer.destroy(),this.transmuxer=null),this.resetStartWhenNotLoaded(this.levelLastLoaded),this.resetLoadingState())}set state(e){const t=this._state;t!==e&&(this._state=e,this.log(`${t}->${e}`))}get state(){return this._state}}function N0(n){return!!n.interstitialsController&&n.enableInterstitialPlayback!==!1}class yx{constructor(){this.chunks=[],this.dataLength=0}push(e){this.chunks.push(e),this.dataLength+=e.length}flush(){const{chunks:e,dataLength:t}=this;let r;if(e.length)e.length===1?r=e[0]:r=ak(e,t);else return new Uint8Array(0);return this.reset(),r}reset(){this.chunks.length=0,this.dataLength=0}}function ak(n,e){const t=new Uint8Array(e);let r=0;for(let i=0;i<n.length;i++){const s=n[i];t.set(s,r),r+=s.length}return t}var Td={exports:{}},U0;function ok(){return U0||(U0=1,function(n){var e=Object.prototype.hasOwnProperty,t="~";function r(){}Object.create&&(r.prototype=Object.create(null),new r().__proto__||(t=!1));function i(l,u,c){this.fn=l,this.context=u,this.once=c||!1}function s(l,u,c,d,h){if(typeof c!="function")throw new TypeError("The listener must be a function");var f=new i(c,d||l,h),g=t?t+u:u;return l._events[g]?l._events[g].fn?l._events[g]=[l._events[g],f]:l._events[g].push(f):(l._events[g]=f,l._eventsCount++),l}function a(l,u){--l._eventsCount===0?l._events=new r:delete l._events[u]}function o(){this._events=new r,this._eventsCount=0}o.prototype.eventNames=function(){var u=[],c,d;if(this._eventsCount===0)return u;for(d in c=this._events)e.call(c,d)&&u.push(t?d.slice(1):d);return Object.getOwnPropertySymbols?u.concat(Object.getOwnPropertySymbols(c)):u},o.prototype.listeners=function(u){var c=t?t+u:u,d=this._events[c];if(!d)return[];if(d.fn)return[d.fn];for(var h=0,f=d.length,g=new Array(f);h<f;h++)g[h]=d[h].fn;return g},o.prototype.listenerCount=function(u){var c=t?t+u:u,d=this._events[c];return d?d.fn?1:d.length:0},o.prototype.emit=function(u,c,d,h,f,g){var m=t?t+u:u;if(!this._events[m])return!1;var y=this._events[m],p=arguments.length,v,E;if(y.fn){switch(y.once&&this.removeListener(u,y.fn,void 0,!0),p){case 1:return y.fn.call(y.context),!0;case 2:return y.fn.call(y.context,c),!0;case 3:return y.fn.call(y.context,c,d),!0;case 4:return y.fn.call(y.context,c,d,h),!0;case 5:return y.fn.call(y.context,c,d,h,f),!0;case 6:return y.fn.call(y.context,c,d,h,f,g),!0}for(E=1,v=new Array(p-1);E<p;E++)v[E-1]=arguments[E];y.fn.apply(y.context,v)}else{var T=y.length,A;for(E=0;E<T;E++)switch(y[E].once&&this.removeListener(u,y[E].fn,void 0,!0),p){case 1:y[E].fn.call(y[E].context);break;case 2:y[E].fn.call(y[E].context,c);break;case 3:y[E].fn.call(y[E].context,c,d);break;case 4:y[E].fn.call(y[E].context,c,d,h);break;default:if(!v)for(A=1,v=new Array(p-1);A<p;A++)v[A-1]=arguments[A];y[E].fn.apply(y[E].context,v)}}return!0},o.prototype.on=function(u,c,d){return s(this,u,c,d,!1)},o.prototype.once=function(u,c,d){return s(this,u,c,d,!0)},o.prototype.removeListener=function(u,c,d,h){var f=t?t+u:u;if(!this._events[f])return this;if(!c)return a(this,f),this;var g=this._events[f];if(g.fn)g.fn===c&&(!h||g.once)&&(!d||g.context===d)&&a(this,f);else{for(var m=0,y=[],p=g.length;m<p;m++)(g[m].fn!==c||h&&!g[m].once||d&&g[m].context!==d)&&y.push(g[m]);y.length?this._events[f]=y.length===1?y[0]:y:a(this,f)}return this},o.prototype.removeAllListeners=function(u){var c;return u?(c=t?t+u:u,this._events[c]&&a(this,c)):(this._events=new r,this._eventsCount=0),this},o.prototype.off=o.prototype.removeListener,o.prototype.addListener=o.prototype.on,o.prefixed=t,o.EventEmitter=o,n.exports=o}(Td)),Td.exports}var lk=ok(),Cg=Uw(lk);const wo="1.6.5",fa={};function uk(){return typeof __HLS_WORKER_BUNDLE__=="function"}function ck(){const n=fa[wo];if(n)return n.clientCount++,n;const e=new self.Blob([`var exports={};var module={exports:exports};function define(f){f()};define.amd=true;(${__HLS_WORKER_BUNDLE__.toString()})(true);`],{type:"text/javascript"}),t=self.URL.createObjectURL(e),i={worker:new self.Worker(t),objectURL:t,clientCount:1};return fa[wo]=i,i}function dk(n){const e=fa[n];if(e)return e.clientCount++,e;const t=new self.URL(n,self.location.href).href,i={worker:new self.Worker(t),scriptURL:t,clientCount:1};return fa[n]=i,i}function hk(n){const e=fa[n||wo];if(e&&e.clientCount--===1){const{worker:r,objectURL:i}=e;delete fa[n||wo],i&&self.URL.revokeObjectURL(i),r.terminate()}}function vx(n,e){return e+10<=n.length&&n[e]===51&&n[e+1]===68&&n[e+2]===73&&n[e+3]<255&&n[e+4]<255&&n[e+6]<128&&n[e+7]<128&&n[e+8]<128&&n[e+9]<128}function wg(n,e){return e+10<=n.length&&n[e]===73&&n[e+1]===68&&n[e+2]===51&&n[e+3]<255&&n[e+4]<255&&n[e+6]<128&&n[e+7]<128&&n[e+8]<128&&n[e+9]<128}function Lc(n,e){let t=0;return t=(n[e]&127)<<21,t|=(n[e+1]&127)<<14,t|=(n[e+2]&127)<<7,t|=n[e+3]&127,t}function bo(n,e){const t=e;let r=0;for(;wg(n,e);){r+=10;const i=Lc(n,e+6);r+=i,vx(n,e+10)&&(r+=10),e+=r}if(r>0)return n.subarray(t,t+r)}function fk(n,e,t,r){const i=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350],s=e[t+2],a=s>>2&15;if(a>12){const f=new Error(`invalid ADTS sampling index:${a}`);n.emit(S.ERROR,S.ERROR,{type:re.MEDIA_ERROR,details:O.FRAG_PARSING_ERROR,fatal:!0,error:f,reason:f.message});return}const o=(s>>6&3)+1,l=e[t+3]>>6&3|(s&1)<<2,u="mp4a.40."+o,c=i[a];let d=a;(o===5||o===29)&&(d-=3);const h=[o<<3|(d&14)>>1,(d&1)<<7|l<<3];return Ie.log(`manifest codec:${r}, parsed codec:${u}, channels:${l}, rate:${c} (ADTS object type:${o} sampling index:${a})`),{config:h,samplerate:c,channelCount:l,codec:u,parsedCodec:u,manifestCodec:r}}function Ex(n,e){return n[e]===255&&(n[e+1]&246)===240}function Sx(n,e){return n[e+1]&1?7:9}function bg(n,e){return(n[e+3]&3)<<11|n[e+4]<<3|(n[e+5]&224)>>>5}function gk(n,e){return e+5<n.length}function Xu(n,e){return e+1<n.length&&Ex(n,e)}function mk(n,e){return gk(n,e)&&Ex(n,e)&&bg(n,e)<=n.length-e}function pk(n,e){if(Xu(n,e)){const t=Sx(n,e);if(e+t>=n.length)return!1;const r=bg(n,e);if(r<=t)return!1;const i=e+r;return i===n.length||Xu(n,i)}return!1}function xx(n,e,t,r,i){if(!n.samplerate){const s=fk(e,t,r,i);if(!s)return;Oe(n,s)}}function Tx(n){return 1024*9e4/n}function yk(n,e){const t=Sx(n,e);if(e+t<=n.length){const r=bg(n,e)-t;if(r>0)return{headerLength:t,frameLength:r}}}function Lx(n,e,t,r,i){const s=Tx(n.samplerate),a=r+i*s,o=yk(e,t);let l;if(o){const{frameLength:d,headerLength:h}=o,f=h+d,g=Math.max(0,t+f-e.length);g?(l=new Uint8Array(f-h),l.set(e.subarray(t+h,e.length),0)):l=e.subarray(t+h,t+f);const m={unit:l,pts:a};return g||n.samples.push(m),{sample:m,length:f,missing:g}}const u=e.length-t;return l=new Uint8Array(u),l.set(e.subarray(t,e.length),0),{sample:{unit:l,pts:a},length:u,missing:-1}}function vk(n,e){return wg(n,e)&&Lc(n,e+6)+10<=n.length-e}function Ek(n){return n instanceof ArrayBuffer?n:n.byteOffset==0&&n.byteLength==n.buffer.byteLength?n.buffer:new Uint8Array(n).buffer}function Ld(n,e=0,t=1/0){return Sk(n,e,t,Uint8Array)}function Sk(n,e,t,r){const i=xk(n);let s=1;"BYTES_PER_ELEMENT"in r&&(s=r.BYTES_PER_ELEMENT);const a=Tk(n)?n.byteOffset:0,o=(a+n.byteLength)/s,l=(a+e)/s,u=Math.floor(Math.max(0,Math.min(l,o))),c=Math.floor(Math.min(u+Math.max(t,0),o));return new r(i,u,c-u)}function xk(n){return n instanceof ArrayBuffer?n:n.buffer}function Tk(n){return n&&n.buffer instanceof ArrayBuffer&&n.byteLength!==void 0&&n.byteOffset!==void 0}function Lk(n){const e={key:n.type,description:"",data:"",mimeType:null,pictureType:null},t=3;if(n.size<2)return;if(n.data[0]!==t){console.log("Ignore frame with unrecognized character encoding");return}const r=n.data.subarray(1).indexOf(0);if(r===-1)return;const i=sn(Ld(n.data,1,r)),s=n.data[2+r],a=n.data.subarray(3+r).indexOf(0);if(a===-1)return;const o=sn(Ld(n.data,3+r,a));let l;return i==="-->"?l=sn(Ld(n.data,4+r+a)):l=Ek(n.data.subarray(4+r+a)),e.mimeType=i,e.pictureType=s,e.description=o,e.data=l,e}function Ak(n){if(n.size<2)return;const e=sn(n.data,!0),t=new Uint8Array(n.data.subarray(e.length+1));return{key:n.type,info:e,data:t.buffer}}function Rk(n){if(n.size<2)return;if(n.type==="TXXX"){let t=1;const r=sn(n.data.subarray(t),!0);t+=r.length+1;const i=sn(n.data.subarray(t));return{key:n.type,info:r,data:i}}const e=sn(n.data.subarray(1));return{key:n.type,info:"",data:e}}function _k(n){if(n.type==="WXXX"){if(n.size<2)return;let t=1;const r=sn(n.data.subarray(t),!0);t+=r.length+1;const i=sn(n.data.subarray(t));return{key:n.type,info:r,data:i}}const e=sn(n.data);return{key:n.type,info:"",data:e}}function Ik(n){return n.type==="PRIV"?Ak(n):n.type[0]==="W"?_k(n):n.type==="APIC"?Lk(n):Rk(n)}function Dk(n){const e=String.fromCharCode(n[0],n[1],n[2],n[3]),t=Lc(n,4),r=10;return{type:e,size:t,data:n.subarray(r,r+t)}}const Ml=10,Ck=10;function Ax(n){let e=0;const t=[];for(;wg(n,e);){const r=Lc(n,e+6);n[e+5]>>6&1&&(e+=Ml),e+=Ml;const i=e+r;for(;e+Ck<i;){const s=Dk(n.subarray(e)),a=Ik(s);a&&t.push(a),e+=s.size+Ml}vx(n,e)&&(e+=Ml)}return t}function Rx(n){return n&&n.key==="PRIV"&&n.info==="com.apple.streaming.transportStreamTimestamp"}function wk(n){if(n.data.byteLength===8){const e=new Uint8Array(n.data),t=e[3]&1;let r=(e[4]<<23)+(e[5]<<15)+(e[6]<<7)+e[7];return r/=45,t&&(r+=4772185884e-2),Math.round(r)}}function kg(n){const e=Ax(n);for(let t=0;t<e.length;t++){const r=e[t];if(Rx(r))return wk(r)}}let en=function(n){return n.audioId3="org.id3",n.dateRange="com.apple.quicktime.HLS",n.emsg="https://aomedia.org/emsg/ID3",n.misbklv="urn:misb:KLV:bin:1910.1",n}({});function Yn(n="",e=9e4){return{type:n,id:-1,pid:-1,inputTimeScale:e,sequenceNumber:-1,samples:[],dropped:0}}class Pg{constructor(){this._audioTrack=void 0,this._id3Track=void 0,this.frameIndex=0,this.cachedData=null,this.basePTS=null,this.initPTS=null,this.lastPTS=null}resetInitSegment(e,t,r,i){this._id3Track={type:"id3",id:3,pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0}}resetTimeStamp(e){this.initPTS=e,this.resetContiguity()}resetContiguity(){this.basePTS=null,this.lastPTS=null,this.frameIndex=0}canParse(e,t){return!1}appendFrame(e,t,r){}demux(e,t){this.cachedData&&(e=Tn(this.cachedData,e),this.cachedData=null);let r=bo(e,0),i=r?r.length:0,s;const a=this._audioTrack,o=this._id3Track,l=r?kg(r):void 0,u=e.length;for((this.basePTS===null||this.frameIndex===0&&Z(l))&&(this.basePTS=bk(l,t,this.initPTS),this.lastPTS=this.basePTS),this.lastPTS===null&&(this.lastPTS=this.basePTS),r&&r.length>0&&o.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:r,type:en.audioId3,duration:Number.POSITIVE_INFINITY});i<u;){if(this.canParse(e,i)){const c=this.appendFrame(a,e,i);c?(this.frameIndex++,this.lastPTS=c.sample.pts,i+=c.length,s=i):i=u}else vk(e,i)?(r=bo(e,i),o.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:r,type:en.audioId3,duration:Number.POSITIVE_INFINITY}),i+=r.length,s=i):i++;if(i===u&&s!==u){const c=e.slice(s);this.cachedData?this.cachedData=Tn(this.cachedData,c):this.cachedData=c}}return{audioTrack:a,videoTrack:Yn(),id3Track:o,textTrack:Yn()}}demuxSampleAes(e,t,r){return Promise.reject(new Error(`[${this}] This demuxer does not support Sample-AES decryption`))}flush(e){const t=this.cachedData;return t&&(this.cachedData=null,this.demux(t,0)),{audioTrack:this._audioTrack,videoTrack:Yn(),id3Track:this._id3Track,textTrack:Yn()}}destroy(){this.cachedData=null,this._audioTrack=this._id3Track=void 0}}const bk=(n,e,t)=>{if(Z(n))return n*90;const r=t?t.baseTime*9e4/t.timescale:0;return e*9e4+r};let Nl=null;const kk=[32,64,96,128,160,192,224,256,288,320,352,384,416,448,32,48,56,64,80,96,112,128,160,192,224,256,320,384,32,40,48,56,64,80,96,112,128,160,192,224,256,320,32,48,56,64,80,96,112,128,144,160,176,192,224,256,8,16,24,32,40,48,56,64,80,96,112,128,144,160],Pk=[44100,48e3,32e3,22050,24e3,16e3,11025,12e3,8e3],Ok=[[0,72,144,12],[0,0,0,0],[0,72,144,12],[0,144,144,12]],Fk=[0,1,1,4];function _x(n,e,t,r,i){if(t+24>e.length)return;const s=Ix(e,t);if(s&&t+s.frameLength<=e.length){const a=s.samplesPerFrame*9e4/s.sampleRate,o=r+i*a,l={unit:e.subarray(t,t+s.frameLength),pts:o,dts:o};return n.config=[],n.channelCount=s.channelCount,n.samplerate=s.sampleRate,n.samples.push(l),{sample:l,length:s.frameLength,missing:0}}}function Ix(n,e){const t=n[e+1]>>3&3,r=n[e+1]>>1&3,i=n[e+2]>>4&15,s=n[e+2]>>2&3;if(t!==1&&i!==0&&i!==15&&s!==3){const a=n[e+2]>>1&1,o=n[e+3]>>6,l=t===3?3-r:r===3?3:4,u=kk[l*14+i-1]*1e3,d=Pk[(t===3?0:t===2?1:2)*3+s],h=o===3?1:2,f=Ok[t][r],g=Fk[r],m=f*8*g,y=Math.floor(f*u/d+a)*g;if(Nl===null){const E=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);Nl=E?parseInt(E[1]):0}return!!Nl&&Nl<=87&&r===2&&u>=224e3&&o===0&&(n[e+3]=n[e+3]|128),{sampleRate:d,channelCount:h,frameLength:y,samplesPerFrame:m}}}function Og(n,e){return n[e]===255&&(n[e+1]&224)===224&&(n[e+1]&6)!==0}function Dx(n,e){return e+1<n.length&&Og(n,e)}function Mk(n,e){return Og(n,e)&&4<=n.length-e}function Cx(n,e){if(e+1<n.length&&Og(n,e)){const r=Ix(n,e);let i=4;r!=null&&r.frameLength&&(i=r.frameLength);const s=e+i;return s===n.length||Dx(n,s)}return!1}class Nk extends Pg{constructor(e,t){super(),this.observer=void 0,this.config=void 0,this.observer=e,this.config=t}resetInitSegment(e,t,r,i){super.resetInitSegment(e,t,r,i),this._audioTrack={container:"audio/adts",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"aac",samples:[],manifestCodec:t,duration:i,inputTimeScale:9e4,dropped:0}}static probe(e,t){if(!e)return!1;const r=bo(e,0);let i=(r==null?void 0:r.length)||0;if(Cx(e,i))return!1;for(let s=e.length;i<s;i++)if(pk(e,i))return t.log("ADTS sync word found !"),!0;return!1}canParse(e,t){return mk(e,t)}appendFrame(e,t,r){xx(e,this.observer,t,r,e.manifestCodec);const i=Lx(e,t,r,this.basePTS,this.frameIndex);if(i&&i.missing===0)return i}}const wx=(n,e)=>{let t=0,r=5;e+=r;const i=new Uint32Array(1),s=new Uint32Array(1),a=new Uint8Array(1);for(;r>0;){a[0]=n[e];const o=Math.min(r,8),l=8-o;s[0]=4278190080>>>24+l<<l,i[0]=(a[0]&s[0])>>l,t=t?t<<o|i[0]:i[0],e+=1,r-=o}return t};class Uk extends Pg{constructor(e){super(),this.observer=void 0,this.observer=e}resetInitSegment(e,t,r,i){super.resetInitSegment(e,t,r,i),this._audioTrack={container:"audio/ac-3",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"ac3",samples:[],manifestCodec:t,duration:i,inputTimeScale:9e4,dropped:0}}canParse(e,t){return t+64<e.length}appendFrame(e,t,r){const i=bx(e,t,r,this.basePTS,this.frameIndex);if(i!==-1)return{sample:e.samples[e.samples.length-1],length:i,missing:0}}static probe(e){if(!e)return!1;const t=bo(e,0);if(!t)return!1;const r=t.length;return e[r]===11&&e[r+1]===119&&kg(t)!==void 0&&wx(e,r)<16}}function bx(n,e,t,r,i){if(t+8>e.length||e[t]!==11||e[t+1]!==119)return-1;const s=e[t+4]>>6;if(s>=3)return-1;const o=[48e3,44100,32e3][s],l=e[t+4]&63,c=[64,69,96,64,70,96,80,87,120,80,88,120,96,104,144,96,105,144,112,121,168,112,122,168,128,139,192,128,140,192,160,174,240,160,175,240,192,208,288,192,209,288,224,243,336,224,244,336,256,278,384,256,279,384,320,348,480,320,349,480,384,417,576,384,418,576,448,487,672,448,488,672,512,557,768,512,558,768,640,696,960,640,697,960,768,835,1152,768,836,1152,896,975,1344,896,976,1344,1024,1114,1536,1024,1115,1536,1152,1253,1728,1152,1254,1728,1280,1393,1920,1280,1394,1920][l*3+s]*2;if(t+c>e.length)return-1;const d=e[t+6]>>5;let h=0;d===2?h+=2:(d&1&&d!==1&&(h+=2),d&4&&(h+=2));const f=(e[t+6]<<8|e[t+7])>>12-h&1,m=[2,1,2,3,3,4,4,5][d]+f,y=e[t+5]>>3,p=e[t+5]&7,v=new Uint8Array([s<<6|y<<1|p>>2,(p&3)<<6|d<<3|f<<2|l>>4,l<<4&224]),E=1536/o*9e4,T=r+i*E,A=e.subarray(t,t+c);return n.config=v,n.channelCount=m,n.samplerate=o,n.samples.push({unit:A,pts:T}),c}class Bk extends Pg{resetInitSegment(e,t,r,i){super.resetInitSegment(e,t,r,i),this._audioTrack={container:"audio/mpeg",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"mp3",samples:[],manifestCodec:t,duration:i,inputTimeScale:9e4,dropped:0}}static probe(e){if(!e)return!1;const t=bo(e,0);let r=(t==null?void 0:t.length)||0;if(t&&e[r]===11&&e[r+1]===119&&kg(t)!==void 0&&wx(e,r)<=16)return!1;for(let i=e.length;r<i;r++)if(Cx(e,r))return Ie.log("MPEG Audio sync word found !"),!0;return!1}canParse(e,t){return Mk(e,t)}appendFrame(e,t,r){if(this.basePTS!==null)return _x(e,t,r,this.basePTS,this.frameIndex)}}const $k=/\/emsg[-/]ID3/i;class jk{constructor(e,t){this.remainderData=null,this.timeOffset=0,this.config=void 0,this.videoTrack=void 0,this.audioTrack=void 0,this.id3Track=void 0,this.txtTrack=void 0,this.config=t}resetTimeStamp(){}resetInitSegment(e,t,r,i){const s=this.videoTrack=Yn("video",1),a=this.audioTrack=Yn("audio",1),o=this.txtTrack=Yn("text",1);if(this.id3Track=Yn("id3",1),this.timeOffset=0,!(e!=null&&e.byteLength))return;const l=VS(e);if(l.video){const{id:u,timescale:c,codec:d,supplemental:h}=l.video;s.id=u,s.timescale=o.timescale=c,s.codec=d,s.supplemental=h}if(l.audio){const{id:u,timescale:c,codec:d}=l.audio;a.id=u,a.timescale=c,a.codec=d}o.id=jS.text,s.sampleDuration=0,s.duration=a.duration=i}resetContiguity(){this.remainderData=null}static probe(e){return Kw(e)}demux(e,t){this.timeOffset=t;let r=e;const i=this.videoTrack,s=this.txtTrack;if(this.config.progressive){this.remainderData&&(r=Tn(this.remainderData,e));const o=Qw(r);this.remainderData=o.remainder,i.samples=o.valid||new Uint8Array}else i.samples=r;const a=this.extractID3Track(i,t);return s.samples=s0(t,i),{videoTrack:i,audioTrack:this.audioTrack,id3Track:a,textTrack:this.txtTrack}}flush(){const e=this.timeOffset,t=this.videoTrack,r=this.txtTrack;t.samples=this.remainderData||new Uint8Array,this.remainderData=null;const i=this.extractID3Track(t,this.timeOffset);return r.samples=s0(e,t),{videoTrack:t,audioTrack:Yn(),id3Track:i,textTrack:Yn()}}extractID3Track(e,t){const r=this.id3Track;if(e.samples.length){const i=me(e.samples,["emsg"]);i&&i.forEach(s=>{const a=Zw(s);if($k.test(a.schemeIdUri)){const o=B0(a,t);let l=a.eventDuration===4294967295?Number.POSITIVE_INFINITY:a.eventDuration/a.timeScale;l<=.001&&(l=Number.POSITIVE_INFINITY);const u=a.payload;r.samples.push({data:u,len:u.byteLength,dts:o,pts:o,type:en.emsg,duration:l})}else if(this.config.enableEmsgKLVMetadata&&a.schemeIdUri.startsWith("urn:misb:KLV:bin:1910.1")){const o=B0(a,t);r.samples.push({data:a.payload,len:a.payload.byteLength,dts:o,pts:o,type:en.misbklv,duration:Number.POSITIVE_INFINITY})}})}return r}demuxSampleAes(e,t,r){return Promise.reject(new Error("The MP4 demuxer does not support SAMPLE-AES decryption"))}destroy(){this.config=null,this.remainderData=null,this.videoTrack=this.audioTrack=this.id3Track=this.txtTrack=void 0}}function B0(n,e){return Z(n.presentationTime)?n.presentationTime/n.timeScale:e+n.presentationTimeDelta/n.timeScale}class Gk{constructor(e,t,r){this.keyData=void 0,this.decrypter=void 0,this.keyData=r,this.decrypter=new Ag(t,{removePKCS7Padding:!1})}decryptBuffer(e){return this.decrypter.decrypt(e,this.keyData.key.buffer,this.keyData.iv.buffer,Ei.cbc)}decryptAacSample(e,t,r){const i=e[t].unit;if(i.length<=16)return;const s=i.subarray(16,i.length-i.length%16),a=s.buffer.slice(s.byteOffset,s.byteOffset+s.length);this.decryptBuffer(a).then(o=>{const l=new Uint8Array(o);i.set(l,16),this.decrypter.isSync()||this.decryptAacSamples(e,t+1,r)})}decryptAacSamples(e,t,r){for(;;t++){if(t>=e.length){r();return}if(!(e[t].unit.length<32)&&(this.decryptAacSample(e,t,r),!this.decrypter.isSync()))return}}getAvcEncryptedData(e){const t=Math.floor((e.length-48)/160)*16+16,r=new Int8Array(t);let i=0;for(let s=32;s<e.length-16;s+=160,i+=16)r.set(e.subarray(s,s+16),i);return r}getAvcDecryptedUnit(e,t){const r=new Uint8Array(t);let i=0;for(let s=32;s<e.length-16;s+=160,i+=16)e.set(r.subarray(i,i+16),s);return e}decryptAvcSample(e,t,r,i,s){const a=zS(s.data),o=this.getAvcEncryptedData(a);this.decryptBuffer(o.buffer).then(l=>{s.data=this.getAvcDecryptedUnit(a,l),this.decrypter.isSync()||this.decryptAvcSamples(e,t,r+1,i)})}decryptAvcSamples(e,t,r,i){if(e instanceof Uint8Array)throw new Error("Cannot decrypt samples of type Uint8Array");for(;;t++,r=0){if(t>=e.length){i();return}const s=e[t].units;for(;!(r>=s.length);r++){const a=s[r];if(!(a.data.length<=48||a.type!==1&&a.type!==5)&&(this.decryptAvcSample(e,t,r,i,a),!this.decrypter.isSync()))return}}}}class kx{constructor(){this.VideoSample=null}createVideoSample(e,t,r){return{key:e,frame:!1,pts:t,dts:r,units:[],length:0}}getLastNalUnit(e){var t;let r=this.VideoSample,i;if((!r||r.units.length===0)&&(r=e[e.length-1]),(t=r)!=null&&t.units){const s=r.units;i=s[s.length-1]}return i}pushAccessUnit(e,t){if(e.units.length&&e.frame){if(e.pts===void 0){const r=t.samples,i=r.length;if(i){const s=r[i-1];e.pts=s.pts,e.dts=s.dts}else{t.dropped++;return}}t.samples.push(e)}}parseNALu(e,t,r){const i=t.byteLength;let s=e.naluState||0;const a=s,o=[];let l=0,u,c,d,h=-1,f=0;for(s===-1&&(h=0,f=this.getNALuType(t,0),s=0,l=1);l<i;){if(u=t[l++],!s){s=u?0:1;continue}if(s===1){s=u?0:2;continue}if(!u)s=3;else if(u===1){if(c=l-s-1,h>=0){const g={data:t.subarray(h,c),type:f};o.push(g)}else{const g=this.getLastNalUnit(e.samples);g&&(a&&l<=4-a&&g.state&&(g.data=g.data.subarray(0,g.data.byteLength-a)),c>0&&(g.data=Tn(g.data,t.subarray(0,c)),g.state=0))}l<i?(d=this.getNALuType(t,l),h=l,f=d,s=0):s=-1}else s=0}if(h>=0&&s>=0){const g={data:t.subarray(h,i),type:f,state:s};o.push(g)}if(o.length===0){const g=this.getLastNalUnit(e.samples);g&&(g.data=Tn(g.data,t))}return e.naluState=s,o}}class ro{constructor(e){this.data=void 0,this.bytesAvailable=void 0,this.word=void 0,this.bitsAvailable=void 0,this.data=e,this.bytesAvailable=e.byteLength,this.word=0,this.bitsAvailable=0}loadWord(){const e=this.data,t=this.bytesAvailable,r=e.byteLength-t,i=new Uint8Array(4),s=Math.min(4,t);if(s===0)throw new Error("no bytes available");i.set(e.subarray(r,r+s)),this.word=new DataView(i.buffer).getUint32(0),this.bitsAvailable=s*8,this.bytesAvailable-=s}skipBits(e){let t;e=Math.min(e,this.bytesAvailable*8+this.bitsAvailable),this.bitsAvailable>e?(this.word<<=e,this.bitsAvailable-=e):(e-=this.bitsAvailable,t=e>>3,e-=t<<3,this.bytesAvailable-=t,this.loadWord(),this.word<<=e,this.bitsAvailable-=e)}readBits(e){let t=Math.min(this.bitsAvailable,e);const r=this.word>>>32-t;if(e>32&&Ie.error("Cannot read more than 32 bits at a time"),this.bitsAvailable-=t,this.bitsAvailable>0)this.word<<=t;else if(this.bytesAvailable>0)this.loadWord();else throw new Error("no bits available");return t=e-t,t>0&&this.bitsAvailable?r<<t|this.readBits(t):r}skipLZ(){let e;for(e=0;e<this.bitsAvailable;++e)if(this.word&2147483648>>>e)return this.word<<=e,this.bitsAvailable-=e,e;return this.loadWord(),e+this.skipLZ()}skipUEG(){this.skipBits(1+this.skipLZ())}skipEG(){this.skipBits(1+this.skipLZ())}readUEG(){const e=this.skipLZ();return this.readBits(e+1)-1}readEG(){const e=this.readUEG();return 1&e?1+e>>>1:-1*(e>>>1)}readBoolean(){return this.readBits(1)===1}readUByte(){return this.readBits(8)}readUShort(){return this.readBits(16)}readUInt(){return this.readBits(32)}}class $0 extends kx{parsePES(e,t,r,i){const s=this.parseNALu(e,r.data,i);let a=this.VideoSample,o,l=!1;r.data=null,a&&s.length&&!e.audFound&&(this.pushAccessUnit(a,e),a=this.VideoSample=this.createVideoSample(!1,r.pts,r.dts)),s.forEach(u=>{var c,d;switch(u.type){case 1:{let m=!1;o=!0;const y=u.data;if(l&&y.length>4){const p=this.readSliceType(y);(p===2||p===4||p===7||p===9)&&(m=!0)}if(m){var h;(h=a)!=null&&h.frame&&!a.key&&(this.pushAccessUnit(a,e),a=this.VideoSample=null)}a||(a=this.VideoSample=this.createVideoSample(!0,r.pts,r.dts)),a.frame=!0,a.key=m;break}case 5:o=!0,(c=a)!=null&&c.frame&&!a.key&&(this.pushAccessUnit(a,e),a=this.VideoSample=null),a||(a=this.VideoSample=this.createVideoSample(!0,r.pts,r.dts)),a.key=!0,a.frame=!0;break;case 6:{o=!0,Tg(u.data,1,r.pts,t.samples);break}case 7:{var f,g;o=!0,l=!0;const m=u.data,y=this.readSPS(m);if(!e.sps||e.width!==y.width||e.height!==y.height||((f=e.pixelRatio)==null?void 0:f[0])!==y.pixelRatio[0]||((g=e.pixelRatio)==null?void 0:g[1])!==y.pixelRatio[1]){e.width=y.width,e.height=y.height,e.pixelRatio=y.pixelRatio,e.sps=[m];const p=m.subarray(1,4);let v="avc1.";for(let E=0;E<3;E++){let T=p[E].toString(16);T.length<2&&(T="0"+T),v+=T}e.codec=v}break}case 8:o=!0,e.pps=[u.data];break;case 9:o=!0,e.audFound=!0,(d=a)!=null&&d.frame&&(this.pushAccessUnit(a,e),a=null),a||(a=this.VideoSample=this.createVideoSample(!1,r.pts,r.dts));break;case 12:o=!0;break;default:o=!1;break}a&&o&&a.units.push(u)}),i&&a&&(this.pushAccessUnit(a,e),this.VideoSample=null)}getNALuType(e,t){return e[t]&31}readSliceType(e){const t=new ro(e);return t.readUByte(),t.readUEG(),t.readUEG()}skipScalingList(e,t){let r=8,i=8,s;for(let a=0;a<e;a++)i!==0&&(s=t.readEG(),i=(r+s+256)%256),r=i===0?r:i}readSPS(e){const t=new ro(e);let r=0,i=0,s=0,a=0,o,l,u;const c=t.readUByte.bind(t),d=t.readBits.bind(t),h=t.readUEG.bind(t),f=t.readBoolean.bind(t),g=t.skipBits.bind(t),m=t.skipEG.bind(t),y=t.skipUEG.bind(t),p=this.skipScalingList.bind(this);c();const v=c();if(d(5),g(3),c(),y(),v===100||v===110||v===122||v===244||v===44||v===83||v===86||v===118||v===128){const x=h();if(x===3&&g(1),y(),y(),g(1),f())for(l=x!==3?8:12,u=0;u<l;u++)f()&&(u<6?p(16,t):p(64,t))}y();const E=h();if(E===0)h();else if(E===1)for(g(1),m(),m(),o=h(),u=0;u<o;u++)m();y(),g(1);const T=h(),A=h(),I=d(1);I===0&&g(1),g(1),f()&&(r=h(),i=h(),s=h(),a=h());let R=[1,1];if(f()&&f())switch(c()){case 1:R=[1,1];break;case 2:R=[12,11];break;case 3:R=[10,11];break;case 4:R=[16,11];break;case 5:R=[40,33];break;case 6:R=[24,11];break;case 7:R=[20,11];break;case 8:R=[32,11];break;case 9:R=[80,33];break;case 10:R=[18,11];break;case 11:R=[15,11];break;case 12:R=[64,33];break;case 13:R=[160,99];break;case 14:R=[4,3];break;case 15:R=[3,2];break;case 16:R=[2,1];break;case 255:{R=[c()<<8|c(),c()<<8|c()];break}}return{width:Math.ceil((T+1)*16-r*2-i*2),height:(2-I)*(A+1)*16-(I?2:4)*(s+a),pixelRatio:R}}}class j0 extends kx{constructor(...e){super(...e),this.initVPS=null}parsePES(e,t,r,i){const s=this.parseNALu(e,r.data,i);let a=this.VideoSample,o,l=!1;r.data=null,a&&s.length&&!e.audFound&&(this.pushAccessUnit(a,e),a=this.VideoSample=this.createVideoSample(!1,r.pts,r.dts)),s.forEach(u=>{var c,d;switch(u.type){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 8:case 9:a||(a=this.VideoSample=this.createVideoSample(!1,r.pts,r.dts)),a.frame=!0,o=!0;break;case 16:case 17:case 18:case 21:if(o=!0,l){var h;(h=a)!=null&&h.frame&&!a.key&&(this.pushAccessUnit(a,e),a=this.VideoSample=null)}a||(a=this.VideoSample=this.createVideoSample(!0,r.pts,r.dts)),a.key=!0,a.frame=!0;break;case 19:case 20:o=!0,(c=a)!=null&&c.frame&&!a.key&&(this.pushAccessUnit(a,e),a=this.VideoSample=null),a||(a=this.VideoSample=this.createVideoSample(!0,r.pts,r.dts)),a.key=!0,a.frame=!0;break;case 39:o=!0,Tg(u.data,2,r.pts,t.samples);break;case 32:o=!0,e.vps||(typeof e.params!="object"&&(e.params={}),e.params=Oe(e.params,this.readVPS(u.data)),this.initVPS=u.data),e.vps=[u.data];break;case 33:if(o=!0,l=!0,e.vps!==void 0&&e.vps[0]!==this.initVPS&&e.sps!==void 0&&!this.matchSPS(e.sps[0],u.data)&&(this.initVPS=e.vps[0],e.sps=e.pps=void 0),!e.sps){const f=this.readSPS(u.data);e.width=f.width,e.height=f.height,e.pixelRatio=f.pixelRatio,e.codec=f.codecString,e.sps=[],typeof e.params!="object"&&(e.params={});for(const g in f.params)e.params[g]=f.params[g]}this.pushParameterSet(e.sps,u.data,e.vps),a||(a=this.VideoSample=this.createVideoSample(!0,r.pts,r.dts)),a.key=!0;break;case 34:if(o=!0,typeof e.params=="object"){if(!e.pps){e.pps=[];const f=this.readPPS(u.data);for(const g in f)e.params[g]=f[g]}this.pushParameterSet(e.pps,u.data,e.vps)}break;case 35:o=!0,e.audFound=!0,(d=a)!=null&&d.frame&&(this.pushAccessUnit(a,e),a=null),a||(a=this.VideoSample=this.createVideoSample(!1,r.pts,r.dts));break;default:o=!1;break}a&&o&&a.units.push(u)}),i&&a&&(this.pushAccessUnit(a,e),this.VideoSample=null)}pushParameterSet(e,t,r){(r&&r[0]===this.initVPS||!r&&!e.length)&&e.push(t)}getNALuType(e,t){return(e[t]&126)>>>1}ebsp2rbsp(e){const t=new Uint8Array(e.byteLength);let r=0;for(let i=0;i<e.byteLength;i++)i>=2&&e[i]===3&&e[i-1]===0&&e[i-2]===0||(t[r]=e[i],r++);return new Uint8Array(t.buffer,0,r)}pushAccessUnit(e,t){super.pushAccessUnit(e,t),this.initVPS&&(this.initVPS=null)}readVPS(e){const t=new ro(e);t.readUByte(),t.readUByte(),t.readBits(4),t.skipBits(2),t.readBits(6);const r=t.readBits(3),i=t.readBoolean();return{numTemporalLayers:r+1,temporalIdNested:i}}readSPS(e){const t=new ro(this.ebsp2rbsp(e));t.readUByte(),t.readUByte(),t.readBits(4);const r=t.readBits(3);t.readBoolean();const i=t.readBits(2),s=t.readBoolean(),a=t.readBits(5),o=t.readUByte(),l=t.readUByte(),u=t.readUByte(),c=t.readUByte(),d=t.readUByte(),h=t.readUByte(),f=t.readUByte(),g=t.readUByte(),m=t.readUByte(),y=t.readUByte(),p=t.readUByte(),v=[],E=[];for(let Te=0;Te<r;Te++)v.push(t.readBoolean()),E.push(t.readBoolean());if(r>0)for(let Te=r;Te<8;Te++)t.readBits(2);for(let Te=0;Te<r;Te++)v[Te]&&(t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte()),E[Te]&&t.readUByte();t.readUEG();const T=t.readUEG();T==3&&t.skipBits(1);const A=t.readUEG(),I=t.readUEG(),R=t.readBoolean();let x=0,D=0,_=0,M=0;R&&(x+=t.readUEG(),D+=t.readUEG(),_+=t.readUEG(),M+=t.readUEG());const j=t.readUEG(),z=t.readUEG(),H=t.readUEG(),W=t.readBoolean();for(let Te=W?0:r;Te<=r;Te++)t.skipUEG(),t.skipUEG(),t.skipUEG();if(t.skipUEG(),t.skipUEG(),t.skipUEG(),t.skipUEG(),t.skipUEG(),t.skipUEG(),t.readBoolean()&&t.readBoolean())for(let ft=0;ft<4;ft++)for(let rt=0;rt<(ft===3?2:6);rt++)if(!t.readBoolean())t.readUEG();else{const Yt=Math.min(64,1<<4+(ft<<1));ft>1&&t.readEG();for(let ar=0;ar<Yt;ar++)t.readEG()}t.readBoolean(),t.readBoolean(),t.readBoolean()&&(t.readUByte(),t.skipUEG(),t.skipUEG(),t.readBoolean());const B=t.readUEG();let F=0;for(let Te=0;Te<B;Te++){let ft=!1;if(Te!==0&&(ft=t.readBoolean()),ft){Te===B&&t.readUEG(),t.readBoolean(),t.readUEG();let rt=0;for(let sr=0;sr<=F;sr++){const Yt=t.readBoolean();let ar=!1;Yt||(ar=t.readBoolean()),(Yt||ar)&&rt++}F=rt}else{const rt=t.readUEG(),sr=t.readUEG();F=rt+sr;for(let Yt=0;Yt<rt;Yt++)t.readUEG(),t.readBoolean();for(let Yt=0;Yt<sr;Yt++)t.readUEG(),t.readBoolean()}}if(t.readBoolean()){const Te=t.readUEG();for(let ft=0;ft<Te;ft++){for(let rt=0;rt<H+4;rt++)t.readBits(1);t.readBits(1)}}let Q=0,q=1,oe=1,de=!0,pe=1,he=0;t.readBoolean(),t.readBoolean();let Fe=!1;if(t.readBoolean()){if(t.readBoolean()){const or=t.readUByte(),zo=[1,12,10,16,40,24,20,32,80,18,15,64,160,4,3,2],os=[1,11,11,11,33,11,11,11,33,11,11,33,99,3,2,1];or>0&&or<16?(q=zo[or-1],oe=os[or-1]):or===255&&(q=t.readBits(16),oe=t.readBits(16))}if(t.readBoolean()&&t.readBoolean(),t.readBoolean()&&(t.readBits(3),t.readBoolean(),t.readBoolean()&&(t.readUByte(),t.readUByte(),t.readUByte())),t.readBoolean()&&(t.readUEG(),t.readUEG()),t.readBoolean(),t.readBoolean(),t.readBoolean(),Fe=t.readBoolean(),Fe&&(x+=t.readUEG(),D+=t.readUEG(),_+=t.readUEG(),M+=t.readUEG()),t.readBoolean()&&(pe=t.readBits(32),he=t.readBits(32),t.readBoolean()&&t.readUEG(),t.readBoolean())){const os=t.readBoolean(),Wo=t.readBoolean();let qt=!1;(os||Wo)&&(qt=t.readBoolean(),qt&&(t.readUByte(),t.readBits(5),t.readBoolean(),t.readBits(5)),t.readBits(4),t.readBits(4),qt&&t.readBits(4),t.readBits(5),t.readBits(5),t.readBits(5));for(let Pr=0;Pr<=r;Pr++){de=t.readBoolean();const Yo=de||t.readBoolean();let ls=!1;Yo?t.readEG():ls=t.readBoolean();const Ln=ls?1:t.readUEG()+1;if(os)for(let wt=0;wt<Ln;wt++)t.readUEG(),t.readUEG(),qt&&(t.readUEG(),t.readUEG()),t.skipBits(1);if(Wo)for(let wt=0;wt<Ln;wt++)t.readUEG(),t.readUEG(),qt&&(t.readUEG(),t.readUEG()),t.skipBits(1)}}t.readBoolean()&&(t.readBoolean(),t.readBoolean(),t.readBoolean(),Q=t.readUEG())}let Nn=A,_i=I;if(R||Fe){let Te=1,ft=1;T===1?Te=ft=2:T==2&&(Te=2),Nn=A-Te*D-Te*x,_i=I-ft*M-ft*_}const Ac=i?["A","B","C"][i]:"",Rc=o<<24|l<<16|u<<8|c;let Ta=0;for(let Te=0;Te<32;Te++)Ta=(Ta|(Rc>>Te&1)<<31-Te)>>>0;let ot=Ta.toString(16);return a===1&&ot==="2"&&(ot="6"),{codecString:`hvc1.${Ac}${a}.${ot}.${s?"H":"L"}${p}.B0`,params:{general_tier_flag:s,general_profile_idc:a,general_profile_space:i,general_profile_compatibility_flags:[o,l,u,c],general_constraint_indicator_flags:[d,h,f,g,m,y],general_level_idc:p,bit_depth:j+8,bit_depth_luma_minus8:j,bit_depth_chroma_minus8:z,min_spatial_segmentation_idc:Q,chroma_format_idc:T,frame_rate:{fixed:de,fps:he/pe}},width:Nn,height:_i,pixelRatio:[q,oe]}}readPPS(e){const t=new ro(this.ebsp2rbsp(e));t.readUByte(),t.readUByte(),t.skipUEG(),t.skipUEG(),t.skipBits(2),t.skipBits(3),t.skipBits(2),t.skipUEG(),t.skipUEG(),t.skipEG(),t.skipBits(2),t.readBoolean()&&t.skipUEG(),t.skipEG(),t.skipEG(),t.skipBits(4);const i=t.readBoolean(),s=t.readBoolean();let a=1;return s&&i?a=0:s?a=3:i&&(a=2),{parallelismType:a}}matchSPS(e,t){return String.fromCharCode.apply(null,e).substr(3)===String.fromCharCode.apply(null,t).substr(3)}}const pt=188;class Vr{constructor(e,t,r,i){this.logger=void 0,this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.sampleAes=null,this.pmtParsed=!1,this.audioCodec=void 0,this.videoCodec=void 0,this._pmtId=-1,this._videoTrack=void 0,this._audioTrack=void 0,this._id3Track=void 0,this._txtTrack=void 0,this.aacOverFlow=null,this.remainderData=null,this.videoParser=void 0,this.observer=e,this.config=t,this.typeSupported=r,this.logger=i,this.videoParser=null}static probe(e,t){const r=Vr.syncOffset(e);return r>0&&t.warn(`MPEG2-TS detected but first sync word found @ offset ${r}`),r!==-1}static syncOffset(e){const t=e.length;let r=Math.min(pt*5,t-pt)+1,i=0;for(;i<r;){let s=!1,a=-1,o=0;for(let l=i;l<t;l+=pt)if(e[l]===71&&(t-l===pt||e[l+pt]===71)){if(o++,a===-1&&(a=l,a!==0&&(r=Math.min(a+pt*99,e.length-pt)+1)),s||(s=ef(e,l)===0),s&&o>1&&(a===0&&o>2||l+pt>r))return a}else{if(o)return-1;break}i++}return-1}static createTrack(e,t){return{container:e==="video"||e==="audio"?"video/mp2t":void 0,type:e,id:jS[e],pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0,duration:e==="audio"?t:void 0}}resetInitSegment(e,t,r,i){this.pmtParsed=!1,this._pmtId=-1,this._videoTrack=Vr.createTrack("video"),this._videoTrack.duration=i,this._audioTrack=Vr.createTrack("audio",i),this._id3Track=Vr.createTrack("id3"),this._txtTrack=Vr.createTrack("text"),this._audioTrack.segmentCodec="aac",this.aacOverFlow=null,this.remainderData=null,this.audioCodec=t,this.videoCodec=r}resetTimeStamp(){}resetContiguity(){const{_audioTrack:e,_videoTrack:t,_id3Track:r}=this;e&&(e.pesData=null),t&&(t.pesData=null),r&&(r.pesData=null),this.aacOverFlow=null,this.remainderData=null}demux(e,t,r=!1,i=!1){r||(this.sampleAes=null);let s;const a=this._videoTrack,o=this._audioTrack,l=this._id3Track,u=this._txtTrack;let c=a.pid,d=a.pesData,h=o.pid,f=l.pid,g=o.pesData,m=l.pesData,y=null,p=this.pmtParsed,v=this._pmtId,E=e.length;if(this.remainderData&&(e=Tn(this.remainderData,e),E=e.length,this.remainderData=null),E<pt&&!i)return this.remainderData=e,{audioTrack:o,videoTrack:a,id3Track:l,textTrack:u};const T=Math.max(0,Vr.syncOffset(e));E-=(E-T)%pt,E<e.byteLength&&!i&&(this.remainderData=new Uint8Array(e.buffer,E,e.buffer.byteLength-E));let A=0;for(let R=T;R<E;R+=pt)if(e[R]===71){const x=!!(e[R+1]&64),D=ef(e,R),_=(e[R+3]&48)>>4;let M;if(_>1){if(M=R+5+e[R+4],M===R+pt)continue}else M=R+4;switch(D){case c:if(x){if(d&&(s=ps(d,this.logger))){if(this.videoParser===null)switch(a.segmentCodec){case"avc":this.videoParser=new $0;break;case"hevc":this.videoParser=new j0;break}this.videoParser!==null&&this.videoParser.parsePES(a,u,s,!1)}d={data:[],size:0}}d&&(d.data.push(e.subarray(M,R+pt)),d.size+=R+pt-M);break;case h:if(x){if(g&&(s=ps(g,this.logger)))switch(o.segmentCodec){case"aac":this.parseAACPES(o,s);break;case"mp3":this.parseMPEGPES(o,s);break;case"ac3":this.parseAC3PES(o,s);break}g={data:[],size:0}}g&&(g.data.push(e.subarray(M,R+pt)),g.size+=R+pt-M);break;case f:x&&(m&&(s=ps(m,this.logger))&&this.parseID3PES(l,s),m={data:[],size:0}),m&&(m.data.push(e.subarray(M,R+pt)),m.size+=R+pt-M);break;case 0:x&&(M+=e[M]+1),v=this._pmtId=Kk(e,M);break;case v:{x&&(M+=e[M]+1);const j=Vk(e,M,this.typeSupported,r,this.observer,this.logger);c=j.videoPid,c>0&&(a.pid=c,a.segmentCodec=j.segmentVideoCodec),h=j.audioPid,h>0&&(o.pid=h,o.segmentCodec=j.segmentAudioCodec),f=j.id3Pid,f>0&&(l.pid=f),y!==null&&!p&&(this.logger.warn(`MPEG-TS PMT found at ${R} after unknown PID '${y}'. Backtracking to sync byte @${T} to parse all TS packets.`),y=null,R=T-188),p=this.pmtParsed=!0;break}case 17:case 8191:break;default:y=D;break}}else A++;A>0&&tf(this.observer,new Error(`Found ${A} TS packet/s that do not start with 0x47`),void 0,this.logger),a.pesData=d,o.pesData=g,l.pesData=m;const I={audioTrack:o,videoTrack:a,id3Track:l,textTrack:u};return i&&this.extractRemainingSamples(I),I}flush(){const{remainderData:e}=this;this.remainderData=null;let t;return e?t=this.demux(e,-1,!1,!0):t={videoTrack:this._videoTrack,audioTrack:this._audioTrack,id3Track:this._id3Track,textTrack:this._txtTrack},this.extractRemainingSamples(t),this.sampleAes?this.decrypt(t,this.sampleAes):t}extractRemainingSamples(e){const{audioTrack:t,videoTrack:r,id3Track:i,textTrack:s}=e,a=r.pesData,o=t.pesData,l=i.pesData;let u;if(a&&(u=ps(a,this.logger))){if(this.videoParser===null)switch(r.segmentCodec){case"avc":this.videoParser=new $0;break;case"hevc":this.videoParser=new j0;break}this.videoParser!==null&&(this.videoParser.parsePES(r,s,u,!0),r.pesData=null)}else r.pesData=a;if(o&&(u=ps(o,this.logger))){switch(t.segmentCodec){case"aac":this.parseAACPES(t,u);break;case"mp3":this.parseMPEGPES(t,u);break;case"ac3":this.parseAC3PES(t,u);break}t.pesData=null}else o!=null&&o.size&&this.logger.log("last AAC PES packet truncated,might overlap between fragments"),t.pesData=o;l&&(u=ps(l,this.logger))?(this.parseID3PES(i,u),i.pesData=null):i.pesData=l}demuxSampleAes(e,t,r){const i=this.demux(e,r,!0,!this.config.progressive),s=this.sampleAes=new Gk(this.observer,this.config,t);return this.decrypt(i,s)}decrypt(e,t){return new Promise(r=>{const{audioTrack:i,videoTrack:s}=e;i.samples&&i.segmentCodec==="aac"?t.decryptAacSamples(i.samples,0,()=>{s.samples?t.decryptAvcSamples(s.samples,0,0,()=>{r(e)}):r(e)}):s.samples&&t.decryptAvcSamples(s.samples,0,0,()=>{r(e)})})}destroy(){this.observer&&this.observer.removeAllListeners(),this.config=this.logger=this.observer=null,this.aacOverFlow=this.videoParser=this.remainderData=this.sampleAes=null,this._videoTrack=this._audioTrack=this._id3Track=this._txtTrack=void 0}parseAACPES(e,t){let r=0;const i=this.aacOverFlow;let s=t.data;if(i){this.aacOverFlow=null;const d=i.missing,h=i.sample.unit.byteLength;if(d===-1)s=Tn(i.sample.unit,s);else{const f=h-d;i.sample.unit.set(s.subarray(0,d),f),e.samples.push(i.sample),r=i.missing}}let a,o;for(a=r,o=s.length;a<o-1&&!Xu(s,a);a++);if(a!==r){let d;const h=a<o-1;if(h?d=`AAC PES did not start with ADTS header,offset:${a}`:d="No ADTS header found in AAC PES",tf(this.observer,new Error(d),h,this.logger),!h)return}xx(e,this.observer,s,a,this.audioCodec);let l;if(t.pts!==void 0)l=t.pts;else if(i){const d=Tx(e.samplerate);l=i.sample.pts+d}else{this.logger.warn("[tsdemuxer]: AAC PES unknown PTS");return}let u=0,c;for(;a<o;)if(c=Lx(e,s,a,l,u),a+=c.length,c.missing){this.aacOverFlow=c;break}else for(u++;a<o-1&&!Xu(s,a);a++);}parseMPEGPES(e,t){const r=t.data,i=r.length;let s=0,a=0;const o=t.pts;if(o===void 0){this.logger.warn("[tsdemuxer]: MPEG PES unknown PTS");return}for(;a<i;)if(Dx(r,a)){const l=_x(e,r,a,o,s);if(l)a+=l.length,s++;else break}else a++}parseAC3PES(e,t){{const r=t.data,i=t.pts;if(i===void 0){this.logger.warn("[tsdemuxer]: AC3 PES unknown PTS");return}const s=r.length;let a=0,o=0,l;for(;o<s&&(l=bx(e,r,o,i,a++))>0;)o+=l}}parseID3PES(e,t){if(t.pts===void 0){this.logger.warn("[tsdemuxer]: ID3 PES unknown PTS");return}const r=Oe({},t,{type:this._videoTrack?en.emsg:en.audioId3,duration:Number.POSITIVE_INFINITY});e.samples.push(r)}}function ef(n,e){return((n[e+1]&31)<<8)+n[e+2]}function Kk(n,e){return(n[e+10]&31)<<8|n[e+11]}function Vk(n,e,t,r,i,s){const a={audioPid:-1,videoPid:-1,id3Pid:-1,segmentVideoCodec:"avc",segmentAudioCodec:"aac"},o=(n[e+1]&15)<<8|n[e+2],l=e+3+o-4,u=(n[e+10]&15)<<8|n[e+11];for(e+=12+u;e<l;){const c=ef(n,e),d=(n[e+3]&15)<<8|n[e+4];switch(n[e]){case 207:if(!r){Ad("ADTS AAC",s);break}case 15:a.audioPid===-1&&(a.audioPid=c);break;case 21:a.id3Pid===-1&&(a.id3Pid=c);break;case 219:if(!r){Ad("H.264",s);break}case 27:a.videoPid===-1&&(a.videoPid=c);break;case 3:case 4:!t.mpeg&&!t.mp3?s.log("MPEG audio found, not supported in this browser"):a.audioPid===-1&&(a.audioPid=c,a.segmentAudioCodec="mp3");break;case 193:if(!r){Ad("AC-3",s);break}case 129:t.ac3?a.audioPid===-1&&(a.audioPid=c,a.segmentAudioCodec="ac3"):s.log("AC-3 audio found, not supported in this browser");break;case 6:if(a.audioPid===-1&&d>0){let h=e+5,f=d;for(;f>2;){switch(n[h]){case 106:t.ac3!==!0?s.log("AC-3 audio found, not supported in this browser for now"):(a.audioPid=c,a.segmentAudioCodec="ac3");break}const m=n[h+1]+2;h+=m,f-=m}}break;case 194:case 135:return tf(i,new Error("Unsupported EC-3 in M2TS found"),void 0,s),a;case 36:a.videoPid===-1&&(a.videoPid=c,a.segmentVideoCodec="hevc",s.log("HEVC in M2TS found"));break}e+=d+5}return a}function tf(n,e,t,r){r.warn(`parsing error: ${e.message}`),n.emit(S.ERROR,S.ERROR,{type:re.MEDIA_ERROR,details:O.FRAG_PARSING_ERROR,fatal:!1,levelRetry:t,error:e,reason:e.message})}function Ad(n,e){e.log(`${n} with AES-128-CBC encryption found in unencrypted stream`)}function ps(n,e){let t=0,r,i,s,a,o;const l=n.data;if(!n||n.size===0)return null;for(;l[0].length<19&&l.length>1;)l[0]=Tn(l[0],l[1]),l.splice(1,1);if(r=l[0],(r[0]<<16)+(r[1]<<8)+r[2]===1){if(i=(r[4]<<8)+r[5],i&&i>n.size-6)return null;const c=r[7];c&192&&(a=(r[9]&14)*536870912+(r[10]&255)*4194304+(r[11]&254)*16384+(r[12]&255)*128+(r[13]&254)/2,c&64?(o=(r[14]&14)*536870912+(r[15]&255)*4194304+(r[16]&254)*16384+(r[17]&255)*128+(r[18]&254)/2,a-o>60*9e4&&(e.warn(`${Math.round((a-o)/9e4)}s delta between PTS and DTS, align them`),a=o)):o=a),s=r[8];let d=s+9;if(n.size<=d)return null;n.size-=d;const h=new Uint8Array(n.size);for(let f=0,g=l.length;f<g;f++){r=l[f];let m=r.byteLength;if(d)if(d>m){d-=m;continue}else r=r.subarray(d),m-=d,d=0;h.set(r,t),t+=m}return i&&(i-=s+3),{data:h,pts:a,dts:o,len:i}}return null}class Hk{static getSilentFrame(e,t){switch(e){case"mp4a.40.2":if(t===1)return new Uint8Array([0,200,0,128,35,128]);if(t===2)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(t===3)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(t===4)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(t===5)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(t===6)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224]);break;default:if(t===1)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(t===2)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(t===3)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);break}}}const Nr=Math.pow(2,32)-1;class P{static init(){P.types={avc1:[],avcC:[],hvc1:[],hvcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],".mp3":[],dac3:[],"ac-3":[],mvex:[],mvhd:[],pasp:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[]};let e;for(e in P.types)P.types.hasOwnProperty(e)&&(P.types[e]=[e.charCodeAt(0),e.charCodeAt(1),e.charCodeAt(2),e.charCodeAt(3)]);const t=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),r=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]);P.HDLR_TYPES={video:t,audio:r};const i=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),s=new Uint8Array([0,0,0,0,0,0,0,0]);P.STTS=P.STSC=P.STCO=s,P.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),P.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]),P.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),P.STSD=new Uint8Array([0,0,0,0,0,0,0,1]);const a=new Uint8Array([105,115,111,109]),o=new Uint8Array([97,118,99,49]),l=new Uint8Array([0,0,0,1]);P.FTYP=P.box(P.types.ftyp,a,l,a,o),P.DINF=P.box(P.types.dinf,P.box(P.types.dref,i))}static box(e,...t){let r=8,i=t.length;const s=i;for(;i--;)r+=t[i].byteLength;const a=new Uint8Array(r);for(a[0]=r>>24&255,a[1]=r>>16&255,a[2]=r>>8&255,a[3]=r&255,a.set(e,4),i=0,r=8;i<s;i++)a.set(t[i],r),r+=t[i].byteLength;return a}static hdlr(e){return P.box(P.types.hdlr,P.HDLR_TYPES[e])}static mdat(e){return P.box(P.types.mdat,e)}static mdhd(e,t){t*=e;const r=Math.floor(t/(Nr+1)),i=Math.floor(t%(Nr+1));return P.box(P.types.mdhd,new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,e>>24&255,e>>16&255,e>>8&255,e&255,r>>24,r>>16&255,r>>8&255,r&255,i>>24,i>>16&255,i>>8&255,i&255,85,196,0,0]))}static mdia(e){return P.box(P.types.mdia,P.mdhd(e.timescale||0,e.duration||0),P.hdlr(e.type),P.minf(e))}static mfhd(e){return P.box(P.types.mfhd,new Uint8Array([0,0,0,0,e>>24,e>>16&255,e>>8&255,e&255]))}static minf(e){return e.type==="audio"?P.box(P.types.minf,P.box(P.types.smhd,P.SMHD),P.DINF,P.stbl(e)):P.box(P.types.minf,P.box(P.types.vmhd,P.VMHD),P.DINF,P.stbl(e))}static moof(e,t,r){return P.box(P.types.moof,P.mfhd(e),P.traf(r,t))}static moov(e){let t=e.length;const r=[];for(;t--;)r[t]=P.trak(e[t]);return P.box.apply(null,[P.types.moov,P.mvhd(e[0].timescale||0,e[0].duration||0)].concat(r).concat(P.mvex(e)))}static mvex(e){let t=e.length;const r=[];for(;t--;)r[t]=P.trex(e[t]);return P.box.apply(null,[P.types.mvex,...r])}static mvhd(e,t){t*=e;const r=Math.floor(t/(Nr+1)),i=Math.floor(t%(Nr+1)),s=new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,e>>24&255,e>>16&255,e>>8&255,e&255,r>>24,r>>16&255,r>>8&255,r&255,i>>24,i>>16&255,i>>8&255,i&255,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return P.box(P.types.mvhd,s)}static sdtp(e){const t=e.samples||[],r=new Uint8Array(4+t.length);let i,s;for(i=0;i<t.length;i++)s=t[i].flags,r[i+4]=s.dependsOn<<4|s.isDependedOn<<2|s.hasRedundancy;return P.box(P.types.sdtp,r)}static stbl(e){return P.box(P.types.stbl,P.stsd(e),P.box(P.types.stts,P.STTS),P.box(P.types.stsc,P.STSC),P.box(P.types.stsz,P.STSZ),P.box(P.types.stco,P.STCO))}static avc1(e){let t=[],r=[],i,s,a;for(i=0;i<e.sps.length;i++)s=e.sps[i],a=s.byteLength,t.push(a>>>8&255),t.push(a&255),t=t.concat(Array.prototype.slice.call(s));for(i=0;i<e.pps.length;i++)s=e.pps[i],a=s.byteLength,r.push(a>>>8&255),r.push(a&255),r=r.concat(Array.prototype.slice.call(s));const o=P.box(P.types.avcC,new Uint8Array([1,t[3],t[4],t[5],255,224|e.sps.length].concat(t).concat([e.pps.length]).concat(r))),l=e.width,u=e.height,c=e.pixelRatio[0],d=e.pixelRatio[1];return P.box(P.types.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,l>>8&255,l&255,u>>8&255,u&255,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),o,P.box(P.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),P.box(P.types.pasp,new Uint8Array([c>>24,c>>16&255,c>>8&255,c&255,d>>24,d>>16&255,d>>8&255,d&255])))}static esds(e){const t=e.config;return new Uint8Array([0,0,0,0,3,25,0,1,0,4,17,64,21,0,0,0,0,0,0,0,0,0,0,0,5,2,...t,6,1,2])}static audioStsd(e){const t=e.samplerate||0;return new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,e.channelCount||0,0,16,0,0,0,0,t>>8&255,t&255,0,0])}static mp4a(e){return P.box(P.types.mp4a,P.audioStsd(e),P.box(P.types.esds,P.esds(e)))}static mp3(e){return P.box(P.types[".mp3"],P.audioStsd(e))}static ac3(e){return P.box(P.types["ac-3"],P.audioStsd(e),P.box(P.types.dac3,e.config))}static stsd(e){const{segmentCodec:t}=e;if(e.type==="audio"){if(t==="aac")return P.box(P.types.stsd,P.STSD,P.mp4a(e));if(t==="ac3"&&e.config)return P.box(P.types.stsd,P.STSD,P.ac3(e));if(t==="mp3"&&e.codec==="mp3")return P.box(P.types.stsd,P.STSD,P.mp3(e))}else if(e.pps&&e.sps){if(t==="avc")return P.box(P.types.stsd,P.STSD,P.avc1(e));if(t==="hevc"&&e.vps)return P.box(P.types.stsd,P.STSD,P.hvc1(e))}else throw new Error("video track missing pps or sps");throw new Error(`unsupported ${e.type} segment codec (${t}/${e.codec})`)}static tkhd(e){const t=e.id,r=(e.duration||0)*(e.timescale||0),i=e.width||0,s=e.height||0,a=Math.floor(r/(Nr+1)),o=Math.floor(r%(Nr+1));return P.box(P.types.tkhd,new Uint8Array([1,0,0,7,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,t>>24&255,t>>16&255,t>>8&255,t&255,0,0,0,0,a>>24,a>>16&255,a>>8&255,a&255,o>>24,o>>16&255,o>>8&255,o&255,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,i>>8&255,i&255,0,0,s>>8&255,s&255,0,0]))}static traf(e,t){const r=P.sdtp(e),i=e.id,s=Math.floor(t/(Nr+1)),a=Math.floor(t%(Nr+1));return P.box(P.types.traf,P.box(P.types.tfhd,new Uint8Array([0,0,0,0,i>>24,i>>16&255,i>>8&255,i&255])),P.box(P.types.tfdt,new Uint8Array([1,0,0,0,s>>24,s>>16&255,s>>8&255,s&255,a>>24,a>>16&255,a>>8&255,a&255])),P.trun(e,r.length+16+20+8+16+8+8),r)}static trak(e){return e.duration=e.duration||4294967295,P.box(P.types.trak,P.tkhd(e),P.mdia(e))}static trex(e){const t=e.id;return P.box(P.types.trex,new Uint8Array([0,0,0,0,t>>24,t>>16&255,t>>8&255,t&255,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))}static trun(e,t){const r=e.samples||[],i=r.length,s=12+16*i,a=new Uint8Array(s);let o,l,u,c,d,h;for(t+=8+s,a.set([e.type==="video"?1:0,0,15,1,i>>>24&255,i>>>16&255,i>>>8&255,i&255,t>>>24&255,t>>>16&255,t>>>8&255,t&255],0),o=0;o<i;o++)l=r[o],u=l.duration,c=l.size,d=l.flags,h=l.cts,a.set([u>>>24&255,u>>>16&255,u>>>8&255,u&255,c>>>24&255,c>>>16&255,c>>>8&255,c&255,d.isLeading<<2|d.dependsOn,d.isDependedOn<<6|d.hasRedundancy<<4|d.paddingValue<<1|d.isNonSync,d.degradPrio&61440,d.degradPrio&15,h>>>24&255,h>>>16&255,h>>>8&255,h&255],12+16*o);return P.box(P.types.trun,a)}static initSegment(e){P.types||P.init();const t=P.moov(e);return Tn(P.FTYP,t)}static hvc1(e){const t=e.params,r=[e.vps,e.sps,e.pps],i=4,s=new Uint8Array([1,t.general_profile_space<<6|(t.general_tier_flag?32:0)|t.general_profile_idc,t.general_profile_compatibility_flags[0],t.general_profile_compatibility_flags[1],t.general_profile_compatibility_flags[2],t.general_profile_compatibility_flags[3],t.general_constraint_indicator_flags[0],t.general_constraint_indicator_flags[1],t.general_constraint_indicator_flags[2],t.general_constraint_indicator_flags[3],t.general_constraint_indicator_flags[4],t.general_constraint_indicator_flags[5],t.general_level_idc,240|t.min_spatial_segmentation_idc>>8,255&t.min_spatial_segmentation_idc,252|t.parallelismType,252|t.chroma_format_idc,248|t.bit_depth_luma_minus8,248|t.bit_depth_chroma_minus8,0,parseInt(t.frame_rate.fps),i-1|t.temporal_id_nested<<2|t.num_temporal_layers<<3|(t.frame_rate.fixed?64:0),r.length]);let a=s.length;for(let g=0;g<r.length;g+=1){a+=3;for(let m=0;m<r[g].length;m+=1)a+=2+r[g][m].length}const o=new Uint8Array(a);o.set(s,0),a=s.length;const l=r.length-1;for(let g=0;g<r.length;g+=1){o.set(new Uint8Array([32+g|(g===l?128:0),0,r[g].length]),a),a+=3;for(let m=0;m<r[g].length;m+=1)o.set(new Uint8Array([r[g][m].length>>8,r[g][m].length&255]),a),a+=2,o.set(r[g][m],a),a+=r[g][m].length}const u=P.box(P.types.hvcC,o),c=e.width,d=e.height,h=e.pixelRatio[0],f=e.pixelRatio[1];return P.box(P.types.hvc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,c>>8&255,c&255,d>>8&255,d&255,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),u,P.box(P.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),P.box(P.types.pasp,new Uint8Array([h>>24,h>>16&255,h>>8&255,h&255,f>>24,f>>16&255,f>>8&255,f&255])))}}P.types=void 0;P.HDLR_TYPES=void 0;P.STTS=void 0;P.STSC=void 0;P.STCO=void 0;P.STSZ=void 0;P.VMHD=void 0;P.SMHD=void 0;P.STSD=void 0;P.FTYP=void 0;P.DINF=void 0;const Px=9e4;function Fg(n,e,t=1,r=!1){const i=n*e*t;return r?Math.round(i):i}function zk(n,e,t=1,r=!1){return Fg(n,e,1/t,r)}function Na(n,e=!1){return Fg(n,1e3,1/Px,e)}function Wk(n,e=1){return Fg(n,Px,1/e)}const Yk=10*1e3,qk=1024,Qk=1152,Xk=1536;let ys=null,Rd=null;function G0(n,e,t,r){return{duration:e,size:t,cts:r,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:n?2:1,isNonSync:n?0:1}}}class uu{constructor(e,t,r,i){if(this.logger=void 0,this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.ISGenerated=!1,this._initPTS=null,this._initDTS=null,this.nextAvcDts=null,this.nextAudioPts=null,this.videoSampleDuration=null,this.isAudioContiguous=!1,this.isVideoContiguous=!1,this.videoTrackConfig=void 0,this.observer=e,this.config=t,this.typeSupported=r,this.logger=i,this.ISGenerated=!1,ys===null){const a=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);ys=a?parseInt(a[1]):0}if(Rd===null){const s=navigator.userAgent.match(/Safari\/(\d+)/i);Rd=s?parseInt(s[1]):0}}destroy(){this.config=this.videoTrackConfig=this._initPTS=this._initDTS=null}resetTimeStamp(e){this.logger.log("[mp4-remuxer]: initPTS & initDTS reset"),this._initPTS=this._initDTS=e}resetNextTimestamp(){this.logger.log("[mp4-remuxer]: reset next timestamp"),this.isVideoContiguous=!1,this.isAudioContiguous=!1}resetInitSegment(){this.logger.log("[mp4-remuxer]: ISGenerated flag reset"),this.ISGenerated=!1,this.videoTrackConfig=void 0}getVideoStartPts(e){let t=!1;const r=e[0].pts,i=e.reduce((s,a)=>{let o=a.pts,l=o-s;return l<-4294967296&&(t=!0,o=gn(o,r),l=o-s),l>0?s:o},r);return t&&this.logger.debug("PTS rollover detected"),i}remux(e,t,r,i,s,a,o,l){let u,c,d,h,f,g,m=s,y=s;const p=e.pid>-1,v=t.pid>-1,E=t.samples.length,T=e.samples.length>0,A=o&&E>0||E>1;if((!p||T)&&(!v||A)||this.ISGenerated||o){if(this.ISGenerated){var R,x,D,_;const H=this.videoTrackConfig;(H&&(t.width!==H.width||t.height!==H.height||((R=t.pixelRatio)==null?void 0:R[0])!==((x=H.pixelRatio)==null?void 0:x[0])||((D=t.pixelRatio)==null?void 0:D[1])!==((_=H.pixelRatio)==null?void 0:_[1]))||!H&&A||this.nextAudioPts===null&&T)&&this.resetInitSegment()}this.ISGenerated||(d=this.generateIS(e,t,s,a));const M=this.isVideoContiguous;let j=-1,z;if(A&&(j=Zk(t.samples),!M&&this.config.forceKeyFrameOnDiscontinuity))if(g=!0,j>0){this.logger.warn(`[mp4-remuxer]: Dropped ${j} out of ${E} video samples due to a missing keyframe`);const H=this.getVideoStartPts(t.samples);t.samples=t.samples.slice(j),t.dropped+=j,y+=(t.samples[0].pts-H)/t.inputTimeScale,z=y}else j===-1&&(this.logger.warn(`[mp4-remuxer]: No keyframe found out of ${E} video samples`),g=!1);if(this.ISGenerated){if(T&&A){const H=this.getVideoStartPts(t.samples),V=(gn(e.samples[0].pts,H)-H)/t.inputTimeScale;m+=Math.max(0,V),y+=Math.max(0,-V)}if(T){if(e.samplerate||(this.logger.warn("[mp4-remuxer]: regenerate InitSegment as audio detected"),d=this.generateIS(e,t,s,a)),c=this.remuxAudio(e,m,this.isAudioContiguous,a,v||A||l===ne.AUDIO?y:void 0),A){const H=c?c.endPTS-c.startPTS:0;t.inputTimeScale||(this.logger.warn("[mp4-remuxer]: regenerate InitSegment as video detected"),d=this.generateIS(e,t,s,a)),u=this.remuxVideo(t,y,M,H)}}else A&&(u=this.remuxVideo(t,y,M,0));u&&(u.firstKeyFrame=j,u.independent=j!==-1,u.firstKeyFramePTS=z)}}return this.ISGenerated&&this._initPTS&&this._initDTS&&(r.samples.length&&(f=Ox(r,s,this._initPTS,this._initDTS)),i.samples.length&&(h=Fx(i,s,this._initPTS))),{audio:c,video:u,initSegment:d,independent:g,text:h,id3:f}}generateIS(e,t,r,i){const s=e.samples,a=t.samples,o=this.typeSupported,l={},u=this._initPTS;let c=!u||i,d="audio/mp4",h,f,g,m;if(c&&(h=f=1/0),e.config&&s.length){switch(e.timescale=e.samplerate,e.segmentCodec){case"mp3":o.mpeg?(d="audio/mpeg",e.codec=""):o.mp3&&(e.codec="mp3");break;case"ac3":e.codec="ac-3";break}l.audio={id:"audio",container:d,codec:e.codec,initSegment:e.segmentCodec==="mp3"&&o.mpeg?new Uint8Array(0):P.initSegment([e]),metadata:{channelCount:e.channelCount}},c&&(m=e.id,g=e.inputTimeScale,!u||g!==u.timescale?h=f=s[0].pts-Math.round(g*r):c=!1)}if(t.sps&&t.pps&&a.length){if(t.timescale=t.inputTimeScale,l.video={id:"main",container:"video/mp4",codec:t.codec,initSegment:P.initSegment([t]),metadata:{width:t.width,height:t.height}},c)if(m=t.id,g=t.inputTimeScale,!u||g!==u.timescale){const y=this.getVideoStartPts(a),p=Math.round(g*r);f=Math.min(f,gn(a[0].dts,y)-p),h=Math.min(h,y-p)}else c=!1;this.videoTrackConfig={width:t.width,height:t.height,pixelRatio:t.pixelRatio}}if(Object.keys(l).length)return this.ISGenerated=!0,c?(this._initPTS={baseTime:h,timescale:g},this._initDTS={baseTime:f,timescale:g}):h=g=void 0,{tracks:l,initPTS:h,timescale:g,trackId:m}}remuxVideo(e,t,r,i){const s=e.inputTimeScale,a=e.samples,o=[],l=a.length,u=this._initPTS;let c=this.nextAvcDts,d=8,h=this.videoSampleDuration,f,g,m=Number.POSITIVE_INFINITY,y=Number.NEGATIVE_INFINITY,p=!1;if(!r||c===null){const F=t*s,U=a[0].pts-gn(a[0].dts,a[0].pts);ys&&c!==null&&Math.abs(F-U-c)<15e3?r=!0:c=F-U}const v=u.baseTime*s/u.timescale;for(let F=0;F<l;F++){const U=a[F];U.pts=gn(U.pts-v,c),U.dts=gn(U.dts-v,c),U.dts<a[F>0?F-1:F].dts&&(p=!0)}p&&a.sort(function(F,U){const Q=F.dts-U.dts,q=F.pts-U.pts;return Q||q}),f=a[0].dts,g=a[a.length-1].dts;const E=g-f,T=E?Math.round(E/(l-1)):h||e.inputTimeScale/30;if(r){const F=f-c,U=F>T,Q=F<-1;if((U||Q)&&(U?this.logger.warn(`${(e.segmentCodec||"").toUpperCase()}: ${Na(F,!0)} ms (${F}dts) hole between fragments detected at ${t.toFixed(3)}`):this.logger.warn(`${(e.segmentCodec||"").toUpperCase()}: ${Na(-F,!0)} ms (${F}dts) overlapping between fragments detected at ${t.toFixed(3)}`),!Q||c>=a[0].pts||ys)){f=c;const q=a[0].pts-F;if(U)a[0].dts=f,a[0].pts=q;else{let oe=!0;for(let de=0;de<a.length&&!(a[de].dts>q&&oe);de++){const pe=a[de].pts;if(a[de].dts-=F,a[de].pts-=F,de<a.length-1){const he=a[de+1].pts,Fe=a[de].pts,Xe=he<=Fe,Nn=he<=pe;oe=Xe==Nn}}}this.logger.log(`Video: Initial PTS/DTS adjusted: ${Na(q,!0)}/${Na(f,!0)}, delta: ${Na(F,!0)} ms`)}}f=Math.max(0,f);let A=0,I=0,R=f;for(let F=0;F<l;F++){const U=a[F],Q=U.units,q=Q.length;let oe=0;for(let de=0;de<q;de++)oe+=Q[de].data.length;I+=oe,A+=q,U.length=oe,U.dts<R?(U.dts=R,R+=T/4|0||1):R=U.dts,m=Math.min(U.pts,m),y=Math.max(U.pts,y)}g=a[l-1].dts;const x=I+4*A+8;let D;try{D=new Uint8Array(x)}catch(F){this.observer.emit(S.ERROR,S.ERROR,{type:re.MUX_ERROR,details:O.REMUX_ALLOC_ERROR,fatal:!1,error:F,bytes:x,reason:`fail allocating video mdat ${x}`});return}const _=new DataView(D.buffer);_.setUint32(0,x),D.set(P.types.mdat,4);let M=!1,j=Number.POSITIVE_INFINITY,z=Number.POSITIVE_INFINITY,H=Number.NEGATIVE_INFINITY,W=Number.NEGATIVE_INFINITY;for(let F=0;F<l;F++){const U=a[F],Q=U.units;let q=0;for(let pe=0,he=Q.length;pe<he;pe++){const Fe=Q[pe],Xe=Fe.data,Nn=Fe.data.byteLength;_.setUint32(d,Nn),d+=4,D.set(Xe,d),d+=Nn,q+=4+Nn}let oe;if(F<l-1)h=a[F+1].dts-U.dts,oe=a[F+1].pts-U.pts;else{const pe=this.config,he=F>0?U.dts-a[F-1].dts:T;if(oe=F>0?U.pts-a[F-1].pts:T,pe.stretchShortVideoTrack&&this.nextAudioPts!==null){const Fe=Math.floor(pe.maxBufferHole*s),Xe=(i?m+i*s:this.nextAudioPts)-U.pts;Xe>Fe?(h=Xe-he,h<0?h=he:M=!0,this.logger.log(`[mp4-remuxer]: It is approximately ${Xe/90} ms to the next segment; using duration ${h/90} ms for the last video frame.`)):h=he}else h=he}const de=Math.round(U.pts-U.dts);j=Math.min(j,h),H=Math.max(H,h),z=Math.min(z,oe),W=Math.max(W,oe),o.push(G0(U.key,h,q,de))}if(o.length){if(ys){if(ys<70){const F=o[0].flags;F.dependsOn=2,F.isNonSync=0}}else if(Rd&&W-z<H-j&&T/H<.025&&o[0].cts===0){this.logger.warn("Found irregular gaps in sample duration. Using PTS instead of DTS to determine MP4 sample duration.");let F=f;for(let U=0,Q=o.length;U<Q;U++){const q=F+o[U].duration,oe=F+o[U].cts;if(U<Q-1){const de=q+o[U+1].cts;o[U].duration=de-oe}else o[U].duration=U?o[U-1].duration:T;o[U].cts=0,F=q}}}h=M||!h?T:h,this.nextAvcDts=c=g+h,this.videoSampleDuration=h,this.isVideoContiguous=!0;const B={data1:P.moof(e.sequenceNumber++,f,Oe(e,{samples:o})),data2:D,startPTS:m/s,endPTS:(y+h)/s,startDTS:f/s,endDTS:c/s,type:"video",hasAudio:!1,hasVideo:!0,nb:o.length,dropped:e.dropped};return e.samples=[],e.dropped=0,B}getSamplesPerFrame(e){switch(e.segmentCodec){case"mp3":return Qk;case"ac3":return Xk;default:return qk}}remuxAudio(e,t,r,i,s){const a=e.inputTimeScale,o=e.samplerate?e.samplerate:a,l=a/o,u=this.getSamplesPerFrame(e),c=u*l,d=this._initPTS,h=e.segmentCodec==="mp3"&&this.typeSupported.mpeg,f=[],g=s!==void 0;let m=e.samples,y=h?0:8,p=this.nextAudioPts||-1;const v=t*a,E=d.baseTime*a/d.timescale;if(this.isAudioContiguous=r=r||m.length&&p>0&&(i&&Math.abs(v-p)<9e3||Math.abs(gn(m[0].pts-E,v)-p)<20*c),m.forEach(function(V){V.pts=gn(V.pts-E,v)}),!r||p<0){if(m=m.filter(V=>V.pts>=0),!m.length)return;s===0?p=0:i&&!g?p=Math.max(0,v):p=m[0].pts}if(e.segmentCodec==="aac"){const V=this.config.maxAudioFramesDrift;for(let X=0,B=p;X<m.length;X++){const F=m[X],U=F.pts,Q=U-B,q=Math.abs(1e3*Q/a);if(Q<=-V*c&&g)X===0&&(this.logger.warn(`Audio frame @ ${(U/a).toFixed(3)}s overlaps nextAudioPts by ${Math.round(1e3*Q/a)} ms.`),this.nextAudioPts=p=B=U);else if(Q>=V*c&&q<Yk&&g){let oe=Math.round(Q/c);B=U-oe*c,B<0&&(oe--,B+=c),X===0&&(this.nextAudioPts=p=B),this.logger.warn(`[mp4-remuxer]: Injecting ${oe} audio frame @ ${(B/a).toFixed(3)}s due to ${Math.round(1e3*Q/a)} ms gap.`);for(let de=0;de<oe;de++){const pe=Math.max(B,0);let he=Hk.getSilentFrame(e.parsedCodec||e.manifestCodec||e.codec,e.channelCount);he||(this.logger.log("[mp4-remuxer]: Unable to get silent frame for given audio codec; duplicating last frame instead."),he=F.unit.subarray()),m.splice(X,0,{unit:he,pts:pe}),B+=c,X++}}F.pts=B,B+=c}}let T=null,A=null,I,R=0,x=m.length;for(;x--;)R+=m[x].unit.byteLength;for(let V=0,X=m.length;V<X;V++){const B=m[V],F=B.unit;let U=B.pts;if(A!==null){const q=f[V-1];q.duration=Math.round((U-A)/l)}else if(r&&e.segmentCodec==="aac"&&(U=p),T=U,R>0){R+=y;try{I=new Uint8Array(R)}catch(q){this.observer.emit(S.ERROR,S.ERROR,{type:re.MUX_ERROR,details:O.REMUX_ALLOC_ERROR,fatal:!1,error:q,bytes:R,reason:`fail allocating audio mdat ${R}`});return}h||(new DataView(I.buffer).setUint32(0,R),I.set(P.types.mdat,4))}else return;I.set(F,y);const Q=F.byteLength;y+=Q,f.push(G0(!0,u,Q,0)),A=U}const D=f.length;if(!D)return;const _=f[f.length-1];this.nextAudioPts=p=A+l*_.duration;const M=h?new Uint8Array(0):P.moof(e.sequenceNumber++,T/l,Oe({},e,{samples:f}));e.samples=[];const j=T/a,z=p/a,W={data1:M,data2:I,startPTS:j,endPTS:z,startDTS:j,endDTS:z,type:"audio",hasAudio:!0,hasVideo:!1,nb:D};return this.isAudioContiguous=!0,W}}function gn(n,e){let t;if(e===null)return n;for(e<n?t=-8589934592:t=8589934592;Math.abs(n-e)>4294967296;)n+=t;return n}function Zk(n){for(let e=0;e<n.length;e++)if(n[e].key)return e;return-1}function Ox(n,e,t,r){const i=n.samples.length;if(!i)return;const s=n.inputTimeScale;for(let o=0;o<i;o++){const l=n.samples[o];l.pts=gn(l.pts-t.baseTime*s/t.timescale,e*s)/s,l.dts=gn(l.dts-r.baseTime*s/r.timescale,e*s)/s}const a=n.samples;return n.samples=[],{samples:a}}function Fx(n,e,t){const r=n.samples.length;if(!r)return;const i=n.inputTimeScale;for(let a=0;a<r;a++){const o=n.samples[a];o.pts=gn(o.pts-t.baseTime*i/t.timescale,e*i)/i}n.samples.sort((a,o)=>a.pts-o.pts);const s=n.samples;return n.samples=[],{samples:s}}class Jk{constructor(e,t,r,i){this.logger=void 0,this.emitInitSegment=!1,this.audioCodec=void 0,this.videoCodec=void 0,this.initData=void 0,this.initPTS=null,this.initTracks=void 0,this.lastEndTime=null,this.isVideoContiguous=!1,this.logger=i}destroy(){}resetTimeStamp(e){this.initPTS=e,this.lastEndTime=null}resetNextTimestamp(){this.isVideoContiguous=!1,this.lastEndTime=null}resetInitSegment(e,t,r,i){this.audioCodec=t,this.videoCodec=r,this.generateInitSegment(Ww(e,i)),this.emitInitSegment=!0}generateInitSegment(e){let{audioCodec:t,videoCodec:r}=this;if(!(e!=null&&e.byteLength)){this.initTracks=void 0,this.initData=void 0;return}const i=this.initData=VS(e);i.audio&&(t=K0(i.audio,Ne.AUDIO,this.logger)),i.video&&(r=K0(i.video,Ne.VIDEO,this.logger));const s={};i.audio&&i.video?s.audiovideo={container:"video/mp4",codec:t+","+r,supplemental:i.video.supplemental,initSegment:e,id:"main"}:i.audio?s.audio={container:"audio/mp4",codec:t,initSegment:e,id:"audio"}:i.video?s.video={container:"video/mp4",codec:r,supplemental:i.video.supplemental,initSegment:e,id:"main"}:this.logger.warn("[passthrough-remuxer.ts]: initSegment does not contain moov or trak boxes."),this.initTracks=s}remux(e,t,r,i,s,a){var o,l;let{initPTS:u,lastEndTime:c}=this;const d={audio:void 0,video:void 0,text:i,id3:r,initSegment:void 0};Z(c)||(c=this.lastEndTime=s||0);const h=t.samples;if(!(h!=null&&h.length))return d;const f={initPTS:void 0,timescale:void 0,trackId:void 0};let g=this.initData;if((o=g)!=null&&o.length||(this.generateInitSegment(h),g=this.initData),!((l=g)!=null&&l.length))return this.logger.warn("[passthrough-remuxer.ts]: Failed to generate initSegment."),d;this.emitInitSegment&&(f.tracks=this.initTracks,this.emitInitSegment=!1);const m=Yw(h,g,this.logger),y=g.audio?m[g.audio.id]:null,p=g.video?m[g.video.id]:null,v=Ul(p,1/0),E=Ul(y,1/0),T=Ul(p,0,!0),A=Ul(y,0,!0);let I,R=s,x=0;if(y&&(!p||!u&&E<v||u&&u.trackId===g.audio.id)?(f.trackId=g.audio.id,I=y,x=A-E):p&&(f.trackId=g.video.id,I=p,x=T-v),I){const V=I.timescale;R=I.start/V,f.timescale=V,u||(f.initPTS=I.start-s*V,this.initPTS=u={baseTime:f.initPTS,timescale:V,trackId:f.trackId})}(a||!u)&&(eP(u,R,s,x)||f.timescale!==u.timescale)&&(f.initPTS=R-s,u&&u.timescale===1&&this.logger.warn(`Adjusting initPTS @${s} from ${u.baseTime/u.timescale} to ${f.initPTS}`),this.initPTS=u={baseTime:f.initPTS,timescale:1});const D=e?R-u.baseTime/u.timescale:c;qw(g,h,u.baseTime/u.timescale);const _=D+x;x>0?this.lastEndTime=_:(this.logger.warn("Duration parsed from mp4 should be greater than zero"),this.resetNextTimestamp());const M=!!g.audio,j=!!g.video;let z="";M&&(z+="audio"),j&&(z+="video");const H={data1:h,startPTS:D,startDTS:D,endPTS:_,endDTS:_,type:z,hasAudio:M,hasVideo:j,nb:1,dropped:0};d.audio=M&&!j?H:void 0,d.video=j?H:void 0;const W=p==null?void 0:p.sampleCount;if(W){const V=p.keyFrameIndex,X=V!==-1;H.nb=W,H.dropped=V===0||this.isVideoContiguous?0:X?V:W,H.independent=X,H.firstKeyFrame=V,X&&p.keyFrameStart&&(H.firstKeyFramePTS=p.keyFrameStart-u.baseTime/u.timescale),this.isVideoContiguous||(d.independent=X),this.isVideoContiguous||(this.isVideoContiguous=X),H.dropped&&this.logger.warn(`fmp4 does not start with IDR: firstIDR ${V}/${W} dropped: ${H.dropped} pts: ${H.firstKeyFramePTS||"NA"}`)}return d.initSegment=f,d.id3=Ox(r,s,u,u),i.samples.length&&(d.text=Fx(i,s,u)),d}}function Ul(n,e,t=!1){return(n==null?void 0:n.start)!==void 0?(n.start+(t?n.duration:0))/n.timescale:e}function eP(n,e,t,r){if(n===null)return!0;const i=Math.max(r,1),s=e-n.baseTime/n.timescale;return Math.abs(s-t)>i}function K0(n,e,t){const r=n==null?void 0:n.codec;return r&&r.length>4?r:e===Ne.AUDIO?r==="ec-3"||r==="ac-3"||r==="alac"?r:r==="fLaC"||r==="Opus"?Vu(r,!1):(t.warn(`Unhandled audio codec "${r}" in mp4 MAP`),r||"mp4a"):(t.warn(`Unhandled video codec "${r}" in mp4 MAP`),r||"avc1")}let yr;try{yr=self.performance.now.bind(self.performance)}catch{yr=Date.now}const cu=[{demux:jk,remux:Jk},{demux:Vr,remux:uu},{demux:Nk,remux:uu},{demux:Bk,remux:uu}];cu.splice(2,0,{demux:Uk,remux:uu});class V0{constructor(e,t,r,i,s,a){this.asyncResult=!1,this.logger=void 0,this.observer=void 0,this.typeSupported=void 0,this.config=void 0,this.id=void 0,this.demuxer=void 0,this.remuxer=void 0,this.decrypter=void 0,this.probe=void 0,this.decryptionPromise=null,this.transmuxConfig=void 0,this.currentTransmuxState=void 0,this.observer=e,this.typeSupported=t,this.config=r,this.id=s,this.logger=a}configure(e){this.transmuxConfig=e,this.decrypter&&this.decrypter.reset()}push(e,t,r,i){const s=r.transmuxing;s.executeStart=yr();let a=new Uint8Array(e);const{currentTransmuxState:o,transmuxConfig:l}=this;i&&(this.currentTransmuxState=i);const{contiguous:u,discontinuity:c,trackSwitch:d,accurateTimeOffset:h,timeOffset:f,initSegmentChange:g}=i||o,{audioCodec:m,videoCodec:y,defaultInitPts:p,duration:v,initSegmentData:E}=l,T=tP(a,t);if(T&&Gs(T.method)){const x=this.getDecrypter(),D=_g(T.method);if(x.isSync()){let _=x.softwareDecrypt(a,T.key.buffer,T.iv.buffer,D);if(r.part>-1){const j=x.flush();_=j&&j.buffer}if(!_)return s.executeEnd=yr(),_d(r);a=new Uint8Array(_)}else return this.asyncResult=!0,this.decryptionPromise=x.webCryptoDecrypt(a,T.key.buffer,T.iv.buffer,D).then(_=>{const M=this.push(_,null,r);return this.decryptionPromise=null,M}),this.decryptionPromise}const A=this.needsProbing(c,d);if(A){const x=this.configureTransmuxer(a);if(x)return this.logger.warn(`[transmuxer] ${x.message}`),this.observer.emit(S.ERROR,S.ERROR,{type:re.MEDIA_ERROR,details:O.FRAG_PARSING_ERROR,fatal:!1,error:x,reason:x.message}),s.executeEnd=yr(),_d(r)}(c||d||g||A)&&this.resetInitSegment(E,m,y,v,t),(c||g||A)&&this.resetInitialTimestamp(p),u||this.resetContiguity();const I=this.transmux(a,T,f,h,r);this.asyncResult=ko(I);const R=this.currentTransmuxState;return R.contiguous=!0,R.discontinuity=!1,R.trackSwitch=!1,s.executeEnd=yr(),I}flush(e){const t=e.transmuxing;t.executeStart=yr();const{decrypter:r,currentTransmuxState:i,decryptionPromise:s}=this;if(s)return this.asyncResult=!0,s.then(()=>this.flush(e));const a=[],{timeOffset:o}=i;if(r){const d=r.flush();d&&a.push(this.push(d.buffer,null,e))}const{demuxer:l,remuxer:u}=this;if(!l||!u){t.executeEnd=yr();const d=[_d(e)];return this.asyncResult?Promise.resolve(d):d}const c=l.flush(o);return ko(c)?(this.asyncResult=!0,c.then(d=>(this.flushRemux(a,d,e),a))):(this.flushRemux(a,c,e),this.asyncResult?Promise.resolve(a):a)}flushRemux(e,t,r){const{audioTrack:i,videoTrack:s,id3Track:a,textTrack:o}=t,{accurateTimeOffset:l,timeOffset:u}=this.currentTransmuxState;this.logger.log(`[transmuxer.ts]: Flushed ${this.id} sn: ${r.sn}${r.part>-1?" part: "+r.part:""} of ${this.id===ne.MAIN?"level":"track"} ${r.level}`);const c=this.remuxer.remux(i,s,a,o,u,l,!0,this.id);e.push({remuxResult:c,chunkMeta:r}),r.transmuxing.executeEnd=yr()}resetInitialTimestamp(e){const{demuxer:t,remuxer:r}=this;!t||!r||(t.resetTimeStamp(e),r.resetTimeStamp(e))}resetContiguity(){const{demuxer:e,remuxer:t}=this;!e||!t||(e.resetContiguity(),t.resetNextTimestamp())}resetInitSegment(e,t,r,i,s){const{demuxer:a,remuxer:o}=this;!a||!o||(a.resetInitSegment(e,t,r,i),o.resetInitSegment(e,t,r,s))}destroy(){this.demuxer&&(this.demuxer.destroy(),this.demuxer=void 0),this.remuxer&&(this.remuxer.destroy(),this.remuxer=void 0)}transmux(e,t,r,i,s){let a;return t&&t.method==="SAMPLE-AES"?a=this.transmuxSampleAes(e,t,r,i,s):a=this.transmuxUnencrypted(e,r,i,s),a}transmuxUnencrypted(e,t,r,i){const{audioTrack:s,videoTrack:a,id3Track:o,textTrack:l}=this.demuxer.demux(e,t,!1,!this.config.progressive);return{remuxResult:this.remuxer.remux(s,a,o,l,t,r,!1,this.id),chunkMeta:i}}transmuxSampleAes(e,t,r,i,s){return this.demuxer.demuxSampleAes(e,t,r).then(a=>({remuxResult:this.remuxer.remux(a.audioTrack,a.videoTrack,a.id3Track,a.textTrack,r,i,!1,this.id),chunkMeta:s}))}configureTransmuxer(e){const{config:t,observer:r,typeSupported:i}=this;let s;for(let d=0,h=cu.length;d<h;d++){var a;if((a=cu[d].demux)!=null&&a.probe(e,this.logger)){s=cu[d];break}}if(!s)return new Error("Failed to find demuxer by probing fragment data");const o=this.demuxer,l=this.remuxer,u=s.remux,c=s.demux;(!l||!(l instanceof u))&&(this.remuxer=new u(r,t,i,this.logger)),(!o||!(o instanceof c))&&(this.demuxer=new c(r,t,i,this.logger),this.probe=c.probe)}needsProbing(e,t){return!this.demuxer||!this.remuxer||e||t}getDecrypter(){let e=this.decrypter;return e||(e=this.decrypter=new Ag(this.config)),e}}function tP(n,e){let t=null;return n.byteLength>0&&(e==null?void 0:e.key)!=null&&e.iv!==null&&e.method!=null&&(t=e),t}const _d=n=>({remuxResult:{},chunkMeta:n});function ko(n){return"then"in n&&n.then instanceof Function}class nP{constructor(e,t,r,i,s){this.audioCodec=void 0,this.videoCodec=void 0,this.initSegmentData=void 0,this.duration=void 0,this.defaultInitPts=void 0,this.audioCodec=e,this.videoCodec=t,this.initSegmentData=r,this.duration=i,this.defaultInitPts=s||null}}class rP{constructor(e,t,r,i,s,a){this.discontinuity=void 0,this.contiguous=void 0,this.accurateTimeOffset=void 0,this.trackSwitch=void 0,this.timeOffset=void 0,this.initSegmentChange=void 0,this.discontinuity=e,this.contiguous=t,this.accurateTimeOffset=r,this.trackSwitch=i,this.timeOffset=s,this.initSegmentChange=a}}let H0=0;class Mx{constructor(e,t,r,i){this.error=null,this.hls=void 0,this.id=void 0,this.instanceNo=H0++,this.observer=void 0,this.frag=null,this.part=null,this.useWorker=void 0,this.workerContext=null,this.transmuxer=null,this.onTransmuxComplete=void 0,this.onFlush=void 0,this.onWorkerMessage=l=>{const u=l.data,c=this.hls;if(!(!c||!(u!=null&&u.event)||u.instanceNo!==this.instanceNo))switch(u.event){case"init":{var d;const h=(d=this.workerContext)==null?void 0:d.objectURL;h&&self.URL.revokeObjectURL(h);break}case"transmuxComplete":{this.handleTransmuxComplete(u.data);break}case"flush":{this.onFlush(u.data);break}case"workerLog":{c.logger[u.data.logType]&&c.logger[u.data.logType](u.data.message);break}default:{u.data=u.data||{},u.data.frag=this.frag,u.data.part=this.part,u.data.id=this.id,c.trigger(u.event,u.data);break}}},this.onWorkerError=l=>{if(!this.hls)return;const u=new Error(`${l.message}  (${l.filename}:${l.lineno})`);this.hls.config.enableWorker=!1,this.hls.logger.warn(`Error in "${this.id}" Web Worker, fallback to inline`),this.hls.trigger(S.ERROR,{type:re.OTHER_ERROR,details:O.INTERNAL_EXCEPTION,fatal:!1,event:"demuxerWorker",error:u})};const s=e.config;this.hls=e,this.id=t,this.useWorker=!!s.enableWorker,this.onTransmuxComplete=r,this.onFlush=i;const a=(l,u)=>{u=u||{},u.frag=this.frag||void 0,l===S.ERROR&&(u=u,u.parent=this.id,u.part=this.part,this.error=u.error),this.hls.trigger(l,u)};this.observer=new Cg,this.observer.on(S.FRAG_DECRYPTED,a),this.observer.on(S.ERROR,a);const o=o0(s.preferManagedMediaSource);if(this.useWorker&&typeof Worker<"u"){const l=this.hls.logger;if(s.workerPath||uk()){try{s.workerPath?(l.log(`loading Web Worker ${s.workerPath} for "${t}"`),this.workerContext=dk(s.workerPath)):(l.log(`injecting Web Worker for "${t}"`),this.workerContext=ck());const{worker:c}=this.workerContext;c.addEventListener("message",this.onWorkerMessage),c.addEventListener("error",this.onWorkerError),c.postMessage({instanceNo:this.instanceNo,cmd:"init",typeSupported:o,id:t,config:Ve(s)})}catch(c){l.warn(`Error setting up "${t}" Web Worker, fallback to inline`,c),this.terminateWorker(),this.error=null,this.transmuxer=new V0(this.observer,o,s,"",t,e.logger)}return}}this.transmuxer=new V0(this.observer,o,s,"",t,e.logger)}reset(){if(this.frag=null,this.part=null,this.workerContext){const e=this.instanceNo;this.instanceNo=H0++;const t=this.hls.config,r=o0(t.preferManagedMediaSource);this.workerContext.worker.postMessage({instanceNo:this.instanceNo,cmd:"reset",resetNo:e,typeSupported:r,id:this.id,config:Ve(t)})}}terminateWorker(){if(this.workerContext){const{worker:e}=this.workerContext;this.workerContext=null,e.removeEventListener("message",this.onWorkerMessage),e.removeEventListener("error",this.onWorkerError),hk(this.hls.config.workerPath)}}destroy(){if(this.workerContext)this.terminateWorker(),this.onWorkerMessage=this.onWorkerError=null;else{const t=this.transmuxer;t&&(t.destroy(),this.transmuxer=null)}const e=this.observer;e&&e.removeAllListeners(),this.frag=null,this.part=null,this.observer=null,this.hls=null}push(e,t,r,i,s,a,o,l,u,c){var d,h;u.transmuxing.start=self.performance.now();const{instanceNo:f,transmuxer:g}=this,m=a?a.start:s.start,y=s.decryptdata,p=this.frag,v=!(p&&s.cc===p.cc),E=!(p&&u.level===p.level),T=p?u.sn-p.sn:-1,A=this.part?u.part-this.part.index:-1,I=T===0&&u.id>1&&u.id===(p==null?void 0:p.stats.chunkCount),R=!E&&(T===1||T===0&&(A===1||I&&A<=0)),x=self.performance.now();(E||T||s.stats.parsing.start===0)&&(s.stats.parsing.start=x),a&&(A||!R)&&(a.stats.parsing.start=x);const D=!(p&&((d=s.initSegment)==null?void 0:d.url)===((h=p.initSegment)==null?void 0:h.url)),_=new rP(v,R,l,E,m,D);if(!R||v||D){this.hls.logger.log(`[transmuxer-interface]: Starting new transmux session for ${s.type} sn: ${u.sn}${u.part>-1?" part: "+u.part:""} ${this.id===ne.MAIN?"level":"track"}: ${u.level} id: ${u.id}
        discontinuity: ${v}
        trackSwitch: ${E}
        contiguous: ${R}
        accurateTimeOffset: ${l}
        timeOffset: ${m}
        initSegmentChange: ${D}`);const M=new nP(r,i,t,o,c);this.configureTransmuxer(M)}if(this.frag=s,this.part=a,this.workerContext)this.workerContext.worker.postMessage({instanceNo:f,cmd:"demux",data:e,decryptdata:y,chunkMeta:u,state:_},e instanceof ArrayBuffer?[e]:[]);else if(g){const M=g.push(e,y,u,_);ko(M)?M.then(j=>{this.handleTransmuxComplete(j)}).catch(j=>{this.transmuxerError(j,u,"transmuxer-interface push error")}):this.handleTransmuxComplete(M)}}flush(e){e.transmuxing.start=self.performance.now();const{instanceNo:t,transmuxer:r}=this;if(this.workerContext)this.workerContext.worker.postMessage({instanceNo:t,cmd:"flush",chunkMeta:e});else if(r){const i=r.flush(e);ko(i)?i.then(s=>{this.handleFlushResult(s,e)}).catch(s=>{this.transmuxerError(s,e,"transmuxer-interface flush error")}):this.handleFlushResult(i,e)}}transmuxerError(e,t,r){this.hls&&(this.error=e,this.hls.trigger(S.ERROR,{type:re.MEDIA_ERROR,details:O.FRAG_PARSING_ERROR,chunkMeta:t,frag:this.frag||void 0,part:this.part||void 0,fatal:!1,error:e,err:e,reason:r}))}handleFlushResult(e,t){e.forEach(r=>{this.handleTransmuxComplete(r)}),this.onFlush(t)}configureTransmuxer(e){const{instanceNo:t,transmuxer:r}=this;this.workerContext?this.workerContext.worker.postMessage({instanceNo:t,cmd:"configure",config:e}):r&&r.configure(e)}handleTransmuxComplete(e){e.chunkMeta.transmuxing.end=self.performance.now(),this.onTransmuxComplete(e)}}const z0=100;class iP extends Dg{constructor(e,t,r){super(e,t,r,"audio-stream-controller",ne.AUDIO),this.mainAnchor=null,this.mainFragLoading=null,this.audioOnly=!1,this.bufferedTrack=null,this.switchingTrack=null,this.trackId=-1,this.waitingData=null,this.mainDetails=null,this.flushing=!1,this.bufferFlushed=!1,this.cachedTrackLoadedData=null,this.registerListeners()}onHandlerDestroying(){this.unregisterListeners(),super.onHandlerDestroying(),this.resetItem()}resetItem(){this.mainDetails=this.mainAnchor=this.mainFragLoading=this.bufferedTrack=this.switchingTrack=this.waitingData=this.cachedTrackLoadedData=null}registerListeners(){super.registerListeners();const{hls:e}=this;e.on(S.LEVEL_LOADED,this.onLevelLoaded,this),e.on(S.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),e.on(S.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.on(S.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.on(S.BUFFER_RESET,this.onBufferReset,this),e.on(S.BUFFER_CREATED,this.onBufferCreated,this),e.on(S.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(S.BUFFER_FLUSHED,this.onBufferFlushed,this),e.on(S.INIT_PTS_FOUND,this.onInitPtsFound,this),e.on(S.FRAG_LOADING,this.onFragLoading,this),e.on(S.FRAG_BUFFERED,this.onFragBuffered,this)}unregisterListeners(){const{hls:e}=this;e&&(super.unregisterListeners(),e.off(S.LEVEL_LOADED,this.onLevelLoaded,this),e.off(S.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),e.off(S.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.off(S.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.off(S.BUFFER_RESET,this.onBufferReset,this),e.off(S.BUFFER_CREATED,this.onBufferCreated,this),e.off(S.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(S.BUFFER_FLUSHED,this.onBufferFlushed,this),e.off(S.INIT_PTS_FOUND,this.onInitPtsFound,this),e.off(S.FRAG_LOADING,this.onFragLoading,this),e.off(S.FRAG_BUFFERED,this.onFragBuffered,this))}onInitPtsFound(e,{frag:t,id:r,initPTS:i,timescale:s}){if(r===ne.MAIN){const a=t.cc,o=this.fragCurrent;if(this.initPTS[a]={baseTime:i,timescale:s},this.log(`InitPTS for cc: ${a} found from main: ${i}/${s}`),this.mainAnchor=t,this.state===$.WAITING_INIT_PTS){const l=this.waitingData;(!l&&!this.loadingParts||l&&l.frag.cc!==a)&&this.syncWithAnchor(t,l==null?void 0:l.frag)}else!this.hls.hasEnoughToStart&&o&&o.cc!==a?(o.abortRequests(),this.syncWithAnchor(t,o)):this.state===$.IDLE&&this.tick()}}getLoadPosition(){return!this.startFragRequested&&this.nextLoadPosition>=0?this.nextLoadPosition:super.getLoadPosition()}syncWithAnchor(e,t){var r;const i=((r=this.mainFragLoading)==null?void 0:r.frag)||null;if(t&&(i==null?void 0:i.cc)===t.cc)return;const s=(i||e).cc,a=this.getLevelDetails(),o=this.getLoadPosition(),l=nx(a,s,o);l&&(this.log(`Waiting fragment cc (${t==null?void 0:t.cc}) cancelled because video is at cc ${e.cc}`),this.startFragRequested=!1,this.nextLoadPosition=l.start,this.resetLoadingState(),this.state===$.IDLE&&this.doTickIdle())}startLoad(e,t){if(!this.levels){this.startPosition=e,this.state=$.STOPPED;return}const r=this.lastCurrentTime;this.stopLoad(),this.setInterval(z0),r>0&&e===-1?(this.log(`Override startPosition with lastCurrentTime @${r.toFixed(3)}`),e=r,this.state=$.IDLE):this.state=$.WAITING_TRACK,this.nextLoadPosition=this.lastCurrentTime=e+this.timelineOffset,this.startPosition=t?-1:e,this.tick()}doTick(){switch(this.state){case $.IDLE:this.doTickIdle();break;case $.WAITING_TRACK:{const{levels:t,trackId:r}=this,i=t==null?void 0:t[r],s=i==null?void 0:i.details;if(s&&!this.waitForLive(i)){if(this.waitForCdnTuneIn(s))break;this.state=$.WAITING_INIT_PTS}break}case $.FRAG_LOADING_WAITING_RETRY:{var e;const t=performance.now(),r=this.retryDate;if(!r||t>=r||(e=this.media)!=null&&e.seeking){const{levels:i,trackId:s}=this;this.log("RetryDate reached, switch back to IDLE state"),this.resetStartWhenNotLoaded((i==null?void 0:i[s])||null),this.state=$.IDLE}break}case $.WAITING_INIT_PTS:{const t=this.waitingData;if(t){const{frag:r,part:i,cache:s,complete:a}=t,o=this.mainAnchor;if(this.initPTS[r.cc]!==void 0){this.waitingData=null,this.state=$.FRAG_LOADING;const l=s.flush().buffer,u={frag:r,part:i,payload:l,networkDetails:null};this._handleFragmentLoadProgress(u),a&&super._handleFragmentLoadComplete(u)}else o&&o.cc!==t.frag.cc&&this.syncWithAnchor(o,t.frag)}else this.state=$.IDLE}}this.onTickEnd()}resetLoadingState(){const e=this.waitingData;e&&(this.fragmentTracker.removeFragment(e.frag),this.waitingData=null),super.resetLoadingState()}onTickEnd(){const{media:e}=this;e!=null&&e.readyState&&(this.lastCurrentTime=e.currentTime)}doTickIdle(){var e;const{hls:t,levels:r,media:i,trackId:s}=this,a=t.config;if(!this.buffering||!i&&!this.primaryPrefetch&&(this.startFragRequested||!a.startFragPrefetch)||!(r!=null&&r[s]))return;const o=r[s],l=o.details;if(!l||this.waitForLive(o)||this.waitForCdnTuneIn(l)){this.state=$.WAITING_TRACK,this.startFragRequested=!1;return}const u=this.mediaBuffer?this.mediaBuffer:this.media;this.bufferFlushed&&u&&(this.bufferFlushed=!1,this.afterBufferFlushed(u,Ne.AUDIO,ne.AUDIO));const c=this.getFwdBufferInfo(u,ne.AUDIO);if(c===null)return;if(!this.switchingTrack&&this._streamEnded(c,l)){t.trigger(S.BUFFER_EOS,{type:"audio"}),this.state=$.ENDED;return}const d=c.len,h=t.maxBufferLength,f=l.fragments,g=f[0].start,m=this.getLoadPosition(),y=this.flushing?m:c.end;if(this.switchingTrack&&i){const E=m;l.PTSKnown&&E<g&&(c.end>g||c.nextStart)&&(this.log("Alt audio track ahead of main track, seek to start of alt audio track"),i.currentTime=g+.05)}if(d>=h&&!this.switchingTrack&&y<f[f.length-1].start)return;let p=this.getNextFragment(y,l);if(p&&this.isLoopLoading(p,y)&&(p=this.getNextFragmentLoopLoading(p,l,c,ne.MAIN,h)),!p){this.bufferFlushed=!0;return}let v=((e=this.mainFragLoading)==null?void 0:e.frag)||null;if(!this.audioOnly&&this.startFragRequested&&v&&vt(p)&&!p.endList&&(!l.live||!this.loadingParts&&y<this.hls.liveSyncPosition)&&(this.fragmentTracker.getState(v)===ct.OK&&(this.mainFragLoading=v=null),v&&vt(v))){if(p.start>v.end){const T=this.fragmentTracker.getFragAtPos(y,ne.MAIN);T&&T.end>v.end&&(v=T,this.mainFragLoading={frag:T,targetBufferTime:null})}if(p.start>v.end)return}this.loadFragment(p,o,y)}onMediaDetaching(e,t){this.bufferFlushed=this.flushing=!1,super.onMediaDetaching(e,t)}onAudioTracksUpdated(e,{audioTracks:t}){this.resetTransmuxer(),this.levels=t.map(r=>new Io(r))}onAudioTrackSwitching(e,t){const r=!!t.url;this.trackId=t.id;const{fragCurrent:i}=this;i&&(i.abortRequests(),this.removeUnbufferedFrags(i.start)),this.resetLoadingState(),r?(this.switchingTrack=t,this.flushAudioIfNeeded(t),this.state!==$.STOPPED&&(this.setInterval(z0),this.state=$.IDLE,this.tick())):(this.resetTransmuxer(),this.switchingTrack=null,this.bufferedTrack=t,this.clearInterval())}onManifestLoading(){super.onManifestLoading(),this.bufferFlushed=this.flushing=this.audioOnly=!1,this.resetItem(),this.trackId=-1}onLevelLoaded(e,t){this.mainDetails=t.details;const r=this.cachedTrackLoadedData;r&&(this.cachedTrackLoadedData=null,this.onAudioTrackLoaded(S.AUDIO_TRACK_LOADED,r))}onAudioTrackLoaded(e,t){var r;const{levels:i}=this,{details:s,id:a,groupId:o,track:l}=t;if(!i){this.warn(`Audio tracks reset while loading track ${a} "${l.name}" of "${o}"`);return}const u=this.mainDetails;if(!u||s.endCC>u.endCC||u.expired){this.cachedTrackLoadedData=t,this.state!==$.STOPPED&&(this.state=$.WAITING_TRACK);return}this.cachedTrackLoadedData=null,this.log(`Audio track ${a} "${l.name}" of "${o}" loaded [${s.startSN},${s.endSN}]${s.lastPartSn?`[part-${s.lastPartSn}-${s.lastPartIndex}]`:""},duration:${s.totalduration}`);const c=i[a];let d=0;if(s.live||(r=c.details)!=null&&r.live){if(this.checkLiveUpdate(s),s.deltaUpdateFailed)return;if(c.details){var h;d=this.alignPlaylists(s,c.details,(h=this.levelLastLoaded)==null?void 0:h.details)}s.alignedSliding||(px(s,u),s.alignedSliding||Qu(s,u),d=s.fragmentStart)}c.details=s,this.levelLastLoaded=c,this.startFragRequested||this.setStartPosition(u,d),this.hls.trigger(S.AUDIO_TRACK_UPDATED,{details:s,id:a,groupId:t.groupId}),this.state===$.WAITING_TRACK&&!this.waitForCdnTuneIn(s)&&(this.state=$.IDLE),this.tick()}_handleFragmentLoadProgress(e){var t;const r=e.frag,{part:i,payload:s}=e,{config:a,trackId:o,levels:l}=this;if(!l){this.warn(`Audio tracks were reset while fragment load was in progress. Fragment ${r.sn} of level ${r.level} will not be buffered`);return}const u=l[o];if(!u){this.warn("Audio track is undefined on fragment load progress");return}const c=u.details;if(!c){this.warn("Audio track details undefined on fragment load progress"),this.removeUnbufferedFrags(r.start);return}const d=a.defaultAudioCodec||u.audioCodec||"mp4a.40.2";let h=this.transmuxer;h||(h=this.transmuxer=new Mx(this.hls,ne.AUDIO,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)));const f=this.initPTS[r.cc],g=(t=r.initSegment)==null?void 0:t.data;if(f!==void 0){const y=i?i.index:-1,p=y!==-1,v=new Rg(r.level,r.sn,r.stats.chunkCount,s.byteLength,y,p);h.push(s,g,d,"",r,i,c.totalduration,!1,v,f)}else{this.log(`Unknown video PTS for cc ${r.cc}, waiting for video PTS before demuxing audio frag ${r.sn} of [${c.startSN} ,${c.endSN}],track ${o}`);const{cache:m}=this.waitingData=this.waitingData||{frag:r,part:i,cache:new yx,complete:!1};m.push(new Uint8Array(s)),this.state!==$.STOPPED&&(this.state=$.WAITING_INIT_PTS)}}_handleFragmentLoadComplete(e){if(this.waitingData){this.waitingData.complete=!0;return}super._handleFragmentLoadComplete(e)}onBufferReset(){this.mediaBuffer=null}onBufferCreated(e,t){this.bufferFlushed=this.flushing=!1;const r=t.tracks.audio;r&&(this.mediaBuffer=r.buffer||null)}onFragLoading(e,t){!this.audioOnly&&t.frag.type===ne.MAIN&&vt(t.frag)&&(this.mainFragLoading=t,this.state===$.IDLE&&this.tick())}onFragBuffered(e,t){const{frag:r,part:i}=t;if(r.type!==ne.AUDIO){!this.audioOnly&&r.type===ne.MAIN&&!r.elementaryStreams.video&&!r.elementaryStreams.audiovideo&&(this.audioOnly=!0,this.mainFragLoading=null);return}if(this.fragContextChanged(r)){this.warn(`Fragment ${r.sn}${i?" p: "+i.index:""} of level ${r.level} finished buffering, but was aborted. state: ${this.state}, audioSwitch: ${this.switchingTrack?this.switchingTrack.name:"false"}`);return}if(vt(r)){this.fragPrevious=r;const s=this.switchingTrack;s&&(this.bufferedTrack=s,this.switchingTrack=null,this.hls.trigger(S.AUDIO_TRACK_SWITCHED,Ce({},s)))}this.fragBufferedComplete(r,i),this.media&&this.tick()}onError(e,t){var r;if(t.fatal){this.state=$.ERROR;return}switch(t.details){case O.FRAG_GAP:case O.FRAG_PARSING_ERROR:case O.FRAG_DECRYPT_ERROR:case O.FRAG_LOAD_ERROR:case O.FRAG_LOAD_TIMEOUT:case O.KEY_LOAD_ERROR:case O.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(ne.AUDIO,t);break;case O.AUDIO_TRACK_LOAD_ERROR:case O.AUDIO_TRACK_LOAD_TIMEOUT:case O.LEVEL_PARSING_ERROR:!t.levelRetry&&this.state===$.WAITING_TRACK&&((r=t.context)==null?void 0:r.type)===Se.AUDIO_TRACK&&(this.state=$.IDLE);break;case O.BUFFER_ADD_CODEC_ERROR:case O.BUFFER_APPEND_ERROR:if(t.parent!=="audio")return;this.resetLoadingState();break;case O.BUFFER_FULL_ERROR:if(t.parent!=="audio")return;this.reduceLengthAndFlushBuffer(t)&&(this.bufferedTrack=null,super.flushMainBuffer(0,Number.POSITIVE_INFINITY,"audio"));break;case O.INTERNAL_EXCEPTION:this.recoverWorkerError(t);break}}onBufferFlushing(e,{type:t}){t!==Ne.VIDEO&&(this.flushing=!0)}onBufferFlushed(e,{type:t}){if(t!==Ne.VIDEO){this.flushing=!1,this.bufferFlushed=!0,this.state===$.ENDED&&(this.state=$.IDLE);const r=this.mediaBuffer||this.media;r&&(this.afterBufferFlushed(r,t,ne.AUDIO),this.tick())}}_handleTransmuxComplete(e){var t;const r="audio",{hls:i}=this,{remuxResult:s,chunkMeta:a}=e,o=this.getCurrentContext(a);if(!o){this.resetWhenMissingContext(a);return}const{frag:l,part:u,level:c}=o,{details:d}=c,{audio:h,text:f,id3:g,initSegment:m}=s;if(this.fragContextChanged(l)||!d){this.fragmentTracker.removeFragment(l);return}if(this.state=$.PARSING,this.switchingTrack&&h&&this.completeAudioSwitch(this.switchingTrack),m!=null&&m.tracks){const y=l.initSegment||l;this._bufferInitSegment(c,m.tracks,y,a),i.trigger(S.FRAG_PARSING_INIT_SEGMENT,{frag:y,id:r,tracks:m.tracks})}if(h){const{startPTS:y,endPTS:p,startDTS:v,endDTS:E}=h;u&&(u.elementaryStreams[Ne.AUDIO]={startPTS:y,endPTS:p,startDTS:v,endDTS:E}),l.setElementaryStreamInfo(Ne.AUDIO,y,p,v,E),this.bufferFragmentData(h,l,u,a)}if(g!=null&&(t=g.samples)!=null&&t.length){const y=Oe({id:r,frag:l,details:d},g);i.trigger(S.FRAG_PARSING_METADATA,y)}if(f){const y=Oe({id:r,frag:l,details:d},f);i.trigger(S.FRAG_PARSING_USERDATA,y)}}_bufferInitSegment(e,t,r,i){if(this.state!==$.PARSING||(t.video&&delete t.video,t.audiovideo&&delete t.audiovideo,!t.audio))return;const s=t.audio;s.id=ne.AUDIO;const a=e.audioCodec;this.log(`Init audio buffer, container:${s.container}, codecs[level/parsed]=[${a}/${s.codec}]`),a&&a.split(",").length===1&&(s.levelCodec=a),this.hls.trigger(S.BUFFER_CODECS,t);const o=s.initSegment;if(o!=null&&o.byteLength){const l={type:"audio",frag:r,part:null,chunkMeta:i,parent:r.type,data:o};this.hls.trigger(S.BUFFER_APPENDING,l)}this.tickImmediate()}loadFragment(e,t,r){const i=this.fragmentTracker.getState(e);if(this.switchingTrack||i===ct.NOT_LOADED||i===ct.PARTIAL){var s;if(!vt(e))this._loadInitSegment(e,t);else if((s=t.details)!=null&&s.live&&!this.initPTS[e.cc]){this.log(`Waiting for video PTS in continuity counter ${e.cc} of live stream before loading audio fragment ${e.sn} of level ${this.trackId}`),this.state=$.WAITING_INIT_PTS;const a=this.mainDetails;a&&a.fragmentStart!==t.details.fragmentStart&&Qu(t.details,a)}else super.loadFragment(e,t,r)}else this.clearTrackerIfNeeded(e)}flushAudioIfNeeded(e){if(this.media&&this.bufferedTrack){const{name:t,lang:r,assocLang:i,characteristics:s,audioCodec:a,channels:o}=this.bufferedTrack;Wi({name:t,lang:r,assocLang:i,characteristics:s,audioCodec:a,channels:o},e,ki)||(zu(e.url,this.hls)?(this.log("Switching audio track : flushing all audio"),super.flushMainBuffer(0,Number.POSITIVE_INFINITY,"audio"),this.bufferedTrack=null):this.bufferedTrack=e)}}completeAudioSwitch(e){const{hls:t}=this;this.flushAudioIfNeeded(e),this.bufferedTrack=e,this.switchingTrack=null,t.trigger(S.AUDIO_TRACK_SWITCHED,Ce({},e))}}class Mg extends kr{constructor(e,t){super(t,e.logger),this.hls=void 0,this.canLoad=!1,this.timer=-1,this.hls=e}destroy(){this.clearTimer(),this.hls=this.log=this.warn=null}clearTimer(){this.timer!==-1&&(self.clearTimeout(this.timer),this.timer=-1)}startLoad(){this.canLoad=!0,this.loadPlaylist()}stopLoad(){this.canLoad=!1,this.clearTimer()}switchParams(e,t,r){const i=t==null?void 0:t.renditionReports;if(i){let s=-1;for(let a=0;a<i.length;a++){const o=i[a];let l;try{l=new self.URL(o.URI,t.url).href}catch(u){this.warn(`Could not construct new URL for Rendition Report: ${u}`),l=o.URI||""}if(l===e){s=a;break}else l===e.substring(0,l.length)&&(s=a)}if(s!==-1){const a=i[s],o=parseInt(a["LAST-MSN"])||(t==null?void 0:t.lastPartSn);let l=parseInt(a["LAST-PART"])||(t==null?void 0:t.lastPartIndex);if(this.hls.config.lowLatencyMode){const c=Math.min(t.age-t.partTarget,t.targetduration);l>=0&&c>t.partTarget&&(l+=1)}const u=r&&u0(r);return new c0(o,l>=0?l:void 0,u)}}}loadPlaylist(e){this.clearTimer()}loadingPlaylist(e,t){this.clearTimer()}shouldLoadPlaylist(e){return this.canLoad&&!!e&&!!e.url&&(!e.details||e.details.live)}getUrlWithDirectives(e,t){if(t)try{return t.addDirectives(e)}catch(r){this.warn(`Could not construct new URL with HLS Delivery Directives: ${r}`)}return e}playlistLoaded(e,t,r){const{details:i,stats:s}=t,a=self.performance.now(),o=s.loading.first?Math.max(0,a-s.loading.first):0;i.advancedDateTime=Date.now()-o;const l=this.hls.config.timelineOffset;if(l!==i.appliedTimelineOffset){const c=Math.max(l||0,0);i.appliedTimelineOffset=c,i.fragments.forEach(d=>{d.start=d.playlistOffset+c})}if(i.live||r!=null&&r.live){const c="levelInfo"in t?t.levelInfo:t.track;if(i.reloaded(r),r&&i.fragments.length>0){Jb(r,i);const v=i.playlistParsingError;if(v){this.warn(v);const E=this.hls;if(!E.config.ignorePlaylistParsingErrors){var u;const{networkDetails:T}=t;E.trigger(S.ERROR,{type:re.NETWORK_ERROR,details:O.LEVEL_PARSING_ERROR,fatal:!1,url:i.url,error:v,reason:v.message,level:t.level||void 0,parent:(u=i.fragments[0])==null?void 0:u.type,networkDetails:T,stats:s});return}i.playlistParsingError=null}}i.requestScheduled===-1&&(i.requestScheduled=s.loading.start);const d=this.hls.mainForwardBufferInfo,h=d?d.end-d.len:0,f=(i.edge-h)*1e3,g=dx(i,f);if(i.requestScheduled+g<a?i.requestScheduled=a:i.requestScheduled+=g,this.log(`live playlist ${e} ${i.advanced?"REFRESHED "+i.lastPartSn+"-"+i.lastPartIndex:i.updated?"UPDATED":"MISSED"}`),!this.canLoad||!i.live)return;let m,y,p;if(i.canBlockReload&&i.endSN&&i.advanced){const v=this.hls.config.lowLatencyMode,E=i.lastPartSn,T=i.endSN,A=i.lastPartIndex,I=A!==-1,R=E===T;I?R?(y=T+1,p=v?0:A):(y=E,p=v?A+1:i.maxPartIndex):y=T+1;const x=i.age,D=x+i.ageHeader;let _=Math.min(D-i.partTarget,i.targetduration*1.5);if(_>0){if(D>i.targetduration*3)this.log(`Playlist last advanced ${x.toFixed(2)}s ago. Omitting segment and part directives.`),y=void 0,p=void 0;else if(r!=null&&r.tuneInGoal&&D-i.partTarget>r.tuneInGoal)this.warn(`CDN Tune-in goal increased from: ${r.tuneInGoal} to: ${_} with playlist age: ${i.age}`),_=0;else{const M=Math.floor(_/i.targetduration);if(y+=M,p!==void 0){const j=Math.round(_%i.targetduration/i.partTarget);p+=j}this.log(`CDN Tune-in age: ${i.ageHeader}s last advanced ${x.toFixed(2)}s goal: ${_} skip sn ${M} to part ${p}`)}i.tuneInGoal=_}if(m=this.getDeliveryDirectives(i,t.deliveryDirectives,y,p),v||!R){i.requestScheduled=a,this.loadingPlaylist(c,m);return}}else(i.canBlockReload||i.canSkipUntil)&&(m=this.getDeliveryDirectives(i,t.deliveryDirectives,y,p));m&&y!==void 0&&i.canBlockReload&&(i.requestScheduled=s.loading.first+Math.max(g-o*2,g/2)),this.scheduleLoading(c,m,i)}else this.clearTimer()}scheduleLoading(e,t,r){const i=r||e.details;if(!i){this.loadingPlaylist(e,t);return}const s=self.performance.now(),a=i.requestScheduled;if(s>=a){this.loadingPlaylist(e,t);return}const o=a-s;this.log(`reload live playlist ${e.name||e.bitrate+"bps"} in ${Math.round(o)} ms`),this.clearTimer(),this.timer=self.setTimeout(()=>this.loadingPlaylist(e,t),o)}getDeliveryDirectives(e,t,r,i){let s=u0(e);return t!=null&&t.skip&&e.deltaUpdateFailed&&(r=t.msn,i=t.part,s=ou.No),new c0(r,i,s)}checkRetry(e){const t=e.details,r=Wu(e),i=e.errorAction,{action:s,retryCount:a=0,retryConfig:o}=i||{},l=!!i&&!!o&&(s===It.RetryRequest||!i.resolved&&s===It.SendAlternateToPenaltyBox);if(l){var u;if(a>=o.maxNumRetry)return!1;if(r&&(u=e.context)!=null&&u.deliveryDirectives)this.warn(`Retrying playlist loading ${a+1}/${o.maxNumRetry} after "${t}" without delivery-directives`),this.loadPlaylist();else{const c=Lg(o,a);this.clearTimer(),this.timer=self.setTimeout(()=>this.loadPlaylist(),c),this.warn(`Retrying playlist loading ${a+1}/${o.maxNumRetry} after "${t}" in ${c}ms`)}e.levelRetry=!0,i.resolved=!0}return l}}function Nx(n,e){if(n.length!==e.length)return!1;for(let t=0;t<n.length;t++)if(!Po(n[t].attrs,e[t].attrs))return!1;return!0}function Po(n,e,t){const r=n["STABLE-RENDITION-ID"];return r&&!t?r===e["STABLE-RENDITION-ID"]:!(t||["LANGUAGE","NAME","CHARACTERISTICS","AUTOSELECT","DEFAULT","FORCED","ASSOC-LANGUAGE"]).some(i=>n[i]!==e[i])}function nf(n,e){return e.label.toLowerCase()===n.name.toLowerCase()&&(!e.language||e.language.toLowerCase()===(n.lang||"").toLowerCase())}class sP extends Mg{constructor(e){super(e,"audio-track-controller"),this.tracks=[],this.groupIds=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0,this.registerListeners()}registerListeners(){const{hls:e}=this;e.on(S.MANIFEST_LOADING,this.onManifestLoading,this),e.on(S.MANIFEST_PARSED,this.onManifestParsed,this),e.on(S.LEVEL_LOADING,this.onLevelLoading,this),e.on(S.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(S.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.on(S.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e.off(S.MANIFEST_LOADING,this.onManifestLoading,this),e.off(S.MANIFEST_PARSED,this.onManifestParsed,this),e.off(S.LEVEL_LOADING,this.onLevelLoading,this),e.off(S.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(S.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.off(S.ERROR,this.onError,this)}destroy(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.currentTrack=null,super.destroy()}onManifestLoading(){this.tracks=[],this.tracksInGroup=[],this.groupIds=null,this.currentTrack=null,this.trackId=-1,this.selectDefaultTrack=!0}onManifestParsed(e,t){this.tracks=t.audioTracks||[]}onAudioTrackLoaded(e,t){const{id:r,groupId:i,details:s}=t,a=this.tracksInGroup[r];if(!a||a.groupId!==i){this.warn(`Audio track with id:${r} and group:${i} not found in active group ${a==null?void 0:a.groupId}`);return}const o=a.details;a.details=t.details,this.log(`Audio track ${r} "${a.name}" lang:${a.lang} group:${i} loaded [${s.startSN}-${s.endSN}]`),r===this.trackId&&this.playlistLoaded(r,t,o)}onLevelLoading(e,t){this.switchLevel(t.level)}onLevelSwitching(e,t){this.switchLevel(t.level)}switchLevel(e){const t=this.hls.levels[e];if(!t)return;const r=t.audioGroups||null,i=this.groupIds;let s=this.currentTrack;if(!r||(i==null?void 0:i.length)!==(r==null?void 0:r.length)||r!=null&&r.some(o=>(i==null?void 0:i.indexOf(o))===-1)){this.groupIds=r,this.trackId=-1,this.currentTrack=null;const o=this.tracks.filter(h=>!r||r.indexOf(h.groupId)!==-1);if(o.length)this.selectDefaultTrack&&!o.some(h=>h.default)&&(this.selectDefaultTrack=!1),o.forEach((h,f)=>{h.id=f});else if(!s&&!this.tracksInGroup.length)return;this.tracksInGroup=o;const l=this.hls.config.audioPreference;if(!s&&l){const h=Zn(l,o,ki);if(h>-1)s=o[h];else{const f=Zn(l,this.tracks);s=this.tracks[f]}}let u=this.findTrackId(s);u===-1&&s&&(u=this.findTrackId(null));const c={audioTracks:o};this.log(`Updating audio tracks, ${o.length} track(s) found in group(s): ${r==null?void 0:r.join(",")}`),this.hls.trigger(S.AUDIO_TRACKS_UPDATED,c);const d=this.trackId;if(u!==-1&&d===-1)this.setAudioTrack(u);else if(o.length&&d===-1){var a;const h=new Error(`No audio track selected for current audio group-ID(s): ${(a=this.groupIds)==null?void 0:a.join(",")} track count: ${o.length}`);this.warn(h.message),this.hls.trigger(S.ERROR,{type:re.MEDIA_ERROR,details:O.AUDIO_TRACK_LOAD_ERROR,fatal:!0,error:h})}}}onError(e,t){t.fatal||!t.context||t.context.type===Se.AUDIO_TRACK&&t.context.id===this.trackId&&(!this.groupIds||this.groupIds.indexOf(t.context.groupId)!==-1)&&this.checkRetry(t)}get allAudioTracks(){return this.tracks}get audioTracks(){return this.tracksInGroup}get audioTrack(){return this.trackId}set audioTrack(e){this.selectDefaultTrack=!1,this.setAudioTrack(e)}setAudioOption(e){const t=this.hls;if(t.config.audioPreference=e,e){const r=this.allAudioTracks;if(this.selectDefaultTrack=!1,r.length){const i=this.currentTrack;if(i&&Wi(e,i,ki))return i;const s=Zn(e,this.tracksInGroup,ki);if(s>-1){const a=this.tracksInGroup[s];return this.setAudioTrack(s),a}else if(i){let a=t.loadLevel;a===-1&&(a=t.firstAutoLevel);const o=Eb(e,t.levels,r,a,ki);if(o===-1)return null;t.nextLoadLevel=o}if(e.channels||e.audioCodec){const a=Zn(e,r);if(a>-1)return r[a]}}}return null}setAudioTrack(e){const t=this.tracksInGroup;if(e<0||e>=t.length){this.warn(`Invalid audio track id: ${e}`);return}this.selectDefaultTrack=!1;const r=this.currentTrack,i=t[e],s=i.details&&!i.details.live;if(e===this.trackId&&i===r&&s||(this.log(`Switching to audio-track ${e} "${i.name}" lang:${i.lang} group:${i.groupId} channels:${i.channels}`),this.trackId=e,this.currentTrack=i,this.hls.trigger(S.AUDIO_TRACK_SWITCHING,Ce({},i)),s))return;const a=this.switchParams(i.url,r==null?void 0:r.details,i.details);this.loadPlaylist(a)}findTrackId(e){const t=this.tracksInGroup;for(let r=0;r<t.length;r++){const i=t[r];if(!(this.selectDefaultTrack&&!i.default)&&(!e||Wi(e,i,ki)))return r}if(e){const{name:r,lang:i,assocLang:s,characteristics:a,audioCodec:o,channels:l}=e;for(let u=0;u<t.length;u++){const c=t[u];if(Wi({name:r,lang:i,assocLang:s,characteristics:a,audioCodec:o,channels:l},c,ki))return u}for(let u=0;u<t.length;u++){const c=t[u];if(Po(e.attrs,c.attrs,["LANGUAGE","ASSOC-LANGUAGE","CHARACTERISTICS"]))return u}for(let u=0;u<t.length;u++){const c=t[u];if(Po(e.attrs,c.attrs,["LANGUAGE"]))return u}}return-1}loadPlaylist(e){super.loadPlaylist();const t=this.currentTrack;this.shouldLoadPlaylist(t)&&zu(t.url,this.hls)&&this.scheduleLoading(t,e)}loadingPlaylist(e,t){super.loadingPlaylist(e,t);const r=e.id,i=e.groupId,s=this.getUrlWithDirectives(e.url,t),a=e.details,o=a==null?void 0:a.age;this.log(`Loading audio-track ${r} "${e.name}" lang:${e.lang} group:${i}${(t==null?void 0:t.msn)!==void 0?" at sn "+t.msn+" part "+t.part:""}${o&&a.live?" age "+o.toFixed(1)+(a.type&&" "+a.type||""):""} ${s}`),this.hls.trigger(S.AUDIO_TRACK_LOADING,{url:s,id:r,groupId:i,deliveryDirectives:t||null,track:e})}}class aP{constructor(e){this.tracks=void 0,this.queues={video:[],audio:[],audiovideo:[]},this.tracks=e}destroy(){this.tracks=this.queues=null}append(e,t,r){if(this.queues===null||this.tracks===null)return;const i=this.queues[t];i.push(e),i.length===1&&!r&&this.executeNext(t)}appendBlocker(e){return new Promise(t=>{const r={label:"async-blocker",execute:t,onStart:()=>{},onComplete:()=>{},onError:()=>{}};this.append(r,e)})}prependBlocker(e){return new Promise(t=>{if(this.queues){const r={label:"async-blocker-prepend",execute:t,onStart:()=>{},onComplete:()=>{},onError:()=>{}};this.queues[e].unshift(r)}})}removeBlockers(){this.queues!==null&&[this.queues.video,this.queues.audio,this.queues.audiovideo].forEach(e=>{var t;const r=(t=e[0])==null?void 0:t.label;(r==="async-blocker"||r==="async-blocker-prepend")&&(e[0].execute(),e.splice(0,1))})}unblockAudio(e){if(this.queues===null)return;this.queues.audio[0]===e&&this.shiftAndExecuteNext("audio")}executeNext(e){if(this.queues===null||this.tracks===null)return;const t=this.queues[e];if(t.length){const i=t[0];try{i.execute()}catch(s){var r;if(i.onError(s),this.queues===null||this.tracks===null)return;const a=(r=this.tracks[e])==null?void 0:r.buffer;a!=null&&a.updating||this.shiftAndExecuteNext(e)}}}shiftAndExecuteNext(e){this.queues!==null&&(this.queues[e].shift(),this.executeNext(e))}current(e){var t;return((t=this.queues)==null?void 0:t[e][0])||null}toString(){const{queues:e,tracks:t}=this;return e===null||t===null?"<destroyed>":`
${this.list("video")}
${this.list("audio")}
${this.list("audiovideo")}}`}list(e){var t,r;return(t=this.queues)!=null&&t[e]||(r=this.tracks)!=null&&r[e]?`${e}: (${this.listSbInfo(e)}) ${this.listOps(e)}`:""}listSbInfo(e){var t;const r=(t=this.tracks)==null?void 0:t[e],i=r==null?void 0:r.buffer;return i?`SourceBuffer${i.updating?" updating":""}${r.ended?" ended":""}${r.ending?" ending":""}`:"none"}listOps(e){var t;return((t=this.queues)==null?void 0:t[e].map(r=>r.label).join(", "))||""}}const W0=/(avc[1234]|hvc1|hev1|dvh[1e]|vp09|av01)(?:\.[^.,]+)+/,Ux="HlsJsTrackRemovedError";class oP extends Error{constructor(e){super(e),this.name=Ux}}class lP extends kr{constructor(e,t){super("buffer-controller",e.logger),this.hls=void 0,this.fragmentTracker=void 0,this.details=null,this._objectUrl=null,this.operationQueue=null,this.bufferCodecEventsTotal=0,this.media=null,this.mediaSource=null,this.lastMpegAudioChunk=null,this.blockedAudioAppend=null,this.lastVideoAppendEnd=0,this.appendSource=void 0,this.transferData=void 0,this.overrides=void 0,this.appendErrors={audio:0,video:0,audiovideo:0},this.tracks={},this.sourceBuffers=[[null,null],[null,null]],this._onEndStreaming=r=>{var i;this.hls&&((i=this.mediaSource)==null?void 0:i.readyState)==="open"&&this.hls.pauseBuffering()},this._onStartStreaming=r=>{this.hls&&this.hls.resumeBuffering()},this._onMediaSourceOpen=r=>{const{media:i,mediaSource:s}=this;r&&this.log("Media source opened"),!(!i||!s)&&(s.removeEventListener("sourceopen",this._onMediaSourceOpen),i.removeEventListener("emptied",this._onMediaEmptied),this.updateDuration(),this.hls.trigger(S.MEDIA_ATTACHED,{media:i,mediaSource:s}),this.mediaSource!==null&&this.checkPendingTracks())},this._onMediaSourceClose=()=>{this.log("Media source closed")},this._onMediaSourceEnded=()=>{this.log("Media source ended")},this._onMediaEmptied=()=>{const{mediaSrc:r,_objectUrl:i}=this;r!==i&&this.error(`Media element src was set while attaching MediaSource (${i} > ${r})`)},this.hls=e,this.fragmentTracker=t,this.appendSource=Nw(vi(e.config.preferManagedMediaSource)),this.initTracks(),this.registerListeners()}hasSourceTypes(){return Object.keys(this.tracks).length>0}destroy(){this.unregisterListeners(),this.details=null,this.lastMpegAudioChunk=this.blockedAudioAppend=null,this.transferData=this.overrides=void 0,this.operationQueue&&(this.operationQueue.destroy(),this.operationQueue=null),this.hls=this.fragmentTracker=null,this._onMediaSourceOpen=this._onMediaSourceClose=null,this._onMediaSourceEnded=null,this._onStartStreaming=this._onEndStreaming=null}registerListeners(){const{hls:e}=this;e.on(S.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(S.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(S.MANIFEST_LOADING,this.onManifestLoading,this),e.on(S.MANIFEST_PARSED,this.onManifestParsed,this),e.on(S.BUFFER_RESET,this.onBufferReset,this),e.on(S.BUFFER_APPENDING,this.onBufferAppending,this),e.on(S.BUFFER_CODECS,this.onBufferCodecs,this),e.on(S.BUFFER_EOS,this.onBufferEos,this),e.on(S.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(S.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(S.FRAG_PARSED,this.onFragParsed,this),e.on(S.FRAG_CHANGED,this.onFragChanged,this),e.on(S.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e.off(S.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(S.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(S.MANIFEST_LOADING,this.onManifestLoading,this),e.off(S.MANIFEST_PARSED,this.onManifestParsed,this),e.off(S.BUFFER_RESET,this.onBufferReset,this),e.off(S.BUFFER_APPENDING,this.onBufferAppending,this),e.off(S.BUFFER_CODECS,this.onBufferCodecs,this),e.off(S.BUFFER_EOS,this.onBufferEos,this),e.off(S.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(S.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(S.FRAG_PARSED,this.onFragParsed,this),e.off(S.FRAG_CHANGED,this.onFragChanged,this),e.off(S.ERROR,this.onError,this)}transferMedia(){const{media:e,mediaSource:t}=this;if(!e)return null;const r={};if(this.operationQueue){const s=this.isUpdating();s||this.operationQueue.removeBlockers();const a=this.isQueued();(s||a)&&this.warn(`Transfering MediaSource with${a?" operations in queue":""}${s?" updating SourceBuffer(s)":""} ${this.operationQueue}`),this.operationQueue.destroy()}const i=this.transferData;return!this.sourceBufferCount&&i&&i.mediaSource===t?Oe(r,i.tracks):this.sourceBuffers.forEach(s=>{const[a]=s;a&&(r[a]=Oe({},this.tracks[a]),this.removeBuffer(a)),s[0]=s[1]=null}),{media:e,mediaSource:t,tracks:r}}initTracks(){const e={};this.sourceBuffers=[[null,null],[null,null]],this.tracks=e,this.resetQueue(),this.resetAppendErrors(),this.lastMpegAudioChunk=this.blockedAudioAppend=null,this.lastVideoAppendEnd=0}onManifestLoading(){this.bufferCodecEventsTotal=0,this.details=null}onManifestParsed(e,t){var r;let i=2;(t.audio&&!t.video||!t.altAudio)&&(i=1),this.bufferCodecEventsTotal=i,this.log(`${i} bufferCodec event(s) expected.`),(r=this.transferData)!=null&&r.mediaSource&&this.sourceBufferCount&&i&&this.bufferCreated()}onMediaAttaching(e,t){const r=this.media=t.media,i=vi(this.appendSource);if(this.transferData=this.overrides=void 0,r&&i){const s=!!t.mediaSource;(s||t.overrides)&&(this.transferData=t,this.overrides=t.overrides);const a=this.mediaSource=t.mediaSource||new i;if(this.assignMediaSource(a),s)this._objectUrl=r.src,this.attachTransferred();else{const o=this._objectUrl=self.URL.createObjectURL(a);if(this.appendSource)try{r.removeAttribute("src");const l=self.ManagedMediaSource;r.disableRemotePlayback=r.disableRemotePlayback||l&&a instanceof l,Y0(r),uP(r,o),r.load()}catch{r.src=o}else r.src=o}r.addEventListener("emptied",this._onMediaEmptied)}}assignMediaSource(e){var t,r;this.log(`${((t=this.transferData)==null?void 0:t.mediaSource)===e?"transferred":"created"} media source: ${(r=e.constructor)==null?void 0:r.name}`),e.addEventListener("sourceopen",this._onMediaSourceOpen),e.addEventListener("sourceended",this._onMediaSourceEnded),e.addEventListener("sourceclose",this._onMediaSourceClose),this.appendSource&&(e.addEventListener("startstreaming",this._onStartStreaming),e.addEventListener("endstreaming",this._onEndStreaming))}attachTransferred(){const e=this.media,t=this.transferData;if(!t||!e)return;const r=this.tracks,i=t.tracks,s=i?Object.keys(i):null,a=s?s.length:0,o=()=>{this.media&&this.mediaSourceOpenOrEnded&&this._onMediaSourceOpen()};if(i&&s&&a){if(!this.tracksReady){this.hls.config.startFragPrefetch=!0,this.log("attachTransferred: waiting for SourceBuffer track info");return}if(this.log(`attachTransferred: (bufferCodecEventsTotal ${this.bufferCodecEventsTotal})
required tracks: ${Ve(r,(l,u)=>l==="initSegment"?void 0:u)};
transfer tracks: ${Ve(i,(l,u)=>l==="initSegment"?void 0:u)}}`),!US(i,r)){t.mediaSource=null,t.tracks=void 0;const l=e.currentTime,u=this.details,c=Math.max(l,(u==null?void 0:u.fragments[0].start)||0);if(c-l>1){this.log(`attachTransferred: waiting for playback to reach new tracks start time ${l} -> ${c}`);return}this.warn(`attachTransferred: resetting MediaSource for incompatible tracks ("${Object.keys(i)}"->"${Object.keys(r)}") start time: ${c} currentTime: ${l}`),this.onMediaDetaching(S.MEDIA_DETACHING,{}),this.onMediaAttaching(S.MEDIA_ATTACHING,t),e.currentTime=c;return}this.transferData=void 0,s.forEach(l=>{const u=l,c=i[u];if(c){const d=c.buffer;if(d){const h=this.fragmentTracker,f=c.id;if(h.hasFragments(f)||h.hasParts(f)){const y=ge.getBuffered(d);h.detectEvictedFragments(u,y,f,null,!0)}const g=Id(u),m=[u,d];this.sourceBuffers[g]=m,d.updating&&this.operationQueue&&this.operationQueue.prependBlocker(u),this.trackSourceBuffer(u,c)}}}),o(),this.bufferCreated()}else this.log("attachTransferred: MediaSource w/o SourceBuffers"),o()}get mediaSourceOpenOrEnded(){var e;const t=(e=this.mediaSource)==null?void 0:e.readyState;return t==="open"||t==="ended"}onMediaDetaching(e,t){const r=!!t.transferMedia;this.transferData=this.overrides=void 0;const{media:i,mediaSource:s,_objectUrl:a}=this;if(s){if(this.log(`media source ${r?"transferring":"detaching"}`),r)this.sourceBuffers.forEach(([o])=>{o&&this.removeBuffer(o)}),this.resetQueue();else{if(this.mediaSourceOpenOrEnded){const o=s.readyState==="open";try{const l=s.sourceBuffers;for(let u=l.length;u--;)o&&l[u].abort(),s.removeSourceBuffer(l[u]);o&&s.endOfStream()}catch(l){this.warn(`onMediaDetaching: ${l.message} while calling endOfStream`)}}this.sourceBufferCount&&this.onBufferReset()}s.removeEventListener("sourceopen",this._onMediaSourceOpen),s.removeEventListener("sourceended",this._onMediaSourceEnded),s.removeEventListener("sourceclose",this._onMediaSourceClose),this.appendSource&&(s.removeEventListener("startstreaming",this._onStartStreaming),s.removeEventListener("endstreaming",this._onEndStreaming)),this.mediaSource=null,this._objectUrl=null}i&&(i.removeEventListener("emptied",this._onMediaEmptied),r||(a&&self.URL.revokeObjectURL(a),this.mediaSrc===a?(i.removeAttribute("src"),this.appendSource&&Y0(i),i.load()):this.warn("media|source.src was changed by a third party - skip cleanup")),this.media=null),this.hls.trigger(S.MEDIA_DETACHED,t)}onBufferReset(){this.sourceBuffers.forEach(([e])=>{e&&this.resetBuffer(e)}),this.initTracks()}resetBuffer(e){var t;const r=(t=this.tracks[e])==null?void 0:t.buffer;if(this.removeBuffer(e),r)try{var i;(i=this.mediaSource)!=null&&i.sourceBuffers.length&&this.mediaSource.removeSourceBuffer(r)}catch(s){this.warn(`onBufferReset ${e}`,s)}delete this.tracks[e]}removeBuffer(e){this.removeBufferListeners(e),this.sourceBuffers[Id(e)]=[null,null];const t=this.tracks[e];t&&(t.buffer=void 0)}resetQueue(){this.operationQueue&&this.operationQueue.destroy(),this.operationQueue=new aP(this.tracks)}onBufferCodecs(e,t){const r=this.tracks,i=Object.keys(t);this.log(`BUFFER_CODECS: "${i}" (current SB count ${this.sourceBufferCount})`);const s="audiovideo"in t&&(r.audio||r.video)||r.audiovideo&&("audio"in t||"video"in t),a=!s&&this.sourceBufferCount&&this.media&&i.some(o=>!r[o]);if(s||a){this.warn(`Unsupported transition between "${Object.keys(r)}" and "${i}" SourceBuffers`);return}i.forEach(o=>{var l,u,c;const d=t[o],{id:h,codec:f,levelCodec:g,container:m,metadata:y,supplemental:p}=d;let v=r[o];const E=(l=this.transferData)==null||(u=l.tracks)==null?void 0:u[o],T=E!=null&&E.buffer?E:v,A=(T==null?void 0:T.pendingCodec)||(T==null?void 0:T.codec),I=T==null?void 0:T.levelCodec;v||(v=r[o]={buffer:void 0,listeners:[],codec:f,supplemental:p,container:m,levelCodec:g,metadata:y,id:h});const R=au(A,I),x=R==null?void 0:R.replace(W0,"$1");let D=au(f,g);const _=(c=D)==null?void 0:c.replace(W0,"$1");D&&R&&x!==_&&(o.slice(0,5)==="audio"&&(D=Vu(D,this.appendSource)),this.log(`switching codec ${A} to ${D}`),D!==(v.pendingCodec||v.codec)&&(v.pendingCodec=D),v.container=m,this.appendChangeType(o,m,D))}),(this.tracksReady||this.sourceBufferCount)&&(t.tracks=this.sourceBufferTracks),!this.sourceBufferCount&&this.mediaSourceOpenOrEnded&&this.checkPendingTracks()}get sourceBufferTracks(){return Object.keys(this.tracks).reduce((e,t)=>{const r=this.tracks[t];return e[t]={id:r.id,container:r.container,codec:r.codec,levelCodec:r.levelCodec},e},{})}appendChangeType(e,t,r){const i=`${t};codecs=${r}`,s={label:`change-type=${i}`,execute:()=>{const a=this.tracks[e];if(a){const o=a.buffer;o!=null&&o.changeType&&(this.log(`changing ${e} sourceBuffer type to ${i}`),o.changeType(i),a.codec=r,a.container=t)}this.shiftAndExecuteNext(e)},onStart:()=>{},onComplete:()=>{},onError:a=>{this.warn(`Failed to change ${e} SourceBuffer type`,a)}};this.append(s,e,this.isPending(this.tracks[e]))}blockAudio(e){var t;const r=e.start,i=r+e.duration*.05;if(((t=this.fragmentTracker.getAppendedFrag(r,ne.MAIN))==null?void 0:t.gap)===!0)return;const a={label:"block-audio",execute:()=>{var o;const l=this.tracks.video;(this.lastVideoAppendEnd>i||l!=null&&l.buffer&&ge.isBuffered(l.buffer,i)||((o=this.fragmentTracker.getAppendedFrag(i,ne.MAIN))==null?void 0:o.gap)===!0)&&(this.blockedAudioAppend=null,this.shiftAndExecuteNext("audio"))},onStart:()=>{},onComplete:()=>{},onError:o=>{this.warn("Error executing block-audio operation",o)}};this.blockedAudioAppend={op:a,frag:e},this.append(a,"audio",!0)}unblockAudio(){const{blockedAudioAppend:e,operationQueue:t}=this;e&&t&&(this.blockedAudioAppend=null,t.unblockAudio(e.op))}onBufferAppending(e,t){const{tracks:r}=this,{data:i,type:s,parent:a,frag:o,part:l,chunkMeta:u}=t,c=u.buffering[s],d=o.sn,h=self.performance.now();c.start=h;const f=o.stats.buffering,g=l?l.stats.buffering:null;f.start===0&&(f.start=h),g&&g.start===0&&(g.start=h);const m=r.audio;let y=!1;s==="audio"&&(m==null?void 0:m.container)==="audio/mpeg"&&(y=!this.lastMpegAudioChunk||u.id===1||this.lastMpegAudioChunk.sn!==u.sn,this.lastMpegAudioChunk=u);const p=this.tracks.video,v=p==null?void 0:p.buffer;if(v&&d!=="initSegment"){const A=l||o,I=this.blockedAudioAppend;if(s==="audio"&&a!=="main"&&!this.blockedAudioAppend){const x=A.start+A.duration*.05,D=v.buffered,_=this.currentOp("video");!D.length&&!_?this.blockAudio(A):!_&&!ge.isBuffered(v,x)&&this.lastVideoAppendEnd<x&&this.blockAudio(A)}else if(s==="video"){const R=A.end;if(I){const x=I.frag.start;(R>x||R<this.lastVideoAppendEnd||ge.isBuffered(v,x))&&this.unblockAudio()}this.lastVideoAppendEnd=R}}const E=(l||o).start,T={label:`append-${s}`,execute:()=>{if(c.executeStart=self.performance.now(),y){const A=this.tracks[s];if(A){const I=A.buffer;if(I){const R=E-I.timestampOffset;Math.abs(R)>=.1&&(this.log(`Updating audio SourceBuffer timestampOffset to ${E} (delta: ${R}) sn: ${d})`),I.timestampOffset=E)}}}this.appendExecutor(i,s)},onStart:()=>{},onComplete:()=>{const A=self.performance.now();c.executeEnd=c.end=A,f.first===0&&(f.first=A),g&&g.first===0&&(g.first=A);const I={};this.sourceBuffers.forEach(([R,x])=>{R&&(I[R]=ge.getBuffered(x))}),this.appendErrors[s]=0,s==="audio"||s==="video"?this.appendErrors.audiovideo=0:(this.appendErrors.audio=0,this.appendErrors.video=0),this.hls.trigger(S.BUFFER_APPENDED,{type:s,frag:o,part:l,chunkMeta:u,parent:o.type,timeRanges:I})},onError:A=>{var I;const R={type:re.MEDIA_ERROR,parent:o.type,details:O.BUFFER_APPEND_ERROR,sourceBufferName:s,frag:o,part:l,chunkMeta:u,error:A,err:A,fatal:!1},x=(I=this.media)==null?void 0:I.error;if(A.code===DOMException.QUOTA_EXCEEDED_ERR)R.details=O.BUFFER_FULL_ERROR;else if(A.code===DOMException.INVALID_STATE_ERR&&this.mediaSourceOpenOrEnded&&!x)R.errorAction=Do(!0);else if(A.name===Ux&&this.sourceBufferCount===0)R.errorAction=Do(!0);else{const D=++this.appendErrors[s];this.warn(`Failed ${D}/${this.hls.config.appendErrorMaxRetry} times to append segment in "${s}" sourceBuffer (${x||"no media error"})`),(D>=this.hls.config.appendErrorMaxRetry||x)&&(R.fatal=!0)}this.hls.trigger(S.ERROR,R)}};this.append(T,s,this.isPending(this.tracks[s]))}getFlushOp(e,t,r){return this.log(`queuing "${e}" remove ${t}-${r}`),{label:"remove",execute:()=>{this.removeExecutor(e,t,r)},onStart:()=>{},onComplete:()=>{this.hls.trigger(S.BUFFER_FLUSHED,{type:e})},onError:i=>{this.warn(`Failed to remove ${t}-${r} from "${e}" SourceBuffer`,i)}}}onBufferFlushing(e,t){const{type:r,startOffset:i,endOffset:s}=t;r?this.append(this.getFlushOp(r,i,s),r):this.sourceBuffers.forEach(([a])=>{a&&this.append(this.getFlushOp(a,i,s),a)})}onFragParsed(e,t){const{frag:r,part:i}=t,s=[],a=i?i.elementaryStreams:r.elementaryStreams;a[Ne.AUDIOVIDEO]?s.push("audiovideo"):(a[Ne.AUDIO]&&s.push("audio"),a[Ne.VIDEO]&&s.push("video"));const o=()=>{const l=self.performance.now();r.stats.buffering.end=l,i&&(i.stats.buffering.end=l);const u=i?i.stats:r.stats;this.hls.trigger(S.FRAG_BUFFERED,{frag:r,part:i,stats:u,id:r.type})};s.length===0&&this.warn(`Fragments must have at least one ElementaryStreamType set. type: ${r.type} level: ${r.level} sn: ${r.sn}`),this.blockBuffers(o,s).catch(l=>{this.warn(`Fragment buffered callback ${l}`),this.stepOperationQueue(this.sourceBufferTypes)})}onFragChanged(e,t){this.trimBuffers()}get bufferedToEnd(){return this.sourceBufferCount>0&&!this.sourceBuffers.some(([e])=>{var t,r;return e&&(!((t=this.tracks[e])!=null&&t.ended)||((r=this.tracks[e])==null?void 0:r.ending))})}onBufferEos(e,t){var r;this.sourceBuffers.forEach(([a])=>{if(a){const o=this.tracks[a];(!t.type||t.type===a)&&(o.ending=!0,o.ended||(o.ended=!0,this.log(`${a} buffer reached EOS`)))}});const i=((r=this.overrides)==null?void 0:r.endOfStream)!==!1;this.sourceBufferCount>0&&!this.sourceBuffers.some(([a])=>{var o;return a&&!((o=this.tracks[a])!=null&&o.ended)})&&(i?(this.log("Queueing EOS"),this.blockUntilOpen(()=>{this.tracksEnded();const{mediaSource:a}=this;if(!a||a.readyState!=="open"){a&&this.log(`Could not call mediaSource.endOfStream(). mediaSource.readyState: ${a.readyState}`);return}this.log("Calling mediaSource.endOfStream()"),a.endOfStream(),this.hls.trigger(S.BUFFERED_TO_END,void 0)})):(this.tracksEnded(),this.hls.trigger(S.BUFFERED_TO_END,void 0)))}tracksEnded(){this.sourceBuffers.forEach(([e])=>{if(e!==null){const t=this.tracks[e];t&&(t.ending=!1)}})}onLevelUpdated(e,{details:t}){t.fragments.length&&(this.details=t,this.updateDuration())}updateDuration(){const e=this.getDurationAndRange();e&&this.blockUntilOpen(()=>this.updateMediaSource(e))}onError(e,t){if(t.details===O.BUFFER_APPEND_ERROR&&t.frag){var r;const i=(r=t.errorAction)==null?void 0:r.nextAutoLevel;Z(i)&&i!==t.frag.level&&this.resetAppendErrors()}}resetAppendErrors(){this.appendErrors={audio:0,video:0,audiovideo:0}}trimBuffers(){const{hls:e,details:t,media:r}=this;if(!r||t===null||!this.sourceBufferCount)return;const i=e.config,s=r.currentTime,a=t.levelTargetDuration,o=t.live&&i.liveBackBufferLength!==null?i.liveBackBufferLength:i.backBufferLength;if(Z(o)&&o>=0){const l=Math.max(o,a),u=Math.floor(s/a)*a-l;this.flushBackBuffer(s,a,u)}if(Z(i.frontBufferFlushThreshold)&&i.frontBufferFlushThreshold>0){const l=Math.max(i.maxBufferLength,i.frontBufferFlushThreshold),u=Math.max(l,a),c=Math.floor(s/a)*a+u;this.flushFrontBuffer(s,a,c)}}flushBackBuffer(e,t,r){this.sourceBuffers.forEach(([i,s])=>{if(s){const o=ge.getBuffered(s);if(o.length>0&&r>o.start(0)){var a;this.hls.trigger(S.BACK_BUFFER_REACHED,{bufferEnd:r});const l=this.tracks[i];if((a=this.details)!=null&&a.live)this.hls.trigger(S.LIVE_BACK_BUFFER_REACHED,{bufferEnd:r});else if(l!=null&&l.ended){this.log(`Cannot flush ${i} back buffer while SourceBuffer is in ended state`);return}this.hls.trigger(S.BUFFER_FLUSHING,{startOffset:0,endOffset:r,type:i})}}})}flushFrontBuffer(e,t,r){this.sourceBuffers.forEach(([i,s])=>{if(s){const a=ge.getBuffered(s),o=a.length;if(o<2)return;const l=a.start(o-1),u=a.end(o-1);if(r>l||e>=l&&e<=u)return;this.hls.trigger(S.BUFFER_FLUSHING,{startOffset:l,endOffset:1/0,type:i})}})}getDurationAndRange(){var e;const{details:t,mediaSource:r}=this;if(!t||!this.media||(r==null?void 0:r.readyState)!=="open")return null;const i=t.edge;if(t.live&&this.hls.config.liveDurationInfinity){if(t.fragments.length&&t.live&&r.setLiveSeekableRange){const u=Math.max(0,t.fragmentStart),c=Math.max(u,i);return{duration:1/0,start:u,end:c}}return{duration:1/0}}const s=(e=this.overrides)==null?void 0:e.duration;if(s)return Z(s)?{duration:s}:null;const a=this.media.duration,o=Z(r.duration)?r.duration:0;return i>o&&i>a||!Z(a)?{duration:i}:null}updateMediaSource({duration:e,start:t,end:r}){const i=this.mediaSource;!this.media||!i||i.readyState!=="open"||(i.duration!==e&&(Z(e)&&this.log(`Updating MediaSource duration to ${e.toFixed(3)}`),i.duration=e),t!==void 0&&r!==void 0&&(this.log(`MediaSource duration is set to ${i.duration}. Setting seekable range to ${t}-${r}.`),i.setLiveSeekableRange(t,r)))}get tracksReady(){const e=this.pendingTrackCount;return e>0&&(e>=this.bufferCodecEventsTotal||this.isPending(this.tracks.audiovideo))}checkPendingTracks(){const{bufferCodecEventsTotal:e,pendingTrackCount:t,tracks:r}=this;if(this.log(`checkPendingTracks (pending: ${t} codec events expected: ${e}) ${Ve(r)}`),this.tracksReady){var i;const s=(i=this.transferData)==null?void 0:i.tracks;s&&Object.keys(s).length?this.attachTransferred():this.createSourceBuffers()}}bufferCreated(){if(this.sourceBufferCount){const e={};this.sourceBuffers.forEach(([t,r])=>{if(t){const i=this.tracks[t];e[t]={buffer:r,container:i.container,codec:i.codec,supplemental:i.supplemental,levelCodec:i.levelCodec,id:i.id,metadata:i.metadata}}}),this.hls.trigger(S.BUFFER_CREATED,{tracks:e}),this.log(`SourceBuffers created. Running queue: ${this.operationQueue}`),this.sourceBuffers.forEach(([t])=>{this.executeNext(t)})}else{const e=new Error("could not create source buffer for media codec(s)");this.hls.trigger(S.ERROR,{type:re.MEDIA_ERROR,details:O.BUFFER_INCOMPATIBLE_CODECS_ERROR,fatal:!0,error:e,reason:e.message})}}createSourceBuffers(){const{tracks:e,sourceBuffers:t,mediaSource:r}=this;if(!r)throw new Error("createSourceBuffers called when mediaSource was null");for(const s in e){const a=s,o=e[a];if(this.isPending(o)){const l=this.getTrackCodec(o,a),u=`${o.container};codecs=${l}`;o.codec=l,this.log(`creating sourceBuffer(${u})${this.currentOp(a)?" Queued":""} ${Ve(o)}`);try{const c=r.addSourceBuffer(u),d=Id(a),h=[a,c];t[d]=h,o.buffer=c}catch(c){var i;this.error(`error while trying to add sourceBuffer: ${c.message}`),this.shiftAndExecuteNext(a),(i=this.operationQueue)==null||i.removeBlockers(),delete this.tracks[a],this.hls.trigger(S.ERROR,{type:re.MEDIA_ERROR,details:O.BUFFER_ADD_CODEC_ERROR,fatal:!1,error:c,sourceBufferName:a,mimeType:u,parent:o.id});return}this.trackSourceBuffer(a,o)}}this.bufferCreated()}getTrackCodec(e,t){const r=e.supplemental;let i=e.codec;r&&(t==="video"||t==="audiovideo")&&Yh(r,"video")&&(i=sb(i,r));const s=au(i,e.levelCodec);return s?t.slice(0,5)==="audio"?Vu(s,this.appendSource):s:""}trackSourceBuffer(e,t){const r=t.buffer;if(!r)return;const i=this.getTrackCodec(t,e);this.tracks[e]={buffer:r,codec:i,container:t.container,levelCodec:t.levelCodec,supplemental:t.supplemental,metadata:t.metadata,id:t.id,listeners:[]},this.removeBufferListeners(e),this.addBufferListener(e,"updatestart",this.onSBUpdateStart),this.addBufferListener(e,"updateend",this.onSBUpdateEnd),this.addBufferListener(e,"error",this.onSBUpdateError),this.appendSource&&this.addBufferListener(e,"bufferedchange",(s,a)=>{const o=a.removedRanges;o!=null&&o.length&&this.hls.trigger(S.BUFFER_FLUSHED,{type:s})})}get mediaSrc(){var e,t;const r=((e=this.media)==null||(t=e.querySelector)==null?void 0:t.call(e,"source"))||this.media;return r==null?void 0:r.src}onSBUpdateStart(e){const t=this.currentOp(e);t&&t.onStart()}onSBUpdateEnd(e){var t;if(((t=this.mediaSource)==null?void 0:t.readyState)==="closed"){this.resetBuffer(e);return}const r=this.currentOp(e);r&&(r.onComplete(),this.shiftAndExecuteNext(e))}onSBUpdateError(e,t){var r;const i=new Error(`${e} SourceBuffer error. MediaSource readyState: ${(r=this.mediaSource)==null?void 0:r.readyState}`);this.error(`${i}`,t),this.hls.trigger(S.ERROR,{type:re.MEDIA_ERROR,details:O.BUFFER_APPENDING_ERROR,sourceBufferName:e,error:i,fatal:!1});const s=this.currentOp(e);s&&s.onError(i)}removeExecutor(e,t,r){const{media:i,mediaSource:s}=this,a=this.tracks[e],o=a==null?void 0:a.buffer;if(!i||!s||!o){this.warn(`Attempting to remove from the ${e} SourceBuffer, but it does not exist`),this.shiftAndExecuteNext(e);return}const l=Z(i.duration)?i.duration:1/0,u=Z(s.duration)?s.duration:1/0,c=Math.max(0,t),d=Math.min(r,l,u);d>c&&(!a.ending||a.ended)?(a.ended=!1,this.log(`Removing [${c},${d}] from the ${e} SourceBuffer`),o.remove(c,d)):this.shiftAndExecuteNext(e)}appendExecutor(e,t){const r=this.tracks[t],i=r==null?void 0:r.buffer;if(!i)throw new oP(`Attempting to append to the ${t} SourceBuffer, but it does not exist`);r.ending=!1,r.ended=!1,i.appendBuffer(e)}blockUntilOpen(e){if(this.isUpdating()||this.isQueued())this.blockBuffers(e).catch(t=>{this.warn(`SourceBuffer blocked callback ${t}`),this.stepOperationQueue(this.sourceBufferTypes)});else try{e()}catch(t){this.warn(`Callback run without blocking ${this.operationQueue} ${t}`)}}isUpdating(){return this.sourceBuffers.some(([e,t])=>e&&t.updating)}isQueued(){return this.sourceBuffers.some(([e])=>e&&!!this.currentOp(e))}isPending(e){return!!e&&!e.buffer}blockBuffers(e,t=this.sourceBufferTypes){if(!t.length)return this.log("Blocking operation requested, but no SourceBuffers exist"),Promise.resolve().then(e);const{operationQueue:r}=this,i=t.map(a=>this.appendBlocker(a));return t.length>1&&!!this.blockedAudioAppend&&this.unblockAudio(),Promise.all(i).then(a=>{r===this.operationQueue&&(e(),this.stepOperationQueue(this.sourceBufferTypes))})}stepOperationQueue(e){e.forEach(t=>{var r;const i=(r=this.tracks[t])==null?void 0:r.buffer;!i||i.updating||this.shiftAndExecuteNext(t)})}append(e,t,r){this.operationQueue&&this.operationQueue.append(e,t,r)}appendBlocker(e){if(this.operationQueue)return this.operationQueue.appendBlocker(e)}currentOp(e){return this.operationQueue?this.operationQueue.current(e):null}executeNext(e){e&&this.operationQueue&&this.operationQueue.executeNext(e)}shiftAndExecuteNext(e){this.operationQueue&&this.operationQueue.shiftAndExecuteNext(e)}get pendingTrackCount(){return Object.keys(this.tracks).reduce((e,t)=>e+(this.isPending(this.tracks[t])?1:0),0)}get sourceBufferCount(){return this.sourceBuffers.reduce((e,[t])=>e+(t?1:0),0)}get sourceBufferTypes(){return this.sourceBuffers.map(([e])=>e).filter(e=>!!e)}addBufferListener(e,t,r){const i=this.tracks[e];if(!i)return;const s=i.buffer;if(!s)return;const a=r.bind(this,e);i.listeners.push({event:t,listener:a}),s.addEventListener(t,a)}removeBufferListeners(e){const t=this.tracks[e];if(!t)return;const r=t.buffer;r&&(t.listeners.forEach(i=>{r.removeEventListener(i.event,i.listener)}),t.listeners.length=0)}}function Y0(n){const e=n.querySelectorAll("source");[].slice.call(e).forEach(t=>{n.removeChild(t)})}function uP(n,e){const t=self.document.createElement("source");t.type="video/mp4",t.src=e,n.appendChild(t)}function Id(n){return n==="audio"?1:0}class Ng{constructor(e){this.hls=void 0,this.autoLevelCapping=void 0,this.firstLevel=void 0,this.media=void 0,this.restrictedLevels=void 0,this.timer=void 0,this.clientRect=void 0,this.streamController=void 0,this.hls=e,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.firstLevel=-1,this.media=null,this.restrictedLevels=[],this.timer=void 0,this.clientRect=null,this.registerListeners()}setStreamController(e){this.streamController=e}destroy(){this.hls&&this.unregisterListener(),this.timer&&this.stopCapping(),this.media=null,this.clientRect=null,this.hls=this.streamController=null}registerListeners(){const{hls:e}=this;e.on(S.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),e.on(S.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(S.MANIFEST_PARSED,this.onManifestParsed,this),e.on(S.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(S.BUFFER_CODECS,this.onBufferCodecs,this),e.on(S.MEDIA_DETACHING,this.onMediaDetaching,this)}unregisterListener(){const{hls:e}=this;e.off(S.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),e.off(S.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(S.MANIFEST_PARSED,this.onManifestParsed,this),e.off(S.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(S.BUFFER_CODECS,this.onBufferCodecs,this),e.off(S.MEDIA_DETACHING,this.onMediaDetaching,this)}onFpsDropLevelCapping(e,t){const r=this.hls.levels[t.droppedLevel];this.isLevelAllowed(r)&&this.restrictedLevels.push({bitrate:r.bitrate,height:r.height,width:r.width})}onMediaAttaching(e,t){this.media=t.media instanceof HTMLVideoElement?t.media:null,this.clientRect=null,this.timer&&this.hls.levels.length&&this.detectPlayerSize()}onManifestParsed(e,t){const r=this.hls;this.restrictedLevels=[],this.firstLevel=t.firstLevel,r.config.capLevelToPlayerSize&&t.video&&this.startCapping()}onLevelsUpdated(e,t){this.timer&&Z(this.autoLevelCapping)&&this.detectPlayerSize()}onBufferCodecs(e,t){this.hls.config.capLevelToPlayerSize&&t.video&&this.startCapping()}onMediaDetaching(){this.stopCapping(),this.media=null}detectPlayerSize(){if(this.media){if(this.mediaHeight<=0||this.mediaWidth<=0){this.clientRect=null;return}const e=this.hls.levels;if(e.length){const t=this.hls,r=this.getMaxLevel(e.length-1);r!==this.autoLevelCapping&&t.logger.log(`Setting autoLevelCapping to ${r}: ${e[r].height}p@${e[r].bitrate} for media ${this.mediaWidth}x${this.mediaHeight}`),t.autoLevelCapping=r,t.autoLevelEnabled&&t.autoLevelCapping>this.autoLevelCapping&&this.streamController&&this.streamController.nextLevelSwitch(),this.autoLevelCapping=t.autoLevelCapping}}}getMaxLevel(e){const t=this.hls.levels;if(!t.length)return-1;const r=t.filter((i,s)=>this.isLevelAllowed(i)&&s<=e);return this.clientRect=null,Ng.getMaxLevelByMediaSize(r,this.mediaWidth,this.mediaHeight)}startCapping(){this.timer||(this.autoLevelCapping=Number.POSITIVE_INFINITY,self.clearInterval(this.timer),this.timer=self.setInterval(this.detectPlayerSize.bind(this),1e3),this.detectPlayerSize())}stopCapping(){this.restrictedLevels=[],this.firstLevel=-1,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.timer&&(self.clearInterval(this.timer),this.timer=void 0)}getDimensions(){if(this.clientRect)return this.clientRect;const e=this.media,t={width:0,height:0};if(e){const r=e.getBoundingClientRect();t.width=r.width,t.height=r.height,!t.width&&!t.height&&(t.width=r.right-r.left||e.width||0,t.height=r.bottom-r.top||e.height||0)}return this.clientRect=t,t}get mediaWidth(){return this.getDimensions().width*this.contentScaleFactor}get mediaHeight(){return this.getDimensions().height*this.contentScaleFactor}get contentScaleFactor(){let e=1;if(!this.hls.config.ignoreDevicePixelRatio)try{e=self.devicePixelRatio}catch{}return Math.min(e,this.hls.config.maxDevicePixelRatio)}isLevelAllowed(e){return!this.restrictedLevels.some(r=>e.bitrate===r.bitrate&&e.width===r.width&&e.height===r.height)}static getMaxLevelByMediaSize(e,t,r){if(!(e!=null&&e.length))return-1;const i=(o,l)=>l?o.width!==l.width||o.height!==l.height:!0;let s=e.length-1;const a=Math.max(t,r);for(let o=0;o<e.length;o+=1){const l=e[o];if((l.width>=a||l.height>=a)&&i(l,e[o+1])){s=o;break}}return s}}const cP={MANIFEST:"m",AUDIO:"a",VIDEO:"v",MUXED:"av",INIT:"i",CAPTION:"c",TIMED_TEXT:"tt",KEY:"k",OTHER:"o"},Ut=cP,dP={HLS:"h"},hP=dP,fP="CMCD-Object",gP="CMCD-Request",mP="CMCD-Session",pP="CMCD-Status",Ha={OBJECT:fP,REQUEST:gP,SESSION:mP,STATUS:pP},yP={[Ha.OBJECT]:["br","d","ot","tb"],[Ha.REQUEST]:["bl","dl","mtp","nor","nrr","su"],[Ha.SESSION]:["cid","pr","sf","sid","st","v"],[Ha.STATUS]:["bs","rtp"]};class ga{constructor(e,t){Array.isArray(e)&&(e=e.map(r=>r instanceof ga?r:new ga(r))),this.value=e,this.params=t}}const vP="Dict";function EP(n){return Array.isArray(n)?JSON.stringify(n):n instanceof Map?"Map{}":n instanceof Set?"Set{}":typeof n=="object"?JSON.stringify(n):String(n)}function SP(n,e,t,r){return new Error(`failed to ${n} "${EP(e)}" as ${t}`,{cause:r})}function rr(n,e,t){return SP("serialize",n,e,t)}class Bx{constructor(e){this.description=e}}const q0="Bare Item",xP="Boolean";function TP(n){if(typeof n!="boolean")throw rr(n,xP);return n?"?1":"?0"}function LP(n){return btoa(String.fromCharCode(...n))}const AP="Byte Sequence";function RP(n){if(ArrayBuffer.isView(n)===!1)throw rr(n,AP);return`:${LP(n)}:`}const _P="Integer";function IP(n){return n<-999999999999999||999999999999999<n}function $x(n){if(IP(n))throw rr(n,_P);return n.toString()}function DP(n){return`@${$x(n.getTime()/1e3)}`}function jx(n,e){if(n<0)return-jx(-n,e);const t=Math.pow(10,e);if(Math.abs(n*t%1-.5)<Number.EPSILON){const i=Math.floor(n*t);return(i%2===0?i:i+1)/t}else return Math.round(n*t)/t}const CP="Decimal";function wP(n){const e=jx(n,3);if(Math.floor(Math.abs(e)).toString().length>12)throw rr(n,CP);const t=e.toString();return t.includes(".")?t:`${t}.0`}const bP="String",kP=/[\x00-\x1f\x7f]+/;function PP(n){if(kP.test(n))throw rr(n,bP);return`"${n.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}"`}function OP(n){return n.description||n.toString().slice(7,-1)}const FP="Token";function Q0(n){const e=OP(n);if(/^([a-zA-Z*])([!#$%&'*+\-.^_`|~\w:/]*)$/.test(e)===!1)throw rr(e,FP);return e}function rf(n){switch(typeof n){case"number":if(!Z(n))throw rr(n,q0);return Number.isInteger(n)?$x(n):wP(n);case"string":return PP(n);case"symbol":return Q0(n);case"boolean":return TP(n);case"object":if(n instanceof Date)return DP(n);if(n instanceof Uint8Array)return RP(n);if(n instanceof Bx)return Q0(n);default:throw rr(n,q0)}}const MP="Key";function sf(n){if(/^[a-z*][a-z0-9\-_.*]*$/.test(n)===!1)throw rr(n,MP);return n}function Ug(n){return n==null?"":Object.entries(n).map(([e,t])=>t===!0?`;${sf(e)}`:`;${sf(e)}=${rf(t)}`).join("")}function Gx(n){return n instanceof ga?`${rf(n.value)}${Ug(n.params)}`:rf(n)}function NP(n){return`(${n.value.map(Gx).join(" ")})${Ug(n.params)}`}function UP(n,e={whitespace:!0}){if(typeof n!="object")throw rr(n,vP);const t=n instanceof Map?n.entries():Object.entries(n),r=e!=null&&e.whitespace?" ":"";return Array.from(t).map(([i,s])=>{s instanceof ga||(s=new ga(s));let a=sf(i);return s.value===!0?a+=Ug(s.params):(a+="=",Array.isArray(s.value)?a+=NP(s):a+=Gx(s)),a}).join(`,${r}`)}function BP(n,e){return UP(n,e)}function $P(n){return n==="ot"||n==="sf"||n==="st"}function jP(n){return typeof n=="number"?Z(n):n!=null&&n!==""&&n!==!1}function GP(n,e){const t=new URL(n),r=new URL(e);if(t.origin!==r.origin)return n;const i=t.pathname.split("/").slice(1),s=r.pathname.split("/").slice(1,-1);for(;i[0]===s[0];)i.shift(),s.shift();for(;s.length;)s.shift(),i.unshift("..");return i.join("/")}const du=n=>Math.round(n),KP=(n,e)=>(e!=null&&e.baseUrl&&(n=GP(n,e.baseUrl)),encodeURIComponent(n)),Bl=n=>du(n/100)*100,VP={br:du,d:du,bl:Bl,dl:Bl,mtp:Bl,nor:KP,rtp:Bl,tb:du};function HP(n,e){const t={};if(n==null||typeof n!="object")return t;const r=Object.keys(n).sort(),i=Oe({},VP,e==null?void 0:e.formatters),s=e==null?void 0:e.filter;return r.forEach(a=>{if(s!=null&&s(a))return;let o=n[a];const l=i[a];l&&(o=l(o,e)),!(a==="v"&&o===1)&&(a=="pr"&&o===1||jP(o)&&($P(a)&&typeof o=="string"&&(o=new Bx(o)),t[a]=o))}),t}function Kx(n,e={}){return n?BP(HP(n,e),Oe({whitespace:!1},e)):""}function zP(n,e={}){const t={};if(!n)return t;const r=Object.entries(n),i=Object.entries(yP).concat(Object.entries((e==null?void 0:e.customHeaderMap)||{})),s=r.reduce((a,o)=>{var l,u;const[c,d]=o,h=((l=i.find(f=>f[1].includes(c)))===null||l===void 0?void 0:l[0])||Ha.REQUEST;return(u=a[h])!==null&&u!==void 0||(a[h]={}),a[h][c]=d,a},{});return Object.entries(s).reduce((a,[o,l])=>(a[o]=Kx(l,e),a),t)}function WP(n,e,t){return Oe(n,zP(e,t))}const YP="CMCD";function qP(n,e={}){if(!n)return"";const t=Kx(n,e);return`${YP}=${encodeURIComponent(t)}`}const X0=/CMCD=[^&#]+/;function QP(n,e,t){const r=qP(e,t);if(!r)return n;if(X0.test(n))return n.replace(X0,r);const i=n.includes("?")?"&":"?";return`${n}${i}${r}`}class XP{constructor(e){this.hls=void 0,this.config=void 0,this.media=void 0,this.sid=void 0,this.cid=void 0,this.useHeaders=!1,this.includeKeys=void 0,this.initialized=!1,this.starved=!1,this.buffering=!0,this.audioBuffer=void 0,this.videoBuffer=void 0,this.onWaiting=()=>{this.initialized&&(this.starved=!0),this.buffering=!0},this.onPlaying=()=>{this.initialized||(this.initialized=!0),this.buffering=!1},this.applyPlaylistData=i=>{try{this.apply(i,{ot:Ut.MANIFEST,su:!this.initialized})}catch(s){this.hls.logger.warn("Could not generate manifest CMCD data.",s)}},this.applyFragmentData=i=>{try{const{frag:s,part:a}=i,o=this.hls.levels[s.level],l=this.getObjectType(s),u={d:(a||s).duration*1e3,ot:l};(l===Ut.VIDEO||l===Ut.AUDIO||l==Ut.MUXED)&&(u.br=o.bitrate/1e3,u.tb=this.getTopBandwidth(l)/1e3,u.bl=this.getBufferLength(l));const c=a?this.getNextPart(a):this.getNextFrag(s);c!=null&&c.url&&c.url!==s.url&&(u.nor=c.url),this.apply(i,u)}catch(s){this.hls.logger.warn("Could not generate segment CMCD data.",s)}},this.hls=e;const t=this.config=e.config,{cmcd:r}=t;r!=null&&(t.pLoader=this.createPlaylistLoader(),t.fLoader=this.createFragmentLoader(),this.sid=r.sessionId||e.sessionId,this.cid=r.contentId,this.useHeaders=r.useHeaders===!0,this.includeKeys=r.includeKeys,this.registerListeners())}registerListeners(){const e=this.hls;e.on(S.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(S.MEDIA_DETACHED,this.onMediaDetached,this),e.on(S.BUFFER_CREATED,this.onBufferCreated,this)}unregisterListeners(){const e=this.hls;e.off(S.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(S.MEDIA_DETACHED,this.onMediaDetached,this),e.off(S.BUFFER_CREATED,this.onBufferCreated,this)}destroy(){this.unregisterListeners(),this.onMediaDetached(),this.hls=this.config=this.audioBuffer=this.videoBuffer=null,this.onWaiting=this.onPlaying=this.media=null}onMediaAttached(e,t){this.media=t.media,this.media.addEventListener("waiting",this.onWaiting),this.media.addEventListener("playing",this.onPlaying)}onMediaDetached(){this.media&&(this.media.removeEventListener("waiting",this.onWaiting),this.media.removeEventListener("playing",this.onPlaying),this.media=null)}onBufferCreated(e,t){var r,i;this.audioBuffer=(r=t.tracks.audio)==null?void 0:r.buffer,this.videoBuffer=(i=t.tracks.video)==null?void 0:i.buffer}createData(){var e;return{v:1,sf:hP.HLS,sid:this.sid,cid:this.cid,pr:(e=this.media)==null?void 0:e.playbackRate,mtp:this.hls.bandwidthEstimate/1e3}}apply(e,t={}){Oe(t,this.createData());const r=t.ot===Ut.INIT||t.ot===Ut.VIDEO||t.ot===Ut.MUXED;this.starved&&r&&(t.bs=!0,t.su=!0,this.starved=!1),t.su==null&&(t.su=this.buffering);const{includeKeys:i}=this;i&&(t=Object.keys(t).reduce((a,o)=>(i.includes(o)&&(a[o]=t[o]),a),{}));const s={baseUrl:e.url};this.useHeaders?(e.headers||(e.headers={}),WP(e.headers,t,s)):e.url=QP(e.url,t,s)}getNextFrag(e){var t;const r=(t=this.hls.levels[e.level])==null?void 0:t.details;if(r){const i=e.sn-r.startSN;return r.fragments[i+1]}}getNextPart(e){var t,r;const{index:i,fragment:s}=e,a=(t=this.hls.levels[s.level])==null||(r=t.details)==null?void 0:r.partList;if(a){const{sn:o}=s;for(let l=a.length-1;l>=0;l--){const u=a[l];if(u.index===i&&u.fragment.sn===o)return a[l+1]}}}getObjectType(e){const{type:t}=e;if(t==="subtitle")return Ut.TIMED_TEXT;if(e.sn==="initSegment")return Ut.INIT;if(t==="audio")return Ut.AUDIO;if(t==="main")return this.hls.audioTracks.length?Ut.VIDEO:Ut.MUXED}getTopBandwidth(e){let t=0,r;const i=this.hls;if(e===Ut.AUDIO)r=i.audioTracks;else{const s=i.maxAutoLevel,a=s>-1?s+1:i.levels.length;r=i.levels.slice(0,a)}return r.forEach(s=>{s.bitrate>t&&(t=s.bitrate)}),t>0?t:NaN}getBufferLength(e){const t=this.media,r=e===Ut.AUDIO?this.audioBuffer:this.videoBuffer;return!r||!t?NaN:ge.bufferInfo(r,t.currentTime,this.config.maxBufferHole).len*1e3}createPlaylistLoader(){const{pLoader:e}=this.config,t=this.applyPlaylistData,r=e||this.config.loader;return class{constructor(s){this.loader=void 0,this.loader=new r(s)}get stats(){return this.loader.stats}get context(){return this.loader.context}destroy(){this.loader.destroy()}abort(){this.loader.abort()}load(s,a,o){t(s),this.loader.load(s,a,o)}}}createFragmentLoader(){const{fLoader:e}=this.config,t=this.applyFragmentData,r=e||this.config.loader;return class{constructor(s){this.loader=void 0,this.loader=new r(s)}get stats(){return this.loader.stats}get context(){return this.loader.context}destroy(){this.loader.destroy()}abort(){this.loader.abort()}load(s,a,o){t(s),this.loader.load(s,a,o)}}}}const ZP=3e5;class JP extends kr{constructor(e){super("content-steering",e.logger),this.hls=void 0,this.loader=null,this.uri=null,this.pathwayId=".",this._pathwayPriority=null,this.timeToLoad=300,this.reloadTimer=-1,this.updated=0,this.started=!1,this.enabled=!0,this.levels=null,this.audioTracks=null,this.subtitleTracks=null,this.penalizedPathways={},this.hls=e,this.registerListeners()}registerListeners(){const e=this.hls;e.on(S.MANIFEST_LOADING,this.onManifestLoading,this),e.on(S.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(S.MANIFEST_PARSED,this.onManifestParsed,this),e.on(S.ERROR,this.onError,this)}unregisterListeners(){const e=this.hls;e&&(e.off(S.MANIFEST_LOADING,this.onManifestLoading,this),e.off(S.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(S.MANIFEST_PARSED,this.onManifestParsed,this),e.off(S.ERROR,this.onError,this))}pathways(){return(this.levels||[]).reduce((e,t)=>(e.indexOf(t.pathwayId)===-1&&e.push(t.pathwayId),e),[])}get pathwayPriority(){return this._pathwayPriority}set pathwayPriority(e){this.updatePathwayPriority(e)}startLoad(){if(this.started=!0,this.clearTimeout(),this.enabled&&this.uri){if(this.updated){const e=this.timeToLoad*1e3-(performance.now()-this.updated);if(e>0){this.scheduleRefresh(this.uri,e);return}}this.loadSteeringManifest(this.uri)}}stopLoad(){this.started=!1,this.loader&&(this.loader.destroy(),this.loader=null),this.clearTimeout()}clearTimeout(){this.reloadTimer!==-1&&(self.clearTimeout(this.reloadTimer),this.reloadTimer=-1)}destroy(){this.unregisterListeners(),this.stopLoad(),this.hls=null,this.levels=this.audioTracks=this.subtitleTracks=null}removeLevel(e){const t=this.levels;t&&(this.levels=t.filter(r=>r!==e))}onManifestLoading(){this.stopLoad(),this.enabled=!0,this.timeToLoad=300,this.updated=0,this.uri=null,this.pathwayId=".",this.levels=this.audioTracks=this.subtitleTracks=null}onManifestLoaded(e,t){const{contentSteering:r}=t;r!==null&&(this.pathwayId=r.pathwayId,this.uri=r.uri,this.started&&this.startLoad())}onManifestParsed(e,t){this.audioTracks=t.audioTracks,this.subtitleTracks=t.subtitleTracks}onError(e,t){const{errorAction:r}=t;if((r==null?void 0:r.action)===It.SendAlternateToPenaltyBox&&r.flags===In.MoveAllAlternatesMatchingHost){const i=this.levels;let s=this._pathwayPriority,a=this.pathwayId;if(t.context){const{groupId:o,pathwayId:l,type:u}=t.context;o&&i?a=this.getPathwayForGroupId(o,u,a):l&&(a=l)}a in this.penalizedPathways||(this.penalizedPathways[a]=performance.now()),!s&&i&&(s=this.pathways()),s&&s.length>1&&(this.updatePathwayPriority(s),r.resolved=this.pathwayId!==a),r.resolved||this.warn(`Could not resolve ${t.details} ("${t.error.message}") with content-steering for Pathway: ${a} levels: ${i&&i.length} priorities: ${Ve(s)} penalized: ${Ve(this.penalizedPathways)}`)}}filterParsedLevels(e){this.levels=e;let t=this.getLevelsForPathway(this.pathwayId);if(t.length===0){const r=e[0].pathwayId;this.log(`No levels found in Pathway ${this.pathwayId}. Setting initial Pathway to "${r}"`),t=this.getLevelsForPathway(r),this.pathwayId=r}return t.length!==e.length&&this.log(`Found ${t.length}/${e.length} levels in Pathway "${this.pathwayId}"`),t}getLevelsForPathway(e){return this.levels===null?[]:this.levels.filter(t=>e===t.pathwayId)}updatePathwayPriority(e){this._pathwayPriority=e;let t;const r=this.penalizedPathways,i=performance.now();Object.keys(r).forEach(s=>{i-r[s]>ZP&&delete r[s]});for(let s=0;s<e.length;s++){const a=e[s];if(a in r)continue;if(a===this.pathwayId)return;const o=this.hls.nextLoadLevel,l=this.hls.levels[o];if(t=this.getLevelsForPathway(a),t.length>0){this.log(`Setting Pathway to "${a}"`),this.pathwayId=a,gx(t),this.hls.trigger(S.LEVELS_UPDATED,{levels:t});const u=this.hls.levels[o];l&&u&&this.levels&&(u.attrs["STABLE-VARIANT-ID"]!==l.attrs["STABLE-VARIANT-ID"]&&u.bitrate!==l.bitrate&&this.log(`Unstable Pathways change from bitrate ${l.bitrate} to ${u.bitrate}`),this.hls.nextLoadLevel=o);break}}}getPathwayForGroupId(e,t,r){const i=this.getLevelsForPathway(r).concat(this.levels||[]);for(let s=0;s<i.length;s++)if(t===Se.AUDIO_TRACK&&i[s].hasAudioGroup(e)||t===Se.SUBTITLE_TRACK&&i[s].hasSubtitleGroup(e))return i[s].pathwayId;return r}clonePathways(e){const t=this.levels;if(!t)return;const r={},i={};e.forEach(s=>{const{ID:a,"BASE-ID":o,"URI-REPLACEMENT":l}=s;if(t.some(c=>c.pathwayId===a))return;const u=this.getLevelsForPathway(o).map(c=>{const d=new He(c.attrs);d["PATHWAY-ID"]=a;const h=d.AUDIO&&`${d.AUDIO}_clone_${a}`,f=d.SUBTITLES&&`${d.SUBTITLES}_clone_${a}`;h&&(r[d.AUDIO]=h,d.AUDIO=h),f&&(i[d.SUBTITLES]=f,d.SUBTITLES=f);const g=Vx(c.uri,d["STABLE-VARIANT-ID"],"PER-VARIANT-URIS",l),m=new Io({attrs:d,audioCodec:c.audioCodec,bitrate:c.bitrate,height:c.height,name:c.name,url:g,videoCodec:c.videoCodec,width:c.width});if(c.audioGroups)for(let y=1;y<c.audioGroups.length;y++)m.addGroupId("audio",`${c.audioGroups[y]}_clone_${a}`);if(c.subtitleGroups)for(let y=1;y<c.subtitleGroups.length;y++)m.addGroupId("text",`${c.subtitleGroups[y]}_clone_${a}`);return m});t.push(...u),Z0(this.audioTracks,r,l,a),Z0(this.subtitleTracks,i,l,a)})}loadSteeringManifest(e){const t=this.hls.config,r=t.loader;this.loader&&this.loader.destroy(),this.loader=new r(t);let i;try{i=new self.URL(e)}catch{this.enabled=!1,this.log(`Failed to parse Steering Manifest URI: ${e}`);return}if(i.protocol!=="data:"){const c=(this.hls.bandwidthEstimate||t.abrEwmaDefaultEstimate)|0;i.searchParams.set("_HLS_pathway",this.pathwayId),i.searchParams.set("_HLS_throughput",""+c)}const s={responseType:"json",url:i.href},a=t.steeringManifestLoadPolicy.default,o=a.errorRetry||a.timeoutRetry||{},l={loadPolicy:a,timeout:a.maxLoadTimeMs,maxRetry:o.maxNumRetry||0,retryDelay:o.retryDelayMs||0,maxRetryDelay:o.maxRetryDelayMs||0},u={onSuccess:(c,d,h,f)=>{this.log(`Loaded steering manifest: "${i}"`);const g=c.data;if((g==null?void 0:g.VERSION)!==1){this.log(`Steering VERSION ${g.VERSION} not supported!`);return}this.updated=performance.now(),this.timeToLoad=g.TTL;const{"RELOAD-URI":m,"PATHWAY-CLONES":y,"PATHWAY-PRIORITY":p}=g;if(m)try{this.uri=new self.URL(m,i).href}catch{this.enabled=!1,this.log(`Failed to parse Steering Manifest RELOAD-URI: ${m}`);return}this.scheduleRefresh(this.uri||h.url),y&&this.clonePathways(y);const v={steeringManifest:g,url:i.toString()};this.hls.trigger(S.STEERING_MANIFEST_LOADED,v),p&&this.updatePathwayPriority(p)},onError:(c,d,h,f)=>{if(this.log(`Error loading steering manifest: ${c.code} ${c.text} (${d.url})`),this.stopLoad(),c.code===410){this.enabled=!1,this.log(`Steering manifest ${d.url} no longer available`);return}let g=this.timeToLoad*1e3;if(c.code===429){const m=this.loader;if(typeof(m==null?void 0:m.getResponseHeader)=="function"){const y=m.getResponseHeader("Retry-After");y&&(g=parseFloat(y)*1e3)}this.log(`Steering manifest ${d.url} rate limited`);return}this.scheduleRefresh(this.uri||d.url,g)},onTimeout:(c,d,h)=>{this.log(`Timeout loading steering manifest (${d.url})`),this.scheduleRefresh(this.uri||d.url)}};this.log(`Requesting steering manifest: ${i}`),this.loader.load(s,l,u)}scheduleRefresh(e,t=this.timeToLoad*1e3){this.clearTimeout(),this.reloadTimer=self.setTimeout(()=>{var r;const i=(r=this.hls)==null?void 0:r.media;if(i&&!i.ended){this.loadSteeringManifest(e);return}this.scheduleRefresh(e,this.timeToLoad*1e3)},t)}}function Z0(n,e,t,r){n&&Object.keys(e).forEach(i=>{const s=n.filter(a=>a.groupId===i).map(a=>{const o=Oe({},a);return o.details=void 0,o.attrs=new He(o.attrs),o.url=o.attrs.URI=Vx(a.url,a.attrs["STABLE-RENDITION-ID"],"PER-RENDITION-URIS",t),o.groupId=o.attrs["GROUP-ID"]=e[i],o.attrs["PATHWAY-ID"]=r,o});n.push(...s)})}function Vx(n,e,t,r){const{HOST:i,PARAMS:s,[t]:a}=r;let o;e&&(o=a==null?void 0:a[e],o&&(n=o));const l=new self.URL(n);return i&&!o&&(l.host=i),s&&Object.keys(s).sort().forEach(u=>{u&&l.searchParams.set(u,s[u])}),l.href}function nn(n,e,t){vn(n,e,t),n.addEventListener(e,t)}function vn(n,e,t){n.removeEventListener(e,t)}class Ks extends kr{constructor(e){super("eme",e.logger),this.hls=void 0,this.config=void 0,this.media=null,this.keyFormatPromise=null,this.keySystemAccessPromises={},this._requestLicenseFailureCount=0,this.mediaKeySessions=[],this.keyIdToKeySessionPromise={},this.mediaKeys=null,this.setMediaKeysQueue=Ks.CDMCleanupPromise?[Ks.CDMCleanupPromise]:[],this.onMediaEncrypted=t=>{const{initDataType:r,initData:i}=t,s=`"${t.type}" event: init data type: "${r}"`;if(this.debug(s),i!==null){if(!this.keyFormatPromise){let a=Object.keys(this.keySystemAccessPromises);a.length||(a=Va(this.config));const o=a.map(Ol).filter(l=>!!l);this.keyFormatPromise=this.getKeyFormatPromise(o)}this.keyFormatPromise.then(a=>{const o=lu(a);let l,u;if(r==="sinf"){if(o!==we.FAIRPLAY){this.warn(`Ignoring unexpected "${t.type}" event with init data type: "${r}" for selected key-system ${o}`);return}const g=lt(new Uint8Array(i));try{const m=Ig(JSON.parse(g).sinf),y=HS(m);if(!y)throw new Error("'schm' box missing or not cbcs/cenc with schi > tenc");l=new Uint8Array(y.subarray(8,24)),u=we.FAIRPLAY}catch(m){this.warn(`${s} Failed to parse sinf: ${m}`);return}}else{if(o!==we.WIDEVINE&&o!==we.PLAYREADY){this.warn(`Ignoring unexpected "${t.type}" event with init data type: "${r}" for selected key-system ${o}`);return}const g=tb(i),m=g.filter(p=>!!p.systemId&&Ed(p.systemId)===o);m.length>1&&this.warn(`${s} Using first of ${m.length} pssh found for selected key-system ${o}`);const y=m[0];if(!y){g.length===0||g.some(p=>!p.systemId)?this.warn(`${s} contains incomplete or invalid pssh data`):this.log(`ignoring ${s} for ${g.map(p=>Ed(p.systemId)).join(",")} pssh data in favor of playlist keys`);return}if(u=Ed(y.systemId),y.version===0&&y.data)if(u===we.WIDEVINE){const p=y.data.length-22;l=new Uint8Array(y.data.subarray(p,p+16))}else u===we.PLAYREADY&&(l=ox(y.data))}if(!u||!l)return;const c=Kn.hexDump(l),{keyIdToKeySessionPromise:d,mediaKeySessions:h}=this;let f=d[c];for(let g=0;g<h.length;g++){const m=h[g],y=m.decryptdata;if(!y.keyId)continue;const p=Kn.hexDump(y.keyId);if(c===p||y.uri.replace(/-/g,"").indexOf(c)!==-1){if(f=d[p],y.pssh)break;delete d[p],y.pssh=new Uint8Array(i),y.keyId=l,f=d[c]=f.then(()=>this.generateRequestWithPreferredKeySession(m,r,i,"encrypted-event-key-match")),f.catch(v=>this.handleError(v));break}}if(!f){if(u!==o){this.log(`Ignoring "${t.type}" event with ${u} init data for selected key-system ${o}`);return}f=d[c]=this.getKeySystemSelectionPromise([u]).then(({keySystem:g,mediaKeys:m})=>{var y;this.throwIfDestroyed();const p=new Co("ISO-23001-7",c,(y=Ol(g))!=null?y:"");return p.pssh=new Uint8Array(i),p.keyId=l,this.attemptSetMediaKeys(g,m).then(()=>{this.throwIfDestroyed();const v=this.createMediaKeySessionContext({decryptdata:p,keySystem:g,mediaKeys:m});return this.generateRequestWithPreferredKeySession(v,r,i,"encrypted-event-no-match")})}),f.catch(g=>this.handleError(g))}})}},this.onWaitingForKey=t=>{this.log(`"${t.type}" event`)},this.hls=e,this.config=e.config,this.registerListeners()}destroy(){this.onDestroying(),this.onMediaDetached();const e=this.config;e.requestMediaKeySystemAccessFunc=null,e.licenseXhrSetup=e.licenseResponseCallback=void 0,e.drmSystems=e.drmSystemOptions={},this.hls=this.config=this.keyIdToKeySessionPromise=null,this.onMediaEncrypted=this.onWaitingForKey=null}registerListeners(){this.hls.on(S.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(S.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.on(S.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.on(S.MANIFEST_LOADED,this.onManifestLoaded,this),this.hls.on(S.DESTROYING,this.onDestroying,this)}unregisterListeners(){this.hls.off(S.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.off(S.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.off(S.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.off(S.MANIFEST_LOADED,this.onManifestLoaded,this),this.hls.off(S.DESTROYING,this.onDestroying,this)}getLicenseServerUrl(e){const{drmSystems:t,widevineLicenseUrl:r}=this.config,i=t[e];if(i)return i.licenseUrl;if(e===we.WIDEVINE&&r)return r}getLicenseServerUrlOrThrow(e){const t=this.getLicenseServerUrl(e);if(t===void 0)throw new Error(`no license server URL configured for key-system "${e}"`);return t}getServerCertificateUrl(e){const{drmSystems:t}=this.config,r=t[e];if(r)return r.serverCertificateUrl;this.log(`No Server Certificate in config.drmSystems["${e}"]`)}attemptKeySystemAccess(e){const t=this.hls.levels,r=(a,o,l)=>!!a&&l.indexOf(a)===o,i=t.map(a=>a.audioCodec).filter(r),s=t.map(a=>a.videoCodec).filter(r);return i.length+s.length===0&&s.push("avc1.42e01e"),new Promise((a,o)=>{const l=u=>{const c=u.shift();this.getMediaKeysPromise(c,i,s).then(d=>a({keySystem:c,mediaKeys:d})).catch(d=>{u.length?l(u):d instanceof dn?o(d):o(new dn({type:re.KEY_SYSTEM_ERROR,details:O.KEY_SYSTEM_NO_ACCESS,error:d,fatal:!0},d.message))})};l(e)})}requestMediaKeySystemAccess(e,t){const{requestMediaKeySystemAccessFunc:r}=this.config;if(typeof r!="function"){let i=`Configured requestMediaKeySystemAccess is not a function ${r}`;return ax===null&&self.location.protocol==="http:"&&(i=`navigator.requestMediaKeySystemAccess is not available over insecure protocol ${location.protocol}`),Promise.reject(new Error(i))}return r(e,t)}getMediaKeysPromise(e,t,r){const i=Hb(e,t,r,this.config.drmSystemOptions),s=this.keySystemAccessPromises[e];let a=s==null?void 0:s.keySystemAccess;if(!a){this.log(`Requesting encrypted media "${e}" key-system access with config: ${Ve(i)}`),a=this.requestMediaKeySystemAccess(e,i);const o=this.keySystemAccessPromises[e]={keySystemAccess:a};return a.catch(l=>{this.log(`Failed to obtain access to key-system "${e}": ${l}`)}),a.then(l=>{this.log(`Access for key-system "${l.keySystem}" obtained`);const u=this.fetchServerCertificate(e);return this.log(`Create media-keys for "${e}"`),o.mediaKeys=l.createMediaKeys().then(c=>(this.log(`Media-keys created for "${e}"`),o.hasMediaKeys=!0,u.then(d=>d?this.setMediaKeysServerCertificate(c,e,d):c))),o.mediaKeys.catch(c=>{this.error(`Failed to create media-keys for "${e}"}: ${c}`)}),o.mediaKeys})}return a.then(()=>s.mediaKeys)}createMediaKeySessionContext({decryptdata:e,keySystem:t,mediaKeys:r}){this.log(`Creating key-system session "${t}" keyId: ${Kn.hexDump(e.keyId||[])}`);const i=r.createSession(),s={decryptdata:e,keySystem:t,mediaKeys:r,mediaKeysSession:i,keyStatus:"status-pending"};return this.mediaKeySessions.push(s),s}renewKeySession(e){const t=e.decryptdata;if(t.pssh){const r=this.createMediaKeySessionContext(e),i=this.getKeyIdString(t),s="cenc";this.keyIdToKeySessionPromise[i]=this.generateRequestWithPreferredKeySession(r,s,t.pssh.buffer,"expired")}else this.warn("Could not renew expired session. Missing pssh initData.");this.removeSession(e)}getKeyIdString(e){if(!e)throw new Error("Could not read keyId of undefined decryptdata");if(e.keyId===null)throw new Error("keyId is null");return Kn.hexDump(e.keyId)}updateKeySession(e,t){var r;const i=e.mediaKeysSession;return this.log(`Updating key-session "${i.sessionId}" for keyID ${Kn.hexDump(((r=e.decryptdata)==null?void 0:r.keyId)||[])}
      } (data length: ${t&&t.byteLength})`),i.update(t)}getSelectedKeySystemFormats(){return Object.keys(this.keySystemAccessPromises).map(e=>({keySystem:e,hasMediaKeys:this.keySystemAccessPromises[e].hasMediaKeys})).filter(({hasMediaKeys:e})=>!!e).map(({keySystem:e})=>Ol(e)).filter(e=>!!e)}getKeySystemAccess(e){return this.getKeySystemSelectionPromise(e).then(({keySystem:t,mediaKeys:r})=>this.attemptSetMediaKeys(t,r))}selectKeySystem(e){return new Promise((t,r)=>this.getKeySystemSelectionPromise(e).then(({keySystem:i})=>{const s=Ol(i);s?t(s):r(new Error(`Unable to find format for key-system "${i}"`))}).catch(r))}selectKeySystemFormat(e){const t=Object.keys(e.levelkeys||{});return this.keyFormatPromise||(this.log(`Selecting key-system from fragment (sn: ${e.sn} ${e.type}: ${e.level}) key formats ${t.join(", ")}`),this.keyFormatPromise=this.getKeyFormatPromise(t)),this.keyFormatPromise}getKeyFormatPromise(e){const t=Va(this.config),r=e.map(lu).filter(i=>!!i&&t.indexOf(i)!==-1);return this.selectKeySystem(r)}loadKey(e){const t=e.keyInfo.decryptdata,r=this.getKeyIdString(t),i=`(keyId: ${r} format: "${t.keyFormat}" method: ${t.method} uri: ${t.uri})`;this.log(`Starting session for key ${i}`);let s=this.keyIdToKeySessionPromise[r];return s||(s=this.getKeySystemForKeyPromise(t).then(({keySystem:o,mediaKeys:l})=>(this.throwIfDestroyed(),this.log(`Handle encrypted media sn: ${e.frag.sn} ${e.frag.type}: ${e.frag.level} using key ${i}`),this.attemptSetMediaKeys(o,l).then(()=>(this.throwIfDestroyed(),this.createMediaKeySessionContext({keySystem:o,mediaKeys:l,decryptdata:t}))))),(this.keyIdToKeySessionPromise[r]=s.then(o=>{const l="cenc",u=t.pssh?t.pssh.buffer:null;return this.generateRequestWithPreferredKeySession(o,l,u,"playlist-key")})).catch(o=>this.handleError(o))),s}throwIfDestroyed(e="Invalid state"){if(!this.hls)throw new Error("invalid state")}handleError(e){this.hls&&(this.error(e.message),e instanceof dn?this.hls.trigger(S.ERROR,e.data):this.hls.trigger(S.ERROR,{type:re.KEY_SYSTEM_ERROR,details:O.KEY_SYSTEM_NO_KEYS,error:e,fatal:!0}))}getKeySystemForKeyPromise(e){const t=this.getKeyIdString(e),r=this.keyIdToKeySessionPromise[t];if(!r){const i=lu(e.keyFormat),s=i?[i]:Va(this.config);return this.attemptKeySystemAccess(s)}return r}getKeySystemSelectionPromise(e){if(e.length||(e=Va(this.config)),e.length===0)throw new dn({type:re.KEY_SYSTEM_ERROR,details:O.KEY_SYSTEM_NO_CONFIGURED_LICENSE,fatal:!0},`Missing key-system license configuration options ${Ve({drmSystems:this.config.drmSystems})}`);return this.attemptKeySystemAccess(e)}attemptSetMediaKeys(e,t){if(this.mediaKeys===t)return Promise.resolve();const r=this.setMediaKeysQueue.slice();this.log(`Setting media-keys for "${e}"`);const i=Promise.all(r).then(()=>{if(!this.media)throw this.mediaKeys=null,new Error("Attempted to set mediaKeys without media element attached");return this.media.setMediaKeys(t)});return this.mediaKeys=t,this.setMediaKeysQueue.push(i),i.then(()=>{this.log(`Media-keys set for "${e}"`),r.push(i),this.setMediaKeysQueue=this.setMediaKeysQueue.filter(s=>r.indexOf(s)===-1)})}generateRequestWithPreferredKeySession(e,t,r,i){var s,a;const o=(s=this.config.drmSystems)==null||(a=s[e.keySystem])==null?void 0:a.generateRequest;if(o)try{const g=o.call(this.hls,t,r,e);if(!g)throw new Error("Invalid response from configured generateRequest filter");t=g.initDataType,r=g.initData?g.initData:null,e.decryptdata.pssh=r?new Uint8Array(r):null}catch(g){var l;if(this.warn(g.message),(l=this.hls)!=null&&l.config.debug)throw g}if(r===null)return this.log(`Skipping key-session request for "${i}" (no initData)`),Promise.resolve(e);const u=this.getKeyIdString(e.decryptdata);this.log(`Generating key-session request for "${i}": ${u} (init data type: ${t} length: ${r?r.byteLength:null})`);const c=new Cg,d=e._onmessage=g=>{const m=e.mediaKeysSession;if(!m){c.emit("error",new Error("invalid state"));return}const{messageType:y,message:p}=g;this.log(`"${y}" message event for session "${m.sessionId}" message size: ${p.byteLength}`),y==="license-request"||y==="license-renewal"?this.renewLicense(e,p).catch(v=>{c.eventNames().length?c.emit("error",v):this.handleError(v)}):y==="license-release"?e.keySystem===we.FAIRPLAY&&(this.updateKeySession(e,Xh("acknowledged")),this.removeSession(e)):this.warn(`unhandled media key message type "${y}"`)},h=e._onkeystatuseschange=g=>{if(!e.mediaKeysSession){c.emit("error",new Error("invalid state"));return}this.onKeyStatusChange(e);const y=e.keyStatus;c.emit("keyStatus",y),y==="expired"&&(this.warn(`${e.keySystem} expired for key ${u}`),this.renewKeySession(e))};nn(e.mediaKeysSession,"message",d),nn(e.mediaKeysSession,"keystatuseschange",h);const f=new Promise((g,m)=>{c.on("error",m),c.on("keyStatus",y=>{y.startsWith("usable")?g():y==="output-restricted"?m(new dn({type:re.KEY_SYSTEM_ERROR,details:O.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED,fatal:!1},"HDCP level output restricted")):y==="internal-error"?m(new dn({type:re.KEY_SYSTEM_ERROR,details:O.KEY_SYSTEM_STATUS_INTERNAL_ERROR,fatal:!0},`key status changed to "${y}"`)):y==="expired"?m(new Error("key expired while generating request")):this.warn(`unhandled key status change "${y}"`)})});return e.mediaKeysSession.generateRequest(t,r).then(()=>{var g;this.log(`Request generated for key-session "${(g=e.mediaKeysSession)==null?void 0:g.sessionId}" keyId: ${u}`)}).catch(g=>{throw new dn({type:re.KEY_SYSTEM_ERROR,details:O.KEY_SYSTEM_NO_SESSION,error:g,fatal:!1},`Error generating key-session request: ${g}`)}).then(()=>f).catch(g=>{throw c.removeAllListeners(),this.removeSession(e),g}).then(()=>(c.removeAllListeners(),e))}onKeyStatusChange(e){e.mediaKeysSession.keyStatuses.forEach((t,r)=>{if(typeof r=="string"&&typeof t=="object"){const i=r;r=t,t=i}this.log(`key status change "${t}" for keyStatuses keyId: ${Kn.hexDump("buffer"in r?new Uint8Array(r.buffer,r.byteOffset,r.byteLength):new Uint8Array(r))} session keyId: ${Kn.hexDump(new Uint8Array(e.decryptdata.keyId||[]))} uri: ${e.decryptdata.uri}`),e.keyStatus=t})}fetchServerCertificate(e){const t=this.config,r=t.loader,i=new r(t),s=this.getServerCertificateUrl(e);return s?(this.log(`Fetching server certificate for "${e}"`),new Promise((a,o)=>{const l={responseType:"arraybuffer",url:s},u=t.certLoadPolicy.default,c={loadPolicy:u,timeout:u.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},d={onSuccess:(h,f,g,m)=>{a(h.data)},onError:(h,f,g,m)=>{o(new dn({type:re.KEY_SYSTEM_ERROR,details:O.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED,fatal:!0,networkDetails:g,response:Ce({url:l.url,data:void 0},h)},`"${e}" certificate request failed (${s}). Status: ${h.code} (${h.text})`))},onTimeout:(h,f,g)=>{o(new dn({type:re.KEY_SYSTEM_ERROR,details:O.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED,fatal:!0,networkDetails:g,response:{url:l.url,data:void 0}},`"${e}" certificate request timed out (${s})`))},onAbort:(h,f,g)=>{o(new Error("aborted"))}};i.load(l,c,d)})):Promise.resolve()}setMediaKeysServerCertificate(e,t,r){return new Promise((i,s)=>{e.setServerCertificate(r).then(a=>{this.log(`setServerCertificate ${a?"success":"not supported by CDM"} (${r==null?void 0:r.byteLength}) on "${t}"`),i(e)}).catch(a=>{s(new dn({type:re.KEY_SYSTEM_ERROR,details:O.KEY_SYSTEM_SERVER_CERTIFICATE_UPDATE_FAILED,error:a,fatal:!0},a.message))})})}renewLicense(e,t){return this.requestLicense(e,new Uint8Array(t)).then(r=>this.updateKeySession(e,new Uint8Array(r)).catch(i=>{throw new dn({type:re.KEY_SYSTEM_ERROR,details:O.KEY_SYSTEM_SESSION_UPDATE_FAILED,error:i,fatal:!0},i.message)}))}unpackPlayReadyKeyMessage(e,t){const r=String.fromCharCode.apply(null,new Uint16Array(t.buffer));if(!r.includes("PlayReadyKeyMessage"))return e.setRequestHeader("Content-Type","text/xml; charset=utf-8"),t;const i=new DOMParser().parseFromString(r,"application/xml"),s=i.querySelectorAll("HttpHeader");if(s.length>0){let c;for(let d=0,h=s.length;d<h;d++){var a,o;c=s[d];const f=(a=c.querySelector("name"))==null?void 0:a.textContent,g=(o=c.querySelector("value"))==null?void 0:o.textContent;f&&g&&e.setRequestHeader(f,g)}}const l=i.querySelector("Challenge"),u=l==null?void 0:l.textContent;if(!u)throw new Error("Cannot find <Challenge> in key message");return Xh(atob(u))}setupLicenseXHR(e,t,r,i){const s=this.config.licenseXhrSetup;return s?Promise.resolve().then(()=>{if(!r.decryptdata)throw new Error("Key removed");return s.call(this.hls,e,t,r,i)}).catch(a=>{if(!r.decryptdata)throw a;return e.open("POST",t,!0),s.call(this.hls,e,t,r,i)}).then(a=>(e.readyState||e.open("POST",t,!0),{xhr:e,licenseChallenge:a||i})):(e.open("POST",t,!0),Promise.resolve({xhr:e,licenseChallenge:i}))}requestLicense(e,t){const r=this.config.keyLoadPolicy.default;return new Promise((i,s)=>{const a=this.getLicenseServerUrlOrThrow(e.keySystem);this.log(`Sending license request to URL: ${a}`);const o=new XMLHttpRequest;o.responseType="arraybuffer",o.onreadystatechange=()=>{if(!this.hls||!e.mediaKeysSession)return s(new Error("invalid state"));if(o.readyState===4)if(o.status===200){this._requestLicenseFailureCount=0;let l=o.response;this.log(`License received ${l instanceof ArrayBuffer?l.byteLength:l}`);const u=this.config.licenseResponseCallback;if(u)try{l=u.call(this.hls,o,a,e)}catch(c){this.error(c)}i(l)}else{const l=r.errorRetry,u=l?l.maxNumRetry:0;if(this._requestLicenseFailureCount++,this._requestLicenseFailureCount>u||o.status>=400&&o.status<500)s(new dn({type:re.KEY_SYSTEM_ERROR,details:O.KEY_SYSTEM_LICENSE_REQUEST_FAILED,fatal:!0,networkDetails:o,response:{url:a,data:void 0,code:o.status,text:o.statusText}},`License Request XHR failed (${a}). Status: ${o.status} (${o.statusText})`));else{const c=u-this._requestLicenseFailureCount+1;this.warn(`Retrying license request, ${c} attempts left`),this.requestLicense(e,t).then(i,s)}}},e.licenseXhr&&e.licenseXhr.readyState!==XMLHttpRequest.DONE&&e.licenseXhr.abort(),e.licenseXhr=o,this.setupLicenseXHR(o,a,e,t).then(({xhr:l,licenseChallenge:u})=>{e.keySystem==we.PLAYREADY&&(u=this.unpackPlayReadyKeyMessage(l,u)),l.send(u)})})}onDestroying(){this.unregisterListeners(),this._clear()}onMediaAttached(e,t){if(!this.config.emeEnabled)return;const r=t.media;this.media=r,nn(r,"encrypted",this.onMediaEncrypted),nn(r,"waitingforkey",this.onWaitingForKey)}onMediaDetached(){const e=this.media;e&&(vn(e,"encrypted",this.onMediaEncrypted),vn(e,"waitingforkey",this.onWaitingForKey),this.media=null,this.mediaKeys=null)}_clear(){var e;if(this._requestLicenseFailureCount=0,this.keyIdToKeySessionPromise={},!this.mediaKeys&&!this.mediaKeySessions.length)return;const t=this.media,r=this.mediaKeySessions.slice();this.mediaKeySessions=[],this.mediaKeys=null,Co.clearKeyUriToKeyIdMap();const i=r.length;Ks.CDMCleanupPromise=Promise.all(r.map(s=>this.removeSession(s)).concat(t==null||(e=t.setMediaKeys(null))==null?void 0:e.catch(s=>{var a;this.log(`Could not clear media keys: ${s}`),(a=this.hls)==null||a.trigger(S.ERROR,{type:re.OTHER_ERROR,details:O.KEY_SYSTEM_DESTROY_MEDIA_KEYS_ERROR,fatal:!1,error:new Error(`Could not clear media keys: ${s}`)})}))).catch(s=>{var a;this.log(`Could not close sessions and clear media keys: ${s}`),(a=this.hls)==null||a.trigger(S.ERROR,{type:re.OTHER_ERROR,details:O.KEY_SYSTEM_DESTROY_CLOSE_SESSION_ERROR,fatal:!1,error:new Error(`Could not close sessions and clear media keys: ${s}`)})}).then(()=>{i&&this.log("finished closing key sessions and clearing media keys")})}onManifestLoading(){this.keyFormatPromise=null}onManifestLoaded(e,{sessionKeys:t}){if(!(!t||!this.config.emeEnabled)&&!this.keyFormatPromise){const r=t.reduce((i,s)=>(i.indexOf(s.keyFormat)===-1&&i.push(s.keyFormat),i),[]);this.log(`Selecting key-system from session-keys ${r.join(", ")}`),this.keyFormatPromise=this.getKeyFormatPromise(r)}}removeSession(e){const{mediaKeysSession:t,licenseXhr:r}=e;if(t){this.log(`Remove licenses and keys and close session ${t.sessionId}`),e._onmessage&&(t.removeEventListener("message",e._onmessage),e._onmessage=void 0),e._onkeystatuseschange&&(t.removeEventListener("keystatuseschange",e._onkeystatuseschange),e._onkeystatuseschange=void 0),r&&r.readyState!==XMLHttpRequest.DONE&&r.abort(),e.mediaKeysSession=e.decryptdata=e.licenseXhr=void 0;const i=this.mediaKeySessions.indexOf(e);i>-1&&this.mediaKeySessions.splice(i,1);const{drmSystemOptions:s}=this.config;return(Wb(s)?new Promise((o,l)=>{self.setTimeout(()=>l(new Error("MediaKeySession.remove() timeout")),8e3),t.remove().then(o)}):Promise.resolve()).catch(o=>{var l;this.log(`Could not remove session: ${o}`),(l=this.hls)==null||l.trigger(S.ERROR,{type:re.OTHER_ERROR,details:O.KEY_SYSTEM_DESTROY_REMOVE_SESSION_ERROR,fatal:!1,error:new Error(`Could not remove session: ${o}`)})}).then(()=>t.close()).catch(o=>{var l;this.log(`Could not close session: ${o}`),(l=this.hls)==null||l.trigger(S.ERROR,{type:re.OTHER_ERROR,details:O.KEY_SYSTEM_DESTROY_CLOSE_SESSION_ERROR,fatal:!1,error:new Error(`Could not close session: ${o}`)})})}}}Ks.CDMCleanupPromise=void 0;class dn extends Error{constructor(e,t){super(t),this.data=void 0,e.error||(e.error=new Error(t)),this.data=e,e.err=e.error}}class eO{constructor(e){this.hls=void 0,this.isVideoPlaybackQualityAvailable=!1,this.timer=void 0,this.media=null,this.lastTime=void 0,this.lastDroppedFrames=0,this.lastDecodedFrames=0,this.streamController=void 0,this.hls=e,this.registerListeners()}setStreamController(e){this.streamController=e}registerListeners(){this.hls.on(S.MEDIA_ATTACHING,this.onMediaAttaching,this),this.hls.on(S.MEDIA_DETACHING,this.onMediaDetaching,this)}unregisterListeners(){this.hls.off(S.MEDIA_ATTACHING,this.onMediaAttaching,this),this.hls.off(S.MEDIA_DETACHING,this.onMediaDetaching,this)}destroy(){this.timer&&clearInterval(this.timer),this.unregisterListeners(),this.isVideoPlaybackQualityAvailable=!1,this.media=null}onMediaAttaching(e,t){const r=this.hls.config;if(r.capLevelOnFPSDrop){const i=t.media instanceof self.HTMLVideoElement?t.media:null;this.media=i,i&&typeof i.getVideoPlaybackQuality=="function"&&(this.isVideoPlaybackQualityAvailable=!0),self.clearInterval(this.timer),this.timer=self.setInterval(this.checkFPSInterval.bind(this),r.fpsDroppedMonitoringPeriod)}}onMediaDetaching(){this.media=null}checkFPS(e,t,r){const i=performance.now();if(t){if(this.lastTime){const s=i-this.lastTime,a=r-this.lastDroppedFrames,o=t-this.lastDecodedFrames,l=1e3*a/s,u=this.hls;if(u.trigger(S.FPS_DROP,{currentDropped:a,currentDecoded:o,totalDroppedFrames:r}),l>0&&a>u.config.fpsDroppedMonitoringThreshold*o){let c=u.currentLevel;u.logger.warn("drop FPS ratio greater than max allowed value for currentLevel: "+c),c>0&&(u.autoLevelCapping===-1||u.autoLevelCapping>=c)&&(c=c-1,u.trigger(S.FPS_DROP_LEVEL_CAPPING,{level:c,droppedLevel:u.currentLevel}),u.autoLevelCapping=c,this.streamController.nextLevelSwitch())}}this.lastTime=i,this.lastDroppedFrames=r,this.lastDecodedFrames=t}}checkFPSInterval(){const e=this.media;if(e)if(this.isVideoPlaybackQualityAvailable){const t=e.getVideoPlaybackQuality();this.checkFPS(e,t.totalVideoFrames,t.droppedVideoFrames)}else this.checkFPS(e,e.webkitDecodedFrameCount,e.webkitDroppedFrameCount)}}function Hx(n,e){let t;try{t=new Event("addtrack")}catch{t=document.createEvent("Event"),t.initEvent("addtrack",!1,!1)}t.track=n,e.dispatchEvent(t)}function zx(n,e){const t=n.mode;if(t==="disabled"&&(n.mode="hidden"),n.cues&&!n.cues.getCueById(e.id))try{if(n.addCue(e),!n.cues.getCueById(e.id))throw new Error(`addCue is failed for: ${e}`)}catch(r){Ie.debug(`[texttrack-utils]: ${r}`);try{const i=new self.TextTrackCue(e.startTime,e.endTime,e.text);i.id=e.id,n.addCue(i)}catch(i){Ie.debug(`[texttrack-utils]: Legacy TextTrackCue fallback failed: ${i}`)}}t==="disabled"&&(n.mode=t)}function Os(n,e){const t=n.mode;if(t==="disabled"&&(n.mode="hidden"),n.cues)for(let r=n.cues.length;r--;)e&&n.cues[r].removeEventListener("enter",e),n.removeCue(n.cues[r]);t==="disabled"&&(n.mode=t)}function af(n,e,t,r){const i=n.mode;if(i==="disabled"&&(n.mode="hidden"),n.cues&&n.cues.length>0){const s=nO(n.cues,e,t);for(let a=0;a<s.length;a++)(!r||r(s[a]))&&n.removeCue(s[a])}i==="disabled"&&(n.mode=i)}function tO(n,e){if(e<=n[0].startTime)return 0;const t=n.length-1;if(e>n[t].endTime)return-1;let r=0,i=t,s;for(;r<=i;)if(s=Math.floor((i+r)/2),e<n[s].startTime)i=s-1;else if(e>n[s].startTime&&r<t)r=s+1;else return s;return n[r].startTime-e<e-n[i].startTime?r:i}function nO(n,e,t){const r=[],i=tO(n,e);if(i>-1)for(let s=i,a=n.length;s<a;s++){const o=n[s];if(o.startTime>=e&&o.endTime<=t)r.push(o);else if(o.startTime>t)return r}return r}function hu(n){const e=[];for(let t=0;t<n.length;t++){const r=n[t];(r.kind==="subtitles"||r.kind==="captions")&&r.label&&e.push(n[t])}return e}class rO extends Mg{constructor(e){super(e,"subtitle-track-controller"),this.media=null,this.tracks=[],this.groupIds=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0,this.queuedDefaultTrack=-1,this.useTextTrackPolling=!1,this.subtitlePollingInterval=-1,this._subtitleDisplay=!0,this.asyncPollTrackChange=()=>this.pollTrackChange(0),this.onTextTracksChanged=()=>{if(this.useTextTrackPolling||self.clearInterval(this.subtitlePollingInterval),!this.media||!this.hls.config.renderTextTracksNatively)return;let t=null;const r=hu(this.media.textTracks);for(let s=0;s<r.length;s++)if(r[s].mode==="hidden")t=r[s];else if(r[s].mode==="showing"){t=r[s];break}const i=this.findTrackForTextTrack(t);this.subtitleTrack!==i&&this.setSubtitleTrack(i)},this.registerListeners()}destroy(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.currentTrack=null,this.onTextTracksChanged=this.asyncPollTrackChange=null,super.destroy()}get subtitleDisplay(){return this._subtitleDisplay}set subtitleDisplay(e){this._subtitleDisplay=e,this.trackId>-1&&this.toggleTrackModes()}registerListeners(){const{hls:e}=this;e.on(S.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(S.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(S.MANIFEST_LOADING,this.onManifestLoading,this),e.on(S.MANIFEST_PARSED,this.onManifestParsed,this),e.on(S.LEVEL_LOADING,this.onLevelLoading,this),e.on(S.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(S.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.on(S.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e.off(S.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(S.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(S.MANIFEST_LOADING,this.onManifestLoading,this),e.off(S.MANIFEST_PARSED,this.onManifestParsed,this),e.off(S.LEVEL_LOADING,this.onLevelLoading,this),e.off(S.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(S.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.off(S.ERROR,this.onError,this)}onMediaAttached(e,t){this.media=t.media,this.media&&(this.queuedDefaultTrack>-1&&(this.subtitleTrack=this.queuedDefaultTrack,this.queuedDefaultTrack=-1),this.useTextTrackPolling=!(this.media.textTracks&&"onchange"in this.media.textTracks),this.useTextTrackPolling?this.pollTrackChange(500):this.media.textTracks.addEventListener("change",this.asyncPollTrackChange))}pollTrackChange(e){self.clearInterval(this.subtitlePollingInterval),this.subtitlePollingInterval=self.setInterval(this.onTextTracksChanged,e)}onMediaDetaching(e,t){const r=this.media;if(!r)return;const i=!!t.transferMedia;if(self.clearInterval(this.subtitlePollingInterval),this.useTextTrackPolling||r.textTracks.removeEventListener("change",this.asyncPollTrackChange),this.trackId>-1&&(this.queuedDefaultTrack=this.trackId),this.subtitleTrack=-1,this.media=null,i)return;hu(r.textTracks).forEach(a=>{Os(a)})}onManifestLoading(){this.tracks=[],this.groupIds=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0}onManifestParsed(e,t){this.tracks=t.subtitleTracks}onSubtitleTrackLoaded(e,t){const{id:r,groupId:i,details:s}=t,a=this.tracksInGroup[r];if(!a||a.groupId!==i){this.warn(`Subtitle track with id:${r} and group:${i} not found in active group ${a==null?void 0:a.groupId}`);return}const o=a.details;a.details=t.details,this.log(`Subtitle track ${r} "${a.name}" lang:${a.lang} group:${i} loaded [${s.startSN}-${s.endSN}]`),r===this.trackId&&this.playlistLoaded(r,t,o)}onLevelLoading(e,t){this.switchLevel(t.level)}onLevelSwitching(e,t){this.switchLevel(t.level)}switchLevel(e){const t=this.hls.levels[e];if(!t)return;const r=t.subtitleGroups||null,i=this.groupIds;let s=this.currentTrack;if(!r||(i==null?void 0:i.length)!==(r==null?void 0:r.length)||r!=null&&r.some(a=>(i==null?void 0:i.indexOf(a))===-1)){this.groupIds=r,this.trackId=-1,this.currentTrack=null;const a=this.tracks.filter(c=>!r||r.indexOf(c.groupId)!==-1);if(a.length)this.selectDefaultTrack&&!a.some(c=>c.default)&&(this.selectDefaultTrack=!1),a.forEach((c,d)=>{c.id=d});else if(!s&&!this.tracksInGroup.length)return;this.tracksInGroup=a;const o=this.hls.config.subtitlePreference;if(!s&&o){this.selectDefaultTrack=!1;const c=Zn(o,a);if(c>-1)s=a[c];else{const d=Zn(o,this.tracks);s=this.tracks[d]}}let l=this.findTrackId(s);l===-1&&s&&(l=this.findTrackId(null));const u={subtitleTracks:a};this.log(`Updating subtitle tracks, ${a.length} track(s) found in "${r==null?void 0:r.join(",")}" group-id`),this.hls.trigger(S.SUBTITLE_TRACKS_UPDATED,u),l!==-1&&this.trackId===-1&&this.setSubtitleTrack(l)}}findTrackId(e){const t=this.tracksInGroup,r=this.selectDefaultTrack;for(let i=0;i<t.length;i++){const s=t[i];if(!(r&&!s.default||!r&&!e)&&(!e||Wi(s,e)))return i}if(e){for(let i=0;i<t.length;i++){const s=t[i];if(Po(e.attrs,s.attrs,["LANGUAGE","ASSOC-LANGUAGE","CHARACTERISTICS"]))return i}for(let i=0;i<t.length;i++){const s=t[i];if(Po(e.attrs,s.attrs,["LANGUAGE"]))return i}}return-1}findTrackForTextTrack(e){if(e){const t=this.tracksInGroup;for(let r=0;r<t.length;r++){const i=t[r];if(nf(i,e))return r}}return-1}onError(e,t){t.fatal||!t.context||t.context.type===Se.SUBTITLE_TRACK&&t.context.id===this.trackId&&(!this.groupIds||this.groupIds.indexOf(t.context.groupId)!==-1)&&this.checkRetry(t)}get allSubtitleTracks(){return this.tracks}get subtitleTracks(){return this.tracksInGroup}get subtitleTrack(){return this.trackId}set subtitleTrack(e){this.selectDefaultTrack=!1,this.setSubtitleTrack(e)}setSubtitleOption(e){if(this.hls.config.subtitlePreference=e,e){if(e.id===-1)return this.setSubtitleTrack(-1),null;const t=this.allSubtitleTracks;if(this.selectDefaultTrack=!1,t.length){const r=this.currentTrack;if(r&&Wi(e,r))return r;const i=Zn(e,this.tracksInGroup);if(i>-1){const s=this.tracksInGroup[i];return this.setSubtitleTrack(i),s}else{if(r)return null;{const s=Zn(e,t);if(s>-1)return t[s]}}}}return null}loadPlaylist(e){super.loadPlaylist(),this.shouldLoadPlaylist(this.currentTrack)&&this.scheduleLoading(this.currentTrack,e)}loadingPlaylist(e,t){super.loadingPlaylist(e,t);const r=e.id,i=e.groupId,s=this.getUrlWithDirectives(e.url,t),a=e.details,o=a==null?void 0:a.age;this.log(`Loading subtitle ${r} "${e.name}" lang:${e.lang} group:${i}${(t==null?void 0:t.msn)!==void 0?" at sn "+t.msn+" part "+t.part:""}${o&&a.live?" age "+o.toFixed(1)+(a.type&&" "+a.type||""):""} ${s}`),this.hls.trigger(S.SUBTITLE_TRACK_LOADING,{url:s,id:r,groupId:i,deliveryDirectives:t||null,track:e})}toggleTrackModes(){const{media:e}=this;if(!e)return;const t=hu(e.textTracks),r=this.currentTrack;let i;if(r&&(i=t.filter(s=>nf(r,s))[0],i||this.warn(`Unable to find subtitle TextTrack with name "${r.name}" and language "${r.lang}"`)),[].slice.call(t).forEach(s=>{s.mode!=="disabled"&&s!==i&&(s.mode="disabled")}),i){const s=this.subtitleDisplay?"showing":"hidden";i.mode!==s&&(i.mode=s)}}setSubtitleTrack(e){const t=this.tracksInGroup;if(!this.media){this.queuedDefaultTrack=e;return}if(e<-1||e>=t.length||!Z(e)){this.warn(`Invalid subtitle track id: ${e}`);return}this.selectDefaultTrack=!1;const r=this.currentTrack,i=t[e]||null;if(this.trackId=e,this.currentTrack=i,this.toggleTrackModes(),!i){this.hls.trigger(S.SUBTITLE_TRACK_SWITCH,{id:e});return}const s=!!i.details&&!i.details.live;if(e===this.trackId&&i===r&&s)return;this.log(`Switching to subtitle-track ${e}`+(i?` "${i.name}" lang:${i.lang} group:${i.groupId}`:""));const{id:a,groupId:o="",name:l,type:u,url:c}=i;this.hls.trigger(S.SUBTITLE_TRACK_SWITCH,{id:a,groupId:o,name:l,type:u,url:c});const d=this.switchParams(i.url,r==null?void 0:r.details,i.details);this.loadPlaylist(d)}}function iO(){try{return crypto.randomUUID()}catch{try{const e=URL.createObjectURL(new Blob),t=e.toString();return URL.revokeObjectURL(e),t.slice(t.lastIndexOf("/")+1)}catch{let t=new Date().getTime();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,i=>{const s=(t+Math.random()*16)%16|0;return t=Math.floor(t/16),(i=="x"?s:s&3|8).toString(16)})}}}function io(n){let e=5381,t=n.length;for(;t;)e=e*33^n.charCodeAt(--t);return(e>>>0).toString()}const Vs=.025;let Zu=function(n){return n[n.Point=0]="Point",n[n.Range=1]="Range",n}({});function sO(n,e,t){return`${n.identifier}-${t+1}-${io(e)}`}class aO{constructor(e,t){this.base=void 0,this._duration=null,this._timelineStart=null,this.appendInPlaceDisabled=void 0,this.appendInPlaceStarted=void 0,this.dateRange=void 0,this.hasPlayed=!1,this.cumulativeDuration=0,this.resumeOffset=NaN,this.playoutLimit=NaN,this.restrictions={skip:!1,jump:!1},this.snapOptions={out:!1,in:!1},this.assetList=[],this.assetListLoader=void 0,this.assetListResponse=null,this.resumeAnchor=void 0,this.error=void 0,this.resetOnResume=void 0,this.base=t,this.dateRange=e,this.setDateRange(e)}setDateRange(e){this.dateRange=e,this.resumeOffset=e.attr.optionalFloat("X-RESUME-OFFSET",this.resumeOffset),this.playoutLimit=e.attr.optionalFloat("X-PLAYOUT-LIMIT",this.playoutLimit),this.restrictions=e.attr.enumeratedStringList("X-RESTRICT",this.restrictions),this.snapOptions=e.attr.enumeratedStringList("X-SNAP",this.snapOptions)}reset(){var e;this.appendInPlaceStarted=!1,(e=this.assetListLoader)==null||e.destroy(),this.assetListLoader=void 0,this.supplementsPrimary||(this.assetListResponse=null,this.assetList=[],this._duration=null)}isAssetPastPlayoutLimit(e){var t;if(e>0&&e>=this.assetList.length)return!0;const r=this.playoutLimit;return e<=0||isNaN(r)?!1:r===0?!0:(((t=this.assetList[e])==null?void 0:t.startOffset)||0)>r}findAssetIndex(e){return this.assetList.indexOf(e)}get identifier(){return this.dateRange.id}get startDate(){return this.dateRange.startDate}get startTime(){const e=this.dateRange.startTime;if(this.snapOptions.out){const t=this.dateRange.tagAnchor;if(t)return Dd(e,t)}return e}get startOffset(){return this.cue.pre?0:this.startTime}get startIsAligned(){if(this.startTime===0||this.snapOptions.out)return!0;const e=this.dateRange.tagAnchor;if(e){const t=this.dateRange.startTime,r=Dd(t,e);return t-r<.1}return!1}get resumptionOffset(){const e=this.resumeOffset,t=Z(e)?e:this.duration;return this.cumulativeDuration+t}get resumeTime(){const e=this.startOffset+this.resumptionOffset;if(this.snapOptions.in){const t=this.resumeAnchor;if(t)return Dd(e,t)}return e}get appendInPlace(){return this.appendInPlaceStarted?!0:this.appendInPlaceDisabled?!1:!!(!this.cue.once&&!this.cue.pre&&this.startIsAligned&&(isNaN(this.playoutLimit)&&isNaN(this.resumeOffset)||this.resumeOffset&&this.duration&&Math.abs(this.resumeOffset-this.duration)<Vs))}set appendInPlace(e){if(this.appendInPlaceStarted){this.resetOnResume=!e;return}this.appendInPlaceDisabled=!e}get timelineStart(){return this._timelineStart!==null?this._timelineStart:this.startTime}set timelineStart(e){this._timelineStart=e}get duration(){const e=this.playoutLimit;let t;return this._duration!==null?t=this._duration:this.dateRange.duration?t=this.dateRange.duration:t=this.dateRange.plannedDuration||0,!isNaN(e)&&e<t&&(t=e),t}set duration(e){this._duration=e}get cue(){return this.dateRange.cue}get timelineOccupancy(){return this.dateRange.attr["X-TIMELINE-OCCUPIES"]==="RANGE"?Zu.Range:Zu.Point}get supplementsPrimary(){return this.dateRange.attr["X-TIMELINE-STYLE"]==="PRIMARY"}get contentMayVary(){return this.dateRange.attr["X-CONTENT-MAY-VARY"]!=="NO"}get assetUrl(){return this.dateRange.attr["X-ASSET-URI"]}get assetListUrl(){return this.dateRange.attr["X-ASSET-LIST"]}get baseUrl(){return this.base.url}get assetListLoaded(){return this.assetList.length>0||this.assetListResponse!==null}toString(){return oO(this)}}function Dd(n,e){return n-e.start<e.duration/2&&!(Math.abs(n-(e.start+e.duration))<Vs)?e.start:e.start+e.duration}function Wx(n,e,t){const r=new self.URL(n,t);return r.protocol!=="data:"&&r.searchParams.set("_HLS_primary_id",e),r}function Cd(n,e){for(;(t=n.assetList[++e])!=null&&t.error;)var t;return e}function oO(n){return`["${n.identifier}" ${n.cue.pre?"<pre>":n.cue.post?"<post>":""}${n.timelineStart.toFixed(2)}-${n.resumeTime.toFixed(2)}]`}function vs(n){const e=n.timelineStart,t=n.duration||0;return`["${n.identifier}" ${e.toFixed(2)}-${(e+t).toFixed(2)}]`}class lO{constructor(e,t,r,i){this.hls=void 0,this.interstitial=void 0,this.assetItem=void 0,this.tracks=null,this.hasDetails=!1,this.mediaAttached=null,this._currentTime=void 0,this._bufferedEosTime=void 0,this.checkPlayout=()=>{this.reachedPlayout(this.currentTime)&&this.hls.trigger(S.PLAYOUT_LIMIT_REACHED,{})};const s=this.hls=new e(t);this.interstitial=r,this.assetItem=i;let a=i.uri;try{a=Wx(a,t.primarySessionId).href}catch{}s.loadSource(a);const o=()=>{this.hasDetails=!0};s.once(S.LEVEL_LOADED,o),s.once(S.AUDIO_TRACK_LOADED,o),s.once(S.SUBTITLE_TRACK_LOADED,o),s.on(S.MEDIA_ATTACHING,(l,{media:u})=>{this.removeMediaListeners(),this.mediaAttached=u,this.interstitial.playoutLimit&&(u.addEventListener("timeupdate",this.checkPlayout),this.appendInPlace&&s.on(S.BUFFER_APPENDED,()=>{const d=this.bufferedEnd;this.reachedPlayout(d)&&(this._bufferedEosTime=d,s.trigger(S.BUFFERED_TO_END,void 0))}))})}get appendInPlace(){var e;return((e=this.interstitial)==null?void 0:e.appendInPlace)||!1}bufferedInPlaceToEnd(e){var t;if(!this.appendInPlace)return!1;if((t=this.hls)!=null&&t.bufferedToEnd)return!0;if(!e||!this._bufferedEosTime)return!1;const r=this.timelineOffset,i=ge.bufferInfo(e,r,0);return this.getAssetTime(i.end)>=this._bufferedEosTime-.02}reachedPlayout(e){const r=this.interstitial.playoutLimit;return this.startOffset+e>=r}get destroyed(){var e;return!((e=this.hls)!=null&&e.userConfig)}get assetId(){return this.assetItem.identifier}get interstitialId(){return this.assetItem.parentIdentifier}get media(){var e;return((e=this.hls)==null?void 0:e.media)||null}get bufferedEnd(){const e=this.media||this.mediaAttached;if(!e)return this._bufferedEosTime?this._bufferedEosTime:this.currentTime;const t=ge.bufferInfo(e,e.currentTime,.001);return this.getAssetTime(t.end)}get currentTime(){const e=this.media||this.mediaAttached;return e?this.getAssetTime(e.currentTime):this._currentTime||0}get duration(){const e=this.assetItem.duration;return e||0}get remaining(){const e=this.duration;return e?Math.max(0,e-this.currentTime):0}get startOffset(){return this.assetItem.startOffset}get timelineOffset(){var e;return((e=this.hls)==null?void 0:e.config.timelineOffset)||0}set timelineOffset(e){const t=this.timelineOffset;if(e!==t){const r=e-t;if(Math.abs(r)>1/9e4){if(this.hasDetails)throw new Error("Cannot set timelineOffset after playlists are loaded");this.hls.config.timelineOffset=e}}}getAssetTime(e){const t=this.timelineOffset,r=this.duration;return Math.min(Math.max(0,e-t),r)}removeMediaListeners(){const e=this.mediaAttached;e&&(this._currentTime=e.currentTime,this.bufferSnapShot(),e.removeEventListener("timeupdate",this.checkPlayout))}bufferSnapShot(){if(this.mediaAttached){var e;(e=this.hls)!=null&&e.bufferedToEnd&&(this._bufferedEosTime=this.bufferedEnd)}}destroy(){this.removeMediaListeners(),this.hls.destroy(),this.hls=this.interstitial=null,this.tracks=this.mediaAttached=this.checkPlayout=null}attachMedia(e){this.hls.attachMedia(e)}detachMedia(){this.removeMediaListeners(),this.mediaAttached=null,this.hls.detachMedia()}resumeBuffering(){this.hls.resumeBuffering()}pauseBuffering(){this.hls.pauseBuffering()}transferMedia(){return this.bufferSnapShot(),this.hls.transferMedia()}resetDetails(){const e=this.hls;if(this.hasDetails){e.stopLoad();const t=r=>delete r.details;e.levels.forEach(t),e.allAudioTracks.forEach(t),e.allSubtitleTracks.forEach(t),this.hasDetails=!1}}on(e,t,r){this.hls.on(e,t)}once(e,t,r){this.hls.once(e,t)}off(e,t,r){this.hls.off(e,t)}toString(){var e;return`HlsAssetPlayer: ${vs(this.assetItem)} ${(e=this.hls)==null?void 0:e.sessionId} ${this.appendInPlace?"append-in-place":""}`}}const J0=.033;class uO extends kr{constructor(e,t){super("interstitials-sched",t),this.onScheduleUpdate=void 0,this.eventMap={},this.events=null,this.items=null,this.durations={primary:0,playout:0,integrated:0},this.onScheduleUpdate=e}destroy(){this.reset(),this.onScheduleUpdate=null}reset(){this.eventMap={},this.setDurations(0,0,0),this.events&&this.events.forEach(e=>e.reset()),this.events=this.items=null}resetErrorsInRange(e,t){return this.events?this.events.reduce((r,i)=>e<=i.startOffset&&t>i.startOffset?(delete i.error,r+1):r,0):0}get duration(){const e=this.items;return e?e[e.length-1].end:0}get length(){return this.items?this.items.length:0}getEvent(e){return e&&this.eventMap[e]||null}hasEvent(e){return e in this.eventMap}findItemIndex(e,t){if(e.event)return this.findEventIndex(e.event.identifier);let r=-1;e.nextEvent?r=this.findEventIndex(e.nextEvent.identifier)-1:e.previousEvent&&(r=this.findEventIndex(e.previousEvent.identifier)+1);const i=this.items;if(i)for(i[r]||(t===void 0&&(t=e.start),r=this.findItemIndexAtTime(t));r>=0&&(s=i[r])!=null&&s.event;){var s;r--}return r}findItemIndexAtTime(e,t){const r=this.items;if(r)for(let i=0;i<r.length;i++){let s=r[i];if(t&&t!=="primary"&&(s=s[t]),e===s.start||e>s.start&&e<s.end)return i}return-1}findJumpRestrictedIndex(e,t){const r=this.items;if(r)for(let i=e;i<=t&&r[i];i++){const s=r[i].event;if(s!=null&&s.restrictions.jump&&!s.appendInPlace)return i}return-1}findEventIndex(e){const t=this.items;if(t)for(let i=t.length;i--;){var r;if(((r=t[i].event)==null?void 0:r.identifier)===e)return i}return-1}findAssetIndex(e,t){const r=e.assetList,i=r.length;if(i>1)for(let s=0;s<i;s++){const a=r[s];if(!a.error){const o=a.timelineStart;if(t===o||t>o&&t<o+(a.duration||0))return s}}return 0}get assetIdAtEnd(){var e,t;const r=(e=this.items)==null||(t=e[this.length-1])==null?void 0:t.event;if(r){const i=r.assetList,s=i[i.length-1];if(s)return s.identifier}return null}parseInterstitialDateRanges(e,t){const r=e.main.details,{dateRanges:i}=r,s=this.events,a=this.parseDateRanges(i,{url:r.url},t),o=Object.keys(i),l=s?s.filter(u=>!o.includes(u.identifier)):[];a.length&&a.sort((u,c)=>{const d=u.cue.pre,h=u.cue.post,f=c.cue.pre,g=c.cue.post;if(d&&!f)return-1;if(f&&!d||h&&!g)return 1;if(g&&!h)return-1;if(!d&&!f&&!h&&!g){const m=u.startTime,y=c.startTime;if(m!==y)return m-y}return u.dateRange.tagOrder-c.dateRange.tagOrder}),this.events=a,l.forEach(u=>{this.removeEvent(u)}),this.updateSchedule(e,l)}updateSchedule(e,t=[]){const r=this.events||[];if(r.length||t.length||this.length<2){const i=this.items,s=this.parseSchedule(r,e);(t.length||(i==null?void 0:i.length)!==s.length||s.some((o,l)=>Math.abs(o.playout.start-i[l].playout.start)>.005||Math.abs(o.playout.end-i[l].playout.end)>.005))&&(this.items=s,this.onScheduleUpdate(t,i))}}parseDateRanges(e,t,r){const i=[],s=Object.keys(e);for(let a=0;a<s.length;a++){const o=s[a],l=e[o];if(l.isInterstitial){let u=this.eventMap[o];u?u.setDateRange(l):(u=new aO(l,t),this.eventMap[o]=u,r===!1&&(u.appendInPlace=r)),i.push(u)}}return i}parseSchedule(e,t){const r=[],i=t.main.details,s=i.live?1/0:i.edge;let a=0;if(e=e.filter(l=>!l.error&&!(l.cue.once&&l.hasPlayed)),e.length){this.resolveOffsets(e,t);let l=0,u=0;if(e.forEach((c,d)=>{const h=c.cue.pre,f=c.cue.post,g=e[d-1]||null,m=c.appendInPlace,y=f?s:c.startOffset,p=c.duration,v=c.timelineOccupancy===Zu.Range?p:0,E=c.resumptionOffset,T=(g==null?void 0:g.startTime)===y,A=y+c.cumulativeDuration;let I=m?A+p:y+E;if(h||!f&&y<=0){const x=u;u+=v,c.timelineStart=A;const D=a;a+=p,r.push({event:c,start:A,end:I,playout:{start:D,end:a},integrated:{start:x,end:u}})}else if(y<=s){if(!T){const _=y-l;if(_>J0){const M=l,j=u;u+=_;const z=a;a+=_;const H={previousEvent:e[d-1]||null,nextEvent:c,start:M,end:M+_,playout:{start:z,end:a},integrated:{start:j,end:u}};r.push(H)}else _>0&&g&&(g.cumulativeDuration+=_,r[r.length-1].end=y)}f&&(I=A),c.timelineStart=A;const x=u;u+=v;const D=a;a+=p,r.push({event:c,start:A,end:I,playout:{start:D,end:a},integrated:{start:x,end:u}})}else return;const R=c.resumeTime;f||R>s?l=s:l=R}),l<s){var o;const c=l,d=u,h=s-l;u+=h;const f=a;a+=h,r.push({previousEvent:((o=r[r.length-1])==null?void 0:o.event)||null,nextEvent:null,start:l,end:c+h,playout:{start:f,end:a},integrated:{start:d,end:u}})}this.setDurations(s,a,u)}else r.push({previousEvent:null,nextEvent:null,start:0,end:s,playout:{start:0,end:s},integrated:{start:0,end:s}}),this.setDurations(s,s,s);return r}setDurations(e,t,r){this.durations={primary:e,playout:t,integrated:r}}resolveOffsets(e,t){const r=t.main.details,i=r.live?1/0:r.edge;let s=0,a=-1;e.forEach((o,l)=>{const u=o.cue.pre,c=o.cue.post,d=u?0:c?i:o.startTime;this.updateAssetDurations(o),a===d?o.cumulativeDuration=s:(s=0,a=d),!c&&o.snapOptions.in&&(o.resumeAnchor=rs(null,r.fragments,o.startOffset+o.resumptionOffset,0,0)||void 0),o.appendInPlace&&!o.appendInPlaceStarted&&(this.primaryCanResumeInPlaceAt(o,t)||(o.appendInPlace=!1)),!o.appendInPlace&&l+1<e.length&&e[l+1].startTime-e[l].resumeTime<J0&&(e[l+1].appendInPlace=!1,e[l+1].appendInPlace&&this.warn(`Could not change append strategy for abutting event ${o}`));const f=Z(o.resumeOffset)?o.resumeOffset:o.duration;s+=f})}primaryCanResumeInPlaceAt(e,t){const r=e.resumeTime,i=e.startTime+e.resumptionOffset;return Math.abs(r-i)>Vs?(this.log(`"${e.identifier}" resumption ${r} not aligned with estimated timeline end ${i}`),!1):t?!Object.keys(t).some(a=>{const o=t[a].details,l=o.edge;if(r>=l)return this.log(`"${e.identifier}" resumption ${r} past ${a} playlist end ${l}`),!1;const u=rs(null,o.fragments,r);if(!u)return this.log(`"${e.identifier}" resumption ${r} does not align with any fragments in ${a} playlist (${o.fragStart}-${o.fragmentEnd})`),!0;const c=a==="audio"?.175:0;return Math.abs(u.start-r)<Vs+c||Math.abs(u.end-r)<Vs+c?!1:(this.log(`"${e.identifier}" resumption ${r} not aligned with ${a} fragment bounds (${u.start}-${u.end} sn: ${u.sn} cc: ${u.cc})`),!0)}):(this.log(`"${e.identifier}" resumption ${r} can not be aligned with media (none selected)`),!1)}updateAssetDurations(e){if(!e.assetListLoaded)return;const t=e.timelineStart;let r=0,i=!1,s=!1;e.assetList.forEach((a,o)=>{const l=t+r;a.startOffset=r,a.timelineStart=l,i||(i=a.duration===null),s||(s=!!a.error);const u=a.error?0:a.duration||0;r+=u}),i&&!s?e.duration=Math.max(r,e.duration):e.duration=r}removeEvent(e){e.reset(),delete this.eventMap[e.identifier]}}function Ur(n){return`[${n.event?'"'+n.event.identifier+'"':"primary"}: ${n.start.toFixed(2)}-${n.end.toFixed(2)}]`}class cO{constructor(e){this.hls=void 0,this.hls=e}destroy(){this.hls=null}loadAssetList(e,t){const r=e.assetListUrl;let i;try{i=Wx(r,this.hls.sessionId,e.baseUrl)}catch(h){const f=this.assignAssetListError(e,O.ASSET_LIST_LOAD_ERROR,h,r);this.hls.trigger(S.ERROR,f);return}t&&i.protocol!=="data:"&&i.searchParams.set("_HLS_start_offset",""+t);const s=this.hls.config,a=s.loader,o=new a(s),l={responseType:"json",url:i.href},u=s.interstitialAssetListLoadPolicy.default,c={loadPolicy:u,timeout:u.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},d={onSuccess:(h,f,g,m)=>{const y=h.data,p=y==null?void 0:y.ASSETS;if(!Array.isArray(p)){const v=this.assignAssetListError(e,O.ASSET_LIST_PARSING_ERROR,new Error("Invalid interstitial asset list"),g.url,f,m);this.hls.trigger(S.ERROR,v);return}e.assetListResponse=y,this.hls.trigger(S.ASSET_LIST_LOADED,{event:e,assetListResponse:y,networkDetails:m})},onError:(h,f,g,m)=>{const y=this.assignAssetListError(e,O.ASSET_LIST_LOAD_ERROR,new Error(`Error loading X-ASSET-LIST: HTTP status ${h.code} ${h.text} (${f.url})`),f.url,m,g);this.hls.trigger(S.ERROR,y)},onTimeout:(h,f,g)=>{const m=this.assignAssetListError(e,O.ASSET_LIST_LOAD_TIMEOUT,new Error(`Timeout loading X-ASSET-LIST (${f.url})`),f.url,h,g);this.hls.trigger(S.ERROR,m)}};return o.load(l,c,d),this.hls.trigger(S.ASSET_LIST_LOADING,{event:e}),o}assignAssetListError(e,t,r,i,s,a){return e.error=r,{type:re.NETWORK_ERROR,details:t,fatal:!1,interstitial:e,url:i,error:r,networkDetails:a,stats:s}}}function ey(n){n==null||n.play().catch(()=>{})}class dO extends kr{constructor(e,t){super("interstitials",e.logger),this.HlsPlayerClass=void 0,this.hls=void 0,this.assetListLoader=void 0,this.mediaSelection=null,this.altSelection=null,this.media=null,this.detachedData=null,this.requiredTracks=null,this.manager=null,this.playerQueue=[],this.bufferedPos=-1,this.timelinePos=-1,this.schedule=void 0,this.playingItem=null,this.bufferingItem=null,this.waitingItem=null,this.endedItem=null,this.playingAsset=null,this.endedAsset=null,this.bufferingAsset=null,this.shouldPlay=!1,this.onPlay=()=>{this.shouldPlay=!0},this.onPause=()=>{this.shouldPlay=!1},this.onSeeking=()=>{const r=this.currentTime;if(r===void 0||this.playbackDisabled)return;const i=r-this.timelinePos;if(Math.abs(i)<1/7056e5)return;const a=i<=-.01;this.timelinePos=r,this.bufferedPos=r;const o=this.playingItem;if(!o){this.checkBuffer();return}if(a&&this.schedule.resetErrorsInRange(r,r-i)&&this.updateSchedule(),this.checkBuffer(),a&&r<o.start||r>=o.end){var l;const h=this.schedule.findItemIndexAtTime(this.timelinePos);if(!this.isInterstitial(o)&&(l=this.media)!=null&&l.paused&&(this.shouldPlay=!1),!a){const f=this.findItemIndex(o);if(h>f){const g=this.schedule.findJumpRestrictedIndex(f+1,h);if(g>f){this.setSchedulePosition(g);return}}}this.setSchedulePosition(h);return}const u=this.playingAsset;if(!u){if(this.playingLastItem&&this.isInterstitial(o)){const h=o.event.assetList[0];h&&(this.endedItem=this.playingItem,this.playingItem=null,this.setScheduleToAssetAtTime(r,h))}return}const c=u.timelineStart,d=u.duration||0;(a&&r<c||r>=c+d)&&this.setScheduleToAssetAtTime(r,u)},this.onTimeupdate=()=>{const r=this.currentTime;if(r===void 0||this.playbackDisabled)return;if(r>this.timelinePos)this.timelinePos=r,r>this.bufferedPos&&this.checkBuffer();else return;const i=this.playingItem;if(!i||this.playingLastItem)return;if(r>=i.end){this.timelinePos=i.end;const o=this.findItemIndex(i);this.setSchedulePosition(o+1)}const s=this.playingAsset;if(!s)return;const a=s.timelineStart+(s.duration||0);r>=a&&this.setScheduleToAssetAtTime(r,s)},this.onScheduleUpdate=(r,i)=>{const s=this.schedule,a=this.playingItem,o=s.events||[],l=s.items||[],u=s.durations,c=r.map(g=>g.identifier),d=!!(o.length||c.length);(d||i)&&this.log(`INTERSTITIALS_UPDATED (${o.length}): ${o}
Schedule: ${l.map(g=>Ur(g))} pos: ${this.timelinePos}`),c.length&&this.log(`Removed events ${c}`),this.playerQueue.forEach(g=>{if(g.interstitial.appendInPlace){const m=g.assetItem.timelineStart,y=g.timelineOffset-m;if(y)try{g.timelineOffset=m}catch(p){Math.abs(y)>Vs&&this.warn(`${p} ("${g.assetId}" ${g.timelineOffset}->${m})`)}}});let h=null;if(a){const g=this.updateItem(a,this.timelinePos);this.itemsMatch(a,g)&&(this.playingItem=g,this.waitingItem=this.endedItem=null,h=()=>this.trimInPlace(g,a))}else this.waitingItem=this.updateItem(this.waitingItem),this.endedItem=this.updateItem(this.endedItem);const f=this.bufferingItem;if(f){const g=this.updateItem(f,this.bufferedPos);this.itemsMatch(f,g)?(this.bufferingItem=g,h||(h=()=>this.trimInPlace(g,f))):f.event&&(this.bufferingItem=this.playingItem,this.clearInterstitial(f.event,null))}if(r.forEach(g=>{g.assetList.forEach(m=>{this.clearAssetPlayer(m.identifier,null)})}),d||i){if(this.hls.trigger(S.INTERSTITIALS_UPDATED,{events:o.slice(0),schedule:l.slice(0),durations:u,removedIds:c}),this.isInterstitial(a)&&c.includes(a.event.identifier)){this.warn(`Interstitial "${a.event.identifier}" removed while playing`),this.primaryFallback(a.event);return}h&&h(),this.checkBuffer()}},this.hls=e,this.HlsPlayerClass=t,this.assetListLoader=new cO(e),this.schedule=new uO(this.onScheduleUpdate,e.logger),this.registerListeners()}registerListeners(){const e=this.hls;e.on(S.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(S.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(S.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(S.MANIFEST_LOADING,this.onManifestLoading,this),e.on(S.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(S.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.on(S.AUDIO_TRACK_UPDATED,this.onAudioTrackUpdated,this),e.on(S.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.on(S.SUBTITLE_TRACK_UPDATED,this.onSubtitleTrackUpdated,this),e.on(S.EVENT_CUE_ENTER,this.onInterstitialCueEnter,this),e.on(S.ASSET_LIST_LOADED,this.onAssetListLoaded,this),e.on(S.BUFFER_APPENDED,this.onBufferAppended,this),e.on(S.BUFFER_FLUSHED,this.onBufferFlushed,this),e.on(S.BUFFERED_TO_END,this.onBufferedToEnd,this),e.on(S.MEDIA_ENDED,this.onMediaEnded,this),e.on(S.ERROR,this.onError,this),e.on(S.DESTROYING,this.onDestroying,this)}unregisterListeners(){const e=this.hls;e&&(e.off(S.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(S.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(S.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(S.MANIFEST_LOADING,this.onManifestLoading,this),e.off(S.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(S.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.off(S.AUDIO_TRACK_UPDATED,this.onAudioTrackUpdated,this),e.off(S.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.off(S.SUBTITLE_TRACK_UPDATED,this.onSubtitleTrackUpdated,this),e.off(S.EVENT_CUE_ENTER,this.onInterstitialCueEnter,this),e.off(S.ASSET_LIST_LOADED,this.onAssetListLoaded,this),e.off(S.BUFFER_CODECS,this.onBufferCodecs,this),e.off(S.BUFFER_APPENDED,this.onBufferAppended,this),e.off(S.BUFFER_FLUSHED,this.onBufferFlushed,this),e.off(S.BUFFERED_TO_END,this.onBufferedToEnd,this),e.off(S.MEDIA_ENDED,this.onMediaEnded,this),e.off(S.ERROR,this.onError,this),e.off(S.DESTROYING,this.onDestroying,this))}startLoad(){this.resumeBuffering()}stopLoad(){this.pauseBuffering()}resumeBuffering(){var e;(e=this.getBufferingPlayer())==null||e.resumeBuffering()}pauseBuffering(){var e;(e=this.getBufferingPlayer())==null||e.pauseBuffering()}destroy(){this.unregisterListeners(),this.stopLoad(),this.assetListLoader&&this.assetListLoader.destroy(),this.emptyPlayerQueue(),this.clearScheduleState(),this.schedule&&this.schedule.destroy(),this.media=this.detachedData=this.mediaSelection=this.requiredTracks=this.altSelection=this.manager=null,this.hls=this.HlsPlayerClass=this.schedule=this.log=null,this.assetListLoader=null,this.onPlay=this.onPause=this.onSeeking=this.onTimeupdate=null,this.onScheduleUpdate=null}onDestroying(){const e=this.primaryMedia||this.media;e&&this.removeMediaListeners(e)}removeMediaListeners(e){vn(e,"play",this.onPlay),vn(e,"pause",this.onPause),vn(e,"seeking",this.onSeeking),vn(e,"timeupdate",this.onTimeupdate)}onMediaAttaching(e,t){const r=this.media=t.media;nn(r,"seeking",this.onSeeking),nn(r,"timeupdate",this.onTimeupdate),nn(r,"play",this.onPlay),nn(r,"pause",this.onPause)}onMediaAttached(e,t){const r=this.effectivePlayingItem,i=this.detachedData;if(this.detachedData=null,r===null)this.checkStart();else if(!i){this.clearScheduleState();const s=this.findItemIndex(r);this.setSchedulePosition(s)}}clearScheduleState(){this.playingItem=this.bufferingItem=this.waitingItem=this.endedItem=this.playingAsset=this.endedAsset=this.bufferingAsset=null}onMediaDetaching(e,t){const r=!!t.transferMedia,i=this.media;if(this.media=null,!r&&(i&&this.removeMediaListeners(i),this.detachedData)){const s=this.getBufferingPlayer();s&&(this.playingAsset=this.endedAsset=this.bufferingAsset=this.bufferingItem=this.waitingItem=this.detachedData=null,s.detachMedia()),this.shouldPlay=!1}}get interstitialsManager(){if(!this.manager){if(!this.hls)return null;const e=this,t=()=>e.bufferingItem||e.waitingItem,r=d=>d&&e.getAssetPlayer(d.identifier),i=(d,h,f,g,m)=>{if(d){let y=d[h].start;const p=d.event;if(p){if(h==="playout"||p.timelineOccupancy!==Zu.Point){const v=r(f);(v==null?void 0:v.interstitial)===p&&(y+=v.assetItem.startOffset+v[m])}}else{const v=g==="bufferedPos"?a():e[g];y+=v-d.start}return y}return 0},s=(d,h)=>{if(d!==0&&h!=="primary"&&e.schedule.length){var f;const g=e.schedule.findItemIndexAtTime(d),m=(f=e.schedule.items)==null?void 0:f[g];if(m){const y=m[h].start-m.start;return d+y}}return d},a=()=>{const d=e.bufferedPos;return d===Number.MAX_VALUE?o("primary"):Math.max(d,0)},o=d=>{var h;return(h=e.primaryDetails)!=null&&h.live?e.primaryDetails.edge:e.schedule.durations[d]},l=(d,h)=>{var f,g;const m=e.effectivePlayingItem;if(m!=null&&(f=m.event)!=null&&f.restrictions.skip)return;e.log(`seek to ${d} "${h}"`);const y=e.effectivePlayingItem,p=e.schedule.findItemIndexAtTime(d,h),v=(g=e.schedule.items)==null?void 0:g[p],E=e.getBufferingPlayer(),T=E==null?void 0:E.interstitial,A=T==null?void 0:T.appendInPlace,I=y&&e.itemsMatch(y,v);if(y&&(A||I)){const x=r(e.playingAsset),D=(x==null?void 0:x.media)||e.primaryMedia;if(D){const _=h==="primary"?D.currentTime:i(y,h,e.playingAsset,"timelinePos","currentTime"),M=d-_,j=(A?_:D.currentTime)+M;if(j>=0&&(!x||A||j<=x.duration)){D.currentTime=j;return}}}if(v){let x=d;if(h!=="primary"){const _=v[h].start,M=d-_;x=v.start+M}const D=!e.isInterstitial(v);if((!e.isInterstitial(y)||y.event.appendInPlace)&&(D||v.event.appendInPlace)){const _=e.media||(A?E==null?void 0:E.media:null);_&&(_.currentTime=x)}else if(y){const _=e.findItemIndex(y);if(p>_){const j=e.schedule.findJumpRestrictedIndex(_+1,p);if(j>_){e.setSchedulePosition(j);return}}let M=0;if(D)e.timelinePos=x,e.checkBuffer();else{var R;const j=v==null||(R=v.event)==null?void 0:R.assetList;if(j){const z=d-(v[h]||v).start;for(let H=j.length;H--;){const W=j[H];if(W.duration&&z>=W.startOffset&&z<W.startOffset+W.duration){M=H;break}}}}e.setSchedulePosition(p,M)}}},u=()=>{const d=e.effectivePlayingItem;if(e.isInterstitial(d))return d;const h=t();return e.isInterstitial(h)?h:null},c={get currentTime(){const d=u(),h=e.effectivePlayingItem;return h&&h===d?i(h,"playout",e.effectivePlayingAsset,"timelinePos","currentTime")-h.playout.start:0},set currentTime(d){const h=u(),f=e.effectivePlayingItem;f&&f===h&&l(d+f.playout.start,"playout")},get duration(){const d=u();return d?d.playout.end-d.playout.start:0},get assetPlayers(){var d;const h=(d=u())==null?void 0:d.event.assetList;return h?h.map(f=>e.getAssetPlayer(f.identifier)):[]},get playingIndex(){var d;const h=(d=u())==null?void 0:d.event;return h&&e.effectivePlayingAsset?h.findAssetIndex(e.effectivePlayingAsset):-1},get scheduleItem(){return u()}};this.manager={get events(){var d,h;return((d=e.schedule)==null||(h=d.events)==null?void 0:h.slice(0))||[]},get schedule(){var d,h;return((d=e.schedule)==null||(h=d.items)==null?void 0:h.slice(0))||[]},get interstitialPlayer(){return u()?c:null},get playerQueue(){return e.playerQueue.slice(0)},get bufferingAsset(){return e.bufferingAsset},get bufferingItem(){return t()},get bufferingIndex(){const d=t();return e.findItemIndex(d)},get playingAsset(){return e.effectivePlayingAsset},get playingItem(){return e.effectivePlayingItem},get playingIndex(){const d=e.effectivePlayingItem;return e.findItemIndex(d)},primary:{get bufferedEnd(){return a()},get currentTime(){const d=e.timelinePos;return d>0?d:0},set currentTime(d){l(d,"primary")},get duration(){return o("primary")},get seekableStart(){var d;return((d=e.primaryDetails)==null?void 0:d.fragmentStart)||0}},integrated:{get bufferedEnd(){return i(t(),"integrated",e.bufferingAsset,"bufferedPos","bufferedEnd")},get currentTime(){return i(e.effectivePlayingItem,"integrated",e.effectivePlayingAsset,"timelinePos","currentTime")},set currentTime(d){l(d,"integrated")},get duration(){return o("integrated")},get seekableStart(){var d;return s(((d=e.primaryDetails)==null?void 0:d.fragmentStart)||0,"integrated")}},skip:()=>{const d=e.effectivePlayingItem,h=d==null?void 0:d.event;if(h&&!h.restrictions.skip){const f=e.findItemIndex(d);if(h.appendInPlace){const g=d.playout.start+d.event.duration;l(g+.001,"playout")}else e.advanceAfterAssetEnded(h,f,1/0)}}}}return this.manager}get effectivePlayingItem(){return this.waitingItem||this.playingItem||this.endedItem}get effectivePlayingAsset(){return this.playingAsset||this.endedAsset}get playingLastItem(){var e;const t=this.playingItem,r=(e=this.schedule)==null?void 0:e.items;return!this.playbackStarted||!t||!r?!1:this.findItemIndex(t)===r.length-1}get playbackStarted(){return this.effectivePlayingItem!==null}get currentTime(){var e,t,r;if(this.mediaSelection===null)return;const i=this.waitingItem||this.playingItem;if(this.isInterstitial(i)&&!i.event.appendInPlace)return;let s=this.media;!s&&(e=this.bufferingItem)!=null&&(t=e.event)!=null&&t.appendInPlace&&(s=this.primaryMedia);const a=(r=s)==null?void 0:r.currentTime;if(!(a===void 0||!Z(a)))return a}get primaryMedia(){var e;return this.media||((e=this.detachedData)==null?void 0:e.media)||null}isInterstitial(e){return!!(e!=null&&e.event)}retreiveMediaSource(e,t){const r=this.getAssetPlayer(e);r&&this.transferMediaFromPlayer(r,t)}transferMediaFromPlayer(e,t){const r=e.interstitial.appendInPlace,i=e.media;if(r&&i===this.primaryMedia){if(this.bufferingAsset=null,(!t||this.isInterstitial(t)&&!t.event.appendInPlace)&&t&&i){this.detachedData={media:i};return}const s=e.transferMedia();this.log(`transfer MediaSource from ${e} ${Ve(s)}`),this.detachedData=s}else t&&i&&(this.shouldPlay||(this.shouldPlay=!i.paused))}transferMediaTo(e,t){var r,i;if(e.media===t)return;let s=null;const a=this.hls,o=e!==a,l=o&&e.interstitial.appendInPlace,u=(r=this.detachedData)==null?void 0:r.mediaSource;let c;if(a.media)l&&(s=a.transferMedia(),this.detachedData=s),c="Primary";else if(u){const f=this.getBufferingPlayer();f?(s=f.transferMedia(),c=`${f}`):c="detached MediaSource"}else c="detached media";if(!s){if(u)s=this.detachedData,this.log(`using detachedData: MediaSource ${Ve(s)}`);else if(!this.detachedData||a.media===t){const f=this.playerQueue;f.length>1&&f.forEach(g=>{if(o&&g.interstitial.appendInPlace!==l){const m=g.interstitial;this.clearInterstitial(g.interstitial,null),m.appendInPlace=!1,m.appendInPlace&&this.warn(`Could not change append strategy for queued assets ${m}`)}}),this.hls.detachMedia(),this.detachedData={media:t}}}const d=s&&"mediaSource"in s&&((i=s.mediaSource)==null?void 0:i.readyState)!=="closed",h=d&&s?s:t;if(this.log(`${d?"transfering MediaSource":"attaching media"} to ${o?e:"Primary"} from ${c}`),h===s){const f=o&&e.assetId===this.schedule.assetIdAtEnd;h.overrides={duration:this.schedule.duration,endOfStream:!o||f,cueRemoval:!o}}e.attachMedia(h)}onInterstitialCueEnter(){this.onTimeupdate()}checkStart(){const e=this.schedule,t=e.events;if(!t||this.playbackDisabled||!this.media)return;this.bufferedPos===-1&&(this.bufferedPos=0);const r=this.timelinePos,i=this.effectivePlayingItem;if(r===-1){const s=this.hls.startPosition;if(this.timelinePos=s,t.length&&t[0].cue.pre){const a=e.findEventIndex(t[0].identifier);this.setSchedulePosition(a)}else if(s>=0||!this.primaryLive){const a=this.timelinePos=s>0?s:0,o=e.findItemIndexAtTime(a);this.setSchedulePosition(o)}}else if(i&&!this.playingItem){const s=e.findItemIndex(i);this.setSchedulePosition(s)}}advanceAfterAssetEnded(e,t,r){const i=Cd(e,r);if(!e.isAssetPastPlayoutLimit(i))this.setSchedulePosition(t,i);else{const s=this.schedule.items;if(s){const a=t+1,o=s.length;if(a>=o){this.setSchedulePosition(-1);return}const l=e.resumeTime;this.timelinePos<l&&(this.timelinePos=l,this.checkBuffer()),this.setSchedulePosition(a)}}}setScheduleToAssetAtTime(e,t){const r=this.schedule,i=t.parentIdentifier,s=r.getEvent(i);if(s){const a=r.findEventIndex(i),o=r.findAssetIndex(s,e);this.advanceAfterAssetEnded(s,a,o-1)}}setSchedulePosition(e,t){const r=this.schedule.items;if(!r||this.playbackDisabled)return;this.log(`setSchedulePosition ${e}, ${t}`);const i=e>=0?r[e]:null,s=this.playingItem,a=this.playingLastItem;if(this.isInterstitial(s)){var o;const u=s.event,c=this.playingAsset,d=c==null?void 0:c.identifier,h=d?this.getAssetPlayer(d):null;if(h&&d&&(!this.eventItemsMatch(s,i)||t!==void 0&&d!==((o=u.assetList)==null?void 0:o[t].identifier))){var l;const f=u.findAssetIndex(c);this.log(`INTERSTITIAL_ASSET_ENDED ${f+1}/${u.assetList.length} ${vs(c)}`),this.endedAsset=c,this.playingAsset=null,this.hls.trigger(S.INTERSTITIAL_ASSET_ENDED,{asset:c,assetListIndex:f,event:u,schedule:r.slice(0),scheduleIndex:e,player:h}),this.retreiveMediaSource(d,i),h.media&&!((l=this.detachedData)!=null&&l.mediaSource)&&h.detachMedia()}if(!this.eventItemsMatch(s,i)&&(this.endedItem=s,this.playingItem=null,this.log(`INTERSTITIAL_ENDED ${u} ${Ur(s)}`),u.hasPlayed=!0,this.hls.trigger(S.INTERSTITIAL_ENDED,{event:u,schedule:r.slice(0),scheduleIndex:e}),u.cue.once)){this.updateSchedule();const f=this.schedule.items;if(i&&f){const g=this.schedule.findItemIndex(i);this.advanceSchedule(g,f,t,s,a)}return}}this.advanceSchedule(e,r,t,s,a)}advanceSchedule(e,t,r,i,s){const a=e>=0?t[e]:null,o=this.primaryMedia,l=this.playerQueue;if(l.length&&l.forEach(u=>{const c=u.interstitial,d=this.schedule.findEventIndex(c.identifier);(d<e||d>e+1)&&this.clearInterstitial(c,a)}),this.isInterstitial(a)){this.timelinePos=Math.min(Math.max(this.timelinePos,a.start),a.end);const u=a.event;if(r===void 0){r=this.schedule.findAssetIndex(u,this.timelinePos);const f=Cd(u,r-1);if(u.isAssetPastPlayoutLimit(f)){this.advanceAfterAssetEnded(u,e,r);return}r=f}const c=this.waitingItem;this.assetsBuffered(a,o)||this.setBufferingItem(a);let d=this.preloadAssets(u,r);if(this.eventItemsMatch(a,c||i)||(this.waitingItem=a,this.log(`INTERSTITIAL_STARTED ${Ur(a)} ${u.appendInPlace?"append in place":""}`),this.hls.trigger(S.INTERSTITIAL_STARTED,{event:u,schedule:t.slice(0),scheduleIndex:e})),!u.assetListLoaded){this.log(`Waiting for ASSET-LIST to complete loading ${u}`);return}if(u.assetListLoader&&(u.assetListLoader.destroy(),u.assetListLoader=void 0),!o){this.log(`Waiting for attachMedia to start Interstitial ${u}`);return}this.waitingItem=this.endedItem=null,this.playingItem=a;const h=u.assetList[r];if(!h){const f=t[e+1],g=this.media;f&&g&&!this.isInterstitial(f)&&g.currentTime<f.start&&(g.currentTime=this.timelinePos=f.start),this.advanceAfterAssetEnded(u,e,r||0);return}if(d||(d=this.getAssetPlayer(h.identifier)),d===null||d.destroyed){const f=u.assetList.length;this.warn(`asset ${r+1}/${f} player destroyed ${u}`),d=this.createAssetPlayer(u,h,r)}if(!this.eventItemsMatch(a,this.bufferingItem)&&u.appendInPlace&&this.isAssetBuffered(h))return;this.startAssetPlayer(d,r,t,e,o),this.shouldPlay&&ey(d.media)}else a!==null?(this.resumePrimary(a,e,i),this.shouldPlay&&ey(this.hls.media)):s&&this.isInterstitial(i)&&(this.endedItem=null,this.playingItem=i,i.event.appendInPlace||this.attachPrimary(this.schedule.durations.primary,null))}get playbackDisabled(){return this.hls.config.enableInterstitialPlayback===!1}get primaryDetails(){var e,t;return(e=this.mediaSelection)==null||(t=e.main)==null?void 0:t.details}get primaryLive(){var e;return!!((e=this.primaryDetails)!=null&&e.live)}resumePrimary(e,t,r){var i;if(this.playingItem=e,this.playingAsset=this.endedAsset=null,this.waitingItem=this.endedItem=null,this.bufferedToItem(e),this.log(`resuming ${Ur(e)}`),!((i=this.detachedData)!=null&&i.mediaSource)){let a=this.timelinePos;(a<e.start||a>=e.end)&&(a=this.getPrimaryResumption(e,t),this.timelinePos=a),this.attachPrimary(a,e)}if(!r)return;const s=this.schedule.items;s&&(this.log(`INTERSTITIALS_PRIMARY_RESUMED ${Ur(e)}`),this.hls.trigger(S.INTERSTITIALS_PRIMARY_RESUMED,{schedule:s.slice(0),scheduleIndex:t}),this.checkBuffer())}getPrimaryResumption(e,t){const r=e.start;if(this.primaryLive){const i=this.primaryDetails;if(t===0)return this.hls.startPosition;if(i&&(r<i.fragmentStart||r>i.edge))return this.hls.liveSyncPosition||-1}return r}isAssetBuffered(e){const t=this.getAssetPlayer(e.identifier);return t!=null&&t.hls?t.hls.bufferedToEnd:ge.bufferInfo(this.primaryMedia,this.timelinePos,0).end+1>=e.timelineStart+(e.duration||0)}attachPrimary(e,t,r){t?this.setBufferingItem(t):this.bufferingItem=this.playingItem,this.bufferingAsset=null;const i=this.primaryMedia;if(!i)return;const s=this.hls;s.media?this.checkBuffer():(this.transferMediaTo(s,i),r&&this.startLoadingPrimaryAt(e,r)),r||(this.timelinePos=e,this.startLoadingPrimaryAt(e,r))}startLoadingPrimaryAt(e,t){var r;const i=this.hls;!i.loadingEnabled||!i.media||Math.abs((((r=i.mainForwardBufferInfo)==null?void 0:r.start)||i.media.currentTime)-e)>.5?i.startLoad(e,t):i.bufferingEnabled||i.resumeBuffering()}onManifestLoading(){this.stopLoad(),this.schedule.reset(),this.emptyPlayerQueue(),this.clearScheduleState(),this.shouldPlay=!1,this.bufferedPos=this.timelinePos=-1,this.mediaSelection=this.altSelection=this.manager=this.requiredTracks=null,this.hls.off(S.BUFFER_CODECS,this.onBufferCodecs,this),this.hls.on(S.BUFFER_CODECS,this.onBufferCodecs,this)}onLevelUpdated(e,t){if(t.level===-1)return;const r=this.hls.levels[t.level],i=Ce(Ce({},this.mediaSelection||this.altSelection),{},{main:r});this.mediaSelection=i,this.schedule.parseInterstitialDateRanges(i,this.hls.config.interstitialAppendInPlace),!this.effectivePlayingItem&&this.schedule.items&&this.checkStart()}onAudioTrackUpdated(e,t){const r=this.hls.audioTracks[t.id],i=this.mediaSelection;if(!i){this.altSelection=Ce(Ce({},this.altSelection),{},{audio:r});return}const s=Ce(Ce({},i),{},{audio:r});this.mediaSelection=s}onSubtitleTrackUpdated(e,t){const r=this.hls.subtitleTracks[t.id],i=this.mediaSelection;if(!i){this.altSelection=Ce(Ce({},this.altSelection),{},{subtitles:r});return}const s=Ce(Ce({},i),{},{subtitles:r});this.mediaSelection=s}onAudioTrackSwitching(e,t){const r=h0(t);this.playerQueue.forEach(i=>i.hls.setAudioOption(t)||i.hls.setAudioOption(r))}onSubtitleTrackSwitch(e,t){const r=h0(t);this.playerQueue.forEach(i=>i.hls.setSubtitleOption(t)||t.id!==-1&&i.hls.setSubtitleOption(r))}onBufferCodecs(e,t){const r=t.tracks;r&&(this.requiredTracks=r)}onBufferAppended(e,t){this.checkBuffer()}onBufferFlushed(e,t){const r=this.playingItem;if(r&&!this.itemsMatch(r,this.bufferingItem)&&!this.isInterstitial(r)){const i=this.timelinePos;this.bufferedPos=i,this.checkBuffer()}}onBufferedToEnd(e){const t=this.schedule.events;if(this.bufferedPos<Number.MAX_VALUE&&t){for(let i=0;i<t.length;i++){const s=t[i];if(s.cue.post){var r;const a=this.schedule.findEventIndex(s.identifier),o=(r=this.schedule.items)==null?void 0:r[a];this.isInterstitial(o)&&this.eventItemsMatch(o,this.bufferingItem)&&this.bufferedToItem(o,0);break}}this.bufferedPos=Number.MAX_VALUE}}onMediaEnded(e){const t=this.playingItem;if(!this.playingLastItem&&t){const r=this.findItemIndex(t);this.setSchedulePosition(r+1)}else this.shouldPlay=!1}updateItem(e,t){const r=this.schedule.items;if(e&&r){const i=this.findItemIndex(e,t);return r[i]||null}return null}trimInPlace(e,t){if(this.isInterstitial(e)&&e.event.appendInPlace&&t.end-e.end>.25){e.event.assetList.forEach((s,a)=>{e.event.isAssetPastPlayoutLimit(a)&&this.clearAssetPlayer(s.identifier,null)});const r=e.end+.25,i=ge.bufferInfo(this.primaryMedia,r,0);(i.end>r||(i.nextStart||0)>r)&&(this.attachPrimary(r,null),this.flushFrontBuffer(r))}}itemsMatch(e,t){return!!t&&(e===t||e.event&&t.event&&this.eventItemsMatch(e,t)||!e.event&&!t.event&&this.findItemIndex(e)===this.findItemIndex(t))}eventItemsMatch(e,t){var r;return!!t&&(e===t||e.event.identifier===((r=t.event)==null?void 0:r.identifier))}findItemIndex(e,t){return e?this.schedule.findItemIndex(e,t):-1}updateSchedule(){const e=this.mediaSelection;e&&this.schedule.updateSchedule(e,[])}checkBuffer(e){const t=this.schedule.items;if(!t)return;const r=ge.bufferInfo(this.primaryMedia,this.timelinePos,0);e&&(this.bufferedPos=this.timelinePos),e||(e=r.len<1),this.updateBufferedPos(r.end,t,e)}updateBufferedPos(e,t,r){const i=this.schedule,s=this.bufferingItem;if(this.bufferedPos>e)return;if(t.length===1&&this.itemsMatch(t[0],s)){this.bufferedPos=e;return}const a=this.playingItem,o=this.findItemIndex(a);let l=i.findItemIndexAtTime(e);if(this.bufferedPos<e){var u,c;const d=this.findItemIndex(s),h=Math.min(d+1,t.length-1),f=t[h];if((l===-1&&s&&e>=s.end||(u=f.event)!=null&&u.appendInPlace&&e+.01>=f.start)&&(l=h),h-o>1&&(s==null||(c=s.event)==null?void 0:c.appendInPlace)===!1)return;if(this.bufferedPos=e,l>d&&l>o)this.bufferedToItem(f);else{const g=this.primaryDetails;this.primaryLive&&g&&e>g.edge-g.targetduration&&f.start<g.edge+this.hls.config.interstitialLiveLookAhead&&this.isInterstitial(f)&&this.preloadAssets(f.event,0)}}else r&&a&&!this.itemsMatch(a,s)&&(l===o?this.bufferedToItem(a):l===o+1&&this.bufferedToItem(t[l]))}assetsBuffered(e,t){return e.event.assetList.length===0?!1:!e.event.assetList.some(i=>{const s=this.getAssetPlayer(i.identifier);return!(s!=null&&s.bufferedInPlaceToEnd(t))})}setBufferingItem(e){const t=this.bufferingItem,r=this.schedule;if(this.itemsMatch(e,t))this.bufferingItem!==e&&(this.bufferingItem=e);else{const{items:i,events:s}=r;if(!i||!s)return t;const a=this.isInterstitial(e),o=this.getBufferingPlayer();this.bufferingItem=e,this.bufferedPos=Math.max(e.start,Math.min(e.end,this.timelinePos));const l=o?o.remaining:t?t.end-this.timelinePos:0;this.log(`INTERSTITIALS_BUFFERED_TO_BOUNDARY ${Ur(e)}`+(t?` (${l.toFixed(2)} remaining)`:"")),this.playbackDisabled||(a?e.event.assetList.forEach(u=>{const c=this.getAssetPlayer(u.identifier);c&&c.resumeBuffering()}):(this.hls.resumeBuffering(),this.playerQueue.forEach(u=>u.pauseBuffering()))),this.hls.trigger(S.INTERSTITIALS_BUFFERED_TO_BOUNDARY,{events:s.slice(0),schedule:i.slice(0),bufferingIndex:this.findItemIndex(e),playingIndex:this.findItemIndex(this.playingItem)})}return t}bufferedToItem(e,t=0){const r=this.setBufferingItem(e);if(!this.playbackDisabled){if(this.isInterstitial(e))this.bufferedToEvent(e,t);else if(r!==null){this.bufferingAsset=null;const i=this.detachedData;i?i.mediaSource?this.attachPrimary(e.start,e,!0):this.preloadPrimary(e):this.preloadPrimary(e)}}}preloadPrimary(e){const t=this.findItemIndex(e),r=this.getPrimaryResumption(e,t);this.startLoadingPrimaryAt(r)}bufferedToEvent(e,t){const r=e.event,i=r.assetList.length===0&&!r.assetListLoader,s=r.cue.once;if(i||!s){const a=this.preloadAssets(r,t);if(a!=null&&a.interstitial.appendInPlace){const o=r.assetList[t],l=this.primaryMedia;o&&l&&this.bufferAssetPlayer(a,l)}}}preloadAssets(e,t){const r=e.assetUrl,i=e.assetList.length,s=i===0&&!e.assetListLoader,a=e.cue.once;if(s){const l=e.timelineStart;if(e.appendInPlace){var o;const h=this.playingItem;!this.isInterstitial(h)&&(h==null||(o=h.nextEvent)==null?void 0:o.identifier)===e.identifier&&this.flushFrontBuffer(l+.25)}let u,c=0;if(!this.playingItem&&this.primaryLive&&(c=this.hls.startPosition,c===-1&&(c=this.hls.liveSyncPosition||0)),c&&!(e.cue.pre||e.cue.post)){const h=c-l;h>0&&(u=Math.round(h*1e3)/1e3)}if(this.log(`Load interstitial asset ${t+1}/${r?1:i} ${e}${u?` live-start: ${c} start-offset: ${u}`:""}`),r)return this.createAsset(e,0,0,l,e.duration,r);const d=this.assetListLoader.loadAssetList(e,u);d&&(e.assetListLoader=d)}else if(!a&&i){for(let l=t;l<i;l++){const u=e.assetList[l],c=this.getAssetPlayerQueueIndex(u.identifier);(c===-1||this.playerQueue[c].destroyed)&&!u.error&&this.createAssetPlayer(e,u,l)}return this.getAssetPlayer(e.assetList[t].identifier)}return null}flushFrontBuffer(e){const t=this.requiredTracks;if(!t)return;this.log(`Removing front buffer starting at ${e}`),Object.keys(t).forEach(i=>{this.hls.trigger(S.BUFFER_FLUSHING,{startOffset:e,endOffset:1/0,type:i})})}getAssetPlayerQueueIndex(e){const t=this.playerQueue;for(let r=0;r<t.length;r++)if(e===t[r].assetId)return r;return-1}getAssetPlayer(e){const t=this.getAssetPlayerQueueIndex(e);return this.playerQueue[t]||null}getBufferingPlayer(){const{playerQueue:e,primaryMedia:t}=this;if(t){for(let r=0;r<e.length;r++)if(e[r].media===t)return e[r]}return null}createAsset(e,t,r,i,s,a){const o={parentIdentifier:e.identifier,identifier:sO(e,a,t),duration:s,startOffset:r,timelineStart:i,uri:a};return this.createAssetPlayer(e,o,t)}createAssetPlayer(e,t,r){const i=this.hls,s=i.userConfig;let a=s.videoPreference;const o=i.loadLevelObj||i.levels[i.currentLevel];(a||o)&&(a=Oe({},a),o.videoCodec&&(a.videoCodec=o.videoCodec),o.videoRange&&(a.allowedVideoRanges=[o.videoRange]));const l=i.audioTracks[i.audioTrack],u=i.subtitleTracks[i.subtitleTrack];let c=0;if(this.primaryLive||e.appendInPlace){const E=this.timelinePos-t.timelineStart;if(E>1){const T=t.duration;T&&E<T&&(c=E)}}const d=t.identifier,h=Ce(Ce({},s),{},{autoStartLoad:!0,startFragPrefetch:!0,primarySessionId:i.sessionId,assetPlayerId:d,abrEwmaDefaultEstimate:i.bandwidthEstimate,interstitialsController:void 0,startPosition:c,liveDurationInfinity:!1,testBandwidth:!1,videoPreference:a,audioPreference:l||s.audioPreference,subtitlePreference:u||s.subtitlePreference});e.appendInPlace&&(e.appendInPlaceStarted=!0,t.timelineStart&&(h.timelineOffset=t.timelineStart));const f=h.cmcd;f!=null&&f.sessionId&&f.contentId&&(h.cmcd=Oe({},f,{contentId:io(t.uri)})),this.getAssetPlayer(d)&&this.warn(`Duplicate date range identifier ${e} and asset ${d}`);const g=new lO(this.HlsPlayerClass,h,e,t);this.playerQueue.push(g),e.assetList[r]=t;const m=E=>{if(E.live){const I=new Error(`Interstitials MUST be VOD assets ${e}`),R={fatal:!0,type:re.OTHER_ERROR,details:O.INTERSTITIAL_ASSET_ITEM_ERROR,error:I};this.handleAssetItemError(R,e,this.schedule.findEventIndex(e.identifier),r,I.message);return}const T=E.edge-E.fragmentStart,A=t.duration;(A===null||T>A)&&(this.log(`Interstitial asset "${d}" duration change ${A} > ${T}`),t.duration=T,this.updateSchedule())};g.on(S.LEVEL_UPDATED,(E,{details:T})=>m(T)),g.on(S.LEVEL_PTS_UPDATED,(E,{details:T})=>m(T));const y=(E,T)=>{const A=this.getAssetPlayer(d);if(A&&T.tracks){A.off(S.BUFFER_CODECS,y),A.tracks=T.tracks;const I=this.primaryMedia;this.bufferingAsset===A.assetItem&&I&&!A.media&&this.bufferAssetPlayer(A,I)}};g.on(S.BUFFER_CODECS,y);const p=()=>{var E;const T=this.getAssetPlayer(d);if(this.log(`buffered to end of asset ${T}`),!T)return;const A=this.schedule.findEventIndex(e.identifier),I=(E=this.schedule.items)==null?void 0:E[A];if(this.isInterstitial(I)){const x=e.findAssetIndex(t),D=Cd(e,x);if(!e.isAssetPastPlayoutLimit(D))this.bufferedToItem(I,D);else{var R;const _=(R=this.schedule.items)==null?void 0:R[A+1];_&&this.bufferedToItem(_)}}};g.on(S.BUFFERED_TO_END,p);const v=E=>()=>{if(!this.getAssetPlayer(d))return;this.shouldPlay=!0;const A=this.schedule.findEventIndex(e.identifier);this.advanceAfterAssetEnded(e,A,E)};return g.once(S.MEDIA_ENDED,v(r)),g.once(S.PLAYOUT_LIMIT_REACHED,v(1/0)),g.on(S.ERROR,(E,T)=>{const A=this.getAssetPlayer(d);if(T.details===O.BUFFER_STALLED_ERROR){if(A!=null&&A.media){const I=A.currentTime,R=A.duration-I;I&&e.appendInPlace&&R/A.media.playbackRate<.5?(this.log(`Advancing buffer past end of asset ${d} ${e} at ${A.media.currentTime}`),p()):(this.warn(`Stalled at ${I} of ${I+R} in asset ${d} ${e}`),this.onTimeupdate(),this.checkBuffer(!0))}return}this.handleAssetItemError(T,e,this.schedule.findEventIndex(e.identifier),r,`Asset player error ${T.error} ${e}`)}),g.on(S.DESTROYING,()=>{if(!this.getAssetPlayer(d))return;const T=new Error(`Asset player destroyed unexpectedly ${d}`),A={fatal:!0,type:re.OTHER_ERROR,details:O.INTERSTITIAL_ASSET_ITEM_ERROR,error:T};this.handleAssetItemError(A,e,this.schedule.findEventIndex(e.identifier),r,T.message)}),this.log(`INTERSTITIAL_ASSET_PLAYER_CREATED ${vs(t)}`),this.hls.trigger(S.INTERSTITIAL_ASSET_PLAYER_CREATED,{asset:t,assetListIndex:r,event:e,player:g}),g}clearInterstitial(e,t){e.assetList.forEach(r=>{this.clearAssetPlayer(r.identifier,t)}),e.reset()}resetAssetPlayer(e){const t=this.getAssetPlayerQueueIndex(e);if(t!==-1){this.log(`reset asset player "${e}" after error`);const r=this.playerQueue[t];this.transferMediaFromPlayer(r,null),r.resetDetails()}}clearAssetPlayer(e,t){const r=this.getAssetPlayerQueueIndex(e);if(r!==-1){this.log(`clear asset player "${e}" toSegment: ${t&&Ur(t)}`);const i=this.playerQueue[r];this.transferMediaFromPlayer(i,t),this.playerQueue.splice(r,1),i.destroy()}}emptyPlayerQueue(){let e;for(;e=this.playerQueue.pop();)e.destroy();this.playerQueue=[]}startAssetPlayer(e,t,r,i,s){const{interstitial:a,assetItem:o,assetId:l}=e,u=a.assetList.length,c=this.playingAsset;this.endedAsset=null,this.playingAsset=o,(!c||c.identifier!==l)&&(c&&(this.clearAssetPlayer(c.identifier,r[i]),delete c.error),this.log(`INTERSTITIAL_ASSET_STARTED ${t+1}/${u} ${vs(o)}`),this.hls.trigger(S.INTERSTITIAL_ASSET_STARTED,{asset:o,assetListIndex:t,event:a,schedule:r.slice(0),scheduleIndex:i,player:e})),this.bufferAssetPlayer(e,s)}bufferAssetPlayer(e,t){var r,i;const{interstitial:s,assetItem:a}=e,o=this.schedule.findEventIndex(s.identifier),l=(r=this.schedule.items)==null?void 0:r[o];if(!l)return;this.setBufferingItem(l),this.bufferingAsset=a;const u=this.getBufferingPlayer();if(u===e)return;const c=s.appendInPlace;if(c&&(u==null?void 0:u.interstitial.appendInPlace)===!1)return;const d=(u==null?void 0:u.tracks)||((i=this.detachedData)==null?void 0:i.tracks)||this.requiredTracks;if(c&&a!==this.playingAsset){if(!e.tracks)return;if(d&&!US(d,e.tracks)){const h=new Error(`Asset ${vs(a)} SourceBuffer tracks ('${Object.keys(e.tracks)}') are not compatible with primary content tracks ('${Object.keys(d)}')`),f={fatal:!0,type:re.OTHER_ERROR,details:O.INTERSTITIAL_ASSET_ITEM_ERROR,error:h},g=s.findAssetIndex(a);this.handleAssetItemError(f,s,o,g,h.message);return}}this.transferMediaTo(e,t)}handleAssetItemError(e,t,r,i,s){if(e.details===O.BUFFER_STALLED_ERROR)return;const a=t.assetList[i];this.warn(`INTERSTITIAL_ASSET_ERROR ${a&&vs(a)} ${e.error}`);const o=a==null?void 0:a.identifier,l=this.getAssetPlayerQueueIndex(o),u=this.playerQueue[l]||null,c=this.schedule.items,d=Oe({},e,{fatal:!1,errorAction:Do(!0),asset:a,assetListIndex:i,event:t,schedule:c,scheduleIndex:r,player:u});if(this.hls.trigger(S.INTERSTITIAL_ASSET_ERROR,d),!e.fatal)return;const h=this.playingAsset,f=new Error(s);if(a&&(this.clearAssetPlayer(o,null),a.error=f),!t.assetList.some(g=>!g.error))t.error=f;else if(t.appendInPlace){for(let g=i;g<t.assetList.length;g++)this.resetAssetPlayer(t.assetList[g].identifier);this.updateSchedule()}t.error?this.primaryFallback(t):h&&h.identifier===o&&this.advanceAfterAssetEnded(t,r,i)}primaryFallback(e){const t=e.timelineStart,r=this.effectivePlayingItem;if(this.updateSchedule(),r){this.log(`Fallback to primary from event "${e.identifier}" start: ${t} pos: ${this.timelinePos} playing: ${r?Ur(r):"<none>"} error: ${e.error}`);let i=this.timelinePos;i===-1&&(i=this.hls.startPosition);const s=this.updateItem(r,i);this.itemsMatch(r,s)&&this.clearInterstitial(e,null),e.appendInPlace&&(this.attachPrimary(t,null),this.flushFrontBuffer(t));const a=this.schedule.findItemIndexAtTime(i);this.setSchedulePosition(a)}else this.checkStart()}onAssetListLoaded(e,t){var r;const i=t.event,s=i.identifier,a=t.assetListResponse.ASSETS;if(!this.schedule.hasEvent(s))return;const o=i.timelineStart,l=i.duration;let u=0;a.forEach((g,m)=>{const y=parseFloat(g.DURATION);this.createAsset(i,m,u,o+u,y,g.URI),u+=y}),i.duration=u,this.log(`Loaded asset-list with duration: ${u} (was: ${l}) ${i}`);const c=this.waitingItem,d=(c==null?void 0:c.event.identifier)===s;this.updateSchedule();const h=(r=this.bufferingItem)==null?void 0:r.event;if(d){var f;const g=this.schedule.findEventIndex(s),m=(f=this.schedule.items)==null?void 0:f[g];if(m){if(!this.playingItem&&this.timelinePos>m.end&&this.schedule.findItemIndexAtTime(this.timelinePos)!==g){i.error=new Error(`Interstitial no longer within playback range ${this.timelinePos} ${i}`),this.primaryFallback(i);return}this.setBufferingItem(m)}this.setSchedulePosition(g)}else if((h==null?void 0:h.identifier)===s&&h.appendInPlace){const g=i.assetList[0],m=this.getAssetPlayer(g.identifier),y=this.primaryMedia;g&&m&&y&&this.bufferAssetPlayer(m,y)}}onError(e,t){switch(t.details){case O.ASSET_LIST_PARSING_ERROR:case O.ASSET_LIST_LOAD_ERROR:case O.ASSET_LIST_LOAD_TIMEOUT:{const r=t.interstitial;r&&this.primaryFallback(r);break}case O.BUFFER_STALLED_ERROR:{this.onTimeupdate(),this.checkBuffer(!0);break}}}}const ty=500;class hO extends Dg{constructor(e,t,r){super(e,t,r,"subtitle-stream-controller",ne.SUBTITLE),this.currentTrackId=-1,this.tracksBuffered=[],this.mainDetails=null,this.registerListeners()}onHandlerDestroying(){this.unregisterListeners(),super.onHandlerDestroying(),this.mainDetails=null}registerListeners(){super.registerListeners();const{hls:e}=this;e.on(S.LEVEL_LOADED,this.onLevelLoaded,this),e.on(S.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.on(S.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.on(S.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.on(S.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),e.on(S.BUFFER_FLUSHING,this.onBufferFlushing,this)}unregisterListeners(){super.unregisterListeners();const{hls:e}=this;e.off(S.LEVEL_LOADED,this.onLevelLoaded,this),e.off(S.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.off(S.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.off(S.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.off(S.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),e.off(S.BUFFER_FLUSHING,this.onBufferFlushing,this)}startLoad(e,t){this.stopLoad(),this.state=$.IDLE,this.setInterval(ty),this.nextLoadPosition=this.lastCurrentTime=e+this.timelineOffset,this.startPosition=t?-1:e,this.tick()}onManifestLoading(){super.onManifestLoading(),this.mainDetails=null}onMediaDetaching(e,t){this.tracksBuffered=[],super.onMediaDetaching(e,t)}onLevelLoaded(e,t){this.mainDetails=t.details}onSubtitleFragProcessed(e,t){const{frag:r,success:i}=t;if(vt(r)&&(this.fragPrevious=r),this.state=$.IDLE,!i)return;const s=this.tracksBuffered[this.currentTrackId];if(!s)return;let a;const o=r.start;for(let u=0;u<s.length;u++)if(o>=s[u].start&&o<=s[u].end){a=s[u];break}const l=r.start+r.duration;a?a.end=l:(a={start:o,end:l},s.push(a)),this.fragmentTracker.fragBuffered(r),this.fragBufferedComplete(r,null),this.media&&this.tick()}onBufferFlushing(e,t){const{startOffset:r,endOffset:i}=t;if(r===0&&i!==Number.POSITIVE_INFINITY){const s=i-1;if(s<=0)return;t.endOffsetSubtitles=Math.max(0,s),this.tracksBuffered.forEach(a=>{for(let o=0;o<a.length;){if(a[o].end<=s){a.shift();continue}else if(a[o].start<s)a[o].start=s;else break;o++}}),this.fragmentTracker.removeFragmentsInRange(r,s,ne.SUBTITLE)}}onError(e,t){const r=t.frag;(r==null?void 0:r.type)===ne.SUBTITLE&&(t.details===O.FRAG_GAP&&this.fragmentTracker.fragBuffered(r,!0),this.fragCurrent&&this.fragCurrent.abortRequests(),this.state!==$.STOPPED&&(this.state=$.IDLE))}onSubtitleTracksUpdated(e,{subtitleTracks:t}){if(this.levels&&Nx(this.levels,t)){this.levels=t.map(r=>new Io(r));return}this.tracksBuffered=[],this.levels=t.map(r=>{const i=new Io(r);return this.tracksBuffered[i.id]=[],i}),this.fragmentTracker.removeFragmentsInRange(0,Number.POSITIVE_INFINITY,ne.SUBTITLE),this.fragPrevious=null,this.mediaBuffer=null}onSubtitleTrackSwitch(e,t){var r;if(this.currentTrackId=t.id,!((r=this.levels)!=null&&r.length)||this.currentTrackId===-1){this.clearInterval();return}const i=this.levels[this.currentTrackId];i!=null&&i.details?this.mediaBuffer=this.mediaBufferTimeRanges:this.mediaBuffer=null,i&&this.state!==$.STOPPED&&this.setInterval(ty)}onSubtitleTrackLoaded(e,t){var r;const{currentTrackId:i,levels:s}=this,{details:a,id:o}=t;if(!s){this.warn(`Subtitle tracks were reset while loading level ${o}`);return}const l=s[o];if(o>=s.length||!l)return;this.log(`Subtitle track ${o} loaded [${a.startSN},${a.endSN}]${a.lastPartSn?`[part-${a.lastPartSn}-${a.lastPartIndex}]`:""},duration:${a.totalduration}`),this.mediaBuffer=this.mediaBufferTimeRanges;let u=0;if(a.live||(r=l.details)!=null&&r.live){const d=this.mainDetails;if(a.deltaUpdateFailed||!d)return;const h=d.fragments[0];if(!l.details)a.hasProgramDateTime&&d.hasProgramDateTime?(Qu(a,d),u=a.fragmentStart):h&&(u=h.start,Jh(a,u));else{var c;u=this.alignPlaylists(a,l.details,(c=this.levelLastLoaded)==null?void 0:c.details),u===0&&h&&(u=h.start,Jh(a,u))}}l.details=a,this.levelLastLoaded=l,o===i&&(this.hls.trigger(S.SUBTITLE_TRACK_UPDATED,{details:a,id:o,groupId:t.groupId}),this.tick(),a.live&&!this.fragCurrent&&this.media&&this.state===$.IDLE&&(rs(null,a.fragments,this.media.currentTime,0)||(this.warn("Subtitle playlist not aligned with playback"),l.details=void 0)))}_handleFragmentLoadComplete(e){const{frag:t,payload:r}=e,i=t.decryptdata,s=this.hls;if(!this.fragContextChanged(t)&&r&&r.byteLength>0&&i!=null&&i.key&&i.iv&&Gs(i.method)){const a=performance.now();this.decrypter.decrypt(new Uint8Array(r),i.key.buffer,i.iv.buffer,_g(i.method)).catch(o=>{throw s.trigger(S.ERROR,{type:re.MEDIA_ERROR,details:O.FRAG_DECRYPT_ERROR,fatal:!1,error:o,reason:o.message,frag:t}),o}).then(o=>{const l=performance.now();s.trigger(S.FRAG_DECRYPTED,{frag:t,payload:o,stats:{tstart:a,tdecrypt:l}})}).catch(o=>{this.warn(`${o.name}: ${o.message}`),this.state=$.IDLE})}}doTick(){if(!this.media){this.state=$.IDLE;return}if(this.state===$.IDLE){const{currentTrackId:e,levels:t}=this,r=t==null?void 0:t[e];if(!r||!t.length||!r.details||this.waitForLive(r))return;const{config:i}=this,s=this.getLoadPosition(),a=ge.bufferedInfo(this.tracksBuffered[this.currentTrackId]||[],s,i.maxBufferHole),{end:o,len:l}=a,u=r.details,c=this.hls.maxBufferLength+u.levelTargetDuration;if(l>c)return;const d=u.fragments,h=d.length,f=u.edge;let g=null;const m=this.fragPrevious;if(o<f){const v=i.maxFragLookUpTolerance,E=o>f-v?0:v;g=rs(m,d,Math.max(d[0].start,o),E),!g&&m&&m.start<d[0].start&&(g=d[0])}else g=d[h-1];if(g=this.filterReplacedPrimary(g,r.details),!g)return;const y=g.sn-u.startSN,p=d[y-1];if(p&&p.cc===g.cc&&this.fragmentTracker.getState(p)===ct.NOT_LOADED&&(g=p),this.fragmentTracker.getState(g)===ct.NOT_LOADED){const v=this.mapToInitFragWhenRequired(g);v&&this.loadFragment(v,r,o)}}}loadFragment(e,t,r){vt(e)?super.loadFragment(e,t,r):this._loadInitSegment(e,t)}get mediaBufferTimeRanges(){return new fO(this.tracksBuffered[this.currentTrackId]||[])}}class fO{constructor(e){this.buffered=void 0;const t=(r,i,s)=>{if(i=i>>>0,i>s-1)throw new DOMException(`Failed to execute '${r}' on 'TimeRanges': The index provided (${i}) is greater than the maximum bound (${s})`);return e[i][r]};this.buffered={get length(){return e.length},end(r){return t("end",r,e.length)},start(r){return t("start",r,e.length)}}}}const gO={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,128:174,129:176,130:189,131:191,132:8482,133:162,134:163,135:9834,136:224,137:32,138:232,139:226,140:234,141:238,142:244,143:251,144:193,145:201,146:211,147:218,148:220,149:252,150:8216,151:161,152:42,153:8217,154:9473,155:169,156:8480,157:8226,158:8220,159:8221,160:192,161:194,162:199,163:200,164:202,165:203,166:235,167:206,168:207,169:239,170:212,171:217,172:249,173:219,174:171,175:187,176:195,177:227,178:205,179:204,180:236,181:210,182:242,183:213,184:245,185:123,186:125,187:92,188:94,189:95,190:124,191:8764,192:196,193:228,194:214,195:246,196:223,197:165,198:164,199:9475,200:197,201:229,202:216,203:248,204:9487,205:9491,206:9495,207:9499},Yx=n=>String.fromCharCode(gO[n]||n),Rn=15,fr=100,mO={17:1,18:3,21:5,22:7,23:9,16:11,19:12,20:14},pO={17:2,18:4,21:6,22:8,23:10,19:13,20:15},yO={25:1,26:3,29:5,30:7,31:9,24:11,27:12,28:14},vO={25:2,26:4,29:6,30:8,31:10,27:13,28:15},EO=["white","green","blue","cyan","red","yellow","magenta","black","transparent"];class SO{constructor(){this.time=null,this.verboseLevel=0}log(e,t){if(this.verboseLevel>=e){const r=typeof t=="function"?t():t;Ie.log(`${this.time} [${e}] ${r}`)}}}const Di=function(e){const t=[];for(let r=0;r<e.length;r++)t.push(e[r].toString(16));return t};class qx{constructor(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1}reset(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1}setStyles(e){const t=["foreground","underline","italics","background","flash"];for(let r=0;r<t.length;r++){const i=t[r];e.hasOwnProperty(i)&&(this[i]=e[i])}}isDefault(){return this.foreground==="white"&&!this.underline&&!this.italics&&this.background==="black"&&!this.flash}equals(e){return this.foreground===e.foreground&&this.underline===e.underline&&this.italics===e.italics&&this.background===e.background&&this.flash===e.flash}copy(e){this.foreground=e.foreground,this.underline=e.underline,this.italics=e.italics,this.background=e.background,this.flash=e.flash}toString(){return"color="+this.foreground+", underline="+this.underline+", italics="+this.italics+", background="+this.background+", flash="+this.flash}}class xO{constructor(){this.uchar=" ",this.penState=new qx}reset(){this.uchar=" ",this.penState.reset()}setChar(e,t){this.uchar=e,this.penState.copy(t)}setPenState(e){this.penState.copy(e)}equals(e){return this.uchar===e.uchar&&this.penState.equals(e.penState)}copy(e){this.uchar=e.uchar,this.penState.copy(e.penState)}isEmpty(){return this.uchar===" "&&this.penState.isDefault()}}class TO{constructor(e){this.chars=[],this.pos=0,this.currPenState=new qx,this.cueStartTime=null,this.logger=void 0;for(let t=0;t<fr;t++)this.chars.push(new xO);this.logger=e}equals(e){for(let t=0;t<fr;t++)if(!this.chars[t].equals(e.chars[t]))return!1;return!0}copy(e){for(let t=0;t<fr;t++)this.chars[t].copy(e.chars[t])}isEmpty(){let e=!0;for(let t=0;t<fr;t++)if(!this.chars[t].isEmpty()){e=!1;break}return e}setCursor(e){this.pos!==e&&(this.pos=e),this.pos<0?(this.logger.log(3,"Negative cursor position "+this.pos),this.pos=0):this.pos>fr&&(this.logger.log(3,"Too large cursor position "+this.pos),this.pos=fr)}moveCursor(e){const t=this.pos+e;if(e>1)for(let r=this.pos+1;r<t+1;r++)this.chars[r].setPenState(this.currPenState);this.setCursor(t)}backSpace(){this.moveCursor(-1),this.chars[this.pos].setChar(" ",this.currPenState)}insertChar(e){e>=144&&this.backSpace();const t=Yx(e);if(this.pos>=fr){this.logger.log(0,()=>"Cannot insert "+e.toString(16)+" ("+t+") at position "+this.pos+". Skipping it!");return}this.chars[this.pos].setChar(t,this.currPenState),this.moveCursor(1)}clearFromPos(e){let t;for(t=e;t<fr;t++)this.chars[t].reset()}clear(){this.clearFromPos(0),this.pos=0,this.currPenState.reset()}clearToEndOfRow(){this.clearFromPos(this.pos)}getTextString(){const e=[];let t=!0;for(let r=0;r<fr;r++){const i=this.chars[r].uchar;i!==" "&&(t=!1),e.push(i)}return t?"":e.join("")}setPenStyles(e){this.currPenState.setStyles(e),this.chars[this.pos].setPenState(this.currPenState)}}class wd{constructor(e){this.rows=[],this.currRow=Rn-1,this.nrRollUpRows=null,this.lastOutputScreen=null,this.logger=void 0;for(let t=0;t<Rn;t++)this.rows.push(new TO(e));this.logger=e}reset(){for(let e=0;e<Rn;e++)this.rows[e].clear();this.currRow=Rn-1}equals(e){let t=!0;for(let r=0;r<Rn;r++)if(!this.rows[r].equals(e.rows[r])){t=!1;break}return t}copy(e){for(let t=0;t<Rn;t++)this.rows[t].copy(e.rows[t])}isEmpty(){let e=!0;for(let t=0;t<Rn;t++)if(!this.rows[t].isEmpty()){e=!1;break}return e}backSpace(){this.rows[this.currRow].backSpace()}clearToEndOfRow(){this.rows[this.currRow].clearToEndOfRow()}insertChar(e){this.rows[this.currRow].insertChar(e)}setPen(e){this.rows[this.currRow].setPenStyles(e)}moveCursor(e){this.rows[this.currRow].moveCursor(e)}setCursor(e){this.logger.log(2,"setCursor: "+e),this.rows[this.currRow].setCursor(e)}setPAC(e){this.logger.log(2,()=>"pacData = "+Ve(e));let t=e.row-1;if(this.nrRollUpRows&&t<this.nrRollUpRows-1&&(t=this.nrRollUpRows-1),this.nrRollUpRows&&this.currRow!==t){for(let o=0;o<Rn;o++)this.rows[o].clear();const s=this.currRow+1-this.nrRollUpRows,a=this.lastOutputScreen;if(a){const o=a.rows[s].cueStartTime,l=this.logger.time;if(o!==null&&l!==null&&o<l)for(let u=0;u<this.nrRollUpRows;u++)this.rows[t-this.nrRollUpRows+u+1].copy(a.rows[s+u])}}this.currRow=t;const r=this.rows[this.currRow];if(e.indent!==null){const s=e.indent,a=Math.max(s-1,0);r.setCursor(e.indent),e.color=r.chars[a].penState.foreground}const i={foreground:e.color,underline:e.underline,italics:e.italics,background:"black",flash:!1};this.setPen(i)}setBkgData(e){this.logger.log(2,()=>"bkgData = "+Ve(e)),this.backSpace(),this.setPen(e),this.insertChar(32)}setRollUpRows(e){this.nrRollUpRows=e}rollUp(){if(this.nrRollUpRows===null){this.logger.log(3,"roll_up but nrRollUpRows not set yet");return}this.logger.log(1,()=>this.getDisplayText());const e=this.currRow+1-this.nrRollUpRows,t=this.rows.splice(e,1)[0];t.clear(),this.rows.splice(this.currRow,0,t),this.logger.log(2,"Rolling up")}getDisplayText(e){e=e||!1;const t=[];let r="",i=-1;for(let s=0;s<Rn;s++){const a=this.rows[s].getTextString();a&&(i=s+1,e?t.push("Row "+i+": '"+a+"'"):t.push(a.trim()))}return t.length>0&&(e?r="["+t.join(" | ")+"]":r=t.join(`
`)),r}getTextAndFormat(){return this.rows}}class ny{constructor(e,t,r){this.chNr=void 0,this.outputFilter=void 0,this.mode=void 0,this.verbose=void 0,this.displayedMemory=void 0,this.nonDisplayedMemory=void 0,this.lastOutputScreen=void 0,this.currRollUpRow=void 0,this.writeScreen=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chNr=e,this.outputFilter=t,this.mode=null,this.verbose=0,this.displayedMemory=new wd(r),this.nonDisplayedMemory=new wd(r),this.lastOutputScreen=new wd(r),this.currRollUpRow=this.displayedMemory.rows[Rn-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null,this.logger=r}reset(){this.mode=null,this.displayedMemory.reset(),this.nonDisplayedMemory.reset(),this.lastOutputScreen.reset(),this.outputFilter.reset(),this.currRollUpRow=this.displayedMemory.rows[Rn-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null}getHandler(){return this.outputFilter}setHandler(e){this.outputFilter=e}setPAC(e){this.writeScreen.setPAC(e)}setBkgData(e){this.writeScreen.setBkgData(e)}setMode(e){e!==this.mode&&(this.mode=e,this.logger.log(2,()=>"MODE="+e),this.mode==="MODE_POP-ON"?this.writeScreen=this.nonDisplayedMemory:(this.writeScreen=this.displayedMemory,this.writeScreen.reset()),this.mode!=="MODE_ROLL-UP"&&(this.displayedMemory.nrRollUpRows=null,this.nonDisplayedMemory.nrRollUpRows=null),this.mode=e)}insertChars(e){for(let r=0;r<e.length;r++)this.writeScreen.insertChar(e[r]);const t=this.writeScreen===this.displayedMemory?"DISP":"NON_DISP";this.logger.log(2,()=>t+": "+this.writeScreen.getDisplayText(!0)),(this.mode==="MODE_PAINT-ON"||this.mode==="MODE_ROLL-UP")&&(this.logger.log(1,()=>"DISPLAYED: "+this.displayedMemory.getDisplayText(!0)),this.outputDataUpdate())}ccRCL(){this.logger.log(2,"RCL - Resume Caption Loading"),this.setMode("MODE_POP-ON")}ccBS(){this.logger.log(2,"BS - BackSpace"),this.mode!=="MODE_TEXT"&&(this.writeScreen.backSpace(),this.writeScreen===this.displayedMemory&&this.outputDataUpdate())}ccAOF(){}ccAON(){}ccDER(){this.logger.log(2,"DER- Delete to End of Row"),this.writeScreen.clearToEndOfRow(),this.outputDataUpdate()}ccRU(e){this.logger.log(2,"RU("+e+") - Roll Up"),this.writeScreen=this.displayedMemory,this.setMode("MODE_ROLL-UP"),this.writeScreen.setRollUpRows(e)}ccFON(){this.logger.log(2,"FON - Flash On"),this.writeScreen.setPen({flash:!0})}ccRDC(){this.logger.log(2,"RDC - Resume Direct Captioning"),this.setMode("MODE_PAINT-ON")}ccTR(){this.logger.log(2,"TR"),this.setMode("MODE_TEXT")}ccRTD(){this.logger.log(2,"RTD"),this.setMode("MODE_TEXT")}ccEDM(){this.logger.log(2,"EDM - Erase Displayed Memory"),this.displayedMemory.reset(),this.outputDataUpdate(!0)}ccCR(){this.logger.log(2,"CR - Carriage Return"),this.writeScreen.rollUp(),this.outputDataUpdate(!0)}ccENM(){this.logger.log(2,"ENM - Erase Non-displayed Memory"),this.nonDisplayedMemory.reset()}ccEOC(){if(this.logger.log(2,"EOC - End Of Caption"),this.mode==="MODE_POP-ON"){const e=this.displayedMemory;this.displayedMemory=this.nonDisplayedMemory,this.nonDisplayedMemory=e,this.writeScreen=this.nonDisplayedMemory,this.logger.log(1,()=>"DISP: "+this.displayedMemory.getDisplayText())}this.outputDataUpdate(!0)}ccTO(e){this.logger.log(2,"TO("+e+") - Tab Offset"),this.writeScreen.moveCursor(e)}ccMIDROW(e){const t={flash:!1};if(t.underline=e%2===1,t.italics=e>=46,t.italics)t.foreground="white";else{const r=Math.floor(e/2)-16,i=["white","green","blue","cyan","red","yellow","magenta"];t.foreground=i[r]}this.logger.log(2,"MIDROW: "+Ve(t)),this.writeScreen.setPen(t)}outputDataUpdate(e=!1){const t=this.logger.time;t!==null&&this.outputFilter&&(this.cueStartTime===null&&!this.displayedMemory.isEmpty()?this.cueStartTime=t:this.displayedMemory.equals(this.lastOutputScreen)||(this.outputFilter.newCue(this.cueStartTime,t,this.lastOutputScreen),e&&this.outputFilter.dispatchCue&&this.outputFilter.dispatchCue(),this.cueStartTime=this.displayedMemory.isEmpty()?null:t),this.lastOutputScreen.copy(this.displayedMemory))}cueSplitAtTime(e){this.outputFilter&&(this.displayedMemory.isEmpty()||(this.outputFilter.newCue&&this.outputFilter.newCue(this.cueStartTime,e,this.displayedMemory),this.cueStartTime=e))}}class ry{constructor(e,t,r){this.channels=void 0,this.currentChannel=0,this.cmdHistory=AO(),this.logger=void 0;const i=this.logger=new SO;this.channels=[null,new ny(e,t,i),new ny(e+1,r,i)]}getHandler(e){return this.channels[e].getHandler()}setHandler(e,t){this.channels[e].setHandler(t)}addData(e,t){this.logger.time=e;for(let r=0;r<t.length;r+=2){const i=t[r]&127,s=t[r+1]&127;let a=!1,o=null;if(i===0&&s===0)continue;this.logger.log(3,()=>"["+Di([t[r],t[r+1]])+"] -> ("+Di([i,s])+")");const l=this.cmdHistory;if(i>=16&&i<=31){if(LO(i,s,l)){$l(null,null,l),this.logger.log(3,()=>"Repeated command ("+Di([i,s])+") is dropped");continue}$l(i,s,this.cmdHistory),a=this.parseCmd(i,s),a||(a=this.parseMidrow(i,s)),a||(a=this.parsePAC(i,s)),a||(a=this.parseBackgroundAttributes(i,s))}else $l(null,null,l);if(!a&&(o=this.parseChars(i,s),o)){const c=this.currentChannel;c&&c>0?this.channels[c].insertChars(o):this.logger.log(2,"No channel found yet. TEXT-MODE?")}!a&&!o&&this.logger.log(2,()=>"Couldn't parse cleaned data "+Di([i,s])+" orig: "+Di([t[r],t[r+1]]))}}parseCmd(e,t){const r=(e===20||e===28||e===21||e===29)&&t>=32&&t<=47,i=(e===23||e===31)&&t>=33&&t<=35;if(!(r||i))return!1;const s=e===20||e===21||e===23?1:2,a=this.channels[s];return e===20||e===21||e===28||e===29?t===32?a.ccRCL():t===33?a.ccBS():t===34?a.ccAOF():t===35?a.ccAON():t===36?a.ccDER():t===37?a.ccRU(2):t===38?a.ccRU(3):t===39?a.ccRU(4):t===40?a.ccFON():t===41?a.ccRDC():t===42?a.ccTR():t===43?a.ccRTD():t===44?a.ccEDM():t===45?a.ccCR():t===46?a.ccENM():t===47&&a.ccEOC():a.ccTO(t-32),this.currentChannel=s,!0}parseMidrow(e,t){let r=0;if((e===17||e===25)&&t>=32&&t<=47){if(e===17?r=1:r=2,r!==this.currentChannel)return this.logger.log(0,"Mismatch channel in midrow parsing"),!1;const i=this.channels[r];return i?(i.ccMIDROW(t),this.logger.log(3,()=>"MIDROW ("+Di([e,t])+")"),!0):!1}return!1}parsePAC(e,t){let r;const i=(e>=17&&e<=23||e>=25&&e<=31)&&t>=64&&t<=127,s=(e===16||e===24)&&t>=64&&t<=95;if(!(i||s))return!1;const a=e<=23?1:2;t>=64&&t<=95?r=a===1?mO[e]:yO[e]:r=a===1?pO[e]:vO[e];const o=this.channels[a];return o?(o.setPAC(this.interpretPAC(r,t)),this.currentChannel=a,!0):!1}interpretPAC(e,t){let r;const i={color:null,italics:!1,indent:null,underline:!1,row:e};return t>95?r=t-96:r=t-64,i.underline=(r&1)===1,r<=13?i.color=["white","green","blue","cyan","red","yellow","magenta","white"][Math.floor(r/2)]:r<=15?(i.italics=!0,i.color="white"):i.indent=Math.floor((r-16)/2)*4,i}parseChars(e,t){let r,i=null,s=null;if(e>=25?(r=2,s=e-8):(r=1,s=e),s>=17&&s<=19){let a;s===17?a=t+80:s===18?a=t+112:a=t+144,this.logger.log(2,()=>"Special char '"+Yx(a)+"' in channel "+r),i=[a]}else e>=32&&e<=127&&(i=t===0?[e]:[e,t]);return i&&this.logger.log(3,()=>"Char codes =  "+Di(i).join(",")),i}parseBackgroundAttributes(e,t){const r=(e===16||e===24)&&t>=32&&t<=47,i=(e===23||e===31)&&t>=45&&t<=47;if(!(r||i))return!1;let s;const a={};e===16||e===24?(s=Math.floor((t-32)/2),a.background=EO[s],t%2===1&&(a.background=a.background+"_semi")):t===45?a.background="transparent":(a.foreground="black",t===47&&(a.underline=!0));const o=e<=23?1:2;return this.channels[o].setBkgData(a),!0}reset(){for(let e=0;e<Object.keys(this.channels).length;e++){const t=this.channels[e];t&&t.reset()}$l(null,null,this.cmdHistory)}cueSplitAtTime(e){for(let t=0;t<this.channels.length;t++){const r=this.channels[t];r&&r.cueSplitAtTime(e)}}}function $l(n,e,t){t.a=n,t.b=e}function LO(n,e,t){return t.a===n&&t.b===e}function AO(){return{a:null,b:null}}var Bg=function(){if(qu!=null&&qu.VTTCue)return self.VTTCue;const n=["","lr","rl"],e=["start","middle","end","left","right"];function t(o,l){if(typeof l!="string"||!Array.isArray(o))return!1;const u=l.toLowerCase();return~o.indexOf(u)?u:!1}function r(o){return t(n,o)}function i(o){return t(e,o)}function s(o,...l){let u=1;for(;u<arguments.length;u++){const c=arguments[u];for(const d in c)o[d]=c[d]}return o}function a(o,l,u){const c=this,d={enumerable:!0};c.hasBeenReset=!1;let h="",f=!1,g=o,m=l,y=u,p=null,v="",E=!0,T="auto",A="start",I=50,R="middle",x=50,D="middle";Object.defineProperty(c,"id",s({},d,{get:function(){return h},set:function(_){h=""+_}})),Object.defineProperty(c,"pauseOnExit",s({},d,{get:function(){return f},set:function(_){f=!!_}})),Object.defineProperty(c,"startTime",s({},d,{get:function(){return g},set:function(_){if(typeof _!="number")throw new TypeError("Start time must be set to a number.");g=_,this.hasBeenReset=!0}})),Object.defineProperty(c,"endTime",s({},d,{get:function(){return m},set:function(_){if(typeof _!="number")throw new TypeError("End time must be set to a number.");m=_,this.hasBeenReset=!0}})),Object.defineProperty(c,"text",s({},d,{get:function(){return y},set:function(_){y=""+_,this.hasBeenReset=!0}})),Object.defineProperty(c,"region",s({},d,{get:function(){return p},set:function(_){p=_,this.hasBeenReset=!0}})),Object.defineProperty(c,"vertical",s({},d,{get:function(){return v},set:function(_){const M=r(_);if(M===!1)throw new SyntaxError("An invalid or illegal string was specified.");v=M,this.hasBeenReset=!0}})),Object.defineProperty(c,"snapToLines",s({},d,{get:function(){return E},set:function(_){E=!!_,this.hasBeenReset=!0}})),Object.defineProperty(c,"line",s({},d,{get:function(){return T},set:function(_){if(typeof _!="number"&&_!=="auto")throw new SyntaxError("An invalid number or illegal string was specified.");T=_,this.hasBeenReset=!0}})),Object.defineProperty(c,"lineAlign",s({},d,{get:function(){return A},set:function(_){const M=i(_);if(!M)throw new SyntaxError("An invalid or illegal string was specified.");A=M,this.hasBeenReset=!0}})),Object.defineProperty(c,"position",s({},d,{get:function(){return I},set:function(_){if(_<0||_>100)throw new Error("Position must be between 0 and 100.");I=_,this.hasBeenReset=!0}})),Object.defineProperty(c,"positionAlign",s({},d,{get:function(){return R},set:function(_){const M=i(_);if(!M)throw new SyntaxError("An invalid or illegal string was specified.");R=M,this.hasBeenReset=!0}})),Object.defineProperty(c,"size",s({},d,{get:function(){return x},set:function(_){if(_<0||_>100)throw new Error("Size must be between 0 and 100.");x=_,this.hasBeenReset=!0}})),Object.defineProperty(c,"align",s({},d,{get:function(){return D},set:function(_){const M=i(_);if(!M)throw new SyntaxError("An invalid or illegal string was specified.");D=M,this.hasBeenReset=!0}})),c.displayState=void 0}return a.prototype.getCueAsHTML=function(){return self.WebVTT.convertCueToDOMTree(self,this.text)},a}();class RO{decode(e,t){if(!e)return"";if(typeof e!="string")throw new Error("Error - expected string data.");return decodeURIComponent(encodeURIComponent(e))}}function Qx(n){function e(r,i,s,a){return(r|0)*3600+(i|0)*60+(s|0)+parseFloat(a||0)}const t=n.match(/^(?:(\d+):)?(\d{2}):(\d{2})(\.\d+)?/);return t?parseFloat(t[2])>59?e(t[2],t[3],0,t[4]):e(t[1],t[2],t[3],t[4]):null}class _O{constructor(){this.values=Object.create(null)}set(e,t){!this.get(e)&&t!==""&&(this.values[e]=t)}get(e,t,r){return r?this.has(e)?this.values[e]:t[r]:this.has(e)?this.values[e]:t}has(e){return e in this.values}alt(e,t,r){for(let i=0;i<r.length;++i)if(t===r[i]){this.set(e,t);break}}integer(e,t){/^-?\d+$/.test(t)&&this.set(e,parseInt(t,10))}percent(e,t){if(/^([\d]{1,3})(\.[\d]*)?%$/.test(t)){const r=parseFloat(t);if(r>=0&&r<=100)return this.set(e,r),!0}return!1}}function Xx(n,e,t,r){const i=r?n.split(r):[n];for(const s in i){if(typeof i[s]!="string")continue;const a=i[s].split(t);if(a.length!==2)continue;const o=a[0],l=a[1];e(o,l)}}const of=new Bg(0,0,""),jl=of.align==="middle"?"middle":"center";function IO(n,e,t){const r=n;function i(){const o=Qx(n);if(o===null)throw new Error("Malformed timestamp: "+r);return n=n.replace(/^[^\sa-zA-Z-]+/,""),o}function s(o,l){const u=new _O;Xx(o,function(h,f){let g;switch(h){case"region":for(let m=t.length-1;m>=0;m--)if(t[m].id===f){u.set(h,t[m].region);break}break;case"vertical":u.alt(h,f,["rl","lr"]);break;case"line":g=f.split(","),u.integer(h,g[0]),u.percent(h,g[0])&&u.set("snapToLines",!1),u.alt(h,g[0],["auto"]),g.length===2&&u.alt("lineAlign",g[1],["start",jl,"end"]);break;case"position":g=f.split(","),u.percent(h,g[0]),g.length===2&&u.alt("positionAlign",g[1],["start",jl,"end","line-left","line-right","auto"]);break;case"size":u.percent(h,f);break;case"align":u.alt(h,f,["start",jl,"end","left","right"]);break}},/:/,/\s/),l.region=u.get("region",null),l.vertical=u.get("vertical","");let c=u.get("line","auto");c==="auto"&&of.line===-1&&(c=-1),l.line=c,l.lineAlign=u.get("lineAlign","start"),l.snapToLines=u.get("snapToLines",!0),l.size=u.get("size",100),l.align=u.get("align",jl);let d=u.get("position","auto");d==="auto"&&of.position===50&&(d=l.align==="start"||l.align==="left"?0:l.align==="end"||l.align==="right"?100:50),l.position=d}function a(){n=n.replace(/^\s+/,"")}if(a(),e.startTime=i(),a(),n.slice(0,3)!=="-->")throw new Error("Malformed time stamp (time stamps must be separated by '-->'): "+r);n=n.slice(3),a(),e.endTime=i(),a(),s(n,e)}function Zx(n){return n.replace(/<br(?: \/)?>/gi,`
`)}class DO{constructor(){this.state="INITIAL",this.buffer="",this.decoder=new RO,this.regionList=[],this.cue=null,this.oncue=void 0,this.onparsingerror=void 0,this.onflush=void 0}parse(e){const t=this;e&&(t.buffer+=t.decoder.decode(e,{stream:!0}));function r(){let s=t.buffer,a=0;for(s=Zx(s);a<s.length&&s[a]!=="\r"&&s[a]!==`
`;)++a;const o=s.slice(0,a);return s[a]==="\r"&&++a,s[a]===`
`&&++a,t.buffer=s.slice(a),o}function i(s){Xx(s,function(a,o){},/:/)}try{let s="";if(t.state==="INITIAL"){if(!/\r\n|\n/.test(t.buffer))return this;s=r();const o=s.match(/^()?WEBVTT([ \t].*)?$/);if(!(o!=null&&o[0]))throw new Error("Malformed WebVTT signature.");t.state="HEADER"}let a=!1;for(;t.buffer;){if(!/\r\n|\n/.test(t.buffer))return this;switch(a?a=!1:s=r(),t.state){case"HEADER":/:/.test(s)?i(s):s||(t.state="ID");continue;case"NOTE":s||(t.state="ID");continue;case"ID":if(/^NOTE($|[ \t])/.test(s)){t.state="NOTE";break}if(!s)continue;if(t.cue=new Bg(0,0,""),t.state="CUE",s.indexOf("-->")===-1){t.cue.id=s;continue}case"CUE":if(!t.cue){t.state="BADCUE";continue}try{IO(s,t.cue,t.regionList)}catch{t.cue=null,t.state="BADCUE";continue}t.state="CUETEXT";continue;case"CUETEXT":{const o=s.indexOf("-->")!==-1;if(!s||o&&(a=!0)){t.oncue&&t.cue&&t.oncue(t.cue),t.cue=null,t.state="ID";continue}if(t.cue===null)continue;t.cue.text&&(t.cue.text+=`
`),t.cue.text+=s}continue;case"BADCUE":s||(t.state="ID")}}}catch{t.state==="CUETEXT"&&t.cue&&t.oncue&&t.oncue(t.cue),t.cue=null,t.state=t.state==="INITIAL"?"BADWEBVTT":"BADCUE"}return this}flush(){const e=this;try{if((e.cue||e.state==="HEADER")&&(e.buffer+=`

`,e.parse()),e.state==="INITIAL"||e.state==="BADWEBVTT")throw new Error("Malformed WebVTT signature.")}catch(t){e.onparsingerror&&e.onparsingerror(t)}return e.onflush&&e.onflush(),this}}const CO=/\r\n|\n\r|\n|\r/g,bd=function(e,t,r=0){return e.slice(r,r+t.length)===t},wO=function(e){let t=parseInt(e.slice(-3));const r=parseInt(e.slice(-6,-4)),i=parseInt(e.slice(-9,-7)),s=e.length>9?parseInt(e.substring(0,e.indexOf(":"))):0;if(!Z(t)||!Z(r)||!Z(i)||!Z(s))throw Error(`Malformed X-TIMESTAMP-MAP: Local:${e}`);return t+=1e3*r,t+=60*1e3*i,t+=60*60*1e3*s,t};function $g(n,e,t){return io(n.toString())+io(e.toString())+io(t)}const bO=function(e,t,r){let i=e[t],s=e[i.prevCC];if(!s||!s.new&&i.new){e.ccOffset=e.presentationOffset=i.start,i.new=!1;return}for(;(a=s)!=null&&a.new;){var a;e.ccOffset+=i.start-s.start,i.new=!1,i=s,s=e[i.prevCC]}e.presentationOffset=r};function kO(n,e,t,r,i,s,a){const o=new DO,l=sn(new Uint8Array(n)).trim().replace(CO,`
`).split(`
`),u=[],c=e?Wk(e.baseTime,e.timescale):0;let d="00:00.000",h=0,f=0,g,m=!0;o.oncue=function(y){const p=t[r];let v=t.ccOffset;const E=(h-c)/9e4;if(p!=null&&p.new&&(f!==void 0?v=t.ccOffset=p.start:bO(t,r,E)),E){if(!e){g=new Error("Missing initPTS for VTT MPEGTS");return}v=E-t.presentationOffset}const T=y.endTime-y.startTime,A=gn((y.startTime+v-f)*9e4,i*9e4)/9e4;y.startTime=Math.max(A,0),y.endTime=Math.max(A+T,0);const I=y.text.trim();y.text=decodeURIComponent(encodeURIComponent(I)),y.id||(y.id=$g(y.startTime,y.endTime,I)),y.endTime>0&&u.push(y)},o.onparsingerror=function(y){g=y},o.onflush=function(){if(g){a(g);return}s(u)},l.forEach(y=>{if(m)if(bd(y,"X-TIMESTAMP-MAP=")){m=!1,y.slice(16).split(",").forEach(p=>{bd(p,"LOCAL:")?d=p.slice(6):bd(p,"MPEGTS:")&&(h=parseInt(p.slice(7)))});try{f=wO(d)/1e3}catch(p){g=p}return}else y===""&&(m=!1);o.parse(y+`
`)}),o.flush()}const kd="stpp.ttml.im1t",Jx=/^(\d{2,}):(\d{2}):(\d{2}):(\d{2})\.?(\d+)?$/,eT=/^(\d*(?:\.\d*)?)(h|m|s|ms|f|t)$/,PO={left:"start",center:"center",right:"end",start:"start",end:"end"};function iy(n,e,t,r){const i=me(new Uint8Array(n),["mdat"]);if(i.length===0){r(new Error("Could not parse IMSC1 mdat"));return}const s=i.map(o=>sn(o)),a=zk(e.baseTime,1,e.timescale);try{s.forEach(o=>t(OO(o,a)))}catch(o){r(o)}}function OO(n,e){const i=new DOMParser().parseFromString(n,"text/xml").getElementsByTagName("tt")[0];if(!i)throw new Error("Invalid ttml");const s={frameRate:30,subFrameRate:1,frameRateMultiplier:0,tickRate:0},a=Object.keys(s).reduce((d,h)=>(d[h]=i.getAttribute(`ttp:${h}`)||s[h],d),{}),o=i.getAttribute("xml:space")!=="preserve",l=sy(Pd(i,"styling","style")),u=sy(Pd(i,"layout","region")),c=Pd(i,"body","[begin]");return[].map.call(c,d=>{const h=tT(d,o);if(!h||!d.hasAttribute("begin"))return null;const f=Fd(d.getAttribute("begin"),a),g=Fd(d.getAttribute("dur"),a);let m=Fd(d.getAttribute("end"),a);if(f===null)throw ay(d);if(m===null){if(g===null)throw ay(d);m=f+g}const y=new Bg(f-e,m-e,h);y.id=$g(y.startTime,y.endTime,y.text);const p=u[d.getAttribute("region")],v=l[d.getAttribute("style")],E=FO(p,v,l),{textAlign:T}=E;if(T){const A=PO[T];A&&(y.lineAlign=A),y.align=T}return Oe(y,E),y}).filter(d=>d!==null)}function Pd(n,e,t){const r=n.getElementsByTagName(e)[0];return r?[].slice.call(r.querySelectorAll(t)):[]}function sy(n){return n.reduce((e,t)=>{const r=t.getAttribute("xml:id");return r&&(e[r]=t),e},{})}function tT(n,e){return[].slice.call(n.childNodes).reduce((t,r,i)=>{var s;return r.nodeName==="br"&&i?t+`
`:(s=r.childNodes)!=null&&s.length?tT(r,e):e?t+r.textContent.trim().replace(/\s+/g," "):t+r.textContent},"")}function FO(n,e,t){const r="http://www.w3.org/ns/ttml#styling";let i=null;const s=["displayAlign","textAlign","color","backgroundColor","fontSize","fontFamily"],a=n!=null&&n.hasAttribute("style")?n.getAttribute("style"):null;return a&&t.hasOwnProperty(a)&&(i=t[a]),s.reduce((o,l)=>{const u=Od(e,r,l)||Od(n,r,l)||Od(i,r,l);return u&&(o[l]=u),o},{})}function Od(n,e,t){return n&&n.hasAttributeNS(e,t)?n.getAttributeNS(e,t):null}function ay(n){return new Error(`Could not parse ttml timestamp ${n}`)}function Fd(n,e){if(!n)return null;let t=Qx(n);return t===null&&(Jx.test(n)?t=MO(n,e):eT.test(n)&&(t=NO(n,e))),t}function MO(n,e){const t=Jx.exec(n),r=(t[4]|0)+(t[5]|0)/e.subFrameRate;return(t[1]|0)*3600+(t[2]|0)*60+(t[3]|0)+r/e.frameRate}function NO(n,e){const t=eT.exec(n),r=Number(t[1]);switch(t[2]){case"h":return r*3600;case"m":return r*60;case"ms":return r*1e3;case"f":return r/e.frameRate;case"t":return r/e.tickRate}return r}class Gl{constructor(e,t){this.timelineController=void 0,this.cueRanges=[],this.trackName=void 0,this.startTime=null,this.endTime=null,this.screen=null,this.timelineController=e,this.trackName=t}dispatchCue(){this.startTime!==null&&(this.timelineController.addCues(this.trackName,this.startTime,this.endTime,this.screen,this.cueRanges),this.startTime=null)}newCue(e,t,r){(this.startTime===null||this.startTime>e)&&(this.startTime=e),this.endTime=t,this.screen=r,this.timelineController.createCaptionsTrack(this.trackName)}reset(){this.cueRanges=[],this.startTime=null}}class UO{constructor(e){this.hls=void 0,this.media=null,this.config=void 0,this.enabled=!0,this.Cues=void 0,this.textTracks=[],this.tracks=[],this.initPTS=[],this.unparsedVttFrags=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.cea608Parser1=void 0,this.cea608Parser2=void 0,this.lastCc=-1,this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs=ly(),this.captionsProperties=void 0,this.hls=e,this.config=e.config,this.Cues=e.config.cueHandler,this.captionsProperties={textTrack1:{label:this.config.captionsTextTrack1Label,languageCode:this.config.captionsTextTrack1LanguageCode},textTrack2:{label:this.config.captionsTextTrack2Label,languageCode:this.config.captionsTextTrack2LanguageCode},textTrack3:{label:this.config.captionsTextTrack3Label,languageCode:this.config.captionsTextTrack3LanguageCode},textTrack4:{label:this.config.captionsTextTrack4Label,languageCode:this.config.captionsTextTrack4LanguageCode}},e.on(S.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(S.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(S.MANIFEST_LOADING,this.onManifestLoading,this),e.on(S.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(S.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.on(S.FRAG_LOADING,this.onFragLoading,this),e.on(S.FRAG_LOADED,this.onFragLoaded,this),e.on(S.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),e.on(S.FRAG_DECRYPTED,this.onFragDecrypted,this),e.on(S.INIT_PTS_FOUND,this.onInitPtsFound,this),e.on(S.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),e.on(S.BUFFER_FLUSHING,this.onBufferFlushing,this)}destroy(){const{hls:e}=this;e.off(S.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(S.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(S.MANIFEST_LOADING,this.onManifestLoading,this),e.off(S.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(S.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.off(S.FRAG_LOADING,this.onFragLoading,this),e.off(S.FRAG_LOADED,this.onFragLoaded,this),e.off(S.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),e.off(S.FRAG_DECRYPTED,this.onFragDecrypted,this),e.off(S.INIT_PTS_FOUND,this.onInitPtsFound,this),e.off(S.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),e.off(S.BUFFER_FLUSHING,this.onBufferFlushing,this),this.hls=this.config=this.media=null,this.cea608Parser1=this.cea608Parser2=void 0}initCea608Parsers(){const e=new Gl(this,"textTrack1"),t=new Gl(this,"textTrack2"),r=new Gl(this,"textTrack3"),i=new Gl(this,"textTrack4");this.cea608Parser1=new ry(1,e,t),this.cea608Parser2=new ry(3,r,i)}addCues(e,t,r,i,s){let a=!1;for(let o=s.length;o--;){const l=s[o],u=BO(l[0],l[1],t,r);if(u>=0&&(l[0]=Math.min(l[0],t),l[1]=Math.max(l[1],r),a=!0,u/(r-t)>.5))return}if(a||s.push([t,r]),this.config.renderTextTracksNatively){const o=this.captionsTracks[e];this.Cues.newCue(o,t,r,i)}else{const o=this.Cues.newCue(null,t,r,i);this.hls.trigger(S.CUES_PARSED,{type:"captions",cues:o,track:e})}}onInitPtsFound(e,{frag:t,id:r,initPTS:i,timescale:s}){const{unparsedVttFrags:a}=this;r===ne.MAIN&&(this.initPTS[t.cc]={baseTime:i,timescale:s}),a.length&&(this.unparsedVttFrags=[],a.forEach(o=>{this.onFragLoaded(S.FRAG_LOADED,o)}))}getExistingTrack(e,t){const{media:r}=this;if(r)for(let i=0;i<r.textTracks.length;i++){const s=r.textTracks[i];if(oy(s,{name:e,lang:t,characteristics:"transcribes-spoken-dialog,describes-music-and-sound"}))return s}return null}createCaptionsTrack(e){this.config.renderTextTracksNatively?this.createNativeTrack(e):this.createNonNativeTrack(e)}createNativeTrack(e){if(this.captionsTracks[e])return;const{captionsProperties:t,captionsTracks:r,media:i}=this,{label:s,languageCode:a}=t[e],o=this.getExistingTrack(s,a);if(o)r[e]=o,Os(r[e]),Hx(r[e],i);else{const l=this.createTextTrack("captions",s,a);l&&(l[e]=!0,r[e]=l)}}createNonNativeTrack(e){if(this.nonNativeCaptionsTracks[e])return;const t=this.captionsProperties[e];if(!t)return;const r=t.label,i={_id:e,label:r,kind:"captions",default:t.media?!!t.media.default:!1,closedCaptions:t.media};this.nonNativeCaptionsTracks[e]=i,this.hls.trigger(S.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:[i]})}createTextTrack(e,t,r){const i=this.media;if(i)return i.addTextTrack(e,t,r)}onMediaAttaching(e,t){this.media=t.media,t.mediaSource||this._cleanTracks()}onMediaDetaching(e,t){const r=!!t.transferMedia;if(this.media=null,r)return;const{captionsTracks:i}=this;Object.keys(i).forEach(s=>{Os(i[s]),delete i[s]}),this.nonNativeCaptionsTracks={}}onManifestLoading(){this.lastCc=-1,this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs=ly(),this._cleanTracks(),this.tracks=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.textTracks=[],this.unparsedVttFrags=[],this.initPTS=[],this.cea608Parser1&&this.cea608Parser2&&(this.cea608Parser1.reset(),this.cea608Parser2.reset())}_cleanTracks(){const{media:e}=this;if(!e)return;const t=e.textTracks;if(t)for(let r=0;r<t.length;r++)Os(t[r])}onSubtitleTracksUpdated(e,t){const r=t.subtitleTracks||[],i=r.some(s=>s.textCodec===kd);if(this.config.enableWebVTT||i&&this.config.enableIMSC1){if(Nx(this.tracks,r)){this.tracks=r;return}if(this.textTracks=[],this.tracks=r,this.config.renderTextTracksNatively){const a=this.media,o=a?hu(a.textTracks):null;if(this.tracks.forEach((l,u)=>{let c;if(o){let d=null;for(let h=0;h<o.length;h++)if(o[h]&&oy(o[h],l)){d=o[h],o[h]=null;break}d&&(c=d)}if(c)Os(c);else{const d=nT(l);c=this.createTextTrack(d,l.name,l.lang),c&&(c.mode="disabled")}c&&this.textTracks.push(c)}),o!=null&&o.length){const l=o.filter(u=>u!==null).map(u=>u.label);l.length&&this.hls.logger.warn(`Media element contains unused subtitle tracks: ${l.join(", ")}. Replace media element for each source to clear TextTracks and captions menu.`)}}else if(this.tracks.length){const a=this.tracks.map(o=>({label:o.name,kind:o.type.toLowerCase(),default:o.default,subtitleTrack:o}));this.hls.trigger(S.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:a})}}}onManifestLoaded(e,t){this.config.enableCEA708Captions&&t.captions&&t.captions.forEach(r=>{const i=/(?:CC|SERVICE)([1-4])/.exec(r.instreamId);if(!i)return;const s=`textTrack${i[1]}`,a=this.captionsProperties[s];a&&(a.label=r.name,r.lang&&(a.languageCode=r.lang),a.media=r)})}closedCaptionsForLevel(e){const t=this.hls.levels[e.level];return t==null?void 0:t.attrs["CLOSED-CAPTIONS"]}onFragLoading(e,t){if(this.enabled&&t.frag.type===ne.MAIN){var r,i;const{cea608Parser1:s,cea608Parser2:a,lastSn:o}=this,{cc:l,sn:u}=t.frag,c=(r=(i=t.part)==null?void 0:i.index)!=null?r:-1;s&&a&&(u!==o+1||u===o&&c!==this.lastPartIndex+1||l!==this.lastCc)&&(s.reset(),a.reset()),this.lastCc=l,this.lastSn=u,this.lastPartIndex=c}}onFragLoaded(e,t){const{frag:r,payload:i}=t;if(r.type===ne.SUBTITLE)if(i.byteLength){const s=r.decryptdata,a="stats"in t;if(s==null||!s.encrypted||a){const o=this.tracks[r.level],l=this.vttCCs;l[r.cc]||(l[r.cc]={start:r.start,prevCC:this.prevCC,new:!0},this.prevCC=r.cc),o&&o.textCodec===kd?this._parseIMSC1(r,i):this._parseVTTs(t)}}else this.hls.trigger(S.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:r,error:new Error("Empty subtitle payload")})}_parseIMSC1(e,t){const r=this.hls;iy(t,this.initPTS[e.cc],i=>{this._appendCues(i,e.level),r.trigger(S.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:e})},i=>{r.logger.log(`Failed to parse IMSC1: ${i}`),r.trigger(S.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:e,error:i})})}_parseVTTs(e){var t;const{frag:r,payload:i}=e,{initPTS:s,unparsedVttFrags:a}=this,o=s.length-1;if(!s[r.cc]&&o===-1){a.push(e);return}const l=this.hls,u=(t=r.initSegment)!=null&&t.data?Tn(r.initSegment.data,new Uint8Array(i)).buffer:i;kO(u,this.initPTS[r.cc],this.vttCCs,r.cc,r.start,c=>{this._appendCues(c,r.level),l.trigger(S.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:r})},c=>{const d=c.message==="Missing initPTS for VTT MPEGTS";d?a.push(e):this._fallbackToIMSC1(r,i),l.logger.log(`Failed to parse VTT cue: ${c}`),!(d&&o>r.cc)&&l.trigger(S.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:r,error:c})})}_fallbackToIMSC1(e,t){const r=this.tracks[e.level];r.textCodec||iy(t,this.initPTS[e.cc],()=>{r.textCodec=kd,this._parseIMSC1(e,t)},()=>{r.textCodec="wvtt"})}_appendCues(e,t){const r=this.hls;if(this.config.renderTextTracksNatively){const i=this.textTracks[t];if(!i||i.mode==="disabled")return;e.forEach(s=>zx(i,s))}else{const i=this.tracks[t];if(!i)return;const s=i.default?"default":"subtitles"+t;r.trigger(S.CUES_PARSED,{type:"subtitles",cues:e,track:s})}}onFragDecrypted(e,t){const{frag:r}=t;r.type===ne.SUBTITLE&&this.onFragLoaded(S.FRAG_LOADED,t)}onSubtitleTracksCleared(){this.tracks=[],this.captionsTracks={}}onFragParsingUserdata(e,t){if(!this.enabled||!this.config.enableCEA708Captions)return;const{frag:r,samples:i}=t;if(!(r.type===ne.MAIN&&this.closedCaptionsForLevel(r)==="NONE"))for(let s=0;s<i.length;s++){const a=i[s].bytes;if(a){this.cea608Parser1||this.initCea608Parsers();const o=this.extractCea608Data(a);this.cea608Parser1.addData(i[s].pts,o[0]),this.cea608Parser2.addData(i[s].pts,o[1])}}}onBufferFlushing(e,{startOffset:t,endOffset:r,endOffsetSubtitles:i,type:s}){const{media:a}=this;if(!(!a||a.currentTime<r)){if(!s||s==="video"){const{captionsTracks:o}=this;Object.keys(o).forEach(l=>af(o[l],t,r))}if(this.config.renderTextTracksNatively&&t===0&&i!==void 0){const{textTracks:o}=this;Object.keys(o).forEach(l=>af(o[l],t,i))}}}extractCea608Data(e){const t=[[],[]],r=e[0]&31;let i=2;for(let s=0;s<r;s++){const a=e[i++],o=127&e[i++],l=127&e[i++];if(o===0&&l===0)continue;if((4&a)!==0){const c=3&a;(c===0||c===1)&&(t[c].push(o),t[c].push(l))}}return t}}function nT(n){return n.characteristics&&/transcribes-spoken-dialog/gi.test(n.characteristics)&&/describes-music-and-sound/gi.test(n.characteristics)?"captions":"subtitles"}function oy(n,e){return!!n&&n.kind===nT(e)&&nf(e,n)}function BO(n,e,t,r){return Math.min(e,r)-Math.max(n,t)}function ly(){return{ccOffset:0,presentationOffset:0,0:{start:0,prevCC:-1,new:!0}}}const $O=/\s/,jO={newCue(n,e,t,r){const i=[];let s,a,o,l,u;const c=self.VTTCue||self.TextTrackCue;for(let h=0;h<r.rows.length;h++)if(s=r.rows[h],o=!0,l=0,u="",!s.isEmpty()){var d;for(let m=0;m<s.chars.length;m++)$O.test(s.chars[m].uchar)&&o?l++:(u+=s.chars[m].uchar,o=!1);s.cueStartTime=e,e===t&&(t+=1e-4),l>=16?l--:l++;const f=Zx(u.trim()),g=$g(e,t,f);n!=null&&(d=n.cues)!=null&&d.getCueById(g)||(a=new c(e,t,f),a.id=g,a.line=h+1,a.align="left",a.position=10+Math.min(80,Math.floor(l*8/32)*10),i.push(a))}return n&&i.length&&(i.sort((h,f)=>h.line==="auto"||f.line==="auto"?0:h.line>8&&f.line>8?f.line-h.line:h.line-f.line),i.forEach(h=>zx(n,h))),i}};function GO(){if(self.fetch&&self.AbortController&&self.ReadableStream&&self.Request)try{return new self.ReadableStream({}),!0}catch{}return!1}const KO=/(\d+)-(\d+)\/(\d+)/;class uy{constructor(e){this.fetchSetup=void 0,this.requestTimeout=void 0,this.request=null,this.response=null,this.controller=void 0,this.context=null,this.config=null,this.callbacks=null,this.stats=void 0,this.loader=null,this.fetchSetup=e.fetchSetup||WO,this.controller=new self.AbortController,this.stats=new xg}destroy(){this.loader=this.callbacks=this.context=this.config=this.request=null,this.abortInternal(),this.response=null,this.fetchSetup=this.controller=this.stats=null}abortInternal(){this.controller&&!this.stats.loading.end&&(this.stats.aborted=!0,this.controller.abort())}abort(){var e;this.abortInternal(),(e=this.callbacks)!=null&&e.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.response)}load(e,t,r){const i=this.stats;if(i.loading.start)throw new Error("Loader can only be used once.");i.loading.start=self.performance.now();const s=VO(e,this.controller.signal),a=e.responseType==="arraybuffer",o=a?"byteLength":"length",{maxTimeToFirstByteMs:l,maxLoadTimeMs:u}=t.loadPolicy;this.context=e,this.config=t,this.callbacks=r,this.request=this.fetchSetup(e,s),self.clearTimeout(this.requestTimeout),t.timeout=l&&Z(l)?l:u,this.requestTimeout=self.setTimeout(()=>{this.callbacks&&(this.abortInternal(),this.callbacks.onTimeout(i,e,this.response))},t.timeout),(ko(this.request)?this.request.then(self.fetch):self.fetch(this.request)).then(d=>{var h;this.response=this.loader=d;const f=Math.max(self.performance.now(),i.loading.start);if(self.clearTimeout(this.requestTimeout),t.timeout=u,this.requestTimeout=self.setTimeout(()=>{this.callbacks&&(this.abortInternal(),this.callbacks.onTimeout(i,e,this.response))},u-(f-i.loading.start)),!d.ok){const{status:m,statusText:y}=d;throw new YO(y||"fetch, bad network response",m,d)}i.loading.first=f,i.total=zO(d.headers)||i.total;const g=(h=this.callbacks)==null?void 0:h.onProgress;return g&&Z(t.highWaterMark)?this.loadProgressively(d,i,e,t.highWaterMark,g):a?d.arrayBuffer():e.responseType==="json"?d.json():d.text()}).then(d=>{var h,f;const g=this.response;if(!g)throw new Error("loader destroyed");self.clearTimeout(this.requestTimeout),i.loading.end=Math.max(self.performance.now(),i.loading.first);const m=d[o];m&&(i.loaded=i.total=m);const y={url:g.url,data:d,code:g.status},p=(h=this.callbacks)==null?void 0:h.onProgress;p&&!Z(t.highWaterMark)&&p(i,e,d,g),(f=this.callbacks)==null||f.onSuccess(y,i,e,g)}).catch(d=>{var h;if(self.clearTimeout(this.requestTimeout),i.aborted)return;const f=d&&d.code||0,g=d?d.message:null;(h=this.callbacks)==null||h.onError({code:f,text:g},e,d?d.details:null,i)})}getCacheAge(){let e=null;if(this.response){const t=this.response.headers.get("age");e=t?parseFloat(t):null}return e}getResponseHeader(e){return this.response?this.response.headers.get(e):null}loadProgressively(e,t,r,i=0,s){const a=new yx,o=e.body.getReader(),l=()=>o.read().then(u=>{if(u.done)return a.dataLength&&s(t,r,a.flush().buffer,e),Promise.resolve(new ArrayBuffer(0));const c=u.value,d=c.length;return t.loaded+=d,d<i||a.dataLength?(a.push(c),a.dataLength>=i&&s(t,r,a.flush().buffer,e)):s(t,r,c.buffer,e),l()}).catch(()=>Promise.reject());return l()}}function VO(n,e){const t={method:"GET",mode:"cors",credentials:"same-origin",signal:e,headers:new self.Headers(Oe({},n.headers))};return n.rangeEnd&&t.headers.set("Range","bytes="+n.rangeStart+"-"+String(n.rangeEnd-1)),t}function HO(n){const e=KO.exec(n);if(e)return parseInt(e[2])-parseInt(e[1])+1}function zO(n){const e=n.get("Content-Range");if(e){const r=HO(e);if(Z(r))return r}const t=n.get("Content-Length");if(t)return parseInt(t)}function WO(n,e){return new self.Request(n.url,e)}class YO extends Error{constructor(e,t,r){super(e),this.code=void 0,this.details=void 0,this.code=t,this.details=r}}const qO=/^age:\s*[\d.]+\s*$/im;class rT{constructor(e){this.xhrSetup=void 0,this.requestTimeout=void 0,this.retryTimeout=void 0,this.retryDelay=void 0,this.config=null,this.callbacks=null,this.context=null,this.loader=null,this.stats=void 0,this.xhrSetup=e&&e.xhrSetup||null,this.stats=new xg,this.retryDelay=0}destroy(){this.callbacks=null,this.abortInternal(),this.loader=null,this.config=null,this.context=null,this.xhrSetup=null}abortInternal(){const e=this.loader;self.clearTimeout(this.requestTimeout),self.clearTimeout(this.retryTimeout),e&&(e.onreadystatechange=null,e.onprogress=null,e.readyState!==4&&(this.stats.aborted=!0,e.abort()))}abort(){var e;this.abortInternal(),(e=this.callbacks)!=null&&e.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.loader)}load(e,t,r){if(this.stats.loading.start)throw new Error("Loader can only be used once.");this.stats.loading.start=self.performance.now(),this.context=e,this.config=t,this.callbacks=r,this.loadInternal()}loadInternal(){const{config:e,context:t}=this;if(!e||!t)return;const r=this.loader=new self.XMLHttpRequest,i=this.stats;i.loading.first=0,i.loaded=0,i.aborted=!1;const s=this.xhrSetup;s?Promise.resolve().then(()=>{if(!(this.loader!==r||this.stats.aborted))return s(r,t.url)}).catch(a=>{if(!(this.loader!==r||this.stats.aborted))return r.open("GET",t.url,!0),s(r,t.url)}).then(()=>{this.loader!==r||this.stats.aborted||this.openAndSendXhr(r,t,e)}).catch(a=>{var o;(o=this.callbacks)==null||o.onError({code:r.status,text:a.message},t,r,i)}):this.openAndSendXhr(r,t,e)}openAndSendXhr(e,t,r){e.readyState||e.open("GET",t.url,!0);const i=t.headers,{maxTimeToFirstByteMs:s,maxLoadTimeMs:a}=r.loadPolicy;if(i)for(const o in i)e.setRequestHeader(o,i[o]);t.rangeEnd&&e.setRequestHeader("Range","bytes="+t.rangeStart+"-"+(t.rangeEnd-1)),e.onreadystatechange=this.readystatechange.bind(this),e.onprogress=this.loadprogress.bind(this),e.responseType=t.responseType,self.clearTimeout(this.requestTimeout),r.timeout=s&&Z(s)?s:a,this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),r.timeout),e.send()}readystatechange(){const{context:e,loader:t,stats:r}=this;if(!e||!t)return;const i=t.readyState,s=this.config;if(!r.aborted&&i>=2&&(r.loading.first===0&&(r.loading.first=Math.max(self.performance.now(),r.loading.start),s.timeout!==s.loadPolicy.maxLoadTimeMs&&(self.clearTimeout(this.requestTimeout),s.timeout=s.loadPolicy.maxLoadTimeMs,this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),s.loadPolicy.maxLoadTimeMs-(r.loading.first-r.loading.start)))),i===4)){self.clearTimeout(this.requestTimeout),t.onreadystatechange=null,t.onprogress=null;const u=t.status,c=t.responseType==="text"?t.responseText:null;if(u>=200&&u<300){const g=c??t.response;if(g!=null){var a,o;r.loading.end=Math.max(self.performance.now(),r.loading.first);const m=t.responseType==="arraybuffer"?g.byteLength:g.length;r.loaded=r.total=m,r.bwEstimate=r.total*8e3/(r.loading.end-r.loading.first);const y=(a=this.callbacks)==null?void 0:a.onProgress;y&&y(r,e,g,t);const p={url:t.responseURL,data:g,code:u};(o=this.callbacks)==null||o.onSuccess(p,r,e,t);return}}const d=s.loadPolicy.errorRetry,h=r.retry,f={url:e.url,data:void 0,code:u};if(Yu(d,h,!1,f))this.retry(d);else{var l;Ie.error(`${u} while loading ${e.url}`),(l=this.callbacks)==null||l.onError({code:u,text:t.statusText},e,t,r)}}}loadtimeout(){if(!this.config)return;const e=this.config.loadPolicy.timeoutRetry,t=this.stats.retry;if(Yu(e,t,!0))this.retry(e);else{var r;Ie.warn(`timeout while loading ${(r=this.context)==null?void 0:r.url}`);const i=this.callbacks;i&&(this.abortInternal(),i.onTimeout(this.stats,this.context,this.loader))}}retry(e){const{context:t,stats:r}=this;this.retryDelay=Lg(e,r.retry),r.retry++,Ie.warn(`${status?"HTTP Status "+status:"Timeout"} while loading ${t==null?void 0:t.url}, retrying ${r.retry}/${e.maxNumRetry} in ${this.retryDelay}ms`),this.abortInternal(),this.loader=null,self.clearTimeout(this.retryTimeout),this.retryTimeout=self.setTimeout(this.loadInternal.bind(this),this.retryDelay)}loadprogress(e){const t=this.stats;t.loaded=e.loaded,e.lengthComputable&&(t.total=e.total)}getCacheAge(){let e=null;if(this.loader&&qO.test(this.loader.getAllResponseHeaders())){const t=this.loader.getResponseHeader("age");e=t?parseFloat(t):null}return e}getResponseHeader(e){return this.loader&&new RegExp(`^${e}:\\s*[\\d.]+\\s*$`,"im").test(this.loader.getAllResponseHeaders())?this.loader.getResponseHeader(e):null}}const QO={maxTimeToFirstByteMs:8e3,maxLoadTimeMs:2e4,timeoutRetry:null,errorRetry:null},XO=Ce(Ce({autoStartLoad:!0,startPosition:-1,defaultAudioCodec:void 0,debug:!1,capLevelOnFPSDrop:!1,capLevelToPlayerSize:!1,ignoreDevicePixelRatio:!1,maxDevicePixelRatio:Number.POSITIVE_INFINITY,preferManagedMediaSource:!0,initialLiveManifestSize:1,maxBufferLength:30,backBufferLength:1/0,frontBufferFlushThreshold:1/0,startOnSegmentBoundary:!1,maxBufferSize:60*1e3*1e3,maxFragLookUpTolerance:.25,maxBufferHole:.1,detectStallWithCurrentTimeMs:1250,highBufferWatchdogPeriod:2,nudgeOffset:.1,nudgeMaxRetry:3,nudgeOnVideoHole:!0,liveSyncMode:"edge",liveSyncDurationCount:3,liveSyncOnStallIncrease:1,liveMaxLatencyDurationCount:1/0,liveSyncDuration:void 0,liveMaxLatencyDuration:void 0,maxLiveSyncPlaybackRate:1,liveDurationInfinity:!1,liveBackBufferLength:null,maxMaxBufferLength:600,enableWorker:!0,workerPath:null,enableSoftwareAES:!0,startLevel:void 0,startFragPrefetch:!1,fpsDroppedMonitoringPeriod:5e3,fpsDroppedMonitoringThreshold:.2,appendErrorMaxRetry:3,ignorePlaylistParsingErrors:!1,loader:rT,fLoader:void 0,pLoader:void 0,xhrSetup:void 0,licenseXhrSetup:void 0,licenseResponseCallback:void 0,abrController:Sb,bufferController:lP,capLevelController:Ng,errorController:Rb,fpsController:eO,stretchShortVideoTrack:!1,maxAudioFramesDrift:1,forceKeyFrameOnDiscontinuity:!0,abrEwmaFastLive:3,abrEwmaSlowLive:9,abrEwmaFastVoD:3,abrEwmaSlowVoD:9,abrEwmaDefaultEstimate:5e5,abrEwmaDefaultEstimateMax:5e6,abrBandWidthFactor:.95,abrBandWidthUpFactor:.7,abrMaxWithRealBitrate:!1,maxStarvationDelay:4,maxLoadingDelay:4,minAutoBitrate:0,emeEnabled:!1,widevineLicenseUrl:void 0,drmSystems:{},drmSystemOptions:{},requestMediaKeySystemAccessFunc:ax,requireKeySystemAccessOnStart:!1,testBandwidth:!0,progressive:!1,lowLatencyMode:!0,cmcd:void 0,enableDateRangeMetadataCues:!0,enableEmsgMetadataCues:!0,enableEmsgKLVMetadata:!1,enableID3MetadataCues:!0,enableInterstitialPlayback:!0,interstitialAppendInPlace:!0,interstitialLiveLookAhead:10,useMediaCapabilities:!0,preserveManualLevelOnError:!1,certLoadPolicy:{default:QO},keyLoadPolicy:{default:{maxTimeToFirstByteMs:8e3,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:2e4,backoff:"linear"},errorRetry:{maxNumRetry:8,retryDelayMs:1e3,maxRetryDelayMs:2e4,backoff:"linear"}}},manifestLoadPolicy:{default:{maxTimeToFirstByteMs:1/0,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},playlistLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:2,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},fragLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:12e4,timeoutRetry:{maxNumRetry:4,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:6,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},steeringManifestLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},interstitialAssetListLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:3e4,timeoutRetry:{maxNumRetry:0,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:0,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},manifestLoadingTimeOut:1e4,manifestLoadingMaxRetry:1,manifestLoadingRetryDelay:1e3,manifestLoadingMaxRetryTimeout:64e3,levelLoadingTimeOut:1e4,levelLoadingMaxRetry:4,levelLoadingRetryDelay:1e3,levelLoadingMaxRetryTimeout:64e3,fragLoadingTimeOut:2e4,fragLoadingMaxRetry:6,fragLoadingRetryDelay:1e3,fragLoadingMaxRetryTimeout:64e3},ZO()),{},{subtitleStreamController:hO,subtitleTrackController:rO,timelineController:UO,audioStreamController:iP,audioTrackController:sP,emeController:Ks,cmcdController:XP,contentSteeringController:JP,interstitialsController:dO});function ZO(){return{cueHandler:jO,enableWebVTT:!0,enableIMSC1:!0,enableCEA708Captions:!0,captionsTextTrack1Label:"English",captionsTextTrack1LanguageCode:"en",captionsTextTrack2Label:"Spanish",captionsTextTrack2LanguageCode:"es",captionsTextTrack3Label:"Unknown CC",captionsTextTrack3LanguageCode:"",captionsTextTrack4Label:"Unknown CC",captionsTextTrack4LanguageCode:"",renderTextTracksNatively:!0}}function JO(n,e,t){if((e.liveSyncDurationCount||e.liveMaxLatencyDurationCount)&&(e.liveSyncDuration||e.liveMaxLatencyDuration))throw new Error("Illegal hls.js config: don't mix up liveSyncDurationCount/liveMaxLatencyDurationCount and liveSyncDuration/liveMaxLatencyDuration");if(e.liveMaxLatencyDurationCount!==void 0&&(e.liveSyncDurationCount===void 0||e.liveMaxLatencyDurationCount<=e.liveSyncDurationCount))throw new Error('Illegal hls.js config: "liveMaxLatencyDurationCount" must be greater than "liveSyncDurationCount"');if(e.liveMaxLatencyDuration!==void 0&&(e.liveSyncDuration===void 0||e.liveMaxLatencyDuration<=e.liveSyncDuration))throw new Error('Illegal hls.js config: "liveMaxLatencyDuration" must be greater than "liveSyncDuration"');const r=lf(n),i=["manifest","level","frag"],s=["TimeOut","MaxRetry","RetryDelay","MaxRetryTimeout"];return i.forEach(a=>{const o=`${a==="level"?"playlist":a}LoadPolicy`,l=e[o]===void 0,u=[];s.forEach(c=>{const d=`${a}Loading${c}`,h=e[d];if(h!==void 0&&l){u.push(d);const f=r[o].default;switch(e[o]={default:f},c){case"TimeOut":f.maxLoadTimeMs=h,f.maxTimeToFirstByteMs=h;break;case"MaxRetry":f.errorRetry.maxNumRetry=h,f.timeoutRetry.maxNumRetry=h;break;case"RetryDelay":f.errorRetry.retryDelayMs=h,f.timeoutRetry.retryDelayMs=h;break;case"MaxRetryTimeout":f.errorRetry.maxRetryDelayMs=h,f.timeoutRetry.maxRetryDelayMs=h;break}}}),u.length&&t.warn(`hls.js config: "${u.join('", "')}" setting(s) are deprecated, use "${o}": ${Ve(e[o])}`)}),Ce(Ce({},r),e)}function lf(n){return n&&typeof n=="object"?Array.isArray(n)?n.map(lf):Object.keys(n).reduce((e,t)=>(e[t]=lf(n[t]),e),{}):n}function eF(n,e){const t=n.loader;t!==uy&&t!==rT?(e.log("[config]: Custom loader detected, cannot enable progressive streaming"),n.progressive=!1):GO()&&(n.loader=uy,n.progressive=!0,n.enableSoftwareAES=!0,e.log("[config]: Progressive streaming enabled, using FetchLoader"))}const fu=2,tF=.1,nF=.05,rF=100;class iF extends rx{constructor(e,t){super("gap-controller",e.logger),this.hls=null,this.fragmentTracker=null,this.media=null,this.mediaSource=void 0,this.nudgeRetry=0,this.stallReported=!1,this.stalled=null,this.moved=!1,this.seeking=!1,this.buffered={},this.lastCurrentTime=0,this.ended=0,this.waiting=0,this.onMediaPlaying=()=>{this.ended=0,this.waiting=0},this.onMediaWaiting=()=>{var r;(r=this.media)!=null&&r.seeking||(this.waiting=self.performance.now(),this.tick())},this.onMediaEnded=()=>{if(this.hls){var r;this.ended=((r=this.media)==null?void 0:r.currentTime)||1,this.hls.trigger(S.MEDIA_ENDED,{stalled:!1})}},this.hls=e,this.fragmentTracker=t,this.registerListeners()}registerListeners(){const{hls:e}=this;e&&(e.on(S.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(S.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(S.BUFFER_APPENDED,this.onBufferAppended,this))}unregisterListeners(){const{hls:e}=this;e&&(e.off(S.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(S.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(S.BUFFER_APPENDED,this.onBufferAppended,this))}destroy(){super.destroy(),this.unregisterListeners(),this.media=this.hls=this.fragmentTracker=null,this.mediaSource=void 0}onMediaAttached(e,t){this.setInterval(rF),this.mediaSource=t.mediaSource;const r=this.media=t.media;nn(r,"playing",this.onMediaPlaying),nn(r,"waiting",this.onMediaWaiting),nn(r,"ended",this.onMediaEnded)}onMediaDetaching(e,t){this.clearInterval();const{media:r}=this;r&&(vn(r,"playing",this.onMediaPlaying),vn(r,"waiting",this.onMediaWaiting),vn(r,"ended",this.onMediaEnded),this.media=null),this.mediaSource=void 0}onBufferAppended(e,t){this.buffered=t.timeRanges}get hasBuffered(){return Object.keys(this.buffered).length>0}tick(){var e;if(!((e=this.media)!=null&&e.readyState)||!this.hasBuffered)return;const t=this.media.currentTime;this.poll(t,this.lastCurrentTime),this.lastCurrentTime=t}poll(e,t){var r,i;const s=(r=this.hls)==null?void 0:r.config;if(!s)return;const a=this.media;if(!a)return;const{seeking:o}=a,l=this.seeking&&!o,u=!this.seeking&&o,c=a.paused&&!o||a.ended||a.playbackRate===0;if(this.seeking=o,e!==t){t&&(this.ended=0),this.moved=!0,o||(this.nudgeRetry=0,s.nudgeOnVideoHole&&!c&&e>t&&this.nudgeOnVideoHole(e,t)),this.waiting===0&&this.stallResolved(e);return}if(u||l){l&&this.stallResolved(e);return}if(c){this.nudgeRetry=0,this.stallResolved(e),!this.ended&&a.ended&&this.hls&&(this.ended=e||1,this.hls.trigger(S.MEDIA_ENDED,{stalled:!1}));return}if(!ge.getBuffered(a).length){this.nudgeRetry=0;return}const d=ge.bufferInfo(a,e,0),h=d.nextStart||0,f=this.fragmentTracker;if(o&&f&&this.hls){const I=cy(this.hls.inFlightFragments,e),R=d.len>fu,x=!h||I||h-e>fu&&!f.getPartialFragment(e);if(R||x)return;this.moved=!1}const g=(i=this.hls)==null?void 0:i.latestLevelDetails;if(!this.moved&&this.stalled!==null&&f){if(!(d.len>0)&&!h)return;const R=Math.max(h,d.start||0)-e,D=!!(g!=null&&g.live)?g.targetduration*2:fu,_=f.getPartialFragment(e);if(R>0&&(R<=D||_)){a.paused||this._trySkipBufferHole(_);return}}const m=s.detectStallWithCurrentTimeMs,y=self.performance.now(),p=this.waiting;let v=this.stalled;if(v===null)if(p>0&&y-p<m)v=this.stalled=p;else{this.stalled=y;return}const E=y-v;if(!o&&(E>=m||p)&&this.hls){var T;if(((T=this.mediaSource)==null?void 0:T.readyState)==="ended"&&!(g!=null&&g.live)&&Math.abs(e-((g==null?void 0:g.edge)||0))<1){if(this.ended)return;this.ended=e||1,this.hls.trigger(S.MEDIA_ENDED,{stalled:!0});return}if(this._reportStall(d),!this.media||!this.hls)return}const A=ge.bufferInfo(a,e,s.maxBufferHole);this._tryFixBufferStall(A,E,e)}stallResolved(e){const t=this.stalled;if(t&&this.hls&&(this.stalled=null,this.stallReported)){const r=self.performance.now()-t;this.log(`playback not stuck anymore @${e}, after ${Math.round(r)}ms`),this.stallReported=!1,this.waiting=0,this.hls.trigger(S.STALL_RESOLVED,{})}}nudgeOnVideoHole(e,t){var r;const i=this.buffered.video;if(this.hls&&this.media&&this.fragmentTracker&&(r=this.buffered.audio)!=null&&r.length&&i&&i.length>1&&e>i.end(0)){const s=ge.bufferedInfo(ge.timeRangesToArray(this.buffered.audio),e,0);if(s.len>1&&t>=s.start){const a=ge.timeRangesToArray(i),o=ge.bufferedInfo(a,t,0).bufferedIndex;if(o>-1&&o<a.length-1){const l=ge.bufferedInfo(a,e,0).bufferedIndex,u=a[o].end,c=a[o+1].start;if((l===-1||l>o)&&c-u<1&&e-u<2){const d=new Error(`nudging playhead to flush pipeline after video hole. currentTime: ${e} hole: ${u} -> ${c} buffered index: ${l}`);this.warn(d.message),this.media.currentTime+=1e-6;const h=this.fragmentTracker.getPartialFragment(e)||void 0,f=ge.bufferInfo(this.media,e,0);this.hls.trigger(S.ERROR,{type:re.MEDIA_ERROR,details:O.BUFFER_SEEK_OVER_HOLE,fatal:!1,error:d,reason:d.message,frag:h,buffer:f.len,bufferInfo:f})}}}}}_tryFixBufferStall(e,t,r){var i,s;const{fragmentTracker:a,media:o}=this,l=(i=this.hls)==null?void 0:i.config;if(!o||!a||!l)return;const u=(s=this.hls)==null?void 0:s.latestLevelDetails,c=a.getPartialFragment(r);if((c||u!=null&&u.live&&r<u.fragmentStart)&&(this._trySkipBufferHole(c)||!this.media))return;const d=e.buffered,h=this.adjacentTraversal(e,r);(d&&d.length>1&&e.len>l.maxBufferHole||e.nextStart&&(e.nextStart-r<l.maxBufferHole||h))&&(t>l.highBufferWatchdogPeriod*1e3||this.waiting)&&(this.warn("Trying to nudge playhead over buffer-hole"),this._tryNudgeBuffer(e))}adjacentTraversal(e,t){const r=this.fragmentTracker,i=e.nextStart;if(r&&i){const s=r.getFragAtPos(t,ne.MAIN),a=r.getFragAtPos(i,ne.MAIN);if(s&&a)return a.sn-s.sn<2}return!1}_reportStall(e){const{hls:t,media:r,stallReported:i,stalled:s}=this;if(!i&&s!==null&&r&&t){this.stallReported=!0;const a=new Error(`Playback stalling at @${r.currentTime} due to low buffer (${Ve(e)})`);this.warn(a.message),t.trigger(S.ERROR,{type:re.MEDIA_ERROR,details:O.BUFFER_STALLED_ERROR,fatal:!1,error:a,buffer:e.len,bufferInfo:e,stalled:{start:s}})}}_trySkipBufferHole(e){var t;const{fragmentTracker:r,media:i}=this,s=(t=this.hls)==null?void 0:t.config;if(!i||!r||!s)return 0;const a=i.currentTime,o=ge.bufferInfo(i,a,0),l=a<o.start?o.start:o.nextStart;if(l&&this.hls){const c=o.len<=s.maxBufferHole,d=o.len>0&&o.len<1&&i.readyState<3,h=l-a;if(h>0&&(c||d)){if(h>s.maxBufferHole){let g=!1;if(a===0){const m=r.getAppendedFrag(0,ne.MAIN);m&&l<m.end&&(g=!0)}if(!g){const m=e||r.getAppendedFrag(a,ne.MAIN);if(m){var u;if(!((u=this.hls.loadLevelObj)!=null&&u.details)||cy(this.hls.inFlightFragments,l))return 0;let p=!1,v=m.end;for(;v<l;){const E=r.getPartialFragment(v);if(E)v+=E.duration;else{p=!0;break}}if(p)return 0}}}const f=Math.max(l+nF,a+tF);if(this.warn(`skipping hole, adjusting currentTime from ${a} to ${f}`),this.moved=!0,i.currentTime=f,!(e!=null&&e.gap)){const g=new Error(`fragment loaded with buffer holes, seeking from ${a} to ${f}`);this.hls.trigger(S.ERROR,{type:re.MEDIA_ERROR,details:O.BUFFER_SEEK_OVER_HOLE,fatal:!1,error:g,reason:g.message,frag:e||void 0,buffer:o.len,bufferInfo:o})}return f}}return 0}_tryNudgeBuffer(e){const{hls:t,media:r,nudgeRetry:i}=this,s=t==null?void 0:t.config;if(!r||!s)return 0;const a=r.currentTime;if(this.nudgeRetry++,i<s.nudgeMaxRetry){const o=a+(i+1)*s.nudgeOffset,l=new Error(`Nudging 'currentTime' from ${a} to ${o}`);this.warn(l.message),r.currentTime=o,t.trigger(S.ERROR,{type:re.MEDIA_ERROR,details:O.BUFFER_NUDGE_ON_STALL,error:l,fatal:!1,buffer:e.len,bufferInfo:e})}else{const o=new Error(`Playhead still not moving while enough data buffered @${a} after ${s.nudgeMaxRetry} nudges`);this.error(o.message),t.trigger(S.ERROR,{type:re.MEDIA_ERROR,details:O.BUFFER_STALLED_ERROR,error:o,fatal:!0,buffer:e.len,bufferInfo:e})}}}function cy(n,e){const t=dy(n.main);if(t&&t.start<=e)return t;const r=dy(n.audio);return r&&r.start<=e?r:null}function dy(n){if(!n)return null;switch(n.state){case $.IDLE:case $.STOPPED:case $.ENDED:case $.ERROR:return null}return n.frag}const sF=.25;function uf(){if(!(typeof self>"u"))return self.VTTCue||self.TextTrackCue}function hy(n,e,t,r,i){let s=new n(e,t,"");try{s.value=r,i&&(s.type=i)}catch{s=new n(e,t,Ve(i?Ce({type:i},r):r))}return s}const Kl=(()=>{const n=uf();try{n&&new n(0,Number.POSITIVE_INFINITY,"")}catch{return Number.MAX_VALUE}return Number.POSITIVE_INFINITY})();function aF(n){return Uint8Array.from(n.replace(/^0x/,"").replace(/([\da-fA-F]{2}) ?/g,"0x$1 ").replace(/ +$/,"").split(" ")).buffer}class oF{constructor(e){this.hls=void 0,this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.removeCues=!0,this.onEventCueEnter=()=>{this.hls&&this.hls.trigger(S.EVENT_CUE_ENTER,{})},this.hls=e,this._registerListeners()}destroy(){this._unregisterListeners(),this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.hls=this.onEventCueEnter=null}_registerListeners(){const{hls:e}=this;e.on(S.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(S.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(S.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(S.MANIFEST_LOADING,this.onManifestLoading,this),e.on(S.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),e.on(S.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(S.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(S.LEVEL_PTS_UPDATED,this.onLevelPtsUpdated,this)}_unregisterListeners(){const{hls:e}=this;e.off(S.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(S.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(S.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(S.MANIFEST_LOADING,this.onManifestLoading,this),e.off(S.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),e.off(S.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(S.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(S.LEVEL_PTS_UPDATED,this.onLevelPtsUpdated,this)}onMediaAttaching(e,t){var r;this.media=t.media,((r=t.overrides)==null?void 0:r.cueRemoval)===!1&&(this.removeCues=!1)}onMediaAttached(){const e=this.hls.latestLevelDetails;e&&this.updateDateRangeCues(e)}onMediaDetaching(e,t){this.media=null,!t.transferMedia&&(this.id3Track&&(this.removeCues&&Os(this.id3Track,this.onEventCueEnter),this.id3Track=null),this.dateRangeCuesAppended={})}onManifestLoading(){this.dateRangeCuesAppended={}}createTrack(e){const t=this.getID3Track(e.textTracks);return t.mode="hidden",t}getID3Track(e){if(this.media){for(let t=0;t<e.length;t++){const r=e[t];if(r.kind==="metadata"&&r.label==="id3")return Hx(r,this.media),r}return this.media.addTextTrack("metadata","id3")}}onFragParsingMetadata(e,t){if(!this.media)return;const{hls:{config:{enableEmsgMetadataCues:r,enableID3MetadataCues:i}}}=this;if(!r&&!i)return;const{samples:s}=t;this.id3Track||(this.id3Track=this.createTrack(this.media));const a=uf();if(a)for(let o=0;o<s.length;o++){const l=s[o].type;if(l===en.emsg&&!r||!i)continue;const u=Ax(s[o].data);if(u){const c=s[o].pts;let d=c+s[o].duration;d>Kl&&(d=Kl),d-c<=0&&(d=c+sF);for(let f=0;f<u.length;f++){const g=u[f];if(!Rx(g)){this.updateId3CueEnds(c,l);const m=hy(a,c,d,g,l);m&&this.id3Track.addCue(m)}}}}}updateId3CueEnds(e,t){var r;const i=(r=this.id3Track)==null?void 0:r.cues;if(i)for(let s=i.length;s--;){const a=i[s];a.type===t&&a.startTime<e&&a.endTime===Kl&&(a.endTime=e)}}onBufferFlushing(e,{startOffset:t,endOffset:r,type:i}){const{id3Track:s,hls:a}=this;if(!a)return;const{config:{enableEmsgMetadataCues:o,enableID3MetadataCues:l}}=a;if(s&&(o||l)){let u;i==="audio"?u=c=>c.type===en.audioId3&&l:i==="video"?u=c=>c.type===en.emsg&&o:u=c=>c.type===en.audioId3&&l||c.type===en.emsg&&o,af(s,t,r,u)}}onLevelUpdated(e,{details:t}){this.updateDateRangeCues(t,!0)}onLevelPtsUpdated(e,t){Math.abs(t.drift)>.01&&this.updateDateRangeCues(t.details)}updateDateRangeCues(e,t){if(!this.media||!e.hasProgramDateTime||!this.hls.config.enableDateRangeMetadataCues)return;const{id3Track:r}=this,{dateRanges:i}=e,s=Object.keys(i);let a=this.dateRangeCuesAppended;if(r&&t){var o;if((o=r.cues)!=null&&o.length){const c=Object.keys(a).filter(d=>!s.includes(d));for(let d=c.length;d--;){const h=c[d],f=a[h].cues;delete a[h],Object.keys(f).forEach(g=>{try{const m=f[g];m.removeEventListener("enter",this.onEventCueEnter),r.removeCue(m)}catch{}})}}else a=this.dateRangeCuesAppended={}}const l=e.fragments[e.fragments.length-1];if(s.length===0||!Z(l==null?void 0:l.programDateTime))return;this.id3Track||(this.id3Track=this.createTrack(this.media));const u=uf();for(let c=0;c<s.length;c++){const d=s[c],h=i[d],f=h.startTime,g=a[d],m=(g==null?void 0:g.cues)||{};let y=(g==null?void 0:g.durationKnown)||!1,p=Kl;const{duration:v,endDate:E}=h;if(E&&v!==null)p=f+v,y=!0;else if(h.endOnNext&&!y){const A=s.reduce((I,R)=>{if(R!==h.id){const x=i[R];if(x.class===h.class&&x.startDate>h.startDate&&(!I||h.startDate<I.startDate))return x}return I},null);A&&(p=A.startTime,y=!0)}const T=Object.keys(h.attr);for(let A=0;A<T.length;A++){const I=T[A];if(!Ub(I))continue;const R=m[I];if(R)y&&!g.durationKnown?R.endTime=p:Math.abs(R.startTime-f)>.01&&(R.startTime=f,R.endTime=p);else if(u){let x=h.attr[I];Bb(I)&&(x=aF(x));const _=hy(u,f,p,{key:I,data:x},en.dateRange);_&&(_.id=d,this.id3Track.addCue(_),m[I]=_,this.hls.config.interstitialsController&&(I==="X-ASSET-LIST"||I==="X-ASSET-URL")&&_.addEventListener("enter",this.onEventCueEnter))}}a[d]={cues:m,dateRange:h,durationKnown:y}}}}class lF{constructor(e){this.hls=void 0,this.config=void 0,this.media=null,this.currentTime=0,this.stallCount=0,this._latency=null,this._targetLatencyUpdated=!1,this.onTimeupdate=()=>{const{media:t}=this,r=this.levelDetails;if(!t||!r)return;this.currentTime=t.currentTime;const i=this.computeLatency();if(i===null)return;this._latency=i;const{lowLatencyMode:s,maxLiveSyncPlaybackRate:a}=this.config;if(!s||a===1||!r.live)return;const o=this.targetLatency;if(o===null)return;const l=i-o,u=Math.min(this.maxLatency,o+r.targetduration);if(l<u&&l>.05&&this.forwardBufferLength>1){const d=Math.min(2,Math.max(1,a)),h=Math.round(2/(1+Math.exp(-.75*l-this.edgeStalled))*20)/20,f=Math.min(d,Math.max(1,h));this.changeMediaPlaybackRate(t,f)}else t.playbackRate!==1&&t.playbackRate!==0&&this.changeMediaPlaybackRate(t,1)},this.hls=e,this.config=e.config,this.registerListeners()}get levelDetails(){var e;return((e=this.hls)==null?void 0:e.latestLevelDetails)||null}get latency(){return this._latency||0}get maxLatency(){const{config:e}=this;if(e.liveMaxLatencyDuration!==void 0)return e.liveMaxLatencyDuration;const t=this.levelDetails;return t?e.liveMaxLatencyDurationCount*t.targetduration:0}get targetLatency(){const e=this.levelDetails;if(e===null||this.hls===null)return null;const{holdBack:t,partHoldBack:r,targetduration:i}=e,{liveSyncDuration:s,liveSyncDurationCount:a,lowLatencyMode:o}=this.config,l=this.hls.userConfig;let u=o&&r||t;(this._targetLatencyUpdated||l.liveSyncDuration||l.liveSyncDurationCount||u===0)&&(u=s!==void 0?s:a*i);const c=i;return u+Math.min(this.stallCount*this.config.liveSyncOnStallIncrease,c)}set targetLatency(e){this.stallCount=0,this.config.liveSyncDuration=e,this._targetLatencyUpdated=!0}get liveSyncPosition(){const e=this.estimateLiveEdge(),t=this.targetLatency;if(e===null||t===null)return null;const r=this.levelDetails;if(r===null)return null;const i=r.edge,s=e-t-this.edgeStalled,a=i-r.totalduration,o=i-(this.config.lowLatencyMode&&r.partTarget||r.targetduration);return Math.min(Math.max(a,s),o)}get drift(){const e=this.levelDetails;return e===null?1:e.drift}get edgeStalled(){const e=this.levelDetails;if(e===null)return 0;const t=(this.config.lowLatencyMode&&e.partTarget||e.targetduration)*3;return Math.max(e.age-t,0)}get forwardBufferLength(){const{media:e}=this,t=this.levelDetails;if(!e||!t)return 0;const r=e.buffered.length;return(r?e.buffered.end(r-1):t.edge)-this.currentTime}destroy(){this.unregisterListeners(),this.onMediaDetaching(),this.hls=null}registerListeners(){const{hls:e}=this;e&&(e.on(S.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(S.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(S.MANIFEST_LOADING,this.onManifestLoading,this),e.on(S.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(S.ERROR,this.onError,this))}unregisterListeners(){const{hls:e}=this;e&&(e.off(S.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(S.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(S.MANIFEST_LOADING,this.onManifestLoading,this),e.off(S.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(S.ERROR,this.onError,this))}onMediaAttached(e,t){this.media=t.media,this.media.addEventListener("timeupdate",this.onTimeupdate)}onMediaDetaching(){this.media&&(this.media.removeEventListener("timeupdate",this.onTimeupdate),this.media=null)}onManifestLoading(){this._latency=null,this.stallCount=0}onLevelUpdated(e,{details:t}){t.advanced&&this.onTimeupdate(),!t.live&&this.media&&this.media.removeEventListener("timeupdate",this.onTimeupdate)}onError(e,t){var r;t.details===O.BUFFER_STALLED_ERROR&&(this.stallCount++,this.hls&&(r=this.levelDetails)!=null&&r.live&&this.hls.logger.warn("[latency-controller]: Stall detected, adjusting target latency"))}changeMediaPlaybackRate(e,t){var r,i;e.playbackRate!==t&&((r=this.hls)==null||r.logger.debug(`[latency-controller]: latency=${this.latency.toFixed(3)}, targetLatency=${(i=this.targetLatency)==null?void 0:i.toFixed(3)}, forwardBufferLength=${this.forwardBufferLength.toFixed(3)}: adjusting playback rate from ${e.playbackRate} to ${t}`),e.playbackRate=t)}estimateLiveEdge(){const e=this.levelDetails;return e===null?null:e.edge+e.age}computeLatency(){const e=this.estimateLiveEdge();return e===null?null:e-this.currentTime}}class uF extends Mg{constructor(e,t){super(e,"level-controller"),this._levels=[],this._firstLevel=-1,this._maxAutoLevel=-1,this._startLevel=void 0,this.currentLevel=null,this.currentLevelIndex=-1,this.manualLevelIndex=-1,this.steering=void 0,this.onParsedComplete=void 0,this.steering=t,this._registerListeners()}_registerListeners(){const{hls:e}=this;e.on(S.MANIFEST_LOADING,this.onManifestLoading,this),e.on(S.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(S.LEVEL_LOADED,this.onLevelLoaded,this),e.on(S.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(S.FRAG_BUFFERED,this.onFragBuffered,this),e.on(S.ERROR,this.onError,this)}_unregisterListeners(){const{hls:e}=this;e.off(S.MANIFEST_LOADING,this.onManifestLoading,this),e.off(S.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(S.LEVEL_LOADED,this.onLevelLoaded,this),e.off(S.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(S.FRAG_BUFFERED,this.onFragBuffered,this),e.off(S.ERROR,this.onError,this)}destroy(){this._unregisterListeners(),this.steering=null,this.resetLevels(),super.destroy()}stopLoad(){this._levels.forEach(t=>{t.loadError=0,t.fragmentError=0}),super.stopLoad()}resetLevels(){this._startLevel=void 0,this.manualLevelIndex=-1,this.currentLevelIndex=-1,this.currentLevel=null,this._levels=[],this._maxAutoLevel=-1}onManifestLoading(e,t){this.resetLevels()}onManifestLoaded(e,t){const r=this.hls.config.preferManagedMediaSource,i=[],s={},a={};let o=!1,l=!1,u=!1;t.levels.forEach(c=>{const d=c.attrs;let{audioCodec:h,videoCodec:f}=c;h&&(c.audioCodec=h=Vu(h,r)||void 0),f&&(f=c.videoCodec=ab(f));const{width:g,height:m,unknownCodecs:y}=c;let p=y?y.length:0;if(y)for(let _=p;_--;){const M=y[_];this.isAudioSupported(M)?(c.audioCodec=h=h?`${h},${M}`:M,p--,ha.audio[h.substring(0,4)]=2):this.isVideoSupported(M)&&(c.videoCodec=f=f?`${f},${M}`:M,p--,ha.video[f.substring(0,4)]=2)}if(o||(o=!!(g&&m)),l||(l=!!f),u||(u=!!h),p||h&&!this.isAudioSupported(h)||f&&!this.isVideoSupported(f)){this.log(`Some or all CODECS not supported "${d.CODECS}"`);return}const{CODECS:v,"FRAME-RATE":E,"HDCP-LEVEL":T,"PATHWAY-ID":A,RESOLUTION:I,"VIDEO-RANGE":R}=d,D=`${`${A||"."}-`}${c.bitrate}-${I}-${E}-${v}-${R}-${T}`;if(s[D])if(s[D].uri!==c.url&&!c.attrs["PATHWAY-ID"]){const _=a[D]+=1;c.attrs["PATHWAY-ID"]=new Array(_+1).join(".");const M=this.createLevel(c);s[D]=M,i.push(M)}else s[D].addGroupId("audio",d.AUDIO),s[D].addGroupId("text",d.SUBTITLES);else{const _=this.createLevel(c);s[D]=_,a[D]=1,i.push(_)}}),this.filterAndSortMediaOptions(i,t,o,l,u)}createLevel(e){const t=new Io(e),r=e.supplemental;if(r!=null&&r.videoCodec&&!this.isVideoSupported(r.videoCodec)){const i=new Error(`SUPPLEMENTAL-CODECS not supported "${r.videoCodec}"`);this.log(i.message),t.supportedResult=ZS(i,[])}return t}isAudioSupported(e){return Yh(e,"audio",this.hls.config.preferManagedMediaSource)}isVideoSupported(e){return Yh(e,"video",this.hls.config.preferManagedMediaSource)}filterAndSortMediaOptions(e,t,r,i,s){let a=[],o=[],l=e;if((r||i)&&s&&(l=l.filter(({videoCodec:y,videoRange:p,width:v,height:E})=>(!!y||!!(v&&E))&&db(p))),l.length===0){Promise.resolve().then(()=>{if(this.hls){let y="no level with compatible codecs found in manifest",p=y;t.levels.length&&(p=`one or more CODECS in variant not supported: ${Ve(t.levels.map(E=>E.attrs.CODECS).filter((E,T,A)=>A.indexOf(E)===T))}`,this.warn(p),y+=` (${p})`);const v=new Error(y);this.hls.trigger(S.ERROR,{type:re.MEDIA_ERROR,details:O.MANIFEST_INCOMPATIBLE_CODECS_ERROR,fatal:!0,url:t.url,error:v,reason:p})}});return}t.audioTracks&&(a=t.audioTracks.filter(y=>!y.audioCodec||this.isAudioSupported(y.audioCodec)),fy(a)),t.subtitles&&(o=t.subtitles,fy(o));const u=l.slice(0);l.sort((y,p)=>{if(y.attrs["HDCP-LEVEL"]!==p.attrs["HDCP-LEVEL"])return(y.attrs["HDCP-LEVEL"]||"")>(p.attrs["HDCP-LEVEL"]||"")?1:-1;if(r&&y.height!==p.height)return y.height-p.height;if(y.frameRate!==p.frameRate)return y.frameRate-p.frameRate;if(y.videoRange!==p.videoRange)return Hu.indexOf(y.videoRange)-Hu.indexOf(p.videoRange);if(y.videoCodec!==p.videoCodec){const v=a0(y.videoCodec),E=a0(p.videoCodec);if(v!==E)return E-v}if(y.uri===p.uri&&y.codecSet!==p.codecSet){const v=Ku(y.codecSet),E=Ku(p.codecSet);if(v!==E)return E-v}return y.averageBitrate!==p.averageBitrate?y.averageBitrate-p.averageBitrate:0});let c=u[0];if(this.steering&&(l=this.steering.filterParsedLevels(l),l.length!==u.length)){for(let y=0;y<u.length;y++)if(u[y].pathwayId===l[0].pathwayId){c=u[y];break}}this._levels=l;for(let y=0;y<l.length;y++)if(l[y]===c){var d;this._firstLevel=y;const p=c.bitrate,v=this.hls.bandwidthEstimate;if(this.log(`manifest loaded, ${l.length} level(s) found, first bitrate: ${p}`),((d=this.hls.userConfig)==null?void 0:d.abrEwmaDefaultEstimate)===void 0){const E=Math.min(p,this.hls.config.abrEwmaDefaultEstimateMax);E>v&&v===this.hls.abrEwmaDefaultEstimate&&(this.hls.bandwidthEstimate=E)}break}const h=s&&!i,f=this.hls.config,g=!!(f.audioStreamController&&f.audioTrackController),m={levels:l,audioTracks:a,subtitleTracks:o,sessionData:t.sessionData,sessionKeys:t.sessionKeys,firstLevel:this._firstLevel,stats:t.stats,audio:s,video:i,altAudio:g&&!h&&a.some(y=>!!y.url)};this.hls.trigger(S.MANIFEST_PARSED,m)}get levels(){return this._levels.length===0?null:this._levels}get loadLevelObj(){return this.currentLevel}get level(){return this.currentLevelIndex}set level(e){const t=this._levels;if(t.length===0)return;if(e<0||e>=t.length){const c=new Error("invalid level idx"),d=e<0;if(this.hls.trigger(S.ERROR,{type:re.OTHER_ERROR,details:O.LEVEL_SWITCH_ERROR,level:e,fatal:d,error:c,reason:c.message}),d)return;e=Math.min(e,t.length-1)}const r=this.currentLevelIndex,i=this.currentLevel,s=i?i.attrs["PATHWAY-ID"]:void 0,a=t[e],o=a.attrs["PATHWAY-ID"];if(this.currentLevelIndex=e,this.currentLevel=a,r===e&&i&&s===o)return;this.log(`Switching to level ${e} (${a.height?a.height+"p ":""}${a.videoRange?a.videoRange+" ":""}${a.codecSet?a.codecSet+" ":""}@${a.bitrate})${o?" with Pathway "+o:""} from level ${r}${s?" with Pathway "+s:""}`);const l={level:e,attrs:a.attrs,details:a.details,bitrate:a.bitrate,averageBitrate:a.averageBitrate,maxBitrate:a.maxBitrate,realBitrate:a.realBitrate,width:a.width,height:a.height,codecSet:a.codecSet,audioCodec:a.audioCodec,videoCodec:a.videoCodec,audioGroups:a.audioGroups,subtitleGroups:a.subtitleGroups,loaded:a.loaded,loadError:a.loadError,fragmentError:a.fragmentError,name:a.name,id:a.id,uri:a.uri,url:a.url,urlId:0,audioGroupIds:a.audioGroupIds,textGroupIds:a.textGroupIds};this.hls.trigger(S.LEVEL_SWITCHING,l);const u=a.details;if(!u||u.live){const c=this.switchParams(a.uri,i==null?void 0:i.details,u);this.loadPlaylist(c)}}get manualLevel(){return this.manualLevelIndex}set manualLevel(e){this.manualLevelIndex=e,this._startLevel===void 0&&(this._startLevel=e),e!==-1&&(this.level=e)}get firstLevel(){return this._firstLevel}set firstLevel(e){this._firstLevel=e}get startLevel(){if(this._startLevel===void 0){const e=this.hls.config.startLevel;return e!==void 0?e:this.hls.firstAutoLevel}return this._startLevel}set startLevel(e){this._startLevel=e}get pathways(){return this.steering?this.steering.pathways():[]}get pathwayPriority(){return this.steering?this.steering.pathwayPriority:null}set pathwayPriority(e){if(this.steering){const t=this.steering.pathways(),r=e.filter(i=>t.indexOf(i)!==-1);if(e.length<1){this.warn(`pathwayPriority ${e} should contain at least one pathway from list: ${t}`);return}this.steering.pathwayPriority=r}}onError(e,t){t.fatal||!t.context||t.context.type===Se.LEVEL&&t.context.level===this.level&&this.checkRetry(t)}onFragBuffered(e,{frag:t}){if(t!==void 0&&t.type===ne.MAIN){const r=t.elementaryStreams;if(!Object.keys(r).some(s=>!!r[s]))return;const i=this._levels[t.level];i!=null&&i.loadError&&(this.log(`Resetting level error count of ${i.loadError} on frag buffered`),i.loadError=0)}}onLevelLoaded(e,t){var r;const{level:i,details:s}=t,a=t.levelInfo;if(!a){var o;this.warn(`Invalid level index ${i}`),(o=t.deliveryDirectives)!=null&&o.skip&&(s.deltaUpdateFailed=!0);return}if(a===this.currentLevel||t.withoutMultiVariant){a.fragmentError===0&&(a.loadError=0);let l=a.details;l===t.details&&l.advanced&&(l=void 0),this.playlistLoaded(i,t,l)}else(r=t.deliveryDirectives)!=null&&r.skip&&(s.deltaUpdateFailed=!0)}loadPlaylist(e){super.loadPlaylist(),this.shouldLoadPlaylist(this.currentLevel)&&this.scheduleLoading(this.currentLevel,e)}loadingPlaylist(e,t){super.loadingPlaylist(e,t);const r=this.getUrlWithDirectives(e.uri,t),i=this.currentLevelIndex,s=e.attrs["PATHWAY-ID"],a=e.details,o=a==null?void 0:a.age;this.log(`Loading level index ${i}${(t==null?void 0:t.msn)!==void 0?" at sn "+t.msn+" part "+t.part:""}${s?" Pathway "+s:""}${o&&a.live?" age "+o.toFixed(1)+(a.type&&" "+a.type||""):""} ${r}`),this.hls.trigger(S.LEVEL_LOADING,{url:r,level:i,levelInfo:e,pathwayId:e.attrs["PATHWAY-ID"],id:0,deliveryDirectives:t||null})}get nextLoadLevel(){return this.manualLevelIndex!==-1?this.manualLevelIndex:this.hls.nextAutoLevel}set nextLoadLevel(e){this.level=e,this.manualLevelIndex===-1&&(this.hls.nextAutoLevel=e)}removeLevel(e){var t;if(this._levels.length===1)return;const r=this._levels.filter((s,a)=>a!==e?!0:(this.steering&&this.steering.removeLevel(s),s===this.currentLevel&&(this.currentLevel=null,this.currentLevelIndex=-1,s.details&&s.details.fragments.forEach(o=>o.level=-1)),!1));gx(r),this._levels=r,this.currentLevelIndex>-1&&(t=this.currentLevel)!=null&&t.details&&(this.currentLevelIndex=this.currentLevel.details.fragments[0].level),this.manualLevelIndex>-1&&(this.manualLevelIndex=this.currentLevelIndex);const i=r.length-1;this._firstLevel=Math.min(this._firstLevel,i),this._startLevel&&(this._startLevel=Math.min(this._startLevel,i)),this.hls.trigger(S.LEVELS_UPDATED,{levels:r})}onLevelsUpdated(e,{levels:t}){this._levels=t}checkMaxAutoUpdated(){const{autoLevelCapping:e,maxAutoLevel:t,maxHdcpLevel:r}=this.hls;this._maxAutoLevel!==t&&(this._maxAutoLevel=t,this.hls.trigger(S.MAX_AUTO_LEVEL_UPDATED,{autoLevelCapping:e,levels:this.levels,maxAutoLevel:t,minAutoLevel:this.hls.minAutoLevel,maxHdcpLevel:r}))}}function fy(n){const e={};n.forEach(t=>{const r=t.groupId||"";t.id=e[r]=e[r]||0,e[r]++})}function iT(){return self.SourceBuffer||self.WebKitSourceBuffer}function sT(){if(!vi())return!1;const e=iT();return!e||e.prototype&&typeof e.prototype.appendBuffer=="function"&&typeof e.prototype.remove=="function"}function cF(){if(!sT())return!1;const n=vi();return typeof(n==null?void 0:n.isTypeSupported)=="function"&&(["avc1.42E01E,mp4a.40.2","av01.0.01M.08","vp09.00.50.08"].some(e=>n.isTypeSupported(_o(e,"video")))||["mp4a.40.2","fLaC"].some(e=>n.isTypeSupported(_o(e,"audio"))))}function dF(){var n;const e=iT();return typeof(e==null||(n=e.prototype)==null?void 0:n.changeType)=="function"}const hF=100;class fF extends Dg{constructor(e,t,r){super(e,t,r,"stream-controller",ne.MAIN),this.audioCodecSwap=!1,this.level=-1,this._forceStartLoad=!1,this._hasEnoughToStart=!1,this.altAudio=0,this.audioOnly=!1,this.fragPlaying=null,this.fragLastKbps=0,this.couldBacktrack=!1,this.backtrackFragment=null,this.audioCodecSwitch=!1,this.videoBuffer=null,this.onMediaPlaying=()=>{this.tick()},this.onMediaSeeked=()=>{const i=this.media,s=i?i.currentTime:null;if(s===null||!Z(s)||(this.log(`Media seeked to ${s.toFixed(3)}`),!this.getBufferedFrag(s)))return;const a=this.getFwdBufferInfoAtPos(i,s,ne.MAIN,0);if(a===null||a.len===0){this.warn(`Main forward buffer length at ${s} on "seeked" event ${a?a.len:"empty"})`);return}this.tick()},this.registerListeners()}registerListeners(){super.registerListeners();const{hls:e}=this;e.on(S.MANIFEST_PARSED,this.onManifestParsed,this),e.on(S.LEVEL_LOADING,this.onLevelLoading,this),e.on(S.LEVEL_LOADED,this.onLevelLoaded,this),e.on(S.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),e.on(S.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.on(S.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),e.on(S.BUFFER_CREATED,this.onBufferCreated,this),e.on(S.BUFFER_FLUSHED,this.onBufferFlushed,this),e.on(S.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(S.FRAG_BUFFERED,this.onFragBuffered,this)}unregisterListeners(){super.unregisterListeners();const{hls:e}=this;e.off(S.MANIFEST_PARSED,this.onManifestParsed,this),e.off(S.LEVEL_LOADED,this.onLevelLoaded,this),e.off(S.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),e.off(S.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.off(S.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),e.off(S.BUFFER_CREATED,this.onBufferCreated,this),e.off(S.BUFFER_FLUSHED,this.onBufferFlushed,this),e.off(S.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(S.FRAG_BUFFERED,this.onFragBuffered,this)}onHandlerDestroying(){this.onMediaPlaying=this.onMediaSeeked=null,this.unregisterListeners(),super.onHandlerDestroying()}startLoad(e,t){if(this.levels){const{lastCurrentTime:r,hls:i}=this;if(this.stopLoad(),this.setInterval(hF),this.level=-1,!this.startFragRequested){let s=i.startLevel;s===-1&&(i.config.testBandwidth&&this.levels.length>1?(s=0,this.bitrateTest=!0):s=i.firstAutoLevel),i.nextLoadLevel=s,this.level=i.loadLevel,this._hasEnoughToStart=!!t}r>0&&e===-1&&!t&&(this.log(`Override startPosition with lastCurrentTime @${r.toFixed(3)}`),e=r),this.state=$.IDLE,this.nextLoadPosition=this.lastCurrentTime=e+this.timelineOffset,this.startPosition=t?-1:e,this.tick()}else this._forceStartLoad=!0,this.state=$.STOPPED}stopLoad(){this._forceStartLoad=!1,super.stopLoad()}doTick(){switch(this.state){case $.WAITING_LEVEL:{const{levels:t,level:r}=this,i=t==null?void 0:t[r],s=i==null?void 0:i.details;if(s&&(!s.live||this.levelLastLoaded===i&&!this.waitForLive(i))){if(this.waitForCdnTuneIn(s))break;this.state=$.IDLE;break}else if(this.hls.nextLoadLevel!==this.level){this.state=$.IDLE;break}break}case $.FRAG_LOADING_WAITING_RETRY:{var e;const t=self.performance.now(),r=this.retryDate;if(!r||t>=r||(e=this.media)!=null&&e.seeking){const{levels:i,level:s}=this,a=i==null?void 0:i[s];this.resetStartWhenNotLoaded(a||null),this.state=$.IDLE}}break}this.state===$.IDLE&&this.doTickIdle(),this.onTickEnd()}onTickEnd(){var e;super.onTickEnd(),(e=this.media)!=null&&e.readyState&&this.media.seeking===!1&&(this.lastCurrentTime=this.media.currentTime),this.checkFragmentChanged()}doTickIdle(){const{hls:e,levelLastLoaded:t,levels:r,media:i}=this;if(t===null||!i&&!this.primaryPrefetch&&(this.startFragRequested||!e.config.startFragPrefetch)||this.altAudio&&this.audioOnly)return;const s=this.buffering?e.nextLoadLevel:e.loadLevel;if(!(r!=null&&r[s]))return;const a=r[s],o=this.getMainFwdBufferInfo();if(o===null)return;const l=this.getLevelDetails();if(l&&this._streamEnded(o,l)){const m={};this.altAudio===2&&(m.type="video"),this.hls.trigger(S.BUFFER_EOS,m),this.state=$.ENDED;return}if(!this.buffering)return;e.loadLevel!==s&&e.manualLevel===-1&&this.log(`Adapting to level ${s} from level ${this.level}`),this.level=e.nextLoadLevel=s;const u=a.details;if(!u||this.state===$.WAITING_LEVEL||this.waitForLive(a)){this.level=s,this.state=$.WAITING_LEVEL,this.startFragRequested=!1;return}const c=o.len,d=this.getMaxBufferLength(a.maxBitrate);if(c>=d)return;this.backtrackFragment&&this.backtrackFragment.start>o.end&&(this.backtrackFragment=null);const h=this.backtrackFragment?this.backtrackFragment.start:o.end;let f=this.getNextFragment(h,u);if(this.couldBacktrack&&!this.fragPrevious&&f&&vt(f)&&this.fragmentTracker.getState(f)!==ct.OK){var g;const y=((g=this.backtrackFragment)!=null?g:f).sn-u.startSN,p=u.fragments[y-1];p&&f.cc===p.cc&&(f=p,this.fragmentTracker.removeFragment(p))}else this.backtrackFragment&&o.len&&(this.backtrackFragment=null);if(f&&this.isLoopLoading(f,h)){if(!f.gap){const y=this.audioOnly&&!this.altAudio?Ne.AUDIO:Ne.VIDEO,p=(y===Ne.VIDEO?this.videoBuffer:this.mediaBuffer)||this.media;p&&this.afterBufferFlushed(p,y,ne.MAIN)}f=this.getNextFragmentLoopLoading(f,u,o,ne.MAIN,d)}f&&(f.initSegment&&!f.initSegment.data&&!this.bitrateTest&&(f=f.initSegment),this.loadFragment(f,a,h))}loadFragment(e,t,r){const i=this.fragmentTracker.getState(e);i===ct.NOT_LOADED||i===ct.PARTIAL?vt(e)?this.bitrateTest?(this.log(`Fragment ${e.sn} of level ${e.level} is being downloaded to test bitrate and will not be buffered`),this._loadBitrateTestFrag(e,t)):super.loadFragment(e,t,r):this._loadInitSegment(e,t):this.clearTrackerIfNeeded(e)}getBufferedFrag(e){return this.fragmentTracker.getBufferedFrag(e,ne.MAIN)}followingBufferedFrag(e){return e?this.getBufferedFrag(e.end+.5):null}immediateLevelSwitch(){this.abortCurrentFrag(),this.flushMainBuffer(0,Number.POSITIVE_INFINITY)}nextLevelSwitch(){const{levels:e,media:t}=this;if(t!=null&&t.readyState){let r;const i=this.getAppendedFrag(t.currentTime);i&&i.start>1&&this.flushMainBuffer(0,i.start-1);const s=this.getLevelDetails();if(s!=null&&s.live){const o=this.getMainFwdBufferInfo();if(!o||o.len<s.targetduration*2)return}if(!t.paused&&e){const o=this.hls.nextLoadLevel,l=e[o],u=this.fragLastKbps;u&&this.fragCurrent?r=this.fragCurrent.duration*l.maxBitrate/(1e3*u)+1:r=0}else r=0;const a=this.getBufferedFrag(t.currentTime+r);if(a){const o=this.followingBufferedFrag(a);if(o){this.abortCurrentFrag();const l=o.maxStartPTS?o.maxStartPTS:o.start,u=o.duration,c=Math.max(a.end,l+Math.min(Math.max(u-this.config.maxFragLookUpTolerance,u*(this.couldBacktrack?.5:.125)),u*(this.couldBacktrack?.75:.25)));this.flushMainBuffer(c,Number.POSITIVE_INFINITY)}}}}abortCurrentFrag(){const e=this.fragCurrent;switch(this.fragCurrent=null,this.backtrackFragment=null,e&&(e.abortRequests(),this.fragmentTracker.removeFragment(e)),this.state){case $.KEY_LOADING:case $.FRAG_LOADING:case $.FRAG_LOADING_WAITING_RETRY:case $.PARSING:case $.PARSED:this.state=$.IDLE;break}this.nextLoadPosition=this.getLoadPosition()}flushMainBuffer(e,t){super.flushMainBuffer(e,t,this.altAudio===2?"video":null)}onMediaAttached(e,t){super.onMediaAttached(e,t);const r=t.media;nn(r,"playing",this.onMediaPlaying),nn(r,"seeked",this.onMediaSeeked)}onMediaDetaching(e,t){const{media:r}=this;r&&(vn(r,"playing",this.onMediaPlaying),vn(r,"seeked",this.onMediaSeeked)),this.videoBuffer=null,this.fragPlaying=null,super.onMediaDetaching(e,t),!t.transferMedia&&(this._hasEnoughToStart=!1)}onManifestLoading(){super.onManifestLoading(),this.log("Trigger BUFFER_RESET"),this.hls.trigger(S.BUFFER_RESET,void 0),this.couldBacktrack=!1,this.fragLastKbps=0,this.fragPlaying=this.backtrackFragment=null,this.altAudio=0,this.audioOnly=!1}onManifestParsed(e,t){let r=!1,i=!1;t.levels.forEach(s=>{const a=s.audioCodec;a&&(r=r||a.indexOf("mp4a.40.2")!==-1,i=i||a.indexOf("mp4a.40.5")!==-1)}),this.audioCodecSwitch=r&&i&&!dF(),this.audioCodecSwitch&&this.log("Both AAC/HE-AAC audio found in levels; declaring level codec as HE-AAC"),this.levels=t.levels,this.startFragRequested=!1}onLevelLoading(e,t){const{levels:r}=this;if(!r||this.state!==$.IDLE)return;const i=t.levelInfo;(!i.details||i.details.live&&(this.levelLastLoaded!==i||i.details.expired)||this.waitForCdnTuneIn(i.details))&&(this.state=$.WAITING_LEVEL)}onLevelLoaded(e,t){var r;const{levels:i,startFragRequested:s}=this,a=t.level,o=t.details,l=o.totalduration;if(!i){this.warn(`Levels were reset while loading level ${a}`);return}this.log(`Level ${a} loaded [${o.startSN},${o.endSN}]${o.lastPartSn?`[part-${o.lastPartSn}-${o.lastPartIndex}]`:""}, cc [${o.startCC}, ${o.endCC}] duration:${l}`);const u=t.levelInfo,c=this.fragCurrent;c&&(this.state===$.FRAG_LOADING||this.state===$.FRAG_LOADING_WAITING_RETRY)&&c.level!==t.level&&c.loader&&this.abortCurrentFrag();let d=0;if(o.live||(r=u.details)!=null&&r.live){var h;if(this.checkLiveUpdate(o),o.deltaUpdateFailed)return;d=this.alignPlaylists(o,u.details,(h=this.levelLastLoaded)==null?void 0:h.details)}if(u.details=o,this.levelLastLoaded=u,s||this.setStartPosition(o,d),this.hls.trigger(S.LEVEL_UPDATED,{details:o,level:a}),this.state===$.WAITING_LEVEL){if(this.waitForCdnTuneIn(o))return;this.state=$.IDLE}s&&o.live&&this.synchronizeToLiveEdge(o),this.tick()}synchronizeToLiveEdge(e){const{config:t,media:r}=this;if(!r)return;const i=this.hls.liveSyncPosition,s=this.getLoadPosition(),a=e.fragmentStart,o=e.edge,l=s>=a-t.maxFragLookUpTolerance&&s<=o;if(i!==null&&r.duration>i&&(s<i||!l)){const c=t.liveMaxLatencyDuration!==void 0?t.liveMaxLatencyDuration:t.liveMaxLatencyDurationCount*e.targetduration;if((!l&&r.readyState<4||s<o-c)&&(this._hasEnoughToStart||(this.nextLoadPosition=i),r.readyState))if(this.warn(`Playback: ${s.toFixed(3)} is located too far from the end of live sliding playlist: ${o}, reset currentTime to : ${i.toFixed(3)}`),this.config.liveSyncMode==="buffered"){var u;const d=ge.bufferInfo(r,i,0);if(!(d!=null&&(u=d.buffered)!=null&&u.length)){r.currentTime=i;return}if(d.start<=s){r.currentTime=i;return}const{nextStart:f}=ge.bufferedInfo(d.buffered,s,0);f&&(r.currentTime=f)}else r.currentTime=i}}_handleFragmentLoadProgress(e){var t;const r=e.frag,{part:i,payload:s}=e,{levels:a}=this;if(!a){this.warn(`Levels were reset while fragment load was in progress. Fragment ${r.sn} of level ${r.level} will not be buffered`);return}const o=a[r.level];if(!o){this.warn(`Level ${r.level} not found on progress`);return}const l=o.details;if(!l){this.warn(`Dropping fragment ${r.sn} of level ${r.level} after level details were reset`),this.fragmentTracker.removeFragment(r);return}const u=o.videoCodec,c=l.PTSKnown||!l.live,d=(t=r.initSegment)==null?void 0:t.data,h=this._getAudioCodec(o),f=this.transmuxer=this.transmuxer||new Mx(this.hls,ne.MAIN,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)),g=i?i.index:-1,m=g!==-1,y=new Rg(r.level,r.sn,r.stats.chunkCount,s.byteLength,g,m),p=this.initPTS[r.cc];f.push(s,d,h,u,r,i,l.totalduration,c,y,p)}onAudioTrackSwitching(e,t){const r=this.hls,i=this.altAudio===2;if(zu(t.url,r))this.altAudio=1;else{if(this.mediaBuffer!==this.media){this.log("Switching on main audio, use media.buffered to schedule main fragment loading"),this.mediaBuffer=this.media;const a=this.fragCurrent;a&&(this.log("Switching to main audio track, cancel main fragment load"),a.abortRequests(),this.fragmentTracker.removeFragment(a)),this.resetTransmuxer(),this.resetLoadingState()}else this.audioOnly&&this.resetTransmuxer();if(i){this.fragmentTracker.removeAllFragments(),r.once(S.BUFFER_FLUSHED,()=>{var a;(a=this.hls)==null||a.trigger(S.AUDIO_TRACK_SWITCHED,t)}),r.trigger(S.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:null});return}r.trigger(S.AUDIO_TRACK_SWITCHED,t)}}onAudioTrackSwitched(e,t){const r=zu(t.url,this.hls);if(r){const i=this.videoBuffer;i&&this.mediaBuffer!==i&&(this.log("Switching on alternate audio, use video.buffered to schedule main fragment loading"),this.mediaBuffer=i)}this.altAudio=r?2:0,this.tick()}onBufferCreated(e,t){const r=t.tracks;let i,s,a=!1;for(const o in r){const l=r[o];if(l.id==="main"){if(s=o,i=l,o==="video"){const u=r[o];u&&(this.videoBuffer=u.buffer)}}else a=!0}a&&i?(this.log(`Alternate track found, use ${s}.buffered to schedule main fragment loading`),this.mediaBuffer=i.buffer):this.mediaBuffer=this.media}onFragBuffered(e,t){const{frag:r,part:i}=t,s=r.type===ne.MAIN;if(s){if(this.fragContextChanged(r)){this.warn(`Fragment ${r.sn}${i?" p: "+i.index:""} of level ${r.level} finished buffering, but was aborted. state: ${this.state}`),this.state===$.PARSED&&(this.state=$.IDLE);return}const o=i?i.stats:r.stats;this.fragLastKbps=Math.round(8*o.total/(o.buffering.end-o.loading.first)),vt(r)&&(this.fragPrevious=r),this.fragBufferedComplete(r,i)}const a=this.media;a&&(!this._hasEnoughToStart&&ge.getBuffered(a).length&&(this._hasEnoughToStart=!0,this.seekToStartPos()),s&&this.tick())}get hasEnoughToStart(){return this._hasEnoughToStart}onError(e,t){var r;if(t.fatal){this.state=$.ERROR;return}switch(t.details){case O.FRAG_GAP:case O.FRAG_PARSING_ERROR:case O.FRAG_DECRYPT_ERROR:case O.FRAG_LOAD_ERROR:case O.FRAG_LOAD_TIMEOUT:case O.KEY_LOAD_ERROR:case O.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(ne.MAIN,t);break;case O.LEVEL_LOAD_ERROR:case O.LEVEL_LOAD_TIMEOUT:case O.LEVEL_PARSING_ERROR:!t.levelRetry&&this.state===$.WAITING_LEVEL&&((r=t.context)==null?void 0:r.type)===Se.LEVEL&&(this.state=$.IDLE);break;case O.BUFFER_ADD_CODEC_ERROR:case O.BUFFER_APPEND_ERROR:if(t.parent!=="main")return;this.resetLoadingState();break;case O.BUFFER_FULL_ERROR:if(t.parent!=="main")return;this.reduceLengthAndFlushBuffer(t)&&this.flushMainBuffer(0,Number.POSITIVE_INFINITY);break;case O.INTERNAL_EXCEPTION:this.recoverWorkerError(t);break}}onFragLoadEmergencyAborted(){this.state=$.IDLE,this._hasEnoughToStart||(this.startFragRequested=!1,this.nextLoadPosition=this.lastCurrentTime),this.tickImmediate()}onBufferFlushed(e,{type:t}){if(t!==Ne.AUDIO||!this.altAudio){const r=(t===Ne.VIDEO?this.videoBuffer:this.mediaBuffer)||this.media;r&&(this.afterBufferFlushed(r,t,ne.MAIN),this.tick())}}onLevelsUpdated(e,t){this.level>-1&&this.fragCurrent&&(this.level=this.fragCurrent.level,this.level===-1&&this.resetWhenMissingContext(this.fragCurrent)),this.levels=t.levels}swapAudioCodec(){this.audioCodecSwap=!this.audioCodecSwap}seekToStartPos(){const{media:e}=this;if(!e)return;const t=e.currentTime;let r=this.startPosition;if(r>=0&&t<r){if(e.seeking){this.log(`could not seek to ${r}, already seeking at ${t}`);return}const i=this.timelineOffset;i&&r&&(r+=i);const s=this.getLevelDetails(),a=ge.getBuffered(e),o=a.length?a.start(0):0,l=o-r,u=Math.max(this.config.maxBufferHole,this.config.maxFragLookUpTolerance);(this.config.startOnSegmentBoundary||l>0&&(l<u||this.loadingParts&&l<2*((s==null?void 0:s.partTarget)||0)))&&(this.log(`adjusting start position by ${l} to match buffer start`),r+=l,this.startPosition=r),t<r&&(this.log(`seek to target start position ${r} from current time ${t} buffer start ${o}`),e.currentTime=r)}}_getAudioCodec(e){let t=this.config.defaultAudioCodec||e.audioCodec;return this.audioCodecSwap&&t&&(this.log("Swapping audio codec"),t.indexOf("mp4a.40.5")!==-1?t="mp4a.40.2":t="mp4a.40.5"),t}_loadBitrateTestFrag(e,t){e.bitrateTest=!0,this._doFragLoad(e,t).then(r=>{const{hls:i}=this,s=r==null?void 0:r.frag;if(!s||this.fragContextChanged(s))return;t.fragmentError=0,this.state=$.IDLE,this.startFragRequested=!1,this.bitrateTest=!1;const a=s.stats;a.parsing.start=a.parsing.end=a.buffering.start=a.buffering.end=self.performance.now(),i.trigger(S.FRAG_LOADED,r),s.bitrateTest=!1})}_handleTransmuxComplete(e){var t;const r=this.playlistType,{hls:i}=this,{remuxResult:s,chunkMeta:a}=e,o=this.getCurrentContext(a);if(!o){this.resetWhenMissingContext(a);return}const{frag:l,part:u,level:c}=o,{video:d,text:h,id3:f,initSegment:g}=s,{details:m}=c,y=this.altAudio?void 0:s.audio;if(this.fragContextChanged(l)){this.fragmentTracker.removeFragment(l);return}if(this.state=$.PARSING,g){if(g!=null&&g.tracks){const E=l.initSegment||l;this._bufferInitSegment(c,g.tracks,E,a),i.trigger(S.FRAG_PARSING_INIT_SEGMENT,{frag:E,id:r,tracks:g.tracks})}const p=g.initPTS,v=g.timescale;Z(p)&&(this.initPTS[l.cc]={baseTime:p,timescale:v},i.trigger(S.INIT_PTS_FOUND,{frag:l,id:r,initPTS:p,timescale:v}))}if(d&&m){y&&d.type==="audiovideo"&&this.logMuxedErr(l);const p=m.fragments[l.sn-1-m.startSN],v=l.sn===m.startSN,E=!p||l.cc>p.cc;if(s.independent!==!1){const{startPTS:T,endPTS:A,startDTS:I,endDTS:R}=d;if(u)u.elementaryStreams[d.type]={startPTS:T,endPTS:A,startDTS:I,endDTS:R};else if(d.firstKeyFrame&&d.independent&&a.id===1&&!E&&(this.couldBacktrack=!0),d.dropped&&d.independent){const x=this.getMainFwdBufferInfo(),D=(x?x.end:this.getLoadPosition())+this.config.maxBufferHole,_=d.firstKeyFramePTS?d.firstKeyFramePTS:T;if(!v&&D<_-this.config.maxBufferHole&&!E){this.backtrack(l);return}else E&&(l.gap=!0);l.setElementaryStreamInfo(d.type,l.start,A,l.start,R,!0)}else v&&T-(m.appliedTimelineOffset||0)>fu&&(l.gap=!0);l.setElementaryStreamInfo(d.type,T,A,I,R),this.backtrackFragment&&(this.backtrackFragment=l),this.bufferFragmentData(d,l,u,a,v||E)}else if(v||E)l.gap=!0;else{this.backtrack(l);return}}if(y){const{startPTS:p,endPTS:v,startDTS:E,endDTS:T}=y;u&&(u.elementaryStreams[Ne.AUDIO]={startPTS:p,endPTS:v,startDTS:E,endDTS:T}),l.setElementaryStreamInfo(Ne.AUDIO,p,v,E,T),this.bufferFragmentData(y,l,u,a)}if(m&&f!=null&&(t=f.samples)!=null&&t.length){const p={id:r,frag:l,details:m,samples:f.samples};i.trigger(S.FRAG_PARSING_METADATA,p)}if(m&&h){const p={id:r,frag:l,details:m,samples:h.samples};i.trigger(S.FRAG_PARSING_USERDATA,p)}}logMuxedErr(e){this.warn(`${vt(e)?"Media":"Init"} segment with muxed audiovideo where only video expected: ${e.url}`)}_bufferInitSegment(e,t,r,i){if(this.state!==$.PARSING)return;this.audioOnly=!!t.audio&&!t.video,this.altAudio&&!this.audioOnly&&(delete t.audio,t.audiovideo&&this.logMuxedErr(r));const{audio:s,video:a,audiovideo:o}=t;if(s){let u=au(s.codec,e.audioCodec);u==="mp4a"&&(u="mp4a.40.5");const c=navigator.userAgent.toLowerCase();if(this.audioCodecSwitch){u&&(u.indexOf("mp4a.40.5")!==-1?u="mp4a.40.2":u="mp4a.40.5");const d=s.metadata;d&&"channelCount"in d&&(d.channelCount||1)!==1&&c.indexOf("firefox")===-1&&(u="mp4a.40.5")}u&&u.indexOf("mp4a.40.5")!==-1&&c.indexOf("android")!==-1&&s.container!=="audio/mpeg"&&(u="mp4a.40.2",this.log(`Android: force audio codec to ${u}`)),e.audioCodec&&e.audioCodec!==u&&this.log(`Swapping manifest audio codec "${e.audioCodec}" for "${u}"`),s.levelCodec=u,s.id=ne.MAIN,this.log(`Init audio buffer, container:${s.container}, codecs[selected/level/parsed]=[${u||""}/${e.audioCodec||""}/${s.codec}]`),delete t.audiovideo}if(a){a.levelCodec=e.videoCodec,a.id=ne.MAIN;const u=a.codec;if((u==null?void 0:u.length)===4)switch(u){case"hvc1":case"hev1":a.codec="hvc1.1.6.L120.90";break;case"av01":a.codec="av01.0.04M.08";break;case"avc1":a.codec="avc1.42e01e";break}this.log(`Init video buffer, container:${a.container}, codecs[level/parsed]=[${e.videoCodec||""}/${u}]${a.codec!==u?" parsed-corrected="+a.codec:""}${a.supplemental?" supplemental="+a.supplemental:""}`),delete t.audiovideo}o&&(this.log(`Init audiovideo buffer, container:${o.container}, codecs[level/parsed]=[${e.codecs}/${o.codec}]`),delete t.video,delete t.audio);const l=Object.keys(t);if(l.length){if(this.hls.trigger(S.BUFFER_CODECS,t),!this.hls)return;l.forEach(u=>{const d=t[u].initSegment;d!=null&&d.byteLength&&this.hls.trigger(S.BUFFER_APPENDING,{type:u,data:d,frag:r,part:null,chunkMeta:i,parent:r.type})})}this.tickImmediate()}getMainFwdBufferInfo(){const e=this.mediaBuffer&&this.altAudio===2?this.mediaBuffer:this.media;return this.getFwdBufferInfo(e,ne.MAIN)}get maxBufferLength(){const{levels:e,level:t}=this,r=e==null?void 0:e[t];return r?this.getMaxBufferLength(r.maxBitrate):this.config.maxBufferLength}backtrack(e){this.couldBacktrack=!0,this.backtrackFragment=e,this.resetTransmuxer(),this.flushBufferGap(e),this.fragmentTracker.removeFragment(e),this.fragPrevious=null,this.nextLoadPosition=e.start,this.state=$.IDLE}checkFragmentChanged(){const e=this.media;let t=null;if(e&&e.readyState>1&&e.seeking===!1){const r=e.currentTime;if(ge.isBuffered(e,r)?t=this.getAppendedFrag(r):ge.isBuffered(e,r+.1)&&(t=this.getAppendedFrag(r+.1)),t){this.backtrackFragment=null;const i=this.fragPlaying,s=t.level;(!i||t.sn!==i.sn||i.level!==s)&&(this.fragPlaying=t,this.hls.trigger(S.FRAG_CHANGED,{frag:t}),(!i||i.level!==s)&&this.hls.trigger(S.LEVEL_SWITCHED,{level:s}))}}}get nextLevel(){const e=this.nextBufferedFrag;return e?e.level:-1}get currentFrag(){var e;if(this.fragPlaying)return this.fragPlaying;const t=((e=this.media)==null?void 0:e.currentTime)||this.lastCurrentTime;return Z(t)?this.getAppendedFrag(t):null}get currentProgramDateTime(){var e;const t=((e=this.media)==null?void 0:e.currentTime)||this.lastCurrentTime;if(Z(t)){const r=this.getLevelDetails(),i=this.currentFrag||(r?rs(null,r.fragments,t):null);if(i){const s=i.programDateTime;if(s!==null){const a=s+(t-i.start)*1e3;return new Date(a)}}}return null}get currentLevel(){const e=this.currentFrag;return e?e.level:-1}get nextBufferedFrag(){const e=this.currentFrag;return e?this.followingBufferedFrag(e):null}get forceStartLoad(){return this._forceStartLoad}}class gF{constructor(e){this.config=void 0,this.keyUriToKeyInfo={},this.emeController=null,this.config=e}abort(e){for(const r in this.keyUriToKeyInfo){const i=this.keyUriToKeyInfo[r].loader;if(i){var t;if(e&&e!==((t=i.context)==null?void 0:t.frag.type))return;i.abort()}}}detach(){for(const e in this.keyUriToKeyInfo){const t=this.keyUriToKeyInfo[e];(t.mediaKeySessionContext||t.decryptdata.isCommonEncryption)&&delete this.keyUriToKeyInfo[e]}}destroy(){this.detach();for(const e in this.keyUriToKeyInfo){const t=this.keyUriToKeyInfo[e].loader;t&&t.destroy()}this.keyUriToKeyInfo={}}createKeyLoadError(e,t=O.KEY_LOAD_ERROR,r,i,s){return new pr({type:re.NETWORK_ERROR,details:t,fatal:!1,frag:e,response:s,error:r,networkDetails:i})}loadClear(e,t){if(this.emeController&&this.config.emeEnabled&&!this.emeController.getSelectedKeySystemFormats().length){if(t.length){const{sn:r,cc:i}=e;for(let s=0;s<t.length;s++){const a=t[s];if(i<=a.cc&&(r==="initSegment"||a.sn==="initSegment"||r<a.sn))return this.emeController.selectKeySystemFormat(a).then(o=>{if(a.setKeyFormat(o),this.emeController&&this.config.requireKeySystemAccessOnStart){const l=lu(o);if(l)return this.emeController.getKeySystemAccess([l])}})}}else if(this.config.requireKeySystemAccessOnStart){const r=Va(this.config);if(r.length)return this.emeController.getKeySystemAccess(r)}}return null}load(e){return!e.decryptdata&&e.encrypted&&this.emeController&&this.config.emeEnabled?this.emeController.selectKeySystemFormat(e).then(t=>this.loadInternal(e,t)):this.loadInternal(e)}loadInternal(e,t){var r,i;t&&e.setKeyFormat(t);const s=e.decryptdata;if(!s){const u=new Error(t?`Expected frag.decryptdata to be defined after setting format ${t}`:"Missing decryption data on fragment in onKeyLoading");return Promise.reject(this.createKeyLoadError(e,O.KEY_LOAD_ERROR,u))}const a=s.uri;if(!a)return Promise.reject(this.createKeyLoadError(e,O.KEY_LOAD_ERROR,new Error(`Invalid key URI: "${a}"`)));let o=this.keyUriToKeyInfo[a];if((r=o)!=null&&r.decryptdata.key)return s.key=o.decryptdata.key,Promise.resolve({frag:e,keyInfo:o});if((i=o)!=null&&i.keyLoadPromise){var l;switch((l=o.mediaKeySessionContext)==null?void 0:l.keyStatus){case void 0:case"status-pending":case"usable":case"usable-in-future":return o.keyLoadPromise.then(u=>(s.key=u.keyInfo.decryptdata.key,{frag:e,keyInfo:o}))}}switch(o=this.keyUriToKeyInfo[a]={decryptdata:s,keyLoadPromise:null,loader:null,mediaKeySessionContext:null},s.method){case"ISO-23001-7":case"SAMPLE-AES":case"SAMPLE-AES-CENC":case"SAMPLE-AES-CTR":return s.keyFormat==="identity"?this.loadKeyHTTP(o,e):this.loadKeyEME(o,e);case"AES-128":case"AES-256":case"AES-256-CTR":return this.loadKeyHTTP(o,e);default:return Promise.reject(this.createKeyLoadError(e,O.KEY_LOAD_ERROR,new Error(`Key supplied with unsupported METHOD: "${s.method}"`)))}}loadKeyEME(e,t){const r={frag:t,keyInfo:e};if(this.emeController&&this.config.emeEnabled){const i=this.emeController.loadKey(r);if(i)return(e.keyLoadPromise=i.then(s=>(e.mediaKeySessionContext=s,r))).catch(s=>{throw e.keyLoadPromise=null,s})}return Promise.resolve(r)}loadKeyHTTP(e,t){const r=this.config,i=r.loader,s=new i(r);return t.keyLoader=e.loader=s,e.keyLoadPromise=new Promise((a,o)=>{const l={keyInfo:e,frag:t,responseType:"arraybuffer",url:e.decryptdata.uri},u=r.keyLoadPolicy.default,c={loadPolicy:u,timeout:u.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},d={onSuccess:(h,f,g,m)=>{const{frag:y,keyInfo:p,url:v}=g;if(!y.decryptdata||p!==this.keyUriToKeyInfo[v])return o(this.createKeyLoadError(y,O.KEY_LOAD_ERROR,new Error("after key load, decryptdata unset or changed"),m));p.decryptdata.key=y.decryptdata.key=new Uint8Array(h.data),y.keyLoader=null,p.loader=null,a({frag:y,keyInfo:p})},onError:(h,f,g,m)=>{this.resetLoader(f),o(this.createKeyLoadError(t,O.KEY_LOAD_ERROR,new Error(`HTTP Error ${h.code} loading key ${h.text}`),g,Ce({url:l.url,data:void 0},h)))},onTimeout:(h,f,g)=>{this.resetLoader(f),o(this.createKeyLoadError(t,O.KEY_LOAD_TIMEOUT,new Error("key loading timed out"),g))},onAbort:(h,f,g)=>{this.resetLoader(f),o(this.createKeyLoadError(t,O.INTERNAL_ABORTED,new Error("key loading aborted"),g))}};s.load(l,c,d)})}resetLoader(e){const{frag:t,keyInfo:r,url:i}=e,s=r.loader;t.keyLoader===s&&(t.keyLoader=null,r.loader=null),delete this.keyUriToKeyInfo[i],s&&s.destroy()}}function gy(n){const{type:e}=n;switch(e){case Se.AUDIO_TRACK:return ne.AUDIO;case Se.SUBTITLE_TRACK:return ne.SUBTITLE;default:return ne.MAIN}}function Md(n,e){let t=n.url;return(t===void 0||t.indexOf("data:")===0)&&(t=e.url),t}class mF{constructor(e){this.hls=void 0,this.loaders=Object.create(null),this.variableList=null,this.onManifestLoaded=this.checkAutostartLoad,this.hls=e,this.registerListeners()}startLoad(e){}stopLoad(){this.destroyInternalLoaders()}registerListeners(){const{hls:e}=this;e.on(S.MANIFEST_LOADING,this.onManifestLoading,this),e.on(S.LEVEL_LOADING,this.onLevelLoading,this),e.on(S.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),e.on(S.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this),e.on(S.LEVELS_UPDATED,this.onLevelsUpdated,this)}unregisterListeners(){const{hls:e}=this;e.off(S.MANIFEST_LOADING,this.onManifestLoading,this),e.off(S.LEVEL_LOADING,this.onLevelLoading,this),e.off(S.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),e.off(S.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this),e.off(S.LEVELS_UPDATED,this.onLevelsUpdated,this)}createInternalLoader(e){const t=this.hls.config,r=t.pLoader,i=t.loader,s=r||i,a=new s(t);return this.loaders[e.type]=a,a}getInternalLoader(e){return this.loaders[e.type]}resetInternalLoader(e){this.loaders[e]&&delete this.loaders[e]}destroyInternalLoaders(){for(const e in this.loaders){const t=this.loaders[e];t&&t.destroy(),this.resetInternalLoader(e)}}destroy(){this.variableList=null,this.unregisterListeners(),this.destroyInternalLoaders()}onManifestLoading(e,t){const{url:r}=t;this.variableList=null,this.load({id:null,level:0,responseType:"text",type:Se.MANIFEST,url:r,deliveryDirectives:null,levelOrTrack:null})}onLevelLoading(e,t){const{id:r,level:i,pathwayId:s,url:a,deliveryDirectives:o,levelInfo:l}=t;this.load({id:r,level:i,pathwayId:s,responseType:"text",type:Se.LEVEL,url:a,deliveryDirectives:o,levelOrTrack:l})}onAudioTrackLoading(e,t){const{id:r,groupId:i,url:s,deliveryDirectives:a,track:o}=t;this.load({id:r,groupId:i,level:null,responseType:"text",type:Se.AUDIO_TRACK,url:s,deliveryDirectives:a,levelOrTrack:o})}onSubtitleTrackLoading(e,t){const{id:r,groupId:i,url:s,deliveryDirectives:a,track:o}=t;this.load({id:r,groupId:i,level:null,responseType:"text",type:Se.SUBTITLE_TRACK,url:s,deliveryDirectives:a,levelOrTrack:o})}onLevelsUpdated(e,t){const r=this.loaders[Se.LEVEL];if(r){const i=r.context;i&&!t.levels.some(s=>s===i.levelOrTrack)&&(r.abort(),delete this.loaders[Se.LEVEL])}}load(e){var t;const r=this.hls.config;let i=this.getInternalLoader(e);if(i){const u=this.hls.logger,c=i.context;if(c&&c.levelOrTrack===e.levelOrTrack&&(c.url===e.url||c.deliveryDirectives&&!e.deliveryDirectives)){c.url===e.url?u.log(`[playlist-loader]: ignore ${e.url} ongoing request`):u.log(`[playlist-loader]: ignore ${e.url} in favor of ${c.url}`);return}u.log(`[playlist-loader]: aborting previous loader for type: ${e.type}`),i.abort()}let s;if(e.type===Se.MANIFEST?s=r.manifestLoadPolicy.default:s=Oe({},r.playlistLoadPolicy.default,{timeoutRetry:null,errorRetry:null}),i=this.createInternalLoader(e),Z((t=e.deliveryDirectives)==null?void 0:t.part)){let u;if(e.type===Se.LEVEL&&e.level!==null?u=this.hls.levels[e.level].details:e.type===Se.AUDIO_TRACK&&e.id!==null?u=this.hls.audioTracks[e.id].details:e.type===Se.SUBTITLE_TRACK&&e.id!==null&&(u=this.hls.subtitleTracks[e.id].details),u){const c=u.partTarget,d=u.targetduration;if(c&&d){const h=Math.max(c*3,d*.8)*1e3;s=Oe({},s,{maxTimeToFirstByteMs:Math.min(h,s.maxTimeToFirstByteMs),maxLoadTimeMs:Math.min(h,s.maxTimeToFirstByteMs)})}}}const a=s.errorRetry||s.timeoutRetry||{},o={loadPolicy:s,timeout:s.maxLoadTimeMs,maxRetry:a.maxNumRetry||0,retryDelay:a.retryDelayMs||0,maxRetryDelay:a.maxRetryDelayMs||0},l={onSuccess:(u,c,d,h)=>{const f=this.getInternalLoader(d);this.resetInternalLoader(d.type);const g=u.data;if(g.indexOf("#EXTM3U")!==0){this.handleManifestParsingError(u,d,new Error("no EXTM3U delimiter"),h||null,c);return}c.parsing.start=performance.now(),Jn.isMediaPlaylist(g)||d.type!==Se.MANIFEST?this.handleTrackOrLevelPlaylist(u,c,d,h||null,f):this.handleMasterPlaylist(u,c,d,h)},onError:(u,c,d,h)=>{this.handleNetworkError(c,d,!1,u,h)},onTimeout:(u,c,d)=>{this.handleNetworkError(c,d,!0,void 0,u)}};i.load(e,o,l)}checkAutostartLoad(){if(!this.hls)return;const{config:{autoStartLoad:e,startPosition:t},forceStartLoad:r}=this.hls;(e||r)&&(this.hls.logger.log(`${e?"auto":"force"} startLoad with configured startPosition ${t}`),this.hls.startLoad(t))}handleMasterPlaylist(e,t,r,i){const s=this.hls,a=e.data,o=Md(e,r),l=Jn.parseMasterPlaylist(a,o);if(l.playlistParsingError){this.handleManifestParsingError(e,r,l.playlistParsingError,i,t);return}const{contentSteering:u,levels:c,sessionData:d,sessionKeys:h,startTimeOffset:f,variableList:g}=l;this.variableList=g;const{AUDIO:m=[],SUBTITLES:y,"CLOSED-CAPTIONS":p}=Jn.parseMasterPlaylistMedia(a,o,l);m.length&&!m.some(E=>!E.url)&&c[0].audioCodec&&!c[0].attrs.AUDIO&&(this.hls.logger.log("[playlist-loader]: audio codec signaled in quality level, but no embedded audio track signaled, create one"),m.unshift({type:"main",name:"main",groupId:"main",default:!1,autoselect:!1,forced:!1,id:-1,attrs:new He({}),bitrate:0,url:""})),s.trigger(S.MANIFEST_LOADED,{levels:c,audioTracks:m,subtitles:y,captions:p,contentSteering:u,url:o,stats:t,networkDetails:i,sessionData:d,sessionKeys:h,startTimeOffset:f,variableList:g})}handleTrackOrLevelPlaylist(e,t,r,i,s){const a=this.hls,{id:o,level:l,type:u}=r,c=Md(e,r),d=Z(l)?l:Z(o)?o:0,h=gy(r),f=Jn.parseLevelPlaylist(e.data,c,d,h,0,this.variableList);if(u===Se.MANIFEST){const g={attrs:new He({}),bitrate:0,details:f,name:"",url:c};f.requestScheduled=t.loading.start+dx(f,0),a.trigger(S.MANIFEST_LOADED,{levels:[g],audioTracks:[],url:c,stats:t,networkDetails:i,sessionData:null,sessionKeys:null,contentSteering:null,startTimeOffset:null,variableList:null})}t.parsing.end=performance.now(),r.levelDetails=f,this.handlePlaylistLoaded(f,e,t,r,i,s)}handleManifestParsingError(e,t,r,i,s){this.hls.trigger(S.ERROR,{type:re.NETWORK_ERROR,details:O.MANIFEST_PARSING_ERROR,fatal:t.type===Se.MANIFEST,url:e.url,err:r,error:r,reason:r.message,response:e,context:t,networkDetails:i,stats:s})}handleNetworkError(e,t,r=!1,i,s){let a=`A network ${r?"timeout":"error"+(i?" (status "+i.code+")":"")} occurred while loading ${e.type}`;e.type===Se.LEVEL?a+=`: ${e.level} id: ${e.id}`:(e.type===Se.AUDIO_TRACK||e.type===Se.SUBTITLE_TRACK)&&(a+=` id: ${e.id} group-id: "${e.groupId}"`);const o=new Error(a);this.hls.logger.warn(`[playlist-loader]: ${a}`);let l=O.UNKNOWN,u=!1;const c=this.getInternalLoader(e);switch(e.type){case Se.MANIFEST:l=r?O.MANIFEST_LOAD_TIMEOUT:O.MANIFEST_LOAD_ERROR,u=!0;break;case Se.LEVEL:l=r?O.LEVEL_LOAD_TIMEOUT:O.LEVEL_LOAD_ERROR,u=!1;break;case Se.AUDIO_TRACK:l=r?O.AUDIO_TRACK_LOAD_TIMEOUT:O.AUDIO_TRACK_LOAD_ERROR,u=!1;break;case Se.SUBTITLE_TRACK:l=r?O.SUBTITLE_TRACK_LOAD_TIMEOUT:O.SUBTITLE_LOAD_ERROR,u=!1;break}c&&this.resetInternalLoader(e.type);const d={type:re.NETWORK_ERROR,details:l,fatal:u,url:e.url,loader:c,context:e,error:o,networkDetails:t,stats:s};if(i){const h=(t==null?void 0:t.url)||e.url;d.response=Ce({url:h,data:void 0},i)}this.hls.trigger(S.ERROR,d)}handlePlaylistLoaded(e,t,r,i,s,a){const o=this.hls,{type:l,level:u,id:c,groupId:d,deliveryDirectives:h}=i,f=Md(t,i),g=gy(i),m=typeof i.level=="number"&&g===ne.MAIN?u:void 0;if(!e.fragments.length){const p=e.playlistParsingError=new Error("No Segments found in Playlist");o.trigger(S.ERROR,{type:re.NETWORK_ERROR,details:O.LEVEL_EMPTY_ERROR,fatal:!1,url:f,error:p,reason:p.message,response:t,context:i,level:m,parent:g,networkDetails:s,stats:r});return}e.targetduration||(e.playlistParsingError=new Error("Missing Target Duration"));const y=e.playlistParsingError;if(y){if(this.hls.logger.warn(y),!o.config.ignorePlaylistParsingErrors){o.trigger(S.ERROR,{type:re.NETWORK_ERROR,details:O.LEVEL_PARSING_ERROR,fatal:!1,url:f,error:y,reason:y.message,response:t,context:i,level:m,parent:g,networkDetails:s,stats:r});return}e.playlistParsingError=null}switch(e.live&&a&&(a.getCacheAge&&(e.ageHeader=a.getCacheAge()||0),(!a.getCacheAge||isNaN(e.ageHeader))&&(e.ageHeader=0)),l){case Se.MANIFEST:case Se.LEVEL:o.trigger(S.LEVEL_LOADED,{details:e,levelInfo:i.levelOrTrack||o.levels[0],level:m||0,id:c||0,stats:r,networkDetails:s,deliveryDirectives:h,withoutMultiVariant:l===Se.MANIFEST});break;case Se.AUDIO_TRACK:o.trigger(S.AUDIO_TRACK_LOADED,{details:e,track:i.levelOrTrack,id:c||0,groupId:d||"",stats:r,networkDetails:s,deliveryDirectives:h});break;case Se.SUBTITLE_TRACK:o.trigger(S.SUBTITLE_TRACK_LOADED,{details:e,track:i.levelOrTrack,id:c||0,groupId:d||"",stats:r,networkDetails:s,deliveryDirectives:h});break}}}class Qn{static get version(){return wo}static isMSESupported(){return sT()}static isSupported(){return cF()}static getMediaSource(){return vi()}static get Events(){return S}static get MetadataSchema(){return en}static get ErrorTypes(){return re}static get ErrorDetails(){return O}static get DefaultConfig(){return Qn.defaultConfig?Qn.defaultConfig:XO}static set DefaultConfig(e){Qn.defaultConfig=e}constructor(e={}){this.config=void 0,this.userConfig=void 0,this.logger=void 0,this.coreComponents=void 0,this.networkControllers=void 0,this._emitter=new Cg,this._autoLevelCapping=-1,this._maxHdcpLevel=null,this.abrController=void 0,this.bufferController=void 0,this.capLevelController=void 0,this.latencyController=void 0,this.levelController=void 0,this.streamController=void 0,this.audioStreamController=void 0,this.subtititleStreamController=void 0,this.audioTrackController=void 0,this.subtitleTrackController=void 0,this.interstitialsController=void 0,this.gapController=void 0,this.emeController=void 0,this.cmcdController=void 0,this._media=null,this._url=null,this._sessionId=void 0,this.triggeringException=void 0,this.started=!1;const t=this.logger=Mw(e.debug||!1,"Hls instance",e.assetPlayerId),r=this.config=JO(Qn.DefaultConfig,e,t);this.userConfig=e,r.progressive&&eF(r,t);const{abrController:i,bufferController:s,capLevelController:a,errorController:o,fpsController:l}=r,u=new o(this),c=this.abrController=new i(this),d=new _b(this),h=r.interstitialsController,f=h?this.interstitialsController=new h(this,Qn):null,g=this.bufferController=new s(this,d),m=this.capLevelController=new a(this),y=new l(this),p=new mF(this),v=r.contentSteeringController,E=v?new v(this):null,T=this.levelController=new uF(this,E),A=new oF(this),I=new gF(this.config),R=this.streamController=new fF(this,d,I),x=this.gapController=new iF(this,d);m.setStreamController(R),y.setStreamController(R);const D=[p,T,R];f&&D.splice(1,0,f),E&&D.splice(1,0,E),this.networkControllers=D;const _=[c,g,x,m,y,A,d];this.audioTrackController=this.createController(r.audioTrackController,D);const M=r.audioStreamController;M&&D.push(this.audioStreamController=new M(this,d,I)),this.subtitleTrackController=this.createController(r.subtitleTrackController,D);const j=r.subtitleStreamController;j&&D.push(this.subtititleStreamController=new j(this,d,I)),this.createController(r.timelineController,_),I.emeController=this.emeController=this.createController(r.emeController,_),this.cmcdController=this.createController(r.cmcdController,_),this.latencyController=this.createController(lF,_),this.coreComponents=_,D.push(u);const z=u.onErrorOut;typeof z=="function"&&this.on(S.ERROR,z,u),this.on(S.MANIFEST_LOADED,p.onManifestLoaded,p)}createController(e,t){if(e){const r=new e(this);return t&&t.push(r),r}return null}on(e,t,r=this){this._emitter.on(e,t,r)}once(e,t,r=this){this._emitter.once(e,t,r)}removeAllListeners(e){this._emitter.removeAllListeners(e)}off(e,t,r=this,i){this._emitter.off(e,t,r,i)}listeners(e){return this._emitter.listeners(e)}emit(e,t,r){return this._emitter.emit(e,t,r)}trigger(e,t){if(this.config.debug)return this.emit(e,e,t);try{return this.emit(e,e,t)}catch(r){if(this.logger.error("An internal error happened while handling event "+e+'. Error message: "'+r.message+'". Here is a stacktrace:',r),!this.triggeringException){this.triggeringException=!0;const i=e===S.ERROR;this.trigger(S.ERROR,{type:re.OTHER_ERROR,details:O.INTERNAL_EXCEPTION,fatal:i,event:e,error:r}),this.triggeringException=!1}}return!1}listenerCount(e){return this._emitter.listenerCount(e)}destroy(){this.logger.log("destroy"),this.trigger(S.DESTROYING,void 0),this.detachMedia(),this.removeAllListeners(),this._autoLevelCapping=-1,this._url=null,this.networkControllers.forEach(t=>t.destroy()),this.networkControllers.length=0,this.coreComponents.forEach(t=>t.destroy()),this.coreComponents.length=0;const e=this.config;e.xhrSetup=e.fetchSetup=void 0,this.userConfig=null}attachMedia(e){if(!e||"media"in e&&!e.media){const s=new Error(`attachMedia failed: invalid argument (${e})`);this.trigger(S.ERROR,{type:re.OTHER_ERROR,details:O.ATTACH_MEDIA_ERROR,fatal:!0,error:s});return}this.logger.log("attachMedia"),this._media&&(this.logger.warn("media must be detached before attaching"),this.detachMedia());const t="media"in e,r=t?e.media:e,i=t?e:{media:r};this._media=r,this.trigger(S.MEDIA_ATTACHING,i)}detachMedia(){this.logger.log("detachMedia"),this.trigger(S.MEDIA_DETACHING,{}),this._media=null}transferMedia(){this._media=null;const e=this.bufferController.transferMedia();return this.trigger(S.MEDIA_DETACHING,{transferMedia:e}),e}loadSource(e){this.stopLoad();const t=this.media,r=this._url,i=this._url=Sg.buildAbsoluteURL(self.location.href,e,{alwaysNormalize:!0});this._autoLevelCapping=-1,this._maxHdcpLevel=null,this.logger.log(`loadSource:${i}`),t&&r&&(r!==i||this.bufferController.hasSourceTypes())&&(this.detachMedia(),this.attachMedia(t)),this.trigger(S.MANIFEST_LOADING,{url:e})}get url(){return this._url}get hasEnoughToStart(){return this.streamController.hasEnoughToStart}get startPosition(){return this.streamController.startPositionValue}startLoad(e=-1,t){this.logger.log(`startLoad(${e+(t?", <skip seek to start>":"")})`),this.started=!0,this.resumeBuffering();for(let r=0;r<this.networkControllers.length&&(this.networkControllers[r].startLoad(e,t),!(!this.started||!this.networkControllers));r++);}stopLoad(){this.logger.log("stopLoad"),this.started=!1;for(let e=0;e<this.networkControllers.length&&(this.networkControllers[e].stopLoad(),!(this.started||!this.networkControllers));e++);}get loadingEnabled(){return this.started}get bufferingEnabled(){return this.streamController.bufferingEnabled}resumeBuffering(){this.bufferingEnabled||(this.logger.log("resume buffering"),this.networkControllers.forEach(e=>{e.resumeBuffering&&e.resumeBuffering()}))}pauseBuffering(){this.bufferingEnabled&&(this.logger.log("pause buffering"),this.networkControllers.forEach(e=>{e.pauseBuffering&&e.pauseBuffering()}))}get inFlightFragments(){const e={[ne.MAIN]:this.streamController.inFlightFrag};return this.audioStreamController&&(e[ne.AUDIO]=this.audioStreamController.inFlightFrag),this.subtititleStreamController&&(e[ne.SUBTITLE]=this.subtititleStreamController.inFlightFrag),e}swapAudioCodec(){this.logger.log("swapAudioCodec"),this.streamController.swapAudioCodec()}recoverMediaError(){this.logger.log("recoverMediaError");const e=this._media,t=e==null?void 0:e.currentTime;this.detachMedia(),e&&(this.attachMedia(e),t&&this.startLoad(t))}removeLevel(e){this.levelController.removeLevel(e)}get sessionId(){let e=this._sessionId;return e||(e=this._sessionId=iO()),e}get levels(){const e=this.levelController.levels;return e||[]}get latestLevelDetails(){return this.streamController.getLevelDetails()||null}get loadLevelObj(){return this.levelController.loadLevelObj}get currentLevel(){return this.streamController.currentLevel}set currentLevel(e){this.logger.log(`set currentLevel:${e}`),this.levelController.manualLevel=e,this.streamController.immediateLevelSwitch()}get nextLevel(){return this.streamController.nextLevel}set nextLevel(e){this.logger.log(`set nextLevel:${e}`),this.levelController.manualLevel=e,this.streamController.nextLevelSwitch()}get loadLevel(){return this.levelController.level}set loadLevel(e){this.logger.log(`set loadLevel:${e}`),this.levelController.manualLevel=e}get nextLoadLevel(){return this.levelController.nextLoadLevel}set nextLoadLevel(e){this.levelController.nextLoadLevel=e}get firstLevel(){return Math.max(this.levelController.firstLevel,this.minAutoLevel)}set firstLevel(e){this.logger.log(`set firstLevel:${e}`),this.levelController.firstLevel=e}get startLevel(){const e=this.levelController.startLevel;return e===-1&&this.abrController.forcedAutoLevel>-1?this.abrController.forcedAutoLevel:e}set startLevel(e){this.logger.log(`set startLevel:${e}`),e!==-1&&(e=Math.max(e,this.minAutoLevel)),this.levelController.startLevel=e}get capLevelToPlayerSize(){return this.config.capLevelToPlayerSize}set capLevelToPlayerSize(e){const t=!!e;t!==this.config.capLevelToPlayerSize&&(t?this.capLevelController.startCapping():(this.capLevelController.stopCapping(),this.autoLevelCapping=-1,this.streamController.nextLevelSwitch()),this.config.capLevelToPlayerSize=t)}get autoLevelCapping(){return this._autoLevelCapping}get bandwidthEstimate(){const{bwEstimator:e}=this.abrController;return e?e.getEstimate():NaN}set bandwidthEstimate(e){this.abrController.resetEstimator(e)}get abrEwmaDefaultEstimate(){const{bwEstimator:e}=this.abrController;return e?e.defaultEstimate:NaN}get ttfbEstimate(){const{bwEstimator:e}=this.abrController;return e?e.getEstimateTTFB():NaN}set autoLevelCapping(e){this._autoLevelCapping!==e&&(this.logger.log(`set autoLevelCapping:${e}`),this._autoLevelCapping=e,this.levelController.checkMaxAutoUpdated())}get maxHdcpLevel(){return this._maxHdcpLevel}set maxHdcpLevel(e){cb(e)&&this._maxHdcpLevel!==e&&(this._maxHdcpLevel=e,this.levelController.checkMaxAutoUpdated())}get autoLevelEnabled(){return this.levelController.manualLevel===-1}get manualLevel(){return this.levelController.manualLevel}get minAutoLevel(){const{levels:e,config:{minAutoBitrate:t}}=this;if(!e)return 0;const r=e.length;for(let i=0;i<r;i++)if(e[i].maxBitrate>=t)return i;return 0}get maxAutoLevel(){const{levels:e,autoLevelCapping:t,maxHdcpLevel:r}=this;let i;if(t===-1&&e!=null&&e.length?i=e.length-1:i=t,r)for(let s=i;s--;){const a=e[s].attrs["HDCP-LEVEL"];if(a&&a<=r)return s}return i}get firstAutoLevel(){return this.abrController.firstAutoLevel}get nextAutoLevel(){return this.abrController.nextAutoLevel}set nextAutoLevel(e){this.abrController.nextAutoLevel=e}get playingDate(){return this.streamController.currentProgramDateTime}get mainForwardBufferInfo(){return this.streamController.getMainFwdBufferInfo()}get maxBufferLength(){return this.streamController.maxBufferLength}setAudioOption(e){var t;return((t=this.audioTrackController)==null?void 0:t.setAudioOption(e))||null}setSubtitleOption(e){var t;return((t=this.subtitleTrackController)==null?void 0:t.setSubtitleOption(e))||null}get allAudioTracks(){const e=this.audioTrackController;return e?e.allAudioTracks:[]}get audioTracks(){const e=this.audioTrackController;return e?e.audioTracks:[]}get audioTrack(){const e=this.audioTrackController;return e?e.audioTrack:-1}set audioTrack(e){const t=this.audioTrackController;t&&(t.audioTrack=e)}get allSubtitleTracks(){const e=this.subtitleTrackController;return e?e.allSubtitleTracks:[]}get subtitleTracks(){const e=this.subtitleTrackController;return e?e.subtitleTracks:[]}get subtitleTrack(){const e=this.subtitleTrackController;return e?e.subtitleTrack:-1}get media(){return this._media}set subtitleTrack(e){const t=this.subtitleTrackController;t&&(t.subtitleTrack=e)}get subtitleDisplay(){const e=this.subtitleTrackController;return e?e.subtitleDisplay:!1}set subtitleDisplay(e){const t=this.subtitleTrackController;t&&(t.subtitleDisplay=e)}get lowLatencyMode(){return this.config.lowLatencyMode}set lowLatencyMode(e){this.config.lowLatencyMode=e}get liveSyncPosition(){return this.latencyController.liveSyncPosition}get latency(){return this.latencyController.latency}get maxLatency(){return this.latencyController.maxLatency}get targetLatency(){return this.latencyController.targetLatency}set targetLatency(e){this.latencyController.targetLatency=e}get drift(){return this.latencyController.drift}get forceStartLoad(){return this.streamController.forceStartLoad}get pathways(){return this.levelController.pathways}get pathwayPriority(){return this.levelController.pathwayPriority}set pathwayPriority(e){this.levelController.pathwayPriority=e}get bufferedToEnd(){var e;return!!((e=this.bufferController)!=null&&e.bufferedToEnd)}get interstitialsManager(){var e;return((e=this.interstitialsController)==null?void 0:e.interstitialsManager)||null}getMediaDecodingInfo(e,t=this.allAudioTracks){const r=ex(t);return JS(e,r,navigator.mediaCapabilities)}}Qn.defaultConfig=void 0;const pF=({url:n,width:e=640,height:t=360})=>{const r=b.useRef(null);return b.useEffect(()=>{if(r.current)if(Qn.isSupported()){const i=new Qn;return i.loadSource(n),i.attachMedia(r.current),i.on(Qn.Events.MANIFEST_PARSED,()=>{var s;(s=r.current)==null||s.play()}),()=>{i.destroy()}}else r.current.canPlayType("application/vnd.apple.mpegurl")&&(r.current.src=n,r.current.addEventListener("loadedmetadata",()=>{var i;(i=r.current)==null||i.play()}))},[n]),L.jsx("video",{ref:r,controls:!0,muted:!0,width:e,height:t,style:{backgroundColor:"black"}})};function yF(){const[n,e]=b.useState("passowrdChange"),r={passowrdChange:L.jsx(Iw,{}),homeChange:L.jsx(pF,{url:`http://127.0.0.1:8083/stream/balkon/channel/0/hls/live/index.m3u8\r
`}),homeCode:L.jsx("div",{children:"Ustawienia2"}),homeLeave:L.jsx("div",{children:"Ustawienia3"})}[n]||null;return L.jsxs("div",{className:Ew.container,children:[L.jsx(Aw,{onChange:e,value:n}),r]})}const vF=new ZR,EF=yR([{path:"/login/",element:L.jsx(M_,{}),action:N_},{path:"/registartion/",element:L.jsx(V_,{}),action:H_},{path:"/",element:L.jsx(WD,{}),children:[{path:"",element:L.jsx(LI,{})},{path:"/router/",element:L.jsx(ew,{})},{path:"room/",element:L.jsx(DC,{})},{path:"room/:id/",element:L.jsx(kC,{})},{path:"room/:id/add/",element:L.jsx(kI,{})},{path:"aquarium/",element:L.jsx(NI,{})},{path:"aquarium/:id/",element:L.jsx(_D,{})},{path:"rfid/:id/",element:L.jsx(zC,{})},{path:"lamp/",element:L.jsx(ZD,{})},{path:"lamp/:id/",element:L.jsx(cC,{})},{path:"button/:id/",element:L.jsx(yw,{})},{path:"device/",element:L.jsx(SC,{})},{path:":deviceFun/:id/event/wizard/",element:L.jsx(fw,{})},{path:"settings/",element:L.jsx(yF,{})}]}]);BE(document.getElementById("root")).render(L.jsx(b.StrictMode,{children:L.jsxs(r_,{client:vF,children:[!1,L.jsx(p_,{children:L.jsx(_R,{router:EF})})]})}));
